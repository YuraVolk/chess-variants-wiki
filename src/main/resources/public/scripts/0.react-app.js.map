{"version":3,"file":"0.react-app.js","mappings":"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AAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KACpwD,CAAC,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KAC5mC,CAAC,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KAChpC,CAAC,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KACxkB,CAAC,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KACp+B,CAAC,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KACjpC,CAAC,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KAC5qC,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,OAC7rD/0B,EA5BQ+0B,EAAQ,cA8BbthC,EAAM,IAAIL,MAAM,KAAKc,SACvBy2B,QACGl3B,IAERuM,EAlCY+0B,EAAQ,QAmCY,CAAC,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAA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","sources":["webpack://spring-react-app/./src/main/client/fonts/chessGlyphIndex.ts","webpack://spring-react-app/./src/main/client/ts/baseTypes.ts","webpack://spring-react-app/./src/main/client/ts/interfaces/Colors.ts","webpack://spring-react-app/./src/main/client/ts/logic/BaseInterfaces.ts","webpack://spring-react-app/./src/main/client/ts/logic/movegen/Board/BoardMoveValidator.ts","webpack://spring-react-app/./src/main/client/ts/logic/movegen/MoveTree/MoveTreeValidator.ts","webpack://spring-react-app/./src/main/client/ts/logic/index/GameBoardWorker.ts","webpack://spring-react-app/./src/main/client/ts/logic/movegen/PieceControl/PieceControlBuilder.ts","webpack://spring-react-app/./src/main/client/ts/logic/movegen/Board/Board.ts","webpack://spring-react-app/./src/main/client/ts/logic/movegen/Board/BoardInterface.ts","webpack://spring-react-app/./src/main/client/ts/logic/movegen/FENData/FENOptions/FENOptions.ts","webpack://spring-react-app/./src/main/client/ts/logic/movegen/FENData/FENData.ts","webpack://spring-react-app/./src/main/client/ts/logic/movegen/FENData/FENDataInterface.ts","webpack://spring-react-app/./src/main/client/ts/logic/movegen/FENData/FENOptions/FENOptionsTags.ts","webpack://spring-react-app/./src/main/client/ts/logic/movegen/FENData/FENOptions/FENOptionsTagsInterface.ts","webpack://spring-react-app/./src/main/client/ts/logic/movegen/GameInformation/GameData.ts","webpack://spring-react-app/./src/main/client/ts/logic/movegen/GameInformation/GameUnits/GameUnits.ts","webpack://spring-react-app/./src/main/client/ts/logic/movegen/GameInformation/GameUnits/PieceString.ts","webpack://spring-react-app/./src/main/client/ts/logic/movegen/MoveTree/MoveNotationStringifier.ts","webpack://spring-react-app/./src/main/client/ts/logic/movegen/MoveTree/MoveTree.ts","webpack://spring-react-app/./src/main/client/ts/logic/movegen/MoveTree/MoveTreeInterface.ts","webpack://spring-react-app/./src/main/client/ts/logic/movegen/PieceControl/PieceControl.ts","webpack://spring-react-app/./src/main/client/ts/logic/movegen/PieceControl/PieceControlDeclarations.ts","webpack://spring-react-app/./src/main/client/ts/logic/movegen/PieceControl/PieceControlInterface.ts","webpack://spring-react-app/./src/main/client/ts/logic/movegen/VariantRules/VariantRule.ts","webpack://spring-react-app/./src/main/client/ts/logic/movegen/VariantRules/VariantRuleDefinitions/BoardDecorators/AllowPassing.ts","webpack://spring-react-app/./src/main/client/ts/logic/movegen/VariantRules/VariantRuleDefinitions/BoardDecorators/AlternativeTeams.ts","webpack://spring-react-app/./src/main/client/ts/logic/movegen/VariantRules/VariantRuleDefinitions/BoardDecorators/BarePieceRule.ts","webpack://spring-react-app/./src/main/client/ts/logic/movegen/VariantRules/VariantRuleDefinitions/BoardDecorators/Blindfold.ts","webpack://spring-react-app/./src/main/client/ts/logic/movegen/VariantRules/VariantRuleDefinitions/BoardDecorators/CaptureTheKing.ts","webpack://spring-react-app/./src/main/client/ts/logic/movegen/VariantRules/VariantRuleDefinitions/BoardDecorators/Chess960.ts","webpack://spring-react-app/./src/main/client/ts/logic/movegen/VariantRules/VariantRuleDefinitions/BoardDecorators/Crazyhouse.ts","webpack://spring-react-app/./src/main/client/ts/logic/movegen/VariantRules/VariantRuleDefinitions/BoardDecorators/DuckChess.ts","webpack://spring-react-app/./src/main/client/ts/logic/movegen/VariantRules/VariantRuleDefinitions/BoardDecorators/FogOfWar.ts","webpack://spring-react-app/./src/main/client/ts/logic/movegen/VariantRules/VariantRuleDefinitions/BoardDecorators/ForcedCapture.ts","webpack://spring-react-app/./src/main/client/ts/logic/movegen/VariantRules/VariantRuleDefinitions/BoardDecorators/GameMetadataRules.ts","webpack://spring-react-app/./src/main/client/ts/logic/movegen/VariantRules/VariantRuleDefinitions/BoardDecorators/Ghostboard.ts","webpack://spring-react-app/./src/main/client/ts/logic/movegen/VariantRules/VariantRuleDefinitions/BoardDecorators/ParadigmChess30.ts","webpack://spring-react-app/./src/main/client/ts/logic/movegen/VariantRules/VariantRuleDefinitions/BoardDecorators/PiecesFaceCenter.ts","webpack://spring-react-app/./src/main/client/ts/logic/movegen/VariantRules/VariantRuleDefinitions/BoardDecorators/SeirawanSetup.ts","webpack://spring-react-app/./src/main/client/ts/logic/movegen/VariantRules/VariantRuleDefinitions/BoardDecorators/SelfCheck.ts","webpack://spring-react-app/./src/main/client/ts/logic/movegen/VariantRules/VariantRuleDefinitions/BoardDecorators/SetupChess.ts","webpack://spring-react-app/./src/main/client/ts/logic/movegen/VariantRules/VariantRuleDefinitions/BoardDecorators/Taboo.ts","webpack://spring-react-app/./src/main/client/ts/logic/movegen/VariantRules/VariantRuleDefinitions/BoardVariantModules/EngineMoveGeneration/Algorithms/ComfuterEvaluation.ts","webpack://spring-react-app/./src/main/client/ts/logic/movegen/VariantRules/VariantRuleDefinitions/BoardVariantModules/EngineMoveGeneration/Algorithms/ComfuterEvaluationExtensions.ts","webpack://spring-react-app/./src/main/client/ts/logic/movegen/VariantRules/VariantRuleDefinitions/BoardVariantModules/EngineMoveGeneration/Algorithms/MixedAlgorithms.ts","webpack://spring-react-app/./src/main/client/ts/logic/movegen/VariantRules/VariantRuleDefinitions/BoardVariantModules/EngineMoveGeneration/Algorithms/RandomEvaluation.ts","webpack://spring-react-app/./src/main/client/ts/logic/movegen/VariantRules/VariantRuleDefinitions/BoardVariantModules/EngineMoveGeneration/Algorithms/RandomEvaluationExtensions.ts","webpack://spring-react-app/./src/main/client/ts/logic/movegen/VariantRules/VariantRuleDefinitions/BoardVariantModules/EngineMoveGeneration/BotInterface.ts","webpack://spring-react-app/./src/main/client/ts/logic/movegen/VariantRules/VariantRuleDefinitions/BoardVariantModules/InsufficientMaterial/InsufficientMaterialChecker.ts","webpack://spring-react-app/./src/main/client/ts/logic/movegen/VariantRules/VariantRuleDefinitions/BoardVariantModules/InsufficientMaterial/InsufficientMaterialConstructor.ts","webpack://spring-react-app/./src/main/client/ts/logic/movegen/VariantRules/VariantRuleDefinitions/BoardVariantModules/InsufficientMaterial/PieceMedianCounter.ts","webpack://spring-react-app/./src/main/client/ts/logic/movegen/VariantRules/VariantRuleDefinitions/BoardVariantModules/InsufficientMaterial/StateSerializer.ts","webpack://spring-react-app/./src/main/client/ts/logic/movegen/VariantRules/VariantRuleDefinitions/BoardVariantModules/InsufficientMaterial/Utilities.ts","webpack://spring-react-app/./src/main/client/ts/logic/movegen/VariantRules/VariantRuleDefinitions/FENDataDecorators/Atomic.ts","webpack://spring-react-app/./src/main/client/ts/logic/movegen/VariantRules/VariantRuleDefinitions/FENDataDecorators/DeadKingWalking.ts","webpack://spring-react-app/./src/main/client/ts/logic/movegen/VariantRules/VariantRuleDefinitions/FENDataDecorators/EnPassant.ts","webpack://spring-react-app/./src/main/client/ts/logic/movegen/VariantRules/VariantRuleDefinitions/FENDataDecorators/FatalCapture.ts","webpack://spring-react-app/./src/main/client/ts/logic/movegen/VariantRules/VariantRuleDefinitions/FENDataDecorators/FiftyMoveRule.ts","webpack://spring-react-app/./src/main/client/ts/logic/movegen/VariantRules/VariantRuleDefinitions/FENDataDecorators/Giveaway.ts","webpack://spring-react-app/./src/main/client/ts/logic/movegen/VariantRules/VariantRuleDefinitions/FENDataDecorators/KingOfTheHill.ts","webpack://spring-react-app/./src/main/client/ts/logic/movegen/VariantRules/VariantRuleDefinitions/FENDataDecorators/NCheck.ts","webpack://spring-react-app/./src/main/client/ts/logic/movegen/VariantRules/VariantRuleDefinitions/FENDataDecorators/OppositeMultiplier.ts","webpack://spring-react-app/./src/main/client/ts/logic/movegen/VariantRules/VariantRuleDefinitions/FENDataDecorators/OppositeSideCastling.ts","webpack://spring-react-app/./src/main/client/ts/logic/movegen/VariantRules/VariantRuleDefinitions/FENDataDecorators/PiecesGoToBanks.ts","webpack://spring-react-app/./src/main/client/ts/logic/movegen/VariantRules/VariantRuleDefinitions/FENDataDecorators/PlayForMate.ts","webpack://spring-react-app/./src/main/client/ts/logic/movegen/VariantRules/VariantRuleDefinitions/FENDataDecorators/PointsForMate.ts","webpack://spring-react-app/./src/main/client/ts/logic/movegen/VariantRules/VariantRuleDefinitions/FENDataDecorators/StalemateOptions.ts","webpack://spring-react-app/./src/main/client/ts/logic/movegen/VariantRules/VariantRuleDefinitions/FENDataDecorators/Takeover.ts","webpack://spring-react-app/./src/main/client/ts/logic/movegen/VariantRules/VariantRuleDefinitions/FENDataDecorators/ThreefoldRepetition.ts","webpack://spring-react-app/./src/main/client/ts/logic/movegen/VariantRules/VariantRuleDefinitions/PieceControlDecorators/AnyCapture.ts","webpack://spring-react-app/./src/main/client/ts/logic/movegen/VariantRules/VariantRuleDefinitions/PieceControlDecorators/PromoteTo.ts","webpack://spring-react-app/./src/main/client/ts/logic/movegen/VariantRules/VariantRuleDefinitions/PieceControlDecorators/PromotionRank.ts","webpack://spring-react-app/./src/main/client/ts/logic/movegen/VariantRules/VariantRuleDefinitions/PieceControlDecorators/RoyalsCannotCapture.ts","webpack://spring-react-app/./src/main/client/ts/logic/movegen/VariantRules/VariantRuleDefinitions/PieceControlDecorators/Sideways.ts","webpack://spring-react-app/./src/main/client/ts/logic/movegen/VariantRules/VariantRuleDefinitions/PieceControlDecorators/Stonewall.ts","webpack://spring-react-app/./src/main/client/ts/logic/movegen/VariantRules/VariantRuleDefinitions/PieceControlDecorators/Torpedo.ts","webpack://spring-react-app/./src/main/client/ts/logic/movegen/VariantRules/VariantRuleInterface.ts","webpack://spring-react-app/./src/main/client/ts/logic/movegen/VariantRules/VariantRuleSetup.ts","webpack://spring-react-app/./src/main/client/ts/logic/utils/Tags/TagLogic/GameMetadataTags.ts","webpack://spring-react-app/./src/main/client/ts/logic/utils/Tags/TagLogic/VariantRulesTag.ts","webpack://spring-react-app/./src/main/client/ts/logic/utils/Tags/TagInterface.ts","webpack://spring-react-app/./src/main/client/ts/logic/utils/Tags/InputOutputProcessing.ts","webpack://spring-react-app/./src/main/client/ts/logic/utils/Tags/Moves/SerializePGNMoves.ts","webpack://spring-react-app/./src/main/client/ts/logic/utils/Tags/Moves/ParsePGNMoves.ts","webpack://spring-react-app/./src/main/client/ts/logic/utils/Tags/TagLogic/FENDataTag.ts","webpack://spring-react-app/./src/main/client/ts/logic/utils/Tags/Utils.ts","webpack://spring-react-app/./src/main/client/ts/utils/ArrayUtils.ts","webpack://spring-react-app/./src/main/client/ts/utils/NumberUtils.ts","webpack://spring-react-app/./src/main/client/ts/utils/ObjectUtils.ts","webpack://spring-react-app/./src/main/client/ts/utils/StringFormatUtils.ts","webpack://spring-react-app/./src/main/client/ts/logic/movegen/VariantRules/VariantRuleDefinitions/ sync \\.ts$"],"sourcesContent":["export const chessGlyphIndex = {\n\tdoubleBackwardArrow: \"!\",\n\tdownloadIcon: '\"',\n\tendBackwardArrow: \"#\",\n\tforwardDoubleArrow: \"α\",\n\tuserSearch: \"$\",\n\tuserConnection: \"%\",\n\tnotAllowed: \"&\",\n\tclock: \"'\",\n\textraInformation: \"(\",\n\tauthorshipNotice: \")\",\n\tdraw: \"+\",\n\tbackwardArrow: \",\",\n\tuserInformation: \"-\",\n\tsmallBackwardArrow: \"/\",\n\tleaderBoard: \";\",\n\tequal: \"=\",\n\tdownwardArrow: \"<\",\n\tupperArrow: \">\",\n\tendForwardArrow: \"@\",\n\turlAttached: \"A\",\n\tcrossMark: \"B\",\n\trightOutwardsArrow: \"C\",\n\thashtag: \"D\",\n\tnewspaper: \"E\",\n\ttwitter: \"F\",\n\tcheckMark: \"G\",\n\tcamera: \"H\",\n\talternativeLine: \"I\",\n\tplay: \"J\",\n\tpause: \"K\",\n\treload: \"L\",\n\tworld: \"M\",\n\tpoints: \"N\",\n\tmedal: \"O\",\n\tsoundOff: \"P\",\n\tcircleCrossMark: \"Q\",\n\tsteadyEvaluation: \"R\",\n\tfacebook: \"S\",\n\tcircle: \"T\",\n\tsoundOn: \"U\",\n\tplus: \"V\",\n\topenEye: \"W\",\n\tcopyToClipboard: \"X\",\n\twavingFlag: \"Y\",\n\teditText: \"Z\",\n\tfullArrowLeft: \"[\",\n\tfullArrowRight: \"]\",\n\tsmallArrowForward: \"\\\\\",\n\tgoBackArrow: \"_\",\n\tyoutube: \"`\",\n\tcalendar: \"a\",\n\tuser: \"b\",\n\tchat: \"c\",\n\tlock: \"d\",\n\tbox: \"e\",\n\tcircularArrows: \"f\",\n\tlightBulb: \"g\",\n\tbriefcase: \"h\",\n\tboard: \"i\",\n\tknightArrows: \"j\",\n\tnewMessage: \"k\",\n\tdrawing: \"l\",\n\ttwoUsers: \"m\",\n\ttwoUsers2: \"n\",\n\topeningBook: \"o\",\n\tdisclaimer: \"p\",\n\tringingBell: \"q\",\n\tlist: \"r\",\n\trookAndPawn: \"s\",\n\thamburgerList: \"t\",\n\tmail: \"u\",\n\tuserExtraInformation: \"v\",\n\thouse: \"w\",\n\tsheetAndPencil: \"x\",\n\topenMail: \"y\",\n\tchatBox: \"z\",\n\tfullArrowDown: \"{\",\n\tsmallArrowUp: \"|\",\n\tfullArrowUp: \"}\",\n\tarrowIntoBox: \"¡\",\n\tkey: \"¢\",\n\tfile: \"£\",\n\tbooks: \"¤\",\n\tsharing: \"¥\",\n\tuserNotAllowed: \"¦\",\n\tuserCrossMark: \"§\",\n\tquestionMark: \"©\",\n\tboardWithCircle: \"«\",\n\tgooglePlus: \"®\",\n\treset: \"°\",\n\treddit: \"±\",\n\topenBook: \"´\",\n\tuserPlus: \"¶\",\n\tcog: \"·\",\n\tpin: \"»\",\n\tsuitcase: \"¼\",\n\tmark: \"½\",\n\tcake: \"¾\",\n\topenLink: \"¿\",\n\tbishopStroke: \"Ä\",\n\tlinkedin: \"Å\",\n\tknight: \"Ç\",\n\tthreeCheck: \"Ë\",\n\tchess960rapid: \"Ñ\",\n\tconnection: \"Õ\",\n\tquotes: \"Ö\",\n\texit: \"×\",\n\tcrossedBinoculars: \"Þ\",\n\tleaderBoardReversed: \"ß\",\n\tbishopFull: \"ä\",\n\tprinter: \"å\",\n\tverticalEvaluation: \"ç\",\n\tt: \"ë\",\n\tpawn: \"í\",\n\ttwoPawns: \"î\",\n\tunrated: \"ð\",\n\telite: \"ñ\",\n\tbug: \"õ\",\n\tcpu: \"ö\",\n\tforwardArrowCircle: \"÷\",\n\tsquareCrossMark: \"ü\",\n\tandroid: \"þ\",\n\ttwoUsersPlus: \"ÿ\",\n\tcrossedArrows: \"Đ\",\n\tking: \"Ā\",\n\tkingFull: \"ā\",\n\tbishop: \"Ă\",\n\ttwoFullRooks: \"ă\",\n\tkingStrokes: \"Ą\",\n\tfullKnight2: \"ą\",\n\tchess960: \"Č\",\n\tleaderBoardAscent: \"č\",\n\tcrazyhouse: \"Ď\",\n\tchecklist: \"ď\",\n\ttarget: \"đ\",\n\tpawnAndHalfRook: \"Ē\",\n\thalfRookAndPawn: \"ē\",\n\tknightStrokes: \"Ė\",\n\tpawnLogo: \"Ę\",\n\tqueenFull: \"ę\",\n\texchange: \"Ě\",\n\tuserNext: \"Ğ\",\n\tuserPrevious: \"Ġ\",\n\tcompass: \"ġ\",\n\tpawnStrokes: \"Ģ\",\n\trookStrokes: \"ģ\",\n\tscreenDisplays: \"Ħ\",\n\tkingOfTheHill: \"Ī\",\n\tantichess: \"ī\",\n\tqueen: \"Į\",\n\tthreePawns: \"į\",\n\tqueenStrokes: \"Ķ\",\n\trookSmallStrokes: \"Ļ\",\n\trookSmall: \"Ľ\",\n\tbishopPair: \"Ł\",\n\trookPair: \"Ņ\",\n\tknightPair: \"Ň\",\n\ttwoUsersSearch: \"Ŋ\",\n\tshield: \"ŋ\",\n\tkingSmall: \"Ō\",\n\tbishopSmall: \"Ő\",\n\tknightSmall: \"Ŗ\",\n\tuserNoConnection: \"Ř\",\n\tuserStream: \"v\",\n\tqueenAlternative: \"Ş\",\n\tpawnAlternative: \"Š\",\n\tthreePawnsAlternative: \"Ţ\",\n\ttwoPawnsAlternative: \"Ť\",\n\trookAlternative: \"Ŧ\",\n\tknightPairFull: \"Ż\",\n\tbishopPairFull: \"Ž\",\n\taddBoard: \"ˆ\",\n\tdiamond: \"Ͱ\",\n\tscales: \"ͱ\",\n\tpawn3d: \"Ͳ\",\n\tuserShieldPlus: \"ͳ\",\n\tgold: \"Ͷ\",\n\tellipsis: \"Ώ\",\n\tanalysis: \"Δ\",\n\tarchive: \"Θ\",\n\tarrowBottomIntoBox: \"Ξ\",\n\tdisclaimerEditor: \"Σ\",\n\tsendTrophy: \"Υ\",\n\taddCheckMark: \"Φ\",\n\tcheckMarkSquare: \"Ψ\",\n\tsquareStaircase: \"ά\",\n\tarrowsUpBottom: \"έ\",\n\tstar: \"ή\",\n\tverticalDash: \"ί\",\n\tshieldCheckMark: \"β\",\n\ttop3: \"ε\",\n\taddImage: \"ζ\",\n\tchessStream: \"η\",\n\tremoveTrophy: \"κ\",\n\timportantMail: \"λ\",\n\tarrowLeave: \"μ\",\n\tdonut: \"ν\",\n\tcomputerAnalysis: \"ξ\",\n\tcheckMarkSquareSmall: \"ο\",\n\tdiagonalExpandArrows: \"π\",\n\tleaderBoardHorizontal: \"ρ\",\n\tcheckMarkAsCircle: \"χ\",\n\tarrowFromBox: \"ϊ\",\n\tboxArrowBottom: \"ό\",\n\tboxArrowLeft: \"ύ\",\n\tboxArrowRight: \"ώ\",\n\tfourArrowsCentral: \"Ϙ\",\n\tclashingSwords: \"τ\",\n\tratingOffset: \"υ\",\n\tsmilingFace: \"ς\",\n\tfileCabinet: \"σ\",\n\teditClock: \"ϙ\",\n\tuserShield: \"Ϛ\",\n\thomeFilled: \"ϛ\",\n\tpaymentCard: \"Ϝ\",\n\tfourArrowsOutwards: \"ϝ\",\n\tpuzzle: \"Ϟ\",\n\taddPhoto: \"ϟ\",\n\tarrowWallLeft: \"Ϡ\",\n\tarrowWallRight: \"ϡ\",\n\tboardConfiguration: \"Ϸ\",\n\tfourBlocks: \"ϸ\",\n\tsandglass: \"Ϻ\",\n\tcrown: \"ϻ\",\n\tcloudUpload: \"Ẹ\",\n\twebChatBox: \"ẹ\",\n\tpuzzleRush: \"Ẻ\",\n\tknightHops: \"ẻ\",\n\tinstagram: \"ἀ\",\n\tsquarePlus: \"ἁ\",\n\tsquareMinus: \"ἂ\",\n\tsquareEqual: \"ἃ\",\n\tsquare: \"ἄ\",\n\tfireFull: \"ἅ\",\n\tpawnRecycle: \"ἆ\",\n\tnoEngine: \"ἇ\",\n\tgoogle: \"Ἀ\",\n\tfourPlayer: \"Ἁ\",\n\tpieceMeal: \"Ἂ\",\n\tarrowBoldUp: \"Ἃ\",\n\tarrowBoldDown: \"Ἄ\",\n\tblunder: \"Ἅ\",\n\tmistake: \"Ἆ\",\n\tvideoChatBox: \"Ἇ\",\n\tbonesCrossed: \"ἐ\",\n\tdisplays: \"ἑ\",\n\tarrowEnter: \"ἒ\",\n\tnewspaperHalf: \"ἓ\",\n\tbookmark: \"ἔ\",\n\tpuzzleLarge: \"ἕ\",\n\tmovePawn: \"Ἐ\",\n\tpawn3dLarge: \"Ἑ\",\n\tsun: \"Ἒ\",\n\trapid: \"Ἓ\",\n\tblitz: \"Ἔ\",\n\tbullet: \"Ἕ\",\n\tmortarboard: \"ἠ\",\n\tlaptop: \"ἡ\",\n\tresetWidth: \"ἢ\",\n\tpawnConnection: \"ἣ\",\n\tcopyToClipboardFromText: \"ἤ\",\n\tfire: \"ἥ\",\n\tcrownSmall: \"ἦ\",\n\torderedList: \"ἧ\",\n\tchess960daily: \"Ἠ\",\n\tarrowWallBottom: \"Ἡ\",\n\tpawn3dBold: \"Ἢ\",\n\tplusInCircle: \"Ἣ\",\n\tlightCorner: \"Ἤ\",\n\tdarkCorner: \"Ἥ\",\n\tsteepCurve: \"Ἦ\",\n\theart: \"Ἧ\",\n\tcheckMarkThin: \"ἰ\",\n\tconnectionDiagonal: \"ἱ\",\n\tdiadem: \"ἲ\",\n\tplusMinus: \"ἳ\",\n\trecycling: \"ἴ\",\n\tmetrics: \"ἵ\",\n\ttop1: \"ἶ\",\n\tengineCheckMark: \"ἷ\",\n\twikipedia: \"Ἰ\",\n\ttournament: \"Ἱ\",\n\thouseConfiguration: \"Ἲ\",\n\tcomputerHindsight: \"Ἳ\",\n\tcomputerCheckMark: \"Ἴ\",\n\tlightDarkTheme: \"Ἵ\",\n\twhistlingBell: \"Ἶ\",\n\tcrossMarkCompact: \"Ἷ\",\n\teyeCrossed: \"ὀ\",\n\tfide: \"ὁ\",\n\tfavorite: \"ὂ\",\n\ttShirtPawn: \"ὃ\",\n\taddSmile: \"ὄ\",\n\tlibrary: \"ὅ\",\n\tdiscord: \"Ὀ\",\n\tanalysisCheckMark: \"Ὁ\",\n\tversusComputer: \"Ὂ\",\n\tdollarSign: \"Ὃ\",\n\tbestMove: \"Ὄ\",\n\tgift: \"Ὅ\",\n\tevaluationLinear: \"ὐ\",\n\tevaluationThrowaway: \"ὑ\",\n\tevaluationEqual: \"ὒ\",\n\tevaluationDead: \"ὓ\",\n\tevaluationSharp: \"ὔ\",\n\tevaluationPerplexing: \"ὕ\",\n\tevaluationSmooth: \"ὖ\",\n\tlibraryAdd: \"ὗ\",\n\tselfPartner: \"Ὑ\",\n\tfourPlayerConfiguration: \"Ὓ\",\n\tlistDownFlow: \"Ὕ\",\n\tpuzzleBattle: \"Ὗ\",\n\thyperbullet: \"ὠ\",\n\tgameLink: \"ὡ\",\n\tgameStudy: \"ὢ\",\n\tevaluationCrazy: \"ὣ\",\n\tengine: \"ὤ\",\n\tcrossedSwordsInCircle: \"ὥ\",\n\thallmark: \"ὦ\",\n\tlike: \"ὧ\",\n\tboardTwoPlayers: \"Ὠ\",\n\tfourPlayerChess: \"Ὡ\",\n\tvariants: \"Ὢ\",\n\tcloudUploadCompact: \"Ὣ\",\n\tclockIncrement: \"Ὤ\",\n\tvideoCamera: \"Ὥ\",\n\tinaccuracy: \"Ὧ\",\n\tbot: \"ὰ\",\n\ttorpedo: \"ά\",\n\tvk: \"ὲ\",\n\tblindfold: \"έ\",\n\tcustomSettings: \"ή\",\n\tcaptureAnything: \"ὶ\",\n\tpawnSideways: \"ί\",\n\tnoCastling: \"ὸ\",\n\tfogOfWar: \"ό\",\n\tautomate: \"ὺ\",\n\tatomic: \"ύ\",\n\tpawnCounterfeit: \"ὼ\",\n\telephant: \"ώ\",\n\tfullBlock: \"ᾀ\",\n\tfourFullBlocks: \"ᾁ\",\n\tnineFullBlocks: \"ᾂ\",\n\tnineFullBlocksCrossed: \"ᾃ\",\n\thamburgerMenuCompact: \"ᾄ\",\n\tlistCompact: \"ᾅ\",\n\tgeoMark: \"ᾆ\",\n\tcrossedDonut: \"ᾇ\",\n\thandshake: \"ᾈ\",\n\tverified: \"ᾉ\",\n\tsandglassRunningOut: \"ᾊ\",\n\trapidLowOnTime: \"ᾋ\",\n\ttourneyBanner: \"ᾌ\",\n\tnoCloud: \"ᾍ\",\n\tfork: \"ᾎ\",\n\tdonutTarget: \"ᾏ\",\n\tnewCalendarDay: \"ᾐ\",\n\tcornerInfiltration: \"ᾑ\",\n\thastTagCompact: \"ᾒ\",\n\tchatterbox: \"ᾓ\",\n\tcircleStar: \"ᾔ\",\n\ttargetPractice: \"ᾕ\",\n\tpawnPromotion: \"ᾖ\",\n\tflagProgression: \"ᾗ\",\n\tpawnDoubleAttack: \"ᾘ\",\n\tkingAndRook: \"ᾙ\",\n\tspecialMedal: \"ᾚ\",\n\tpawnBanner: \"ᾛ\",\n\tuserSquare: \"ᾜ\",\n\tverifiedCandidate: \"ᾝ\",\n\tsaveFile: \"ᾞ\",\n\tduck: \"ᾟ\",\n\taddBanner: \"ᾠ\",\n\tqrCode: \"ᾡ\",\n\tnoAnalysis: \"ᾢ\",\n\tdualPawn: \"ᾣ\",\n\tgameEscape: \"ᾤ\",\n\ttournamentCup: \"ᾥ\",\n\tnoExchanges: \"ᾦ\",\n\ttikTok: \"ᾰ\",\n\tpieChart: \"ᾱ\",\n\tsearch: \"–\",\n\tbinoculars: \"—\",\n\tlargeBoard: \"’\",\n\texclamation: \"†\",\n\ttournamentCupIcon: \"‡\",\n\ttrashBin: \"•\",\n\tarrowForwardBoldCompact: \"…\",\n\tgiftDiamond: \"‹\",\n\tfilter: \"›\",\n\tnoChat: \"⁄\",\n\tnewSheet: \"€\",\n\txml: \"∞\",\n\tblockUser: \"∫\",\n\tfacebookLike: \"≤\",\n\tfacebookDislike: \"≥\",\n\tapple: \"◊\",\n\tphone: \"\"\n} as const;\n","// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport type FunctionType = (...args: any[]) => any;\nexport const verifyFunctionType = (func: unknown): func is FunctionType => typeof func === \"function\";\n\nexport type Length<T extends unknown[]> = T extends { length: infer L } ? L : never;\nexport type Tuple<T, N extends number> = N extends N ? (number extends N ? T[] : _TupleOf<T, N, []>) : never;\ntype _TupleOf<T, N extends number, R extends unknown[]> = R[\"length\"] extends N ? R : _TupleOf<T, N, [T, ...R]>;\n\nexport type Add<A extends number, B extends number> = Length<[...Tuple<unknown, A>, ...Tuple<unknown, B>]>;\nexport const createTuple = <T, L extends number>(val: T, length: L) => Array.from<L, T>({ length }).fill(val);\nexport const createTupleFromCallback = <T, L extends number>(val: (v: unknown, k: number) => T, length: L): Tuple<T, L> =>\n\tArray.from({ length }, val);\nexport const verifyTupleType = <T, L extends number>(arr: T[], length: L): arr is Tuple<T, L> => arr.length === length;\n\nexport type ImplementInterface<T, U> = Pick<T, Exclude<keyof T, keyof U>> & U;\n\nexport function assertNonUndefined<T>(data: T): asserts data is NonNullable<T> {\n\tif (data == null) throw new Error(\"Expected the data above to be anything but null or undefined\");\n}\n\nexport function throwOnNever(arg: never): never {\n\tconsole.dir(arg);\n\tthrow new TypeError(`Unexpected argument that is supposed to be of type never`);\n}\n\nexport function importAll(r: __WebpackModuleApi.RequireContext) {\n\tr.keys().forEach(r);\n}\n\nexport function getEnumKeys<T extends Record<PropertyKey, unknown>>(object: Record<keyof T, unknown>): Array<keyof T> {\n\tconst resultingArray: Array<keyof T> = [];\n\tlet key: keyof T;\n\tfor (key in object) resultingArray.push(key);\n\treturn resultingArray;\n}\n\ntype ArrayKeys<T extends unknown[] | readonly unknown[]> = Exclude<Partial<T>[\"length\"], T[\"length\"]> extends never | undefined\n\t? number\n\t: Exclude<Partial<T>[\"length\"], T[\"length\"]>;\n\ndeclare global {\n\tinterface Array<T> {\n\t\tindexOf(searchElement: T, fromIndex?: number): ArrayKeys<this> | -1;\n\t\tlastIndexOf(searchElement: T, fromIndex?: number): ArrayKeys<this> | -1;\n\t\tevery<S extends T>(predicate: (value: T, index: ArrayKeys<this>, array: T[]) => value is S): this is { [K in keyof this]: S };\n\t\tevery(predicate: (value: T, index: ArrayKeys<this>, array: T[]) => unknown, thisArg?: T[]): boolean;\n\t\tsome(predicate: (value: T, index: ArrayKeys<this>, array: T[]) => unknown, thisArg?: T[]): boolean;\n\t\tforEach(callbackfn: (value: T, index: ArrayKeys<this>, array: T[]) => void, thisArg?: T[]): void;\n\t\tmap<U>(callbackfn: (value: T, index: ArrayKeys<this>, array: T[]) => U): { [K in keyof this]: U };\n\t\tfilter<S extends T>(predicate: (value: T, index: ArrayKeys<this>, array: T[]) => value is S, thisArg?: T[]): S[];\n\t\tfilter(predicate: (value: T, index: ArrayKeys<this>, array: T[]) => unknown, thisArg?: T[]): T[];\n\t\treduce(callbackfn: (previousValue: T, currentValue: T, currentIndex: ArrayKeys<this>, array: T[]) => T): T;\n\t\treduce(callbackfn: (previousValue: T, currentValue: T, currentIndex: ArrayKeys<this>, array: T[]) => T, initialValue: T): T;\n\t\treduce<U>(callbackfn: (previousValue: U, currentValue: T, currentIndex: ArrayKeys<this>, array: T[]) => U, initialValue: U): U;\n\t\treduceRight(callbackfn: (previousValue: T, currentValue: T, currentIndex: ArrayKeys<this>, array: T[]) => T): T;\n\t\treduceRight(callbackfn: (previousValue: T, currentValue: T, currentIndex: ArrayKeys<this>, array: T[]) => T, initialValue: T): T;\n\t\treduceRight<U>(callbackfn: (previousValue: U, currentValue: T, currentIndex: ArrayKeys<this>, array: T[]) => U, initialValue: U): U;\n\t}\n\n\tinterface ReadonlyArray<T> {\n\t\tindexOf(searchElement: T, fromIndex?: number): ArrayKeys<this> | -1;\n\t\tlastIndexOf(searchElement: T, fromIndex?: number): ArrayKeys<this> | -1;\n\t\tevery<S extends T>(\n\t\t\tpredicate: (value: T, index: ArrayKeys<this>, array: readonly T[]) => value is S,\n\t\t\tthisArg?: T[]\n\t\t): this is { readonly [K in keyof this]: S };\n\t\tevery(predicate: (value: T, index: ArrayKeys<this>, array: readonly T[]) => unknown, thisArg?: T[]): boolean;\n\t\tsome(predicate: (value: T, index: ArrayKeys<this>, array: readonly T[]) => unknown, thisArg?: T[]): boolean;\n\t\tforEach(callbackfn: (value: T, index: ArrayKeys<this>, array: readonly T[]) => void, thisArg?: T[]): void;\n\t\tmap<U>(callbackfn: (value: T, index: ArrayKeys<this>, array: readonly T[]) => U, thisArg?: T[]): U[];\n\t\tfilter<S extends T>(predicate: (value: T, index: ArrayKeys<this>, array: readonly T[]) => value is S, thisArg?: T[]): S[];\n\t\tfilter(predicate: (value: T, index: ArrayKeys<this>, array: readonly T[]) => unknown, thisArg?: T[]): T[];\n\t\treduce(callbackfn: (previousValue: T, currentValue: T, currentIndex: ArrayKeys<this>, array: readonly T[]) => T): T;\n\t\treduce(callbackfn: (previousValue: T, currentValue: T, currentIndex: ArrayKeys<this>, array: readonly T[]) => T, initialValue: T): T;\n\t\treduce<U>(callbackfn: (previousValue: U, currentValue: T, currentIndex: ArrayKeys<this>, array: readonly T[]) => U, initialValue: U): U;\n\t\treduceRight(callbackfn: (previousValue: T, currentValue: T, currentIndex: ArrayKeys<this>, array: readonly T[]) => T): T;\n\t\treduceRight(\n\t\t\tcallbackfn: (previousValue: T, currentValue: T, currentIndex: ArrayKeys<this>, array: readonly T[]) => T,\n\t\t\tinitialValue: T\n\t\t): T;\n\t\treduceRight<U>(\n\t\t\tcallbackfn: (previousValue: U, currentValue: T, currentIndex: ArrayKeys<this>, array: readonly T[]) => U,\n\t\t\tinitialValue: U\n\t\t): U;\n\t}\n\n\tinterface ArrayConstructor {\n\t\tfrom<L extends number, T>(arrayLike: { readonly length: L }): Tuple<T, L>;\n\t\tfrom<T, U, L extends number>(iterable: { readonly length: L }, mapfn: (v: T, k: number) => U, thisArg?: T[]): Tuple<U, L>;\n\t}\n}\n","import { throwOnNever, verifyTupleType } from \"../baseTypes\";\n\ndeclare const HexColor: unique symbol;\nexport type HexColor = string & { _: typeof HexColor };\nconst hexColorRegex = /^#(?:[0-9a-fA-F]{3}){1,2}$/;\nexport const createHexColor = (color: string): HexColor => {\n\tif (hexColorRegex.test(color)) {\n\t\treturn color as HexColor;\n\t} else throw new TypeError(\"The supplied hex color is not a hex color: \" + color);\n};\nexport const verifyHexColor = (color: IndexedColor): color is HexColor => typeof color === \"string\";\nexport const validateHexColor = (color: unknown): color is HexColor => {\n\tif (typeof color === \"string\") {\n\t\ttry {\n\t\t\tcreateHexColor(color);\n\t\t\treturn true;\n\t\t} catch {\n\t\t\treturn false;\n\t\t}\n\t} else return false;\n};\n\ndeclare const RGBColor: unique symbol;\nexport type RGBColorValue = number & { _: typeof RGBColor };\nexport const createRGBColor = (color: number): RGBColorValue => {\n\tif (color >= 0 || color <= 255) {\n\t\treturn color as RGBColorValue;\n\t} else throw new TypeError(`The supplied RGB color value is not an RGB color value: ${color}`);\n};\nexport type RGBColor = [RGBColorValue, RGBColorValue, RGBColorValue];\nexport const wrapRGBColor = (color: RGBColor): string => `rgb(${color.join(\",\")})`;\nexport const verifyRGBColor = (color: IndexedColor): color is RGBColor => Array.isArray(color);\nexport const validateRGBColor = (color: unknown): color is RGBColor => {\n\tif (Array.isArray(color) && verifyTupleType(color, 3) && color.every<number>((c): c is number => typeof c === \"number\")) {\n\t\ttry {\n\t\t\tcolor.forEach((c) => createRGBColor(c));\n\t\t\treturn true;\n\t\t} catch {\n\t\t\treturn false;\n\t\t}\n\t} else return false;\n};\n\ndeclare const HSLColor: unique symbol;\nexport interface HSLColor {\n\thue: number;\n\tsaturation: number;\n\tlightness: number;\n\t_: typeof HSLColor;\n}\nexport const createHSLColor = (color: { hue: number; saturation: number; lightness: number }): HSLColor => {\n\tif (\n\t\t(color.hue >= 0 || color.hue <= 359) &&\n\t\t(color.saturation >= 0 || color.saturation <= 100) &&\n\t\t(color.lightness >= 0 || color.lightness <= 100)\n\t) {\n\t\treturn color as HSLColor;\n\t} else throw new TypeError(`The supplied HSL value is not an HSL color: \" + color`);\n};\nexport const wrapHSLColor = (color: HSLColor): string => `hsl(${color.hue},${color.saturation}%,${color.lightness}%)`;\nexport const verifyHSLColor = (color: IndexedColor): color is HSLColor => typeof color === \"object\";\nexport const validateHSLColor = (color: unknown): color is HSLColor => {\n\tconst verifyNumberRecord = <K extends PropertyKey>(obj: Record<K, unknown>): obj is Record<K, number> => {\n\t\tfor (const key in obj) {\n\t\t\tif (!Object.prototype.hasOwnProperty.call(obj, key)) continue;\n\t\t\tif (typeof obj[key] !== \"number\") return false;\n\t\t}\n\n\t\treturn true;\n\t};\n\n\tif (typeof color === \"object\" && color && \"hue\" in color && \"saturation\" in color && \"lightness\" in color && verifyNumberRecord(color)) {\n\t\ttry {\n\t\t\tcreateHSLColor(color);\n\t\t\treturn true;\n\t\t} catch {\n\t\t\treturn false;\n\t\t}\n\t} else return false;\n};\n\nexport type IndexedColor = HexColor | RGBColor | HSLColor;\nexport const wrapIndexedColor = (color: IndexedColor): string => {\n\tif (verifyHexColor(color)) {\n\t\treturn color;\n\t} else if (verifyRGBColor(color)) {\n\t\treturn wrapRGBColor(color);\n\t} else if (verifyHSLColor(color)) {\n\t\treturn wrapHSLColor(color);\n\t} else {\n\t\treturn throwOnNever(color);\n\t}\n};\nexport const validateIndexedColor = (color: unknown): color is IndexedColor => {\n\treturn validateHexColor(color) || validateRGBColor(color) || validateHSLColor(color);\n};\n","import { NumericColor } from \"@moveGeneration/GameInformation/GameUnits/GameUnits\";\nimport { createTupleFromCallback, Tuple } from \"../baseTypes\";\nimport { boardDimension } from \"./movegen/GameInformation/GameData\";\n\nexport interface Cloneable<T> {\n\tcreateClone(): T;\n}\n\nexport interface Memento<S> {\n\tcreateSnapshot(): S;\n\tloadSnapshot(snapshot: S): void;\n}\n\nexport type BoardSquares<T> = Tuple<Tuple<T, typeof boardDimension>, typeof boardDimension>;\nexport const initializeBoardSquares = <T>(baseValue: (v: unknown, k: number) => T): BoardSquares<T> =>\n\tcreateTupleFromCallback(() => createTupleFromCallback(baseValue, boardDimension), boardDimension);\n\nexport const isVerticalPlacement = (color: NumericColor): color is 0 | 2 => color % 2 === 0;\nexport function getVerticalPlacementModulus(num: number): 0 | 1 {\n\tconst result = num % 2;\n\tif (result !== 0 && result !== 1) throw new Error(`Invalid number passed: ${num}`);\n\treturn result;\n}\nexport function getHorizontalPlacementModulus(num: number): 0 | 1 {\n\tconst result = num % 2 ^ 1;\n\tif (result !== 0 && result !== 1) throw new Error(`Invalid number passed: ${num}`);\n\treturn result;\n}\n","import {\n\tcompareMoves,\n\tMove,\n\tMoveComponent,\n\tSpecialMove,\n\tverifyDroppingMove,\n\tverifyInternalMove,\n\tverifyStandardMove\n} from \"../MoveTree/MoveTreeInterface\";\nimport type { Board } from \"./Board\";\n\nexport interface SpecialMoveSettings {\n\thasEnPassant: boolean;\n}\n\nexport function validateBoardMove(board: Board, move: Move): SpecialMoveSettings | false {\n\tlet startingMoves: MoveComponent[];\n\tconst firstMove = move[0];\n\tif (verifyStandardMove(firstMove)) {\n\t\tstartingMoves = board.getLegalMoves(firstMove.startCoordinates[0], firstMove.startCoordinates[1]);\n\t} else if (verifyDroppingMove(firstMove)) {\n\t\tstartingMoves = board.getDroppingMoves(firstMove.piece);\n\t} else if (verifyInternalMove(firstMove)) {\n\t\tstartingMoves = board.getAllowedInternalMoves();\n\t} else throw new Error(`Unexpected move signature encountered: ${JSON.stringify(move)}`);\n\n\tconst specialMoveSettings: SpecialMoveSettings = {\n\t\thasEnPassant: false\n\t};\n\tif (board.variantData.duckChess && move.length === 1) return false;\n\tfor (const moveComponent of move) {\n\t\tconst move = startingMoves.find((legalMove) => compareMoves(legalMove, moveComponent));\n\t\tif (!move) return false;\n\t\tif (verifyStandardMove(move) && move.specialType === SpecialMove.EnPassant) {\n\t\t\tspecialMoveSettings.hasEnPassant = true;\n\t\t}\n\n\t\tif (move.nextChainedMoves) {\n\t\t\tstartingMoves = move.nextChainedMoves;\n\t\t}\n\t}\n\n\treturn specialMoveSettings;\n}\n","import { assertNonUndefined, createTuple } from \"@client/ts/baseTypes\";\nimport { findLastIndex } from \"@utils/ArrayUtils\";\nimport type { Board } from \"../Board/Board\";\nimport { SpecialMoveSettings, validateBoardMove } from \"../Board/BoardMoveValidator\";\nimport { colors, getPlayerNameFromColor, totalPlayers, VariantType } from \"../GameInformation/GameData\";\nimport { createPieceFromData } from \"../GameInformation/GameUnits/PieceString\";\nimport { assertValidMove, createMoveTree, MoveTreeInterface, verifyValidMove } from \"./MoveTree\";\nimport { createBaseMoveWrapper, MoveWrapper, SpecialMove, verifyStandardMove } from \"./MoveTreeInterface\";\n\nexport function validateMoveTree(board: Board, moves: MoveTreeInterface): MoveTreeInterface {\n\tconst clonedBoard = board.createClone();\n\tclonedBoard.moves = createMoveTree(clonedBoard.createSnapshot());\n\tclonedBoard.pregenerateAttacks();\n\n\tconst dimension = Math.max(...clonedBoard.data.fenOptions.tag(\"dim\"));\n\tfunction traverse(\n\t\tcurrent: MoveWrapper[],\n\t\tcurrentFullMove = 0,\n\t\tcurrentTimeOnClocks = createTuple(board.gameData.timeControl.baseTime, totalPlayers)\n\t): MoveWrapper[] {\n\t\tconst moves: MoveWrapper[] = [];\n\n\t\tlet previousSideToMove = -1;\n\t\tfor (let i = 0; i < current.length; i++) {\n\t\t\tconst moveWrapper = current[i];\n\n\t\t\tconst { moveData, path, alternativeLines } = moveWrapper;\n\t\t\tconst newMoveWrapper = createBaseMoveWrapper(\n\t\t\t\t{ moveData, path: path.slice() },\n\t\t\t\t{\n\t\t\t\t\tcomment: moveWrapper.comment\n\t\t\t\t}\n\t\t\t);\n\t\t\tlet validationResult: SpecialMoveSettings | undefined;\n\t\t\ttry {\n\t\t\t\tif ((validationResult = validateBoardMove(clonedBoard, moveData) || undefined)) {\n\t\t\t\t\tnewMoveWrapper.moveData = moveData;\n\t\t\t\t} else break;\n\t\t\t} catch {\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tlet firstStandardMoveSet = false;\n\t\t\tfor (const moveComponent of moveData) {\n\t\t\t\tif (verifyStandardMove(moveComponent)) {\n\t\t\t\t\tif (moveComponent.promotion) {\n\t\t\t\t\t\tmoveComponent.promotion = moveComponent.promotion.map((p) => {\n\t\t\t\t\t\t\tif (p.isWall()) return p;\n\t\t\t\t\t\t\treturn createPieceFromData(clonedBoard.data.sideToMove, p.piece);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!firstStandardMoveSet) {\n\t\t\t\t\t\tnewMoveWrapper.metadata.movingPiece =\n\t\t\t\t\t\t\tclonedBoard.board[moveComponent.startCoordinates[0]][moveComponent.startCoordinates[1]];\n\t\t\t\t\t\tfirstStandardMoveSet = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (validationResult.hasEnPassant) {\n\t\t\t\t\t\tmoveComponent.specialType = SpecialMove.EnPassant;\n\t\t\t\t\t\tvalidationResult.hasEnPassant = false;\n\t\t\t\t\t\tnewMoveWrapper.metadata.isCapture = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (clonedBoard.data.getCapturedPieces(moveComponent).length > 0) newMoveWrapper.metadata.isCapture = true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (i === 0 || findLastIndex(clonedBoard.data.fenOptions.tag(\"dead\"), (b) => !b) === previousSideToMove) {\n\t\t\t\tnewMoveWrapper.metadata.currentFullMove = ++currentFullMove;\n\t\t\t}\n\t\t\tnewMoveWrapper.metadata.currentSideToMove = previousSideToMove = clonedBoard.data.sideToMove;\n\t\t\tconst results = clonedBoard.makeMove(moveData);\n\t\t\tfor (let i = 0; i < totalPlayers; i++) {\n\t\t\t\tif (results.checkmates[i]) {\n\t\t\t\t\tnewMoveWrapper.metadata.checkmates++;\n\t\t\t\t} else if (results.checks[i]) {\n\t\t\t\t\tnewMoveWrapper.metadata.checks++;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor (const line of alternativeLines) {\n\t\t\t\tnewMoveWrapper.alternativeLines.push(traverse(line, currentFullMove, [...currentTimeOnClocks]));\n\t\t\t}\n\n\t\t\tif (moveWrapper.metadata.playerClock) {\n\t\t\t\tcurrentTimeOnClocks[previousSideToMove] -= moveWrapper.metadata.playerClock;\n\t\t\t}\n\t\t\tnewMoveWrapper.metadata = { ...moveWrapper.metadata };\n\t\t\tnewMoveWrapper.metadata.playerClock = currentTimeOnClocks[previousSideToMove];\n\t\t\tconst currentMove = clonedBoard.moves.getMove(newMoveWrapper.path);\n\t\t\tassertValidMove(currentMove);\n\t\t\tcurrentMove.metadata = newMoveWrapper.metadata;\n\t\t\tcurrentMove.comment = moveWrapper.comment;\n\t\t\tclonedBoard.moves.stringifyMove(currentMove, dimension);\n\t\t}\n\n\t\treturn moves;\n\t}\n\n\ttraverse(moves.moves);\n\treturn clonedBoard.moves;\n}\n\nexport function changeGameTermination(board: Board) {\n\tconst currentMove = board.moves.getMove([board.moves.moves.length - 1]);\n\tconst snapshot = board.moves.getBoardSnapshot(verifyValidMove(currentMove) ? currentMove : -1);\n\tassertNonUndefined(snapshot);\n\n\tif (snapshot.boardSnapshot.data.gameOver) {\n\t\tboard.gameData.termination = snapshot.boardSnapshot.data.gameOver;\n\t\tif (board.gameData.result) return;\n\t\tif (board.isTwoPlayer || board.gameType.type === VariantType.Teams) {\n\t\t\tconst currentSnapshot = board.createSnapshot();\n\t\t\tboard.loadSnapshot(snapshot.boardSnapshot);\n\t\t\tboard.gameData.result = board.data.getCurrentResult();\n\t\t\tboard.loadSnapshot(currentSnapshot);\n\t\t} else {\n\t\t\tconst currentResults: string[] = [];\n\t\t\tconst dead = board.data.fenOptions.tag(\"dead\"),\n\t\t\t\tresigned = board.data.fenOptions.tag(\"resigned\"),\n\t\t\t\twb = board.data.fenOptions.tag(\"wb\"),\n\t\t\t\tpoints = snapshot.boardSnapshot.data.points;\n\t\t\tfor (const color of colors) {\n\t\t\t\tif (dead[color] || resigned[color]) continue;\n\t\t\t\tcurrentResults.push(`${getPlayerNameFromColor(color, wb)}: ${points[color]}`);\n\t\t\t}\n\t\t\tboard.gameData.result = currentResults.join(\" – \");\n\t\t}\n\t}\n}\n","import \"reflect-metadata\";\nimport { Board } from \"@moveGeneration/Board/Board\";\nimport { totalPlayers } from \"@moveGeneration/GameInformation/GameData\";\nimport type { PieceStringObject } from \"@moveGeneration/GameInformation/GameUnits/PieceString\";\nimport { PieceString } from \"@moveGeneration/GameInformation/GameUnits/PieceString\";\nimport type { InternalMove, StripPieceStringObjects } from \"@moveGeneration/MoveTree/MoveTreeInterface\";\nimport {\n\tMoveWrapper,\n\tProcessSafeMoveWrapper,\n\tMove,\n\tMoveData,\n\tverifyStandardMove,\n\tMoveComponent,\n\tverifyDroppingMove,\n\tMoveTreeSnapshot,\n\tverifyRequiredMove\n} from \"@moveGeneration/MoveTree/MoveTreeInterface\";\nimport { decorateClassWithVariants, VariantRulePublicProperties } from \"@moveGeneration/VariantRules/VariantRule\";\nimport type { VariantDataRules } from \"@moveGeneration/VariantRules/VariantRuleInterface\";\nimport { compareArrays } from \"@utils/ArrayUtils\";\nimport type { NumericColor } from \"@moveGeneration/GameInformation/GameUnits/GameUnits\";\nimport { serializeBoard } from \"../utils/Tags/InputOutputProcessing\";\nimport { assertNonUndefined, createTuple, FunctionType, Tuple } from \"@client/ts/baseTypes\";\nimport type { GameBoardObjectSetProperties } from \"./GameBoardSlice\";\nimport { stringifyCoordinate } from \"@moveGeneration/Board/BoardInterface\";\nimport { changeGameTermination, validateMoveTree } from \"@moveGeneration/MoveTree/MoveTreeValidator\";\nimport { assertValidMove } from \"@moveGeneration/MoveTree/MoveTree\";\nimport { InsufficientMaterialConstructor } from \"@moveGeneration/VariantRules/VariantRuleDefinitions/BoardVariantModules/InsufficientMaterial/InsufficientMaterialConstructor\";\nimport { InsufficientMaterialChecker } from \"@moveGeneration/VariantRules/VariantRuleDefinitions/BoardVariantModules/InsufficientMaterial/InsufficientMaterialChecker\";\nimport * as StateSerializer from \"@moveGeneration/VariantRules/VariantRuleDefinitions/BoardVariantModules/InsufficientMaterial/StateSerializer\";\nimport { deserializeInsufficientMaterialState } from \"@moveGeneration/VariantRules/VariantRuleDefinitions/BoardVariantModules/InsufficientMaterial/StateSerializer\";\n\nexport const requiredDispatches: Array<keyof RequestManager> = [];\nexport const initialDispatches: Array<keyof RequestManager> = [];\nexport const dispatchSyncRecord: Partial<Record<keyof RequestManager, keyof GameBoardObjectSetProperties>> = {};\n\nfunction withWorkerResult() {\n\treturn function (_: RequestManager, propertyKey: string, descriptor: TypedPropertyDescriptor<FunctionType>) {\n\t\tconst originalMethod = descriptor.value;\n\t\tassertNonUndefined(originalMethod);\n\t\tdescriptor.value = function (...args: unknown[]) {\n\t\t\tpostMessage([propertyKey, originalMethod.apply(this, args)]);\n\t\t};\n\t};\n}\n\nfunction workerDataSync(type: \"required\" | \"initial\", gameObjectPropertySync: keyof GameBoardObjectSetProperties) {\n\treturn function (_: RequestManager, propertyKey: keyof RequestManager) {\n\t\tif (type === \"required\") {\n\t\t\tinitialDispatches.push(propertyKey);\n\t\t\trequiredDispatches.push(propertyKey);\n\t\t} else {\n\t\t\tinitialDispatches.push(propertyKey);\n\t\t}\n\t\tdispatchSyncRecord[propertyKey] = gameObjectPropertySync;\n\t};\n}\n\nclass RequestManager {\n\tprivate board!: Board;\n\tprivate initiallyAliveColors: NumericColor[] = [];\n\tprivate internalMoves: InternalMove[] = [];\n\tprivate legalMoves = new Map<string, MoveData[]>();\n\tprivate fogOfWarPerspective: NumericColor | false = false;\n\n\tprivate stripPieceStrings<T>(object: T): StripPieceStringObjects<T> {\n\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-return\n\t\treturn JSON.parse(JSON.stringify(object));\n\t}\n\n\tprivate generateInitiallyAliveColors() {\n\t\treturn this.board.data.fenOptions\n\t\t\t.tag(\"dead\")\n\t\t\t.map((d) => !d)\n\t\t\t.reduce<NumericColor[]>((p, n, i) => {\n\t\t\t\tif (n) {\n\t\t\t\t\treturn [...p, i];\n\t\t\t\t} else return p;\n\t\t\t}, []);\n\t}\n\n\tprivate generateCurrentMoves() {\n\t\t(this.internalMoves = this.board.getAllowedInternalMoves()), (this.legalMoves = new Map());\n\t\tfor (const piece of this.board.getPlayerPieces()[this.board.data.sideToMove]) {\n\t\t\tthis.legalMoves.set(stringifyCoordinate(piece), this.board.getLegalMoves(piece[0], piece[1]));\n\t\t}\n\t}\n\n\tconstruct(_variantName: string, pgn4: string) {\n\t\tthis.board = new Board(pgn4);\n\t\tthis.board = decorateClassWithVariants(this.board, Board, this.board.variantRules.boardDecorators);\n\t\tthis.generateInitiallyAliveColors();\n\n\t\tconst insufficientMaterialModule = new InsufficientMaterialConstructor(this.board, (state) => {\n\t\t\tthis.board.insufficientMaterialChecker = new InsufficientMaterialChecker(state, this.board);\n\t\t\tthis.board.moves = validateMoveTree(this.board, this.board.moves);\n\t\t\tthis.board.moves.currentMove = [-1];\n\t\t\tchangeGameTermination(this.board);\n\t\t\tthis.generateCurrentMoves();\n\n\t\t\tpostMessage([\"construct\", StateSerializer.serializeInsufficientMaterialState(state)]);\n\t\t});\n\t\tinsufficientMaterialModule.generateInsufficientMaterialState();\n\t\treturn StateSerializer.serializeInsufficientMaterialState(insufficientMaterialModule.state);\n\t}\n\n\t@withWorkerResult()\n\tconstructWithGeneratedData(pgn4: string, insufficientMaterialState: StateSerializer.SerializedInsufficientMaterialState) {\n\t\tthis.board = new Board(pgn4);\n\t\tthis.board = decorateClassWithVariants(this.board, Board, this.board.variantRules.boardDecorators);\n\t\tthis.generateInitiallyAliveColors();\n\n\t\tthis.board.insufficientMaterialChecker = new InsufficientMaterialChecker(\n\t\t\tdeserializeInsufficientMaterialState(insufficientMaterialState),\n\t\t\tthis.board\n\t\t);\n\t\tthis.board.moves = validateMoveTree(this.board, this.board.moves);\n\t\tthis.board.moves.currentMove = [-1];\n\t\tchangeGameTermination(this.board);\n\t\tthis.generateCurrentMoves();\n\t}\n\n\t@workerDataSync(\"required\", \"publicFENSettings\")\n\t@withWorkerResult()\n\tgetFENSettings() {\n\t\tconst board = this.board;\n\t\tconst royalCount = createTuple(0, totalPlayers);\n\t\tlet isCustomRoyals = false;\n\t\tfor (const row of this.board.board) {\n\t\t\tfor (const square of row) {\n\t\t\t\tif (square.isPiece() && square.piece === \"K\" && ++royalCount[square.color] > 1) {\n\t\t\t\t\tisCustomRoyals = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (isCustomRoyals) break;\n\t\t}\n\n\t\tconst points: Tuple<number, typeof totalPlayers> = [...board.data.points];\n\t\treturn {\n\t\t\tsideToMove: board.data.sideToMove,\n\t\t\tpoints,\n\t\t\tisCustomRoyals,\n\t\t\tfenOptions: board.data.fenOptions.createSerializedState()\n\t\t};\n\t}\n\n\t@workerDataSync(\"initial\", \"initiallyAliveColors\")\n\t@withWorkerResult()\n\tgetInitiallyAliveColors() {\n\t\treturn this.initiallyAliveColors;\n\t}\n\n\t@workerDataSync(\"required\", \"moveTree\")\n\t@withWorkerResult()\n\tgetMoveTree() {\n\t\tconst traverse = (moves: MoveWrapper[], fullMoveCounter = 0): ProcessSafeMoveWrapper[] => {\n\t\t\tconst results: ProcessSafeMoveWrapper[] = [];\n\n\t\t\tfor (const moveWrapper of moves) {\n\t\t\t\tconst resultingWrapper: ProcessSafeMoveWrapper = {\n\t\t\t\t\talternativeLines: [],\n\t\t\t\t\tcomment: moveWrapper.comment,\n\t\t\t\t\tpath: moveWrapper.path.slice(),\n\t\t\t\t\tcachedNames: { ...moveWrapper.cachedNames },\n\t\t\t\t\tmetadata: {\n\t\t\t\t\t\tcurrentSideToMove: moveWrapper.metadata.currentSideToMove,\n\t\t\t\t\t\tplayerClock: moveWrapper.metadata.playerClock,\n\t\t\t\t\t\thighlightedArrows: moveWrapper.metadata.highlightedArrows,\n\t\t\t\t\t\thighlightedSquares: moveWrapper.metadata.highlightedSquares\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tif (moveWrapper.metadata.currentFullMove) resultingWrapper.metadata.currentFullMove = moveWrapper.metadata.currentFullMove;\n\n\t\t\t\tfor (const alternativeLine of moveWrapper.alternativeLines) {\n\t\t\t\t\tresultingWrapper.alternativeLines.push(traverse(alternativeLine, fullMoveCounter - 1));\n\t\t\t\t}\n\n\t\t\t\tresults.push(resultingWrapper);\n\t\t\t}\n\n\t\t\treturn results;\n\t\t};\n\n\t\treturn traverse(this.board.moves.moves);\n\t}\n\n\t@withWorkerResult()\n\tloadSnapshotByPath(path: number[]) {\n\t\tlet snapshot: MoveTreeSnapshot;\n\t\tif (compareArrays(path, [-1])) {\n\t\t\tconst preliminarySnapshot = this.board.moves.getBoardSnapshot(-1);\n\t\t\tassertNonUndefined(preliminarySnapshot);\n\t\t\tsnapshot = preliminarySnapshot;\n\t\t} else {\n\t\t\tconst currentMove = this.board.moves.getMove(path);\n\t\t\tassertValidMove(currentMove);\n\t\t\tconst preliminarySnapshot = this.board.moves.getBoardSnapshot(currentMove);\n\t\t\tif (!preliminarySnapshot) return false;\n\t\t\tsnapshot = preliminarySnapshot;\n\t\t}\n\n\t\tthis.board.loadSnapshot(snapshot.boardSnapshot);\n\t\tthis.board.moves.currentMove = [...path];\n\t\tthis.generateCurrentMoves();\n\n\t\treturn true;\n\t}\n\n\tprivate verifyNextChainedMovesAreDeleted(\n\t\tmove: Partial<StripPieceStringObjects<MoveComponent>>\n\t): move is StripPieceStringObjects<MoveComponent> & { nextChainedMoves: never } {\n\t\treturn !(\"nextChainedMoves\" in move);\n\t}\n\n\tprivate convertStrippedMoveToNormal(move: StripPieceStringObjects<Move>): Move {\n\t\tconst newMove: MoveComponent[] = [];\n\t\tfor (const moveComponent of move) {\n\t\t\tdelete moveComponent.nextChainedMoves;\n\t\t\tif (!this.verifyNextChainedMovesAreDeleted(moveComponent)) throw new Error(\"Could not delete nextChainedMoves in move component\");\n\n\t\t\tif (verifyStandardMove(moveComponent)) {\n\t\t\t\tnewMove.push({ ...moveComponent, promotion: moveComponent.promotion?.map((p) => PieceString.fromObjectToClass(p)) });\n\t\t\t} else if (verifyDroppingMove(moveComponent)) {\n\t\t\t\tnewMove.push({ ...moveComponent, piece: PieceString.fromObjectToClass(moveComponent.piece) });\n\t\t\t} else newMove.push(moveComponent);\n\t\t}\n\n\t\tif (!verifyRequiredMove(newMove)) throw new Error(\"Supplied move object had 0 move components\");\n\t\treturn newMove;\n\t}\n\n\t@withWorkerResult()\n\tmakeMove(passedMove: StripPieceStringObjects<Move>) {\n\t\tconst board = this.board,\n\t\t\tmove = this.convertStrippedMoveToNormal(passedMove);\n\t\tboard.moves.augmentMoveWithMetadata({\n\t\t\tmove,\n\t\t\tboard,\n\t\t\tmakeMoveFunction: () => {\n\t\t\t\treturn board.makeMove(move);\n\t\t\t}\n\t\t});\n\n\t\tthis.generateCurrentMoves();\n\t}\n\n\t@workerDataSync(\"required\", \"serializedPGN\")\n\t@withWorkerResult()\n\tserializeBoardToPGN() {\n\t\treturn serializeBoard(this.board);\n\t}\n\n\t@withWorkerResult()\n\tgetDroppingMoves(pieceString: PieceStringObject) {\n\t\tif (this.board.data.gameOver) return [];\n\t\treturn this.stripPieceStrings(this.board.getDroppingMoves(PieceString.fromObjectToClass(pieceString)));\n\t}\n\n\t@withWorkerResult()\n\tgetLegalMoves(i: number, j: number) {\n\t\tif (this.board.data.gameOver) return [];\n\t\treturn this.stripPieceStrings(this.legalMoves.get(stringifyCoordinate([i, j])) ?? this.board.getLegalMoves(i, j));\n\t}\n\n\t@workerDataSync(\"required\", \"allowedInternalMoves\")\n\t@withWorkerResult()\n\tgetInternalMoves() {\n\t\tif (this.board.data.gameOver) return [];\n\t\treturn this.stripPieceStrings(this.internalMoves);\n\t}\n\n\t@workerDataSync(\"initial\", \"variantDataRules\")\n\t@withWorkerResult()\n\tgetVariantData() {\n\t\treturn this.stripPieceStrings(this.board.variantData);\n\t}\n\n\t@workerDataSync(\"required\", \"boardSquares\")\n\t@withWorkerResult()\n\tgetBoard() {\n\t\treturn this.board.board.map((r) => r.map((p) => p.toObject()));\n\t}\n\n\t@workerDataSync(\"required\", \"gameData\")\n\t@withWorkerResult()\n\tgetGameData() {\n\t\tconst newGameData = { ...this.board.gameData };\n\t\tif (typeof newGameData.date === \"object\") {\n\t\t\tnewGameData.date = newGameData.date.toUTCString();\n\t\t}\n\t\treturn newGameData;\n\t}\n\n\t@workerDataSync(\"required\", \"currentMove\")\n\t@withWorkerResult()\n\tgetCurrentMove() {\n\t\treturn this.board.moves.currentMove;\n\t}\n\n\t@workerDataSync(\"initial\", \"variantRules\")\n\t@withWorkerResult()\n\tgetVariantRules() {\n\t\tconst resultingRules: Array<VariantRulePublicProperties<keyof VariantDataRules>> = [];\n\t\tfor (const variantRule of this.board.variantRules) {\n\t\t\tresultingRules.push(variantRule.getPublicProperties());\n\t\t}\n\n\t\treturn resultingRules;\n\t}\n\n\t@workerDataSync(\"initial\", \"variantType\")\n\t@withWorkerResult()\n\tgetVariantType() {\n\t\treturn this.board.gameType.type;\n\t}\n\n\t@withWorkerResult()\n\tdeleteMove(path: number[]) {\n\t\tif (this.board.moves.moves.length !== 0) this.board.moves.deleteMove(path);\n\t}\n\n\t@withWorkerResult()\n\tplayPreferredBotMove() {\n\t\tif (this.board.data.getRealPlayers() <= 1) return;\n\t\tconst legalMoves: MoveComponent[] = [];\n\t\tfor (const piece of this.board.getPlayerPieces()[this.board.data.sideToMove]) {\n\t\t\tlegalMoves.push(...(this.legalMoves.get(stringifyCoordinate(piece)) ?? this.board.getLegalMoves(piece[0], piece[1])));\n\t\t}\n\t\t// TODO Pick strongest piece\n\t\tlegalMoves.push(...this.board.preGeneratedAttacks[this.board.data.sideToMove].pieceDrops.piece);\n\t\tlegalMoves.push(...this.board.preGeneratedAttacks[this.board.data.sideToMove].pieceDrops.pawn);\n\t\tlegalMoves.push(...this.internalMoves);\n\n\t\tconst algorithm = this.board.data.fenOptions.getDefaultZombieAlgorithm(this.board.data.sideToMove);\n\t\tconst moves = algorithm.evaluate(legalMoves, this.board);\n\t\treturn this.stripPieceStrings(algorithm.pickPreferredMove(moves));\n\t}\n\n\t@withWorkerResult()\n\tchangeFogPerspective() {\n\t\tif (!this.board.variantData.fogOfWar || this.board.data.getRealPlayers() <= 1) return this.fogOfWarPerspective;\n\t\tif (this.fogOfWarPerspective === false) {\n\t\t\tthis.fogOfWarPerspective = this.board.data.sideToMove;\n\t\t} else {\n\t\t\tconst newPerspective = this.board.data.nextTurn(this.fogOfWarPerspective);\n\t\t\tif (newPerspective === this.board.data.sideToMove) {\n\t\t\t\tthis.fogOfWarPerspective = false;\n\t\t\t} else this.fogOfWarPerspective = newPerspective;\n\t\t}\n\n\t\treturn this.fogOfWarPerspective;\n\t}\n\n\t@workerDataSync(\"required\", \"squareVisibility\")\n\t@withWorkerResult()\n\tgetSquareVisibility() {\n\t\tif (this.fogOfWarPerspective === false) {\n\t\t\treturn this.board.getSquareVisibility();\n\t\t} else {\n\t\t\tconst sideToMove = this.board.data.sideToMove;\n\t\t\tthis.board.data.sideToMove = this.fogOfWarPerspective;\n\t\t\tconst squareVisibility = this.board.getSquareVisibility();\n\t\t\tthis.board.data.sideToMove = sideToMove;\n\t\t\treturn squareVisibility;\n\t\t}\n\t}\n}\n\nexport type BoardWorkerRequest = keyof RequestManager;\nexport interface BoardWorkerRequestBody<K extends BoardWorkerRequest> {\n\trequestName: K;\n\tparameters: BoardWorkerArguments<K>;\n}\nexport type PublicFENSettings = ReturnType<RequestManager[\"getFENSettings\"]>;\nexport type BoardWorkerReturnType<K extends BoardWorkerRequest> = [K, ReturnType<RequestManager[K]>];\nexport type BoardWorkerArguments<K extends BoardWorkerRequest> = Parameters<RequestManager[K]>;\n\nconst requestManager = new RequestManager();\nself.onmessage = <K extends BoardWorkerRequest>(e: MessageEvent<BoardWorkerRequestBody<K>>) => {\n\tif (!(e.data.requestName in RequestManager.prototype)) return;\n\tconst method: FunctionType = RequestManager.prototype[e.data.requestName];\n\tmethod.apply(requestManager, e.data.parameters);\n};\n","import { createTuple } from \"@client/ts/baseTypes\";\nimport type { PlayerBooleanTuple } from \"@moveGeneration/Board/Board\";\nimport { totalPlayers } from \"@moveGeneration/GameInformation/GameData\";\nimport type { NumericColor } from \"@moveGeneration/GameInformation/GameUnits/GameUnits\";\nimport { initializeBoardSquares } from \"../../BaseInterfaces\";\nimport type { FENData } from \"../FENData/FENData\";\nimport { emptyPieceString, PieceString } from \"../GameInformation/GameUnits/PieceString\";\nimport { decorateClassWithVariants, VariantRule } from \"../VariantRules/VariantRule\";\nimport type { VariantDataRules } from \"../VariantRules/VariantRuleInterface\";\nimport { copyVariantRules } from \"../VariantRules/VariantRuleSetup\";\nimport { PieceControl } from \"./PieceControl\";\nimport { PieceLetter, pieceControlConfigSettings, ControlConfiguration } from \"./PieceControlInterface\";\n\nexport class PieceControlConfigurator {\n\tprivate readonly _control: PieceControl;\n\tprivate readonly _isConfigured: ControlConfiguration;\n\tconstructor(control: PieceControl) {\n\t\tthis._control = control;\n\t\tthis._isConfigured = {\n\t\t\tcoordinates: [0, 0],\n\t\t\tboard: initializeBoardSquares(() => emptyPieceString),\n\t\t\timmunePieces: createTuple(false, totalPlayers),\n\t\t\tcolor: 0\n\t\t};\n\t}\n\n\tsetCoordinates(x: number, y: number) {\n\t\tthis._isConfigured.coordinates = [x, y];\n\t\treturn this;\n\t}\n\tsetBaseImmunePieces(immune: PlayerBooleanTuple) {\n\t\tthis._isConfigured.immunePieces = immune;\n\t\treturn this;\n\t}\n\tsetColor(color: NumericColor) {\n\t\tthis._isConfigured.color = color;\n\t\treturn this;\n\t}\n\tsetBoard(board: PieceString[][]) {\n\t\tthis._isConfigured.board = board;\n\t\treturn this;\n\t}\n\n\tconstructPieceControl(): PieceControl {\n\t\tthis._control.configure(this._isConfigured);\n\t\treturn this._control;\n\t}\n}\n\nexport class PieceControlBuilder {\n\tprivate readonly _generalConfig: {\n\t\tfenData?: FENData;\n\t\tvariantRules?: Array<VariantRule<typeof PieceControl, keyof VariantDataRules>>;\n\t};\n\tconstructor() {\n\t\tthis._generalConfig = {};\n\t}\n\n\tsetFENData(fenData: FENData) {\n\t\tthis._generalConfig.fenData = fenData;\n\t}\n\tsetVariantRules<T extends VariantRule<typeof PieceControl, keyof VariantDataRules>>(rules: T[]) {\n\t\tthis._generalConfig.variantRules = rules;\n\t}\n\tcreatePieceControlWrap(letter: PieceLetter): () => PieceControlConfigurator {\n\t\tconst information = pieceControlConfigSettings[letter];\n\t\tconst control = new information.construct();\n\t\tif (!this._generalConfig.fenData || !this._generalConfig.variantRules) throw new Error(\"PieceControl builder setup is not complete\");\n\t\tcontrol.setFENData(this._generalConfig.fenData);\n\n\t\tconst decoratedControl = decorateClassWithVariants<typeof PieceControl>(\n\t\t\tcontrol,\n\t\t\tPieceControl,\n\t\t\tcopyVariantRules(this._generalConfig.variantRules)\n\t\t);\n\n\t\treturn () => {\n\t\t\treturn new PieceControlConfigurator(decoratedControl);\n\t\t};\n\t}\n}\n","import { assertNonUndefined, createTuple, createTupleFromCallback, Tuple } from \"../../../baseTypes\";\nimport { BoardSquares, Cloneable, initializeBoardSquares, Memento } from \"../../BaseInterfaces\";\nimport { createMoveTree, MoveTreeInterface } from \"../MoveTree/MoveTree\";\nimport {\n\tcreateBaseMoveWrapper,\n\tDroppingMove,\n\tInternalMove,\n\tInternalMoveSignature,\n\tMove,\n\tMoveData,\n\tSpecialMove\n} from \"../MoveTree/MoveTreeInterface\";\nimport { FENData } from \"../FENData/FENData\";\nimport type { PostMoveResults } from \"../FENData/FENDataInterface\";\nimport { boardDimension, colors, GameData, totalPlayers } from \"../GameInformation/GameData\";\nimport { NumericColor, Coordinate, nonPlayablePieces } from \"../GameInformation/GameUnits/GameUnits\";\nimport { createPieceFromData, deadColorIndex, pawnPieceString, PieceString, wallPieceString } from \"../GameInformation/GameUnits/PieceString\";\nimport { PieceControlConfigurator, PieceControlBuilder } from \"../PieceControl/PieceControlBuilder\";\nimport { initPieceControlDeclarations } from \"../PieceControl/PieceControlDeclarations\";\nimport { AttackType, pieceControlConfigSettings, PieceControlGeneratedMove, PieceLetter } from \"../PieceControl/PieceControlInterface\";\nimport { decorateClassWithVariants } from \"../VariantRules/VariantRule\";\nimport { copyVariantRules, validateVariantRules, VariantRuleParsingTypes } from \"../VariantRules/VariantRuleSetup\";\nimport {\n\tDisplaySettings,\n\tcreateGameTypeSettings,\n\tcreateComplexMoveLegalityTracker,\n\tBoardSnapshot,\n\tcreateBasePreGeneratedAttacks,\n\tcompareCoordinates,\n\tstringifyCoordinate,\n\tSpecialMoveGenerationSettings\n} from \"./BoardInterface\";\nimport type { VariantDataRules, VariantHandlerTarget } from \"../VariantRules/VariantRuleInterface\";\nimport { copyClass } from \"@client/ts/utils/ObjectUtils\";\nimport { parsePGN4 } from \"../../utils/Tags/InputOutputProcessing\";\nimport { InsufficientMaterialChecker } from \"@moveGeneration/VariantRules/VariantRuleDefinitions/BoardVariantModules/InsufficientMaterial/InsufficientMaterialChecker\";\n\ninitPieceControlDeclarations();\n\nexport const baseImmunes = createTuple(false, totalPlayers);\nexport type PlayerBooleanTuple = typeof baseImmunes;\n\nexport class Board implements VariantHandlerTarget<Board>, Cloneable<Board>, Memento<BoardSnapshot> {\n\treadonly controls: Record<PieceLetter, () => PieceControlConfigurator> = {};\n\tdata: FENData;\n\tmoves: MoveTreeInterface;\n\tpreGeneratedAttacks = createTupleFromCallback(createBasePreGeneratedAttacks, totalPlayers);\n\tboard: BoardSquares<PieceString>;\n\tisComplexSetup = createComplexMoveLegalityTracker();\n\treadonly gameData: GameData;\n\treadonly gameType = createGameTypeSettings();\n\treadonly variantRules: VariantRuleParsingTypes;\n\treadonly variantData: VariantDataRules;\n\treadonly isTwoPlayer: boolean;\n\tinsufficientMaterialChecker?: InsufficientMaterialChecker;\n\n\t__baseClass: Board;\n\tinitDecoratorSettings() {\n\t\t/* no-op */\n\t}\n\n\t/*---------------------------------- INITIALIZATION -----------------------------------------*/\n\tconstructor(pgn4: string) {\n\t\tthis.__baseClass = this;\n\n\t\tconst parsingResults = parsePGN4(pgn4);\n\t\tthis.gameType.type = parsingResults.gameType;\n\t\tthis.variantRules = parsingResults.variantRules;\n\t\tthis.gameData = parsingResults.gameData;\n\t\tthis.board = parsingResults.board;\n\t\tthis.data = parsingResults.fenData;\n\t\tthis.data.injectBoard(this);\n\t\tthis.data = decorateClassWithVariants<typeof FENData>(this.data, FENData, this.variantRules.fenDataDecorators);\n\t\tthis.variantData = parsingResults.variantRuleData;\n\t\tthis.variantRules = validateVariantRules(this);\n\t\tthis.isTwoPlayer = this.data.getRealPlayers() === 2;\n\t\tthis.initPieceControls(parsingResults.pieceSet);\n\n\t\tthis.moves = createMoveTree(this.createSnapshot());\n\t\tthis.moves.moves = parsingResults.moves;\n\t\tthis.pregenerateAttacks();\n\t}\n\n\tinitPieceControls(pieces: Set<PieceLetter>) {\n\t\tif (pieces.size === 0) return;\n\n\t\tconst builder = new PieceControlBuilder();\n\t\tbuilder.setFENData(this.data);\n\t\tbuilder.setVariantRules(this.variantRules.pieceControlDecorators);\n\n\t\tfor (const piece of pieces) {\n\t\t\tconst pieceControlConfigurator = builder.createPieceControlWrap(piece);\n\t\t\tthis.controls[piece] = pieceControlConfigurator;\n\t\t}\n\t}\n\n\tgetSquareVisibility(): BoardSquares<DisplaySettings[]> {\n\t\treturn initializeBoardSquares(() => []);\n\t}\n\n\tcreateSnapshot(): BoardSnapshot {\n\t\treturn {\n\t\t\tdata: this.data.createSnapshot(),\n\t\t\tboard: this.board.map((a) => [...a]),\n\t\t\tisComplexSetup: Object.assign({}, this.isComplexSetup)\n\t\t};\n\t}\n\n\tloadSnapshot(snapshot: BoardSnapshot) {\n\t\tthis.isComplexSetup = { ...snapshot.isComplexSetup };\n\t\tthis.data.loadSnapshot(snapshot.data);\n\t\tthis.board = snapshot.board.map((row) => [...row]);\n\t\tthis.pregenerateAttacks();\n\t\tthis.runComplexLegalityEvaluationChecks();\n\t}\n\n\tcreateClone(): Board {\n\t\tlet targetObject = copyClass(this.__baseClass, Board);\n\t\ttargetObject.board = this.board.map((a) => [...a]); // PieceStrings are immutable\n\t\ttargetObject.isComplexSetup = Object.assign({}, this.isComplexSetup);\n\t\ttargetObject.preGeneratedAttacks = createTupleFromCallback(createBasePreGeneratedAttacks, totalPlayers);\n\t\ttargetObject.data = this.data.createClone();\n\t\ttargetObject = decorateClassWithVariants<typeof Board>(\n\t\t\ttargetObject,\n\t\t\tBoard,\n\t\t\tcopyVariantRules(this.__baseClass.variantRules.boardDecorators)\n\t\t);\n\t\ttargetObject.data.injectBoard(targetObject);\n\t\ttargetObject.data = decorateClassWithVariants<typeof FENData>(\n\t\t\ttargetObject.data,\n\t\t\tFENData,\n\t\t\tcopyVariantRules(this.__baseClass.variantRules.fenDataDecorators)\n\t\t);\n\t\tconst presumedPieceLetters = new Set<PieceLetter>();\n\t\tlet letter: PieceLetter;\n\t\tfor (letter in this.controls) {\n\t\t\tif (Object.prototype.hasOwnProperty.call(this.controls, letter)) {\n\t\t\t\tpresumedPieceLetters.add(letter);\n\t\t\t}\n\t\t}\n\t\ttargetObject.initPieceControls(presumedPieceLetters);\n\t\ttargetObject.pregenerateAttacks();\n\n\t\treturn targetObject;\n\t}\n\n\t/*---------------------------------- INITIALIZATION -----------------------------------------*/\n\t/*-------------------------------------------------------------------------------------------*/\n\t/*------------------------------------- UTILITIES -------------------------------------------*/\n\n\tisKingInCheck(baseColor: NumericColor, fenRoyal = this.data.fenOptions.tag(\"royal\")): boolean {\n\t\tconst royal = fenRoyal[baseColor];\n\t\tif (!royal || this.data.fenOptions.tag(\"dead\")[baseColor]) return false;\n\t\tconst coordinates = royal;\n\t\treturn !!(\n\t\t\tthis.preGeneratedAttacks[baseColor].slidingPieces[coordinates[0]][coordinates[1]] ||\n\t\t\tthis.preGeneratedAttacks[baseColor].hoppingPieces[coordinates[0]][coordinates[1]]\n\t\t);\n\t}\n\n\tgetPlayerPieces(): Tuple<Coordinate[], typeof totalPlayers> {\n\t\tconst playerPieces: Tuple<Coordinate[], typeof totalPlayers> = [[], [], [], []];\n\n\t\tfor (let i = 0; i < boardDimension; i++) {\n\t\t\tfor (let j = 0; j < boardDimension; j++) {\n\t\t\t\tconst square = this.board[i][j];\n\t\t\t\tif (square.isEmpty()) continue;\n\t\t\t\tconst color = square.color;\n\t\t\t\tif (color !== deadColorIndex) playerPieces[color].push([i, j]);\n\t\t\t}\n\t\t}\n\n\t\treturn playerPieces;\n\t}\n\n\tgetCheckmatesAndStalemates() {\n\t\tconst dead = this.data.fenOptions.tag(\"dead\"),\n\t\t\troyal = this.data.fenOptions.tag(\"royal\");\n\n\t\tconst kingChecks = createTuple(false, totalPlayers);\n\t\tconst legalMoves = createTuple(false, totalPlayers);\n\t\tconst playerPieces = this.getPlayerPieces();\n\t\tlegalMoves[this.data.sideToMove] = true;\n\n\t\tfor (const color of colors) {\n\t\t\tif (dead[color]) continue;\n\t\t\tconst playerArmy = playerPieces[color];\n\t\t\tif (this.isKingInCheck(color)) {\n\t\t\t\tkingChecks[color] = true;\n\t\t\t}\n\t\t\tfor (const piece of playerArmy) {\n\t\t\t\tif (this.getLegalMoves(piece[0], piece[1], color).length) {\n\t\t\t\t\tlegalMoves[color] = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!legalMoves[color]) {\n\t\t\t\tif (this.preGeneratedAttacks[color].pieceDrops.pawn.length || this.preGeneratedAttacks[color].pieceDrops.piece.length) {\n\t\t\t\t\tlegalMoves[color] = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst kingCaptures = royal.map((r, i) =>\n\t\t\t!dead[i] && r ? this.board[r[0]][r[1]].isEmpty() || this.board[r[0]][r[1]].color !== i : false\n\t\t);\n\t\treturn {\n\t\t\tcheckmates: legalMoves.map((move, i) => kingCaptures[i] || (!move && kingChecks[i])),\n\t\t\tstalemates: legalMoves.map((move, i) => !move && !kingChecks[i]),\n\t\t\tchecks: kingChecks\n\t\t};\n\t}\n\n\tprivate runComplexLegalityEvaluationChecks(): void {\n\t\tif (this.isComplexSetup.hasComplexRules) return;\n\t\tfor (let i = 0; i < boardDimension; i++) {\n\t\t\tfor (let j = 0; j < boardDimension; j++) {\n\t\t\t\tconst square = this.board[i][j];\n\t\t\t\tif (square.isPiece() && pieceControlConfigSettings[square.piece].moveGenerationSettings.isComplex) {\n\t\t\t\t\tthis.isComplexSetup.hasComplexPieces = true;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tgetCurrentChecks(sideToMove = this.data.sideToMove) {\n\t\tconst dead = this.data.fenOptions.tag(\"dead\"),\n\t\t\tresigned = this.data.fenOptions.tag(\"resigned\"),\n\t\t\troyal = this.data.fenOptions.tag(\"royal\");\n\n\t\tconst playerRoyals = royal.map((r, i) => (r && !dead[i] && !resigned[i] ? r : null));\n\t\tconst attackingCoordinates = createTupleFromCallback<string[], typeof totalPlayers>(() => [], totalPlayers);\n\t\tfor (const [startingCoordinate, attackList] of this.preGeneratedAttacks[sideToMove].pieceMovements) {\n\t\t\tfor (const attack of attackList) {\n\t\t\t\tfor (const color of colors) {\n\t\t\t\t\tif (color === sideToMove) continue;\n\t\t\t\t\tconst royal = playerRoyals[color];\n\t\t\t\t\tif (royal && compareCoordinates(royal, attack.move)) {\n\t\t\t\t\t\tattackingCoordinates[color].push(startingCoordinate);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn attackingCoordinates;\n\t}\n\n\t/*------------------------------------- UTILITIES -------------------------------------------*/\n\t/*-------------------------------------------------------------------------------------------*/\n\t/*---------------------------------------- API ----------------------------------------------*/\n\n\tmakeMove(move: Move, ignoreNextMoves = false): PostMoveResults {\n\t\tlet returnValues!: PostMoveResults;\n\t\tconst sideToMove = this.data.sideToMove,\n\t\t\tpregeneratedAttacks = this.preGeneratedAttacks;\n\n\t\tfor (let i = 0; i < move.length; i++) {\n\t\t\tif (i === move.length - 1) {\n\t\t\t\treturnValues = this.data.affectOptions(move[i], {\n\t\t\t\t\tignoreCheckmateChecks: ignoreNextMoves,\n\t\t\t\t\tignoreNextTurn: false\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthis.data.affectOptions(move[i], {\n\t\t\t\t\tignoreCheckmateChecks: ignoreNextMoves,\n\t\t\t\t\tignoreNextTurn: true\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\tthis.runComplexLegalityEvaluationChecks();\n\t\tif (ignoreNextMoves) return returnValues;\n\n\t\tconst path = this.moves.currentMove.slice();\n\t\tpath[path.length - 1]++;\n\t\tthis.moves.currentMove = this.moves.setNewMove({\n\t\t\tmove: createBaseMoveWrapper({ path, moveData: move }),\n\t\t\tsnapshot: {\n\t\t\t\tboardSnapshot: this.createSnapshot(),\n\t\t\t\tpregeneratedAttacks: pregeneratedAttacks[sideToMove]\n\t\t\t},\n\t\t\tfenDataString: this.moves.constructPreliminaryHashString(this)\n\t\t});\n\t\tif (this.data.gameOver || this.data.getRealPlayers() === 1) return returnValues;\n\t\tif (returnValues.checkmates[this.data.sideToMove]) {\n\t\t\treturnValues = this.makeMove([{ type: InternalMoveSignature.TeamsCheckmate }], true);\n\t\t} else if (returnValues.stalemates[this.data.sideToMove]) {\n\t\t\treturnValues = this.makeMove([{ type: InternalMoveSignature.Stalemate }]);\n\t\t}\n\n\t\treturn returnValues;\n\t}\n\n\tpregenerateAttacks(exclusiveSideToMoveGeneration: NumericColor | false = false): void {\n\t\tconst royal = this.data.fenOptions.tag(\"royal\");\n\n\t\tthis.preGeneratedAttacks = createTupleFromCallback(createBasePreGeneratedAttacks, totalPlayers);\n\t\tthis.getPlayerPieces().forEach((army, armyColor) => {\n\t\t\tif (exclusiveSideToMoveGeneration !== false && exclusiveSideToMoveGeneration !== armyColor) return;\n\t\t\tconst preGeneratedAttacks = this.preGeneratedAttacks[armyColor];\n\t\t\tfor (const coordinate of army) {\n\t\t\t\tconst square = this.board[coordinate[0]][coordinate[1]];\n\t\t\t\tif (!square.isPiece()) continue;\n\t\t\t\tconst color = square.color;\n\t\t\t\tconst letter = square.piece;\n\t\t\t\tconst controlBuilder = this.controls[letter]().setColor(color).setCoordinates(coordinate[0], coordinate[1]).setBoard(this.board);\n\t\t\t\tconst setting = pieceControlConfigSettings[square.piece];\n\t\t\t\tconst resultingMoves: PieceControlGeneratedMove[] = [];\n\n\t\t\t\tlet control = controlBuilder.setBaseImmunePieces(this.gameType.getBaseColors(color)).constructPieceControl();\n\t\t\t\tresultingMoves.push(...control.getPseudoLegalMoves());\n\n\t\t\t\tcontrol = controlBuilder.setBaseImmunePieces(baseImmunes).constructPieceControl();\n\t\t\t\tif (setting.moveGenerationSettings.isJumping) {\n\t\t\t\t\tconst attacks = control.rayGenJumpingAttacks();\n\t\t\t\t\tfor (const { move: attack } of attacks) {\n\t\t\t\t\t\tfor (const color of colors) {\n\t\t\t\t\t\t\tif (color === armyColor) continue;\n\t\t\t\t\t\t\tconst preGeneratedAttacks = this.preGeneratedAttacks[color];\n\t\t\t\t\t\t\tpreGeneratedAttacks.hoppingPieces[attack[0]][attack[1]]++;\n\t\t\t\t\t\t\tpreGeneratedAttacks.hoppingPieceLines.push([coordinate, attack]);\n\t\t\t\t\t\t\tconst l = preGeneratedAttacks.attackingColors[attack[0]][attack[1]];\n\t\t\t\t\t\t\tif (~l && preGeneratedAttacks.attackingColors[attack[0]][attack[1]] !== color + 1) {\n\t\t\t\t\t\t\t\tpreGeneratedAttacks.attackingColors[attack[0]][attack[1]] = l === 0 ? 1 + color : -1;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (setting.moveGenerationSettings.isSliding) {\n\t\t\t\t\tconst attacks = control.rayGenSlidingAttacks();\n\t\t\t\t\tfor (const attack of attacks) {\n\t\t\t\t\t\tfor (const color of colors) {\n\t\t\t\t\t\t\tif (color === armyColor) continue;\n\t\t\t\t\t\t\tconst preGeneratedAttacks = this.preGeneratedAttacks[color];\n\n\t\t\t\t\t\t\tfor (const { move: subAttack } of attack) {\n\t\t\t\t\t\t\t\tpreGeneratedAttacks.slidingPieces[subAttack[0]][subAttack[1]]++;\n\t\t\t\t\t\t\t\tconst l = preGeneratedAttacks.attackingColors[subAttack[0]][subAttack[1]];\n\t\t\t\t\t\t\t\tif (~l && preGeneratedAttacks.attackingColors[subAttack[0]][subAttack[1]] !== color + 1) {\n\t\t\t\t\t\t\t\t\tpreGeneratedAttacks.attackingColors[subAttack[0]][subAttack[1]] = l === 0 ? 1 + color : -1;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (attack.length !== 0) {\n\t\t\t\t\t\t\t\tpreGeneratedAttacks.slidingPiecesLines.push([coordinate, attack.map((m) => m.move)]);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tconst coordinateArray: Coordinate[] = [];\n\t\t\t\t\t\t\t\tpreGeneratedAttacks.slidingPiecesLines.push([coordinate, coordinateArray]);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tconst rayGen = control.rayGenSlidingAttacks(AttackType.RayTraceLimited);\n\t\t\t\t\tfor (const attack of rayGen) {\n\t\t\t\t\t\tfor (const color of colors) {\n\t\t\t\t\t\t\tif (color === armyColor) continue;\n\t\t\t\t\t\t\tconst preGeneratedAttacks = this.preGeneratedAttacks[color];\n\n\t\t\t\t\t\t\tif (attack.length !== 0) {\n\t\t\t\t\t\t\t\tlet isRoyalOnLine = false;\n\t\t\t\t\t\t\t\tconst resultingAttack: Coordinate[] = [];\n\t\t\t\t\t\t\t\tfor (const { move } of attack) {\n\t\t\t\t\t\t\t\t\tresultingAttack.push(move);\n\t\t\t\t\t\t\t\t\tif (isRoyalOnLine) {\n\t\t\t\t\t\t\t\t\t\tpreGeneratedAttacks.slidingPieces[move[0]][move[1]]++;\n\t\t\t\t\t\t\t\t\t} else if (compareCoordinates(royal[color] ?? [-1, -1], move)) {\n\t\t\t\t\t\t\t\t\t\tisRoyalOnLine = true;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tpreGeneratedAttacks.slidingPiecesRayTracing.push([coordinate, attack.map((m) => m.move)]);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tpreGeneratedAttacks.slidingPiecesLines.push([coordinate, []]);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tpreGeneratedAttacks.pieceMovements.set(stringifyCoordinate(coordinate), resultingMoves);\n\t\t\t}\n\n\t\t\tpreGeneratedAttacks.pieceDrops.piece = this.getDroppingMoves(createPieceFromData(armyColor, nonPlayablePieces.wall));\n\t\t\tpreGeneratedAttacks.pieceDrops.pawn = this.getDroppingMoves(createPieceFromData(armyColor, pawnPieceString.piece));\n\t\t});\n\t}\n\n\tisSetupComplex() {\n\t\treturn this.isComplexSetup.hasComplexPieces || this.isComplexSetup.hasComplexRules || this.data.isComplexEvaluation();\n\t}\n\n\tisTheMoveLegal(color: NumericColor, moveData: MoveData, isSeirawanDrop = false): boolean {\n\t\tconst royals = this.data.fenOptions.tag(\"royal\");\n\t\tconst {\n\t\t\tstartCoordinates: [pieceI, pieceJ],\n\t\t\tendCoordinates: [attackI, attackJ]\n\t\t} = moveData;\n\t\tconst royal = royals[color];\n\t\tif (!this.board[attackI][attackJ].isEmpty() && royal && attackI === royal[0] && attackJ === royal[1]) return false;\n\n\t\tif (this.isSetupComplex()) {\n\t\t\tconst snapshot = this.createSnapshot();\n\t\t\tconst moveArray: Move = [\n\t\t\t\t{\n\t\t\t\t\tstartCoordinates: [pieceI, pieceJ],\n\t\t\t\t\tendCoordinates: [attackI, attackJ]\n\t\t\t\t}\n\t\t\t];\n\t\t\tif (isSeirawanDrop) moveArray.push({ piece: wallPieceString, endCoordinates: [pieceI, pieceJ] });\n\t\t\tconst { checks, checkmates } = this.makeMove(moveArray, true);\n\n\t\t\tlet isKingInCheck = checks[color] || checkmates[color];\n\t\t\tif (!isKingInCheck) {\n\t\t\t\tthis.pregenerateAttacks(color);\n\t\t\t\tisKingInCheck = this.isKingInCheck(color);\n\t\t\t}\n\t\t\tthis.loadSnapshot(snapshot);\n\t\t\treturn !isKingInCheck;\n\t\t} else {\n\t\t\tconst [royalI, royalJ] = royal ?? [null, null];\n\t\t\tconst preGeneratedAttacks = this.preGeneratedAttacks[color];\n\t\t\tif (royalI === null) return true;\n\t\t\tconst isRoyalMove = royalI === pieceI && royalJ === pieceJ;\n\t\t\tconst attackers = preGeneratedAttacks.hoppingPieces[royalI][royalJ] + preGeneratedAttacks.slidingPieces[royalI][royalJ];\n\t\t\tconst targetSafety = preGeneratedAttacks.slidingPieces[attackI][attackJ] + preGeneratedAttacks.hoppingPieces[attackI][attackJ] === 0;\n\t\t\tconst legalitySettings: { canKingCapture: number | undefined } = {\n\t\t\t\tcanKingCapture: undefined\n\t\t\t};\n\n\t\t\tfor (const kingCaptureColor of colors) {\n\t\t\t\tconst royal = royals[kingCaptureColor];\n\t\t\t\tif (kingCaptureColor !== color && royal && royal[0] === attackI && royal[1] === attackJ) {\n\t\t\t\t\tconst royalDefendedSquare = preGeneratedAttacks.attackingColors[royal[1]][royal[0]];\n\t\t\t\t\tif (\n\t\t\t\t\t\t(royalDefendedSquare === kingCaptureColor + 1 || royalDefendedSquare === 0) &&\n\t\t\t\t\t\t(isRoyalMove || preGeneratedAttacks.attackingColors[royalI][royalJ] === kingCaptureColor + 1)\n\t\t\t\t\t) {\n\t\t\t\t\t\tlegalitySettings.canKingCapture = kingCaptureColor + 1;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (!this.gameType.isFFA() && legalitySettings.canKingCapture !== undefined) return true;\n\n\t\t\tfor (const [attackingPiece, attackLine] of preGeneratedAttacks.slidingPiecesRayTracing) {\n\t\t\t\tlet isPieceUnderAttack = false,\n\t\t\t\t\tisRoyalUnderAttack = false,\n\t\t\t\t\tisTheTargetSquarePinListed = false;\n\t\t\t\tfor (const [attackedX, attackedY] of attackLine) {\n\t\t\t\t\tif (!isPieceUnderAttack && attackedX === pieceI && attackedY === pieceJ) isPieceUnderAttack = true;\n\t\t\t\t\telse if (!isTheTargetSquarePinListed && !isRoyalUnderAttack && attackedX === attackI && attackedY === attackJ)\n\t\t\t\t\t\tisTheTargetSquarePinListed = true;\n\t\t\t\t\tif (!isRoyalUnderAttack && attackedX === royalI && attackedY === royalJ) isRoyalUnderAttack = true;\n\n\t\t\t\t\tif (isRoyalMove) {\n\t\t\t\t\t\tif (isRoyalUnderAttack && attackedX === attackI && attackedY === attackJ) {\n\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\tlegalitySettings.canKingCapture &&\n\t\t\t\t\t\t\t\tlegalitySettings.canKingCapture > 0 &&\n\t\t\t\t\t\t\t\tthis.board[attackedX][attackedY].color + 1 === legalitySettings.canKingCapture\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tisPieceUnderAttack &&\n\t\t\t\t\t\t\tisRoyalUnderAttack &&\n\t\t\t\t\t\t\t!compareCoordinates(attackingPiece, moveData.endCoordinates) &&\n\t\t\t\t\t\t\t!isTheTargetSquarePinListed\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\tlegalitySettings.canKingCapture &&\n\t\t\t\t\t\t\t\tlegalitySettings.canKingCapture > 0 &&\n\t\t\t\t\t\t\t\tthis.board[attackedX][attackedY].color + 1 === legalitySettings.canKingCapture\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (attackers > 1) {\n\t\t\t\treturn isRoyalMove ? targetSafety || Boolean(legalitySettings.canKingCapture) : Boolean(legalitySettings.canKingCapture);\n\t\t\t} else if (attackers === 1) {\n\t\t\t\tif (!isRoyalMove) {\n\t\t\t\t\tif (preGeneratedAttacks.hoppingPieces[royalI][royalJ] === 1) {\n\t\t\t\t\t\tfor (const [attackingPiece, attackCoordinates] of preGeneratedAttacks.hoppingPieceLines) {\n\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\tattackCoordinates[0] === royalI &&\n\t\t\t\t\t\t\t\tattackCoordinates[1] === royalJ &&\n\t\t\t\t\t\t\t\tattackingPiece[0] === attackI &&\n\t\t\t\t\t\t\t\tattackingPiece[1] === attackJ\n\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn Boolean(legalitySettings.canKingCapture);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfor (const [attackingPiece, attackLine] of preGeneratedAttacks.slidingPiecesLines) {\n\t\t\t\t\t\t\tlet isRoyalUnderAttack = false,\n\t\t\t\t\t\t\t\tisTheTargetSquareBlocked = false;\n\t\t\t\t\t\t\tfor (const [attackedX, attackedY] of attackLine) {\n\t\t\t\t\t\t\t\tif (!isRoyalUnderAttack && attackedX === royalI && attackedY === royalJ) isRoyalUnderAttack = true;\n\t\t\t\t\t\t\t\telse if (!isTheTargetSquareBlocked && !isRoyalUnderAttack && attackedX === attackI && attackedY === attackJ)\n\t\t\t\t\t\t\t\t\tisTheTargetSquareBlocked = true;\n\n\t\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t\tisRoyalUnderAttack &&\n\t\t\t\t\t\t\t\t\t!compareCoordinates(attackingPiece, moveData.endCoordinates) &&\n\t\t\t\t\t\t\t\t\t!isTheTargetSquareBlocked\n\t\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t\t\tlegalitySettings.canKingCapture &&\n\t\t\t\t\t\t\t\t\t\tlegalitySettings.canKingCapture > 0 &&\n\t\t\t\t\t\t\t\t\t\tthis.board[attackedX][attackedY].color + 1 === legalitySettings.canKingCapture\n\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t\t\treturn Boolean(legalitySettings.canKingCapture);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\treturn targetSafety || Boolean(legalitySettings.canKingCapture);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn isRoyalMove ? targetSafety || Boolean(legalitySettings.canKingCapture) : true;\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate getCastlingMoves(parameters: SpecialMoveGenerationSettings) {\n\t\tconst { i, j, baseColor } = parameters;\n\t\tconst specialMoves: MoveData[] = [];\n\t\tconst royal = this.data.fenOptions.tag(\"royal\")[baseColor];\n\n\t\tif (royal && royal[0] === i && royal[1] === j) {\n\t\t\tif (this.data.fenOptions.isKingsideCastlingAvailable(baseColor, this)) {\n\t\t\t\tspecialMoves.push({\n\t\t\t\t\tstartCoordinates: [i, j],\n\t\t\t\t\tendCoordinates: this.data.fenOptions.getKingsideCastlingEndCoordinate(baseColor),\n\t\t\t\t\tspecialType: SpecialMove.CastlingKingside\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (this.data.fenOptions.isQueensideCastlingAvailable(baseColor, this)) {\n\t\t\t\tspecialMoves.push({\n\t\t\t\t\tstartCoordinates: [i, j],\n\t\t\t\t\tendCoordinates: this.data.fenOptions.getQueensideCastlingEndCoordinate(baseColor),\n\t\t\t\t\tspecialType: SpecialMove.CastlingQueenside\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\treturn specialMoves;\n\t}\n\n\tprivate getEnPassantMoves(parameters: SpecialMoveGenerationSettings) {\n\t\tconst { i, j, baseColor, pieceLetter } = parameters;\n\t\tconst specialMoves: MoveData[] = [];\n\t\tif (pieceControlConfigSettings[pieceLetter].moveGenerationSettings.isPawn) {\n\t\t\tconst enPassantCaptures = this.data.fenOptions.getAvailableEnPassantCaptures(baseColor);\n\t\t\tconst pawnAttacks = this.controls[pieceLetter]()\n\t\t\t\t.setBaseImmunePieces(this.gameType.getBaseColors(baseColor))\n\t\t\t\t.setBoard(this.board)\n\t\t\t\t.setCoordinates(i, j)\n\t\t\t\t.setColor(baseColor)\n\t\t\t\t.constructPieceControl()\n\t\t\t\t.rayGenJumpingAttacks();\n\t\t\tif (enPassantCaptures.length !== 0) {\n\t\t\t\tfor (const attack of pawnAttacks) {\n\t\t\t\t\tfor (const enP of enPassantCaptures) {\n\t\t\t\t\t\tif (compareCoordinates(attack.move, enP)) {\n\t\t\t\t\t\t\tconst snapshot = this.createSnapshot();\n\t\t\t\t\t\t\tconst move: [MoveData] = [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tstartCoordinates: [i, j],\n\t\t\t\t\t\t\t\t\tendCoordinates: attack.move,\n\t\t\t\t\t\t\t\t\tspecialType: SpecialMove.EnPassant,\n\t\t\t\t\t\t\t\t\tisIrreversible: attack.irreversible\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t];\n\n\t\t\t\t\t\t\tthis.makeMove(move, true);\n\t\t\t\t\t\t\tthis.pregenerateAttacks();\n\t\t\t\t\t\t\tif (!this.isKingInCheck(baseColor)) specialMoves.push(move[0]);\n\t\t\t\t\t\t\tthis.loadSnapshot(snapshot);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn specialMoves;\n\t}\n\n\tprivate getSpecialMoves(parameters: SpecialMoveGenerationSettings) {\n\t\treturn [...this.getCastlingMoves(parameters), ...this.getEnPassantMoves(parameters)];\n\t}\n\n\tgetLegalMoves(i: number, j: number, baseColor = this.data.sideToMove, isSeirawanDrop = false): MoveData[] {\n\t\tconst pieceString = this.board[i]?.[j],\n\t\t\troyal = this.data.fenOptions.tag(\"royal\")[baseColor];\n\t\tif (pieceString.isPiece()) {\n\t\t\tconst color = pieceString.color;\n\t\t\tif (color !== baseColor) return [];\n\t\t\tconst pseudoLegalMoves = this.preGeneratedAttacks[color].pieceMovements.get(stringifyCoordinate([i, j]));\n\t\t\tassertNonUndefined(pseudoLegalMoves);\n\n\t\t\tconst specialMoves = this.getSpecialMoves({ i, j, baseColor, pieceLetter: pieceString.piece });\n\t\t\treturn [\n\t\t\t\t...pseudoLegalMoves\n\t\t\t\t\t.map((generatedMove) => {\n\t\t\t\t\t\tconst moveData: MoveData = {\n\t\t\t\t\t\t\tstartCoordinates: [i, j],\n\t\t\t\t\t\t\tendCoordinates: generatedMove.move,\n\t\t\t\t\t\t\tisIrreversible: generatedMove.irreversible\n\t\t\t\t\t\t};\n\t\t\t\t\t\tif (generatedMove.move[2]) {\n\t\t\t\t\t\t\tmoveData.promotion = generatedMove.move[2].split(\"\").map((piece) => createPieceFromData(color, piece));\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn moveData;\n\t\t\t\t\t})\n\t\t\t\t\t.filter((m) => {\n\t\t\t\t\t\tconst capturedPieces = this.data.getCapturedPieces(m);\n\t\t\t\t\t\tconst isKingCapture = royal && capturedPieces.find((c) => royal[0] === c[0] && royal[1] === c[1]);\n\t\t\t\t\t\treturn this.isTheMoveLegal(color, m, isSeirawanDrop) && !isKingCapture;\n\t\t\t\t\t}),\n\t\t\t\t...specialMoves\n\t\t\t];\n\t\t} else {\n\t\t\treturn [];\n\t\t}\n\t}\n\n\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\n\tgetDroppingMoves(_piece: PieceString, _sideToMove = this.data.sideToMove): DroppingMove[] {\n\t\treturn [];\n\t}\n\n\tgetAllowedInternalMoves(sideToMove = this.data.sideToMove): InternalMove[] {\n\t\tconst currentMoves = [InternalMoveSignature.DrawByAgreement];\n\n\t\tconst currentSnapshot = this.createSnapshot();\n\t\tthis.makeMove([{ type: InternalMoveSignature.Resign }], true);\n\t\tconst maximum = Math.max(...this.data.points);\n\t\tconst pointIndexes = this.data.points.reduce<number[]>((p, n, i) => (n === maximum ? [...p, i] : p), []);\n\t\tthis.loadSnapshot(currentSnapshot);\n\t\tif (pointIndexes.length === 1 && pointIndexes[0] === sideToMove) {\n\t\t\tcurrentMoves.push(InternalMoveSignature.ClaimWin);\n\t\t} else {\n\t\t\tcurrentMoves.push(InternalMoveSignature.Resign, InternalMoveSignature.Timeout);\n\t\t}\n\n\t\treturn currentMoves.map((type) => ({ type }));\n\t}\n\n\t/*---------------------------------------- API ----------------------------------------------*/\n}\n","import { createTupleFromCallback, Tuple, verifyTupleType } from \"../../../baseTypes\";\nimport { BoardSquares, initializeBoardSquares } from \"../../BaseInterfaces\";\nimport type { FENDataSnapshot } from \"../FENData/FENDataInterface\";\nimport { totalPlayers, VariantType } from \"../GameInformation/GameData\";\nimport { Coordinate, NumericColor, verifyNumericColor } from \"../GameInformation/GameUnits/GameUnits\";\nimport type { PieceString } from \"../GameInformation/GameUnits/PieceString\";\nimport type { DroppingMove } from \"../MoveTree/MoveTreeInterface\";\nimport type { PieceControlGeneratedMove, PieceLetter } from \"../PieceControl/PieceControlInterface\";\nimport type { Board, PlayerBooleanTuple } from \"./Board\";\n\nexport const enum DisplaySettings {\n\tHighlighted,\n\tFogged,\n\tGhosted,\n\tBlindfolded,\n\tPieceFacesCenter\n}\n\nexport interface BoardSnapshot {\n\tdata: FENDataSnapshot;\n\tboard: BoardSquares<PieceString>;\n\tisComplexSetup: Board[\"isComplexSetup\"];\n}\n\nexport interface PreGeneratedAttacks {\n\thoppingPieces: BoardSquares<number>;\n\tslidingPieces: BoardSquares<number>;\n\thoppingPieceLines: Array<[Coordinate, Coordinate]>;\n\tslidingPiecesLines: Array<readonly [startCoordinate: Coordinate, destinations: Coordinate[]]>;\n\tslidingPiecesRayTracing: Array<readonly [startCoordinate: Coordinate, destinations: Coordinate[]]>;\n\tattackingColors: BoardSquares<number>;\n\tvariantRuleCache: {\n\t\thasCaptures?: boolean;\n\t};\n\tpieceMovements: Map<string, PieceControlGeneratedMove[]>;\n\tpieceDrops: {\n\t\tpawn: DroppingMove[];\n\t\tpiece: DroppingMove[];\n\t};\n}\n\nexport interface SpecialMoveGenerationSettings {\n\ti: number;\n\tj: number;\n\tbaseColor: NumericColor;\n\tpieceLetter: PieceLetter;\n}\n\nconst baseTeams: Tuple<boolean, typeof totalPlayers> = [true, false, true, false];\nexport const stringifyCoordinate = (coordinate: Coordinate) => `${coordinate[0]}:${coordinate[1]}`;\nexport const unstringifyCoordinate = (coordinate: string): Coordinate => {\n\tconst result = coordinate.split(\":\").map((v) => Number(v));\n\tif (verifyTupleType(result, 2) && result.every((n) => !Number.isNaN(n))) {\n\t\treturn result;\n\t} else throw new Error(`Unexpected stringified coordinate: ${coordinate}`);\n};\nexport const createGameTypeSettings = () => ({\n\ttype: VariantType.FFA,\n\tteamSettings: {\n\t\tfirstTeamColors: baseTeams.map((e) => e),\n\t\tsecondTeamColors: baseTeams.map((e) => !e)\n\t},\n\tgetBaseColors(color: NumericColor): PlayerBooleanTuple {\n\t\tif (this.isFFA()) {\n\t\t\treturn createTupleFromCallback((_, i) => i === color, totalPlayers);\n\t\t} else {\n\t\t\treturn this.teamSettings.firstTeamColors[color] ? this.teamSettings.firstTeamColors : this.teamSettings.secondTeamColors;\n\t\t}\n\t},\n\tisFFA() {\n\t\treturn this.type === VariantType.FFA || this.type === VariantType.Solo;\n\t},\n\tisSameTeam(colorA: NumericColor, colorB: NumericColor) {\n\t\tif (colorA === colorB) return true;\n\t\tif (this.isFFA()) {\n\t\t\treturn false;\n\t\t} else {\n\t\t\treturn this.teamSettings.firstTeamColors[colorA]\n\t\t\t\t? this.teamSettings.firstTeamColors[colorA] && this.teamSettings.firstTeamColors[colorA]\n\t\t\t\t: this.teamSettings.secondTeamColors[colorA] && this.teamSettings.secondTeamColors[colorB];\n\t\t}\n\t},\n\tgetTeammateColor(color: NumericColor): NumericColor {\n\t\tif (this.isFFA()) return color;\n\t\tconst teammateIndex = this.teamSettings.firstTeamColors[color]\n\t\t\t? this.teamSettings.firstTeamColors.map((b, i) => b && i !== color).indexOf(true)\n\t\t\t: this.teamSettings.secondTeamColors.map((b, i) => b && i !== color).indexOf(true);\n\t\treturn verifyNumericColor(teammateIndex) ? teammateIndex : color;\n\t}\n});\n\nexport const createComplexMoveLegalityTracker = () => ({\n\thasComplexPieces: false,\n\thasComplexRules: false\n});\n\nexport const createBasePreGeneratedAttacks = (): PreGeneratedAttacks => {\n\treturn {\n\t\thoppingPieces: initializeBoardSquares(() => 0),\n\t\tslidingPieces: initializeBoardSquares(() => 0),\n\t\thoppingPieceLines: [],\n\t\tslidingPiecesLines: [],\n\t\tslidingPiecesRayTracing: [],\n\t\tattackingColors: initializeBoardSquares(() => 0),\n\t\tpieceMovements: new Map<string, PieceControlGeneratedMove[]>(),\n\t\tpieceDrops: {\n\t\t\tpawn: [],\n\t\t\tpiece: []\n\t\t},\n\t\tvariantRuleCache: {}\n\t};\n};\n\nexport const compareCoordinates = (coordinate1: Coordinate, coordinate2: Coordinate): boolean =>\n\tcoordinate1[0] === coordinate2[0] && coordinate1[1] === coordinate2[1];\n","import { Tuple, createTupleFromCallback, assertNonUndefined } from \"@client/ts/baseTypes\";\nimport {\n\tCloneable,\n\tgetHorizontalPlacementModulus,\n\tgetVerticalPlacementModulus,\n\tisVerticalPlacement,\n\tMemento\n} from \"@client/ts/logic/BaseInterfaces\";\nimport type { NumericColor, Coordinate } from \"@moveGeneration/GameInformation/GameUnits/GameUnits\";\nimport {\n\tbotAlgorithms,\n\tZombieMoveGenerationAlgorithm,\n\tZombieType\n} from \"@moveGeneration/VariantRules/VariantRuleDefinitions/BoardVariantModules/EngineMoveGeneration/BotInterface\";\nimport { copyClass } from \"@utils/ObjectUtils\";\nimport type { Board } from \"../../Board/Board\";\nimport { totalPlayers } from \"../../GameInformation/GameData\";\nimport {\n\tcreateFENOptionsTags,\n\tcreateFENOptionsTagsSnapshot,\n\tDynamicFENOptionTag,\n\tFENOptionsSerializedState,\n\tFENOptionsTags,\n\tFENOptionsTagsSnapshot\n} from \"./FENOptionsTagsInterface\";\n\ninterface CastlingData {\n\tendCoordinates: number;\n\tpieceCoordinates: number;\n\tpieceEndCoordinates: number;\n\tcheckSquares: number[];\n}\n\nexport interface FENOptionsSnapshot {\n\ttagsSnapshot: FENOptionsTagsSnapshot;\n}\n\nexport class FENOptions implements Cloneable<FENOptions>, Memento<FENOptionsSnapshot> {\n\tstatic loadSerializedState(state: FENOptionsSerializedState) {\n\t\tconst newTags = createFENOptionsTags();\n\t\tlet key: keyof FENOptionsTags;\n\t\tfor (key in newTags) {\n\t\t\tif (Object.prototype.hasOwnProperty.call(newTags, key)) {\n\t\t\t\tnewTags[key].value = state[key] as never;\n\t\t\t}\n\t\t}\n\n\t\treturn newTags;\n\t}\n\n\ttags = createFENOptionsTags();\n\tprivate castlingKingsideData: Tuple<CastlingData, typeof totalPlayers> = createTupleFromCallback(\n\t\t() => ({ endCoordinates: -1, pieceCoordinates: -1, pieceEndCoordinates: -1, checkSquares: [] }),\n\t\ttotalPlayers\n\t);\n\tprivate castlingQueensideData: Tuple<CastlingData, typeof totalPlayers> = createTupleFromCallback(\n\t\t() => ({ endCoordinates: -1, pieceCoordinates: -1, pieceEndCoordinates: -1, checkSquares: [] }),\n\t\ttotalPlayers\n\t);\n\n\tcreateSnapshot(): FENOptionsSnapshot {\n\t\treturn {\n\t\t\ttagsSnapshot: createFENOptionsTagsSnapshot(this.tags)\n\t\t};\n\t}\n\n\tprivate loadTagSnapshot<V extends FENOptionsTagsSnapshot[keyof FENOptionsTagsSnapshot]>(value: V, tag: DynamicFENOptionTag<V>) {\n\t\ttag.loadSnapshot(value);\n\t}\n\tloadSnapshot(snapshot: FENOptionsSnapshot): void {\n\t\tlet key: keyof FENOptionsTagsSnapshot;\n\t\tfor (key in snapshot.tagsSnapshot) {\n\t\t\tif (!Object.prototype.hasOwnProperty.call(snapshot.tagsSnapshot, key)) continue;\n\t\t\tthis.loadTagSnapshot(snapshot.tagsSnapshot[key], this.tags[key]);\n\t\t}\n\t}\n\n\tprivate verifyKeyTag(key: keyof FENOptionsTags, snapshot: FENOptionsTagsSnapshot): key is keyof FENOptionsTagsSnapshot {\n\t\treturn key in snapshot;\n\t}\n\tcreateClone(): FENOptions {\n\t\tconst newOptions = copyClass(this, FENOptions);\n\t\tconst snapshot = this.createSnapshot();\n\t\tnewOptions.tags = createFENOptionsTags();\n\t\tnewOptions.loadSnapshot(snapshot);\n\n\t\tlet key: keyof FENOptionsTags;\n\t\tfor (key in this.tags) {\n\t\t\tif (Object.prototype.hasOwnProperty.call(this.tags, key) && !this.verifyKeyTag(key, snapshot.tagsSnapshot)) {\n\t\t\t\tnewOptions.tags[key].value = this.tags[key].value;\n\t\t\t}\n\t\t}\n\n\t\treturn newOptions;\n\t}\n\n\ttag<K extends keyof FENOptionsTags>(key: K): FENOptionsTags[K][\"value\"] {\n\t\treturn this.tags[key].value;\n\t}\n\tsetTag<K extends keyof FENOptionsTags>(key: K, value: FENOptionsTags[K][\"value\"]): void {\n\t\tthis.tags[key].value = value;\n\t}\n\n\tcreateSerializedState() {\n\t\tconst serializedState: Partial<FENOptionsSerializedState> = {};\n\t\tlet fenTag: keyof FENOptionsTags;\n\t\tfor (fenTag in this.tags) {\n\t\t\tif (!Object.prototype.hasOwnProperty.call(this.tags, fenTag)) continue;\n\t\t\tconst tag = this.tags[fenTag];\n\t\t\tserializedState[fenTag] = tag.createSnapshot() as never;\n\t\t}\n\n\t\treturn serializedState as FENOptionsSerializedState;\n\t}\n\n\tgenerateCastling(board: Board) {\n\t\tlet [dimensionRY, dimensionBG] = this.tag(\"dim\");\n\t\tif (!this.tag(\"noCorners\")) {\n\t\t\tif (dimensionRY > 8) dimensionRY = 8;\n\t\t\tif (dimensionBG > 8) dimensionBG = 8;\n\t\t}\n\n\t\tconst dimensions: [number, number, number, number] = [dimensionRY, dimensionBG, dimensionRY, dimensionBG];\n\t\tconst royalRanks = this.tag(\"royal\").map((r, i) => (r ? r[getHorizontalPlacementModulus(i)] : r));\n\t\tconst royalCoordinates = this.tag(\"royal\").map((r, i) => (r ? r[getHorizontalPlacementModulus(i)] : r));\n\t\tconst kingsideCastlePieceCoordinate: number[] = [];\n\t\tconst queensideCastlePieceCoordinate: number[] = [];\n\n\t\tconst boardSquares = board.board;\n\t\tfor (let i = 0; i < this.tag(\"royal\").length; i++) {\n\t\t\tconst royalCoordinateI = royalCoordinates[i];\n\t\t\tconst royalRanksI = royalRanks[i];\n\t\t\tif (royalCoordinateI === null || royalRanksI === null) {\n\t\t\t\tkingsideCastlePieceCoordinate.push(-1);\n\t\t\t\tqueensideCastlePieceCoordinate.push(-1);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst condition = i % 2 === 0;\n\t\t\tfor (let j = royalCoordinateI; j < 14; j++) {\n\t\t\t\tconst pieceString = boardSquares[condition ? royalRanksI : j][condition ? j : royalRanksI];\n\t\t\t\tif (!pieceString.isEmpty() && pieceString.piece === this.tag(\"castleWith\")) {\n\t\t\t\t\tkingsideCastlePieceCoordinate.push(j);\n\t\t\t\t\tbreak;\n\t\t\t\t} else if (j === 13) {\n\t\t\t\t\tkingsideCastlePieceCoordinate.push(-1);\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor (let j = royalCoordinateI; j > -1; j--) {\n\t\t\t\tconst pieceString = boardSquares[condition ? royalRanksI : j][condition ? j : royalRanksI];\n\t\t\t\tif (!pieceString.isEmpty() && pieceString.piece === this.tag(\"castleWith\")) {\n\t\t\t\t\tqueensideCastlePieceCoordinate.push(j);\n\t\t\t\t\tbreak;\n\t\t\t\t} else if (j === 0) {\n\t\t\t\t\tqueensideCastlePieceCoordinate.push(-1);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tfor (let i = 0; i < this.tag(\"royal\").length; i++) {\n\t\t\tconst royalCoordinate = royalCoordinates[i];\n\t\t\tif (royalCoordinate === null) continue;\n\n\t\t\tconst d = dimensions[i] - 6 < 1 ? 1 : dimensions[i] - 6;\n\n\t\t\tif (kingsideCastlePieceCoordinate[i] === -1) {\n\t\t\t\tthis.tag(\"castleKingside\")[i] = false;\n\t\t\t} else {\n\t\t\t\tconst kArr = [...Array(kingsideCastlePieceCoordinate[i] - royalCoordinate - 1).keys()];\n\t\t\t\tconst endCoordinates = royalCoordinate + d;\n\t\t\t\tconst castlingData = {\n\t\t\t\t\tendCoordinates,\n\t\t\t\t\tcheckSquares: kArr.map((j) => j + royalCoordinate + 1),\n\t\t\t\t\tpieceCoordinates: kingsideCastlePieceCoordinate[i],\n\t\t\t\t\tpieceEndCoordinates: endCoordinates - 1\n\t\t\t\t};\n\t\t\t\tif (royalCoordinate <= 6) {\n\t\t\t\t\tthis.castlingQueensideData[i] = castlingData;\n\t\t\t\t} else {\n\t\t\t\t\tthis.castlingKingsideData[i] = castlingData;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (queensideCastlePieceCoordinate[i] === -1) {\n\t\t\t\tthis.tags.castleQueenside.value[i] = false;\n\t\t\t} else {\n\t\t\t\tconst qArr = [...Array(royalCoordinate - queensideCastlePieceCoordinate[i] - 1).keys()];\n\t\t\t\tconst endCoordinates = royalCoordinate - d;\n\t\t\t\tconst castlingData = {\n\t\t\t\t\tendCoordinates,\n\t\t\t\t\tcheckSquares: royalCoordinate <= 6 ? qArr.map((j) => j + royalCoordinate - 2) : qArr.map((j) => j + royalCoordinate - 3),\n\t\t\t\t\tpieceCoordinates: queensideCastlePieceCoordinate[i],\n\t\t\t\t\tpieceEndCoordinates: endCoordinates + 1\n\t\t\t\t};\n\t\t\t\tif (royalCoordinate <= 6) {\n\t\t\t\t\tthis.castlingKingsideData[i] = castlingData;\n\t\t\t\t} else {\n\t\t\t\t\tthis.castlingQueensideData[i] = castlingData;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate isCastlingAvailable(player: NumericColor, board: Board, checks: number[]): boolean {\n\t\tconst royal = this.tag(\"royal\")[player];\n\t\tif (royal === null) return false;\n\n\t\tconst royalCoordinate = royal[getVerticalPlacementModulus(player)];\n\t\tconst squares = board.board;\n\n\t\tfor (const checkSquare of checks) {\n\t\t\tconst coordinateA = isVerticalPlacement(player) ? royalCoordinate : checkSquare;\n\t\t\tconst coordinateB = isVerticalPlacement(player) ? checkSquare : royalCoordinate;\n\t\t\tif (\n\t\t\t\t!squares[coordinateA][coordinateB].isEmpty() ||\n\t\t\t\tboard.preGeneratedAttacks[player].hoppingPieces[coordinateA][coordinateB] > 0 ||\n\t\t\t\tboard.preGeneratedAttacks[player].slidingPieces[coordinateA][coordinateB] > 0\n\t\t\t)\n\t\t\t\treturn false;\n\t\t}\n\n\t\tif (board.isKingInCheck(player)) return false;\n\n\t\treturn true;\n\t}\n\n\tisKingsideCastlingAvailable(player: NumericColor, board: Board): boolean {\n\t\tif (!this.tag(\"castleKingside\")[player]) return false;\n\t\tif (this.castlingKingsideData[player].endCoordinates === -1) {\n\t\t\tthis.generateCastling(board);\n\t\t}\n\n\t\treturn this.isCastlingAvailable(player, board, this.castlingKingsideData[player].checkSquares);\n\t}\n\n\tisQueensideCastlingAvailable(player: NumericColor, board: Board): boolean {\n\t\tif (!this.tag(\"castleQueenside\")[player]) return false;\n\t\tif (this.castlingQueensideData[player].endCoordinates === -1) {\n\t\t\tthis.generateCastling(board);\n\t\t}\n\n\t\treturn this.isCastlingAvailable(player, board, this.castlingQueensideData[player].checkSquares);\n\t}\n\n\tprivate getCastlingEndCoordinate(player: NumericColor, coordinates: number | undefined): [number, number] {\n\t\tconst royalCoordinate = this.tag(\"royal\")[player]?.[getVerticalPlacementModulus(player)];\n\t\tassertNonUndefined(coordinates);\n\t\tassertNonUndefined(royalCoordinate);\n\t\tconst coordinateA = isVerticalPlacement(player) ? royalCoordinate : coordinates;\n\t\tconst coordinateB = isVerticalPlacement(player) ? coordinates : royalCoordinate;\n\t\treturn [coordinateA, coordinateB];\n\t}\n\n\tgetKingsideCastlingEndCoordinate(player: NumericColor): [number, number] {\n\t\treturn this.getCastlingEndCoordinate(player, this.castlingKingsideData[player].endCoordinates);\n\t}\n\tgetQueensideCastlingEndCoordinate(player: NumericColor): [number, number] {\n\t\treturn this.getCastlingEndCoordinate(player, this.castlingQueensideData[player].endCoordinates);\n\t}\n\tgetKingsideCastlingPieceEndCoordinate(player: NumericColor): [number, number] {\n\t\treturn this.getCastlingEndCoordinate(player, this.castlingKingsideData[player].pieceEndCoordinates);\n\t}\n\tgetQueensideCastlingPieceEndCoordinate(player: NumericColor): [number, number] {\n\t\treturn this.getCastlingEndCoordinate(player, this.castlingQueensideData[player].pieceEndCoordinates);\n\t}\n\tgetKingsideCastlingTandemPiece(player: NumericColor) {\n\t\treturn this.castlingKingsideData[player].pieceCoordinates;\n\t}\n\tgetQueensideCastlingTandemPiece(player: NumericColor) {\n\t\treturn this.castlingQueensideData[player].pieceCoordinates;\n\t}\n\n\tgetAvailableEnPassantCaptures(baseColor: NumericColor): Coordinate[] {\n\t\tconst coordinates: Coordinate[] = [];\n\t\tthis.tag(\"enPassant\").forEach((enPassant, i) => {\n\t\t\tif (i === baseColor) return;\n\t\t\tif (enPassant) coordinates.push(enPassant[0]);\n\t\t});\n\n\t\treturn coordinates.map((e) => [...e]);\n\t}\n\n\tgetDefaultZombieAlgorithm(baseColor: NumericColor): ZombieMoveGenerationAlgorithm {\n\t\tconst algorithm = botAlgorithms.get(this.tag(\"resigned\")[baseColor] ? this.tag(\"zombieType\")[baseColor] : ZombieType.F_Checker);\n\t\tassertNonUndefined(algorithm);\n\t\treturn algorithm;\n\t}\n}\n","import { Cloneable, isVerticalPlacement, Memento } from \"../../BaseInterfaces\";\nimport type { Board, PlayerBooleanTuple } from \"../Board/Board\";\nimport {\n\tcreateDefaultArmyDeathSettings,\n\tcreateDefaultFENEffectSettings,\n\tFENDataSnapshot,\n\tgetNeighboringSideToMove,\n\tPostMoveResults\n} from \"./FENDataInterface\";\nimport {\n\tDroppingMove,\n\tInternalMove,\n\tInternalMoveSignature,\n\tMoveComponent,\n\tMoveData,\n\tSpecialMove,\n\tverifyDroppingMove,\n\tverifyInternalMove,\n\tverifyStandardMove\n} from \"../MoveTree/MoveTreeInterface\";\nimport { Tuple, createTuple, throwOnNever } from \"../../../baseTypes\";\nimport {\n\tcolors,\n\tDrawnResult,\n\tGeneralTermination,\n\tgetPlayerNameFromColor,\n\tResult,\n\tTermination,\n\ttotalPlayers,\n\tverifyDrawingTermination,\n\tverifyWinningTermination\n} from \"../GameInformation/GameData\";\nimport { PieceString, createPieceFromData, emptyPieceString, deadColorIndex } from \"../GameInformation/GameUnits/PieceString\";\nimport { pieceControlConfigSettings } from \"@moveGeneration/PieceControl/PieceControlInterface\";\nimport { compareCoordinates } from \"../Board/BoardInterface\";\nimport { Coordinate, nonPlayablePieces, NumericColor, verifyNumericColor } from \"../GameInformation/GameUnits/GameUnits\";\nimport type { VariantHandlerTarget } from \"../VariantRules/VariantRuleInterface\";\nimport { FENOptions } from \"./FENOptions/FENOptions\";\n\nconst defaultPointsForMate = 20;\nclass FENData implements VariantHandlerTarget<FENData>, Cloneable<FENData>, Memento<FENDataSnapshot> {\n\tpoints: [number, number, number, number];\n\tsideToMove: NumericColor;\n\tfenOptions: FENOptions;\n\tplyCount: number;\n\tboard!: Board;\n\tprivate privateGameOver: Termination | false = false;\n\n\t__baseClass: FENData;\n\tinitDecoratorSettings() {\n\t\t/* no-op */\n\t}\n\n\tconstructor() {\n\t\tthis.points = [0, 0, 0, 0];\n\t\tthis.sideToMove = 0;\n\t\tthis.fenOptions = new FENOptions();\n\t\tthis.plyCount = 0;\n\t\tthis.__baseClass = this;\n\t}\n\n\tget gameOver() {\n\t\treturn this.privateGameOver;\n\t}\n\n\tset gameOver(gameOver: Termination | false) {\n\t\tif (gameOver === false || this.privateGameOver === false) {\n\t\t\tthis.privateGameOver = gameOver;\n\t\t}\n\t}\n\n\tinjectBoard(board: Board) {\n\t\tthis.board = board;\n\t\tthis.fenOptions.generateCastling(board);\n\t}\n\n\tcreateClone(): FENData {\n\t\tconst newFENData = new FENData();\n\t\tnewFENData.fenOptions = this.fenOptions.createClone();\n\t\tnewFENData.points = [...this.points];\n\t\tnewFENData.sideToMove = this.sideToMove;\n\t\tnewFENData.plyCount = this.plyCount;\n\t\treturn newFENData;\n\t}\n\n\tcreateSnapshot(): FENDataSnapshot {\n\t\treturn {\n\t\t\tpoints: [...this.points],\n\t\t\tsideToMove: this.sideToMove,\n\t\t\tfenOptionsSnapshot: this.fenOptions.createSnapshot(),\n\t\t\tplyCount: this.plyCount,\n\t\t\tgameOver: this.gameOver\n\t\t};\n\t}\n\n\tloadSnapshot(snapshot: FENDataSnapshot): void {\n\t\tthis.fenOptions.loadSnapshot(snapshot.fenOptionsSnapshot);\n\t\tthis.points = [...snapshot.points];\n\t\tthis.sideToMove = snapshot.sideToMove;\n\t\tthis.plyCount = snapshot.plyCount;\n\t\tthis.privateGameOver = snapshot.gameOver;\n\t}\n\n\tgetCapturedPieces(moveData: MoveData): Coordinate[] {\n\t\tconst pieceString = this.board.board[moveData.endCoordinates[0]][moveData.endCoordinates[1]];\n\t\treturn pieceString.isEmpty() || pieceString.isDead() ? [] : [[...moveData.endCoordinates]];\n\t}\n\n\tprivate getCastlingPieceEndCoordinates(coordinates: Coordinate, color: NumericColor): [Coordinate, Coordinate] {\n\t\treturn [\n\t\t\tisVerticalPlacement(color)\n\t\t\t\t? [coordinates[0], this.fenOptions.getKingsideCastlingTandemPiece(color)]\n\t\t\t\t: [this.fenOptions.getKingsideCastlingTandemPiece(color), coordinates[1]],\n\t\t\tisVerticalPlacement(color)\n\t\t\t\t? [coordinates[0], this.fenOptions.getQueensideCastlingTandemPiece(color)]\n\t\t\t\t: [this.fenOptions.getQueensideCastlingTandemPiece(color), coordinates[1]]\n\t\t];\n\t}\n\n\tprocessStandardMove(moveData: MoveData): { endPiece: PieceString[] } {\n\t\tconst {\n\t\t\tstartCoordinates: [startI, startJ],\n\t\t\tendCoordinates: [endI, endJ],\n\t\t\tpromotion\n\t\t} = moveData;\n\t\tconst endPiece = this.board.board[endI][endJ];\n\n\t\tconst piece = promotion?.[0] ?? this.board.board[startI][startJ];\n\t\tconst capturedPieces = this.getCapturedPieces(moveData);\n\t\tthis.board.board[endI][endJ] = piece;\n\t\tthis.board.board[startI][startJ] = emptyPieceString;\n\t\tfor (const coordinate of capturedPieces) {\n\t\t\tif (compareCoordinates(coordinate, moveData.startCoordinates)) {\n\t\t\t\tthis.board.board[endI][endJ] = emptyPieceString;\n\t\t\t} else if (!compareCoordinates(coordinate, moveData.endCoordinates)) {\n\t\t\t\tthis.board.board[coordinate[0]][coordinate[1]] = emptyPieceString;\n\t\t\t}\n\t\t}\n\n\t\tconst [kingsidePiece, queensidePiece] = this.getCastlingPieceEndCoordinates(moveData.startCoordinates, this.sideToMove);\n\t\tif (\"specialType\" in moveData) {\n\t\t\tconst type = moveData.specialType;\n\n\t\t\tswitch (type) {\n\t\t\t\tcase SpecialMove.CastlingKingside: {\n\t\t\t\t\tconst secondKPiece = isVerticalPlacement(this.sideToMove)\n\t\t\t\t\t\t? this.board.board[startI][this.fenOptions.getKingsideCastlingTandemPiece(this.sideToMove)]\n\t\t\t\t\t\t: this.board.board[this.fenOptions.getKingsideCastlingTandemPiece(this.sideToMove)][startJ];\n\t\t\t\t\tconst [kI, kJ] = this.fenOptions.getKingsideCastlingPieceEndCoordinate(this.sideToMove);\n\n\t\t\t\t\tthis.board.board[kI][kJ] = secondKPiece;\n\t\t\t\t\tthis.board.board[kingsidePiece[0]][kingsidePiece[1]] = emptyPieceString;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase SpecialMove.CastlingQueenside: {\n\t\t\t\t\tconst secondQPiece = isVerticalPlacement(this.sideToMove)\n\t\t\t\t\t\t? this.board.board[startI][this.fenOptions.getQueensideCastlingTandemPiece(this.sideToMove)]\n\t\t\t\t\t\t: this.board.board[this.fenOptions.getQueensideCastlingTandemPiece(this.sideToMove)][startJ];\n\t\t\t\t\tconst [qI, qJ] = this.fenOptions.getQueensideCastlingPieceEndCoordinate(this.sideToMove);\n\t\t\t\t\tthis.board.board[qI][qJ] = secondQPiece;\n\t\t\t\t\tthis.board.board[queensidePiece[0]][queensidePiece[1]] = emptyPieceString;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tdefault:\n\t\t\t\t\tif (type === undefined || !(type in SpecialMove)) {\n\t\t\t\t\t\tconsole.error(`Unknown special move constant: ${String(type)}`);\n\t\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst castleKingside = this.fenOptions.tag(\"castleKingside\"),\n\t\t\tcastleQueenside = this.fenOptions.tag(\"castleQueenside\"),\n\t\t\troyal = this.fenOptions.tag(\"royal\");\n\t\tthis.fenOptions.setTag(\n\t\t\t\"royal\",\n\t\t\tthis.fenOptions.tag(\"royal\").map((r, i): Coordinate | null => {\n\t\t\t\tif (r) {\n\t\t\t\t\tif (r[0] === startI && r[1] === startJ) {\n\t\t\t\t\t\tcastleKingside[i] = false;\n\t\t\t\t\t\tcastleQueenside[i] = false;\n\t\t\t\t\t\treturn [endI, endJ];\n\t\t\t\t\t} else return [...r];\n\t\t\t\t} else return null;\n\t\t\t})\n\t\t);\n\n\t\tfor (const color of colors) {\n\t\t\tconst royalPiece = royal[color];\n\t\t\tif (!royalPiece) continue;\n\t\t\tif (compareCoordinates(royalPiece, moveData.startCoordinates)) {\n\t\t\t\tcastleKingside[color] = false;\n\t\t\t\tcastleQueenside[color] = false;\n\t\t\t\tbreak;\n\t\t\t} else if (compareCoordinates(kingsidePiece, moveData.startCoordinates)) {\n\t\t\t\tcastleKingside[color] = false;\n\t\t\t\tbreak;\n\t\t\t} else if (compareCoordinates(queensidePiece, moveData.startCoordinates)) {\n\t\t\t\tcastleQueenside[color] = false;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\treturn { endPiece: endPiece.isEmpty() ? [] : [endPiece] };\n\t}\n\n\tprotected spreadPointsBetweenPlayersEvenly() {\n\t\tconst resigned = this.fenOptions.tag(\"resigned\"),\n\t\t\tdead = this.fenOptions.tag(\"dead\");\n\t\tconst realPlayers = resigned.reduce((p, n, i) => p + Number(n || dead[i]), 0);\n\t\tconst individualPoints = Math.ceil(this.obtainPointsForMate() / realPlayers);\n\t\tfor (const color of colors) {\n\t\t\tif (!dead[color]) {\n\t\t\t\tthis.assignPoints(color, individualPoints);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate branchBetweenResignationMoves(\n\t\tmove: InternalMoveSignature.Resign | InternalMoveSignature.Timeout | InternalMoveSignature.ClaimWin,\n\t\tsideToMove: NumericColor\n\t) {\n\t\tconst playerName = getPlayerNameFromColor(sideToMove).toUpperCase();\n\t\tswitch (move) {\n\t\t\tcase InternalMoveSignature.Resign:\n\t\t\t\tthis.gameOver = `${playerName} RESIGNED!`;\n\t\t\t\tbreak;\n\t\t\tcase InternalMoveSignature.Timeout:\n\t\t\t\tthis.gameOver = `${playerName} FORFEITS ON TIME!`;\n\t\t\t\tbreak;\n\t\t\tcase InternalMoveSignature.ClaimWin:\n\t\t\t\tthis.gameOver = `${playerName} CLAIMED THE WIN!`;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tthrowOnNever(move);\n\t\t}\n\t}\n\n\tprocessInternalMove(internalMove: InternalMove): { stalemates: PlayerBooleanTuple } {\n\t\tconst resigned = this.fenOptions.tag(\"resigned\"),\n\t\t\tdead = this.fenOptions.tag(\"dead\");\n\t\tconst stalemates = createTuple(false, totalPlayers);\n\t\tconst insufficientMaterial = this.board.insufficientMaterialChecker?.checkCurrentState(this.board).every((b, i) => {\n\t\t\tif (i === this.sideToMove) {\n\t\t\t\treturn b;\n\t\t\t} else {\n\t\t\t\treturn b || dead[i];\n\t\t\t}\n\t\t});\n\n\t\tswitch (internalMove.type) {\n\t\t\tcase InternalMoveSignature.Stalemate:\n\t\t\t\tdead[this.sideToMove] = true;\n\t\t\t\tstalemates[this.sideToMove] = true;\n\t\t\t\tbreak;\n\t\t\tcase InternalMoveSignature.Resign:\n\t\t\tcase InternalMoveSignature.Timeout:\n\t\t\t\tif (insufficientMaterial) {\n\t\t\t\t\tthis.assignGeneralTermination(\"Timeout vs Insufficient Material\");\n\t\t\t\t}\n\t\t\t// * Fallthrough\n\t\t\tcase InternalMoveSignature.ClaimWin: {\n\t\t\t\tresigned[this.sideToMove] = true;\n\t\t\t\tthis.turnPiecesDead(this.sideToMove, { ...createDefaultArmyDeathSettings(), excludeRoyals: true, doNotSetDead: true });\n\t\t\t\tconst deadPlayers = dead.map((d, i) => d || resigned[i]).filter(Boolean);\n\n\t\t\t\tlet isResignationOver = deadPlayers.length === totalPlayers - 1;\n\t\t\t\tif (insufficientMaterial) {\n\t\t\t\t\tthis.spreadPointsBetweenPlayersEvenly();\n\t\t\t\t} else if (deadPlayers.length === totalPlayers - 1) {\n\t\t\t\t\tconst alivePlayer = deadPlayers.findIndex((d) => !d);\n\t\t\t\t\tif (verifyNumericColor(alivePlayer)) {\n\t\t\t\t\t\tthis.assignPoints(\n\t\t\t\t\t\t\talivePlayer,\n\t\t\t\t\t\t\tthis.countTotalPointsOnBoard().reduce((p, n, i) => p + (i === alivePlayer ? n : 0), 0)\n\t\t\t\t\t\t);\n\t\t\t\t\t\tisResignationOver = true;\n\t\t\t\t\t}\n\t\t\t\t} else if (!this.board.gameType.isFFA()) {\n\t\t\t\t\tisResignationOver = true;\n\t\t\t\t}\n\n\t\t\t\tif (isResignationOver) {\n\t\t\t\t\tthis.branchBetweenResignationMoves(internalMove.type, this.sideToMove);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase InternalMoveSignature.DrawByAgreement:\n\t\t\t\tthis.gameOver = \"½-½ AGREED.\";\n\t\t\t\tbreak;\n\t\t\tcase InternalMoveSignature.Pass:\n\t\t\t\tbreak;\n\t\t\tcase InternalMoveSignature.TeamsCheckmate: {\n\t\t\t\tthis.gameOver = `CHECKMATE • ${this.getCurrentResult()}`;\n\t\t\t\tthis.turnPiecesDead(this.sideToMove);\n\t\t\t\tthis.turnPiecesDead(this.board.gameType.getTeammateColor(this.sideToMove));\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tdefault:\n\t\t\t\tthrowOnNever(internalMove.type);\n\t\t}\n\n\t\treturn { stalemates };\n\t}\n\n\tprivate processDroppingMove(move: DroppingMove) {\n\t\tconst bank = this.fenOptions.tag(\"bank\"),\n\t\t\tareBanksEnabled = this.fenOptions.tag(\"areBanksEnabled\"),\n\t\t\tsetupComplete = this.fenOptions.tag(\"setupComplete\");\n\t\tif (!this.board.variantData.duckChess && !areBanksEnabled[this.sideToMove]) return;\n\t\tconst playerBank = bank[this.sideToMove];\n\t\tconst pieceStringReference = [...playerBank.keys()].find((pieceString) => pieceString.piece === move.piece.piece);\n\t\tif (!pieceStringReference && !this.board.variantData.duckChess && move.piece.piece !== nonPlayablePieces.duck) return;\n\t\tconst safeReference = pieceStringReference ?? move.piece;\n\n\t\tthis.board.board[move.endCoordinates[0]][move.endCoordinates[1]] = move.piece;\n\n\t\tif (!setupComplete[this.sideToMove]) return;\n\t\tconst bankPieceCount = playerBank.get(safeReference);\n\t\tif (bankPieceCount == 1) {\n\t\t\tplayerBank.delete(safeReference);\n\t\t} else if (bankPieceCount) {\n\t\t\tplayerBank.set(safeReference, bankPieceCount - 1);\n\t\t}\n\t}\n\n\tturnPiecesDead(color: NumericColor, settings = createDefaultArmyDeathSettings()) {\n\t\tconst royal = this.fenOptions.tag(\"royal\"),\n\t\t\tdead = this.fenOptions.tag(\"dead\");\n\t\tconst royalPiece = royal[color];\n\t\tif (!settings.doNotSetDead) {\n\t\t\tdead[color] = true;\n\t\t\troyal[color] = null;\n\t\t}\n\n\t\tfor (const coordinate of this.board.getPlayerPieces()[color]) {\n\t\t\tif (settings.excludeRoyals && royalPiece && compareCoordinates(coordinate, royalPiece)) continue;\n\t\t\tconst piece = this.board.board[coordinate[0]][coordinate[1]].piece;\n\t\t\tif (settings.onlyPawns && !pieceControlConfigSettings[piece].moveGenerationSettings.isPawn) continue;\n\t\t\tthis.board.board[coordinate[0]][coordinate[1]] = createPieceFromData(\n\t\t\t\tdeadColorIndex,\n\t\t\t\tthis.board.board[coordinate[0]][coordinate[1]].piece\n\t\t\t);\n\t\t}\n\t}\n\n\tprivate getKingCaptures() {\n\t\tconst kingCaptures = createTuple(false, totalPlayers);\n\t\tfor (const color of colors) {\n\t\t\tconst royalCoordinate = this.fenOptions.tag(\"royal\")[color];\n\t\t\tif (!royalCoordinate) continue;\n\t\t\tconst pieceString = this.board.board[royalCoordinate[0]][royalCoordinate[1]];\n\t\t\tif (pieceString.isEmpty() || pieceString.color !== color) {\n\t\t\t\tkingCaptures[color] = true;\n\t\t\t}\n\t\t}\n\n\t\treturn kingCaptures;\n\t}\n\n\tprivate processPointsForChecks(currentChecks: Tuple<Set<string>, typeof totalPlayers>) {\n\t\tconst sideToMove = this.sideToMove;\n\t\tconst updatedChecks = this.board.getCurrentChecks(),\n\t\t\tplayerChecks = createTuple(false, totalPlayers);\n\t\tfor (const color of colors) {\n\t\t\tfor (const coordinate of updatedChecks[color]) {\n\t\t\t\tif (!currentChecks[color].has(coordinate)) {\n\t\t\t\t\tplayerChecks[color] = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst checkedPlayers = playerChecks.filter(Boolean).length;\n\t\tif (checkedPlayers === 2) {\n\t\t\tthis.assignPoints(sideToMove, 1);\n\t\t} else if (checkedPlayers === 3) {\n\t\t\tthis.assignPoints(sideToMove, 5);\n\t\t}\n\t}\n\n\taffectOptions(move: MoveComponent, settings = createDefaultFENEffectSettings()): PostMoveResults {\n\t\tlet moveStalemates: PlayerBooleanTuple | undefined;\n\t\tlet endSquare: PieceString[] | undefined;\n\t\tconst currentChecks = this.board.getCurrentChecks().map((arr) => new Set(arr));\n\n\t\tif (verifyInternalMove(move)) {\n\t\t\tmoveStalemates = this.processInternalMove(move).stalemates;\n\t\t} else if (verifyStandardMove(move)) {\n\t\t\tendSquare = this.processStandardMove(move).endPiece;\n\t\t} else if (verifyDroppingMove(move)) {\n\t\t\tthis.processDroppingMove(move);\n\t\t}\n\n\t\tif (!settings.ignoreCheckmateChecks) this.board.pregenerateAttacks();\n\t\tconst { checkmates, stalemates, checks } = settings.ignoreCheckmateChecks\n\t\t\t? {\n\t\t\t\t\tcheckmates: createTuple(false, totalPlayers),\n\t\t\t\t\tchecks: createTuple(false, totalPlayers),\n\t\t\t\t\tstalemates: createTuple(false, totalPlayers)\n\t\t\t  }\n\t\t\t: this.board.getCheckmatesAndStalemates();\n\t\tif (moveStalemates) {\n\t\t\tfor (let i = 0; i < totalPlayers; i++) {\n\t\t\t\tif (moveStalemates[i]) {\n\t\t\t\t\tstalemates[i] = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst totalMateSum = checkmates.reduce((p, n) => (n ? p + this.obtainPointsForMate() : p), 0);\n\t\tconst boardAlternations = {\n\t\t\tpointDistribution: {\n\t\t\t\tcheckmatePoints: checkmates.map((_, i) => (i === this.sideToMove ? totalMateSum : 0)),\n\t\t\t\tpieceCapturingPoints: createTuple(0, totalPlayers)\n\t\t\t}\n\t\t};\n\n\t\tif (endSquare) {\n\t\t\tfor (const piece of endSquare) {\n\t\t\t\tboardAlternations.pointDistribution.pieceCapturingPoints[this.sideToMove] = this.getPointsForPiece(piece);\n\t\t\t}\n\t\t}\n\n\t\tconst kingCaptures = this.getKingCaptures();\n\t\tconst dead = this.fenOptions.tag(\"dead\"),\n\t\t\tresigned = this.fenOptions.tag(\"resigned\");\n\t\tif (this.board.gameType.isFFA()) {\n\t\t\tfor (const color of colors) {\n\t\t\t\tif (dead[color] || resigned[color]) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tif (checkmates[color] || (color === this.sideToMove && stalemates[color])) {\n\t\t\t\t\tthis.turnPiecesDead(color);\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tthis.assignPoints(\n\t\t\t\t\tcolor,\n\t\t\t\t\tboardAlternations.pointDistribution.checkmatePoints[color] + boardAlternations.pointDistribution.pieceCapturingPoints[color]\n\t\t\t\t);\n\t\t\t}\n\t\t} else {\n\t\t\tfor (const color of colors) {\n\t\t\t\tif (kingCaptures[color]) {\n\t\t\t\t\tthis.turnPiecesDead(color);\n\t\t\t\t\tthis.assignGeneralTermination(\"King Captured\");\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tconst realPlayers = this.getRealPlayers();\n\t\tconst isOver = this.board.gameType.isFFA() ? realPlayers === 1 : realPlayers !== totalPlayers;\n\t\tif (isOver) this.assignGeneralTermination(\"Checkmate\");\n\n\t\tif (!settings.ignoreNextTurn && !isOver) {\n\t\t\tthis.processPointsForChecks(currentChecks);\n\n\t\t\tconst insufficientPieces = this.board.insufficientMaterialChecker?.checkCurrentState(this.board);\n\t\t\tif (!this.gameOver && insufficientPieces?.every((insufficient, i) => dead[i] || insufficient)) {\n\t\t\t\tthis.gameOver = `INSUFFICIENT MATERIAL • ${this.getCurrentResult()}`;\n\t\t\t\tthis.spreadPointsBetweenPlayersEvenly();\n\t\t\t}\n\t\t\tif (this.getRealPlayers() > 1) {\n\t\t\t\tthis.sideToMove = this.nextTurn();\n\t\t\t}\n\t\t}\n\n\t\treturn { checkmates, stalemates, checks };\n\t}\n\n\tgetRealPlayers() {\n\t\tconst dead = this.fenOptions.tag(\"dead\"),\n\t\t\tresigned = this.fenOptions.tag(\"resigned\");\n\n\t\tlet totalPlayers = 0;\n\t\tfor (const color of colors) {\n\t\t\tif (resigned[color] || dead[color]) continue;\n\t\t\ttotalPlayers++;\n\t\t}\n\t\treturn totalPlayers;\n\t}\n\n\tnextTurn(player: NumericColor = this.sideToMove): NumericColor {\n\t\tif (this.getRealPlayers() <= 1) throw new Error(\"Next turn called while the game is terminated\");\n\t\treturn getNeighboringSideToMove(player, this.fenOptions.tag(\"dead\"));\n\t}\n\n\tpreviousTurn(player: NumericColor = this.sideToMove): NumericColor {\n\t\tconst dead = this.fenOptions.tag(\"dead\");\n\n\t\tif (this.getRealPlayers() <= 1) throw new Error(\"Previous turn called while the game is terminated\");\n\t\tlet sideToMove: number = player;\n\t\tdo {\n\t\t\tsideToMove = sideToMove === 0 ? totalPlayers - 1 : sideToMove - 1;\n\t\t} while (dead[sideToMove]);\n\n\t\tif (verifyNumericColor(sideToMove)) {\n\t\t\treturn sideToMove;\n\t\t} else throw new Error(`Unexpected numeric color: ${sideToMove}`);\n\t}\n\n\tisComplexEvaluation() {\n\t\treturn false;\n\t}\n\n\tobtainPointsForMate() {\n\t\treturn defaultPointsForMate;\n\t}\n\n\tassignPoints(sideToMove: NumericColor, points: number) {\n\t\tif (points > 0) {\n\t\t\tthis.points[sideToMove] += points;\n\t\t}\n\t}\n\n\tgetPointsForPiece(pieceString: PieceString) {\n\t\tif (pieceString.isPiece() && this.board.gameType.isFFA()) {\n\t\t\treturn pieceControlConfigSettings[pieceString.piece].points.singlesPoints;\n\t\t} else return 0;\n\t}\n\n\tcountTotalPointsOnBoard(): Tuple<number, typeof totalPlayers> {\n\t\tconst royal = this.fenOptions.tag(\"royal\"),\n\t\t\tresigned = this.fenOptions.tag(\"resigned\"),\n\t\t\tzombieImmune = this.fenOptions.tag(\"zombieImmune\");\n\n\t\tconst resultingPoints: Tuple<number, typeof totalPlayers> = [0, 0, 0, 0];\n\t\tthis.board.getPlayerPieces().forEach((army, color) => {\n\t\t\tif (zombieImmune[color]) return;\n\n\t\t\tconst royalPiece = royal[color];\n\t\t\tfor (const coordinate of army) {\n\t\t\t\tif (royalPiece && compareCoordinates(coordinate, royalPiece)) {\n\t\t\t\t\tresultingPoints[color] += this.obtainPointsForMate();\n\t\t\t\t} else if (resigned[color]) {\n\t\t\t\t\tconst piece = this.board.board[coordinate[0]][coordinate[1]].piece;\n\t\t\t\t\tresultingPoints[color] += pieceControlConfigSettings[piece].points.singlesPoints;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\treturn resultingPoints;\n\t}\n\n\tgetCurrentResult(): Result {\n\t\tif (this.board.gameType.isFFA()) {\n\t\t\tconst dead = this.fenOptions.tag(\"dead\"),\n\t\t\t\tresigned = this.fenOptions.tag(\"resigned\");\n\n\t\t\tif (!this.board.isTwoPlayer) throw new Error(\"Result can only get called for 2P and teams\");\n\t\t\tconst max = Math.max(...this.points);\n\t\t\tlet firstAlivePlayer: NumericColor | undefined, maximumIndex: NumericColor | undefined;\n\t\t\tfor (const color of colors) {\n\t\t\t\tif (dead[color] || resigned[color]) continue;\n\t\t\t\tif (this.points[color] === max) {\n\t\t\t\t\tif (maximumIndex === undefined) {\n\t\t\t\t\t\tmaximumIndex = color;\n\t\t\t\t\t} else return \"½-½\";\n\t\t\t\t}\n\t\t\t\tif (firstAlivePlayer === undefined) firstAlivePlayer = color;\n\t\t\t}\n\n\t\t\treturn firstAlivePlayer === maximumIndex ? \"1-0\" : \"0-1\";\n\t\t} else {\n\t\t\tlet result: Result = \"½-½\";\n\t\t\tfor (const color of colors) {\n\t\t\t\tif (this.points[color] > 0) {\n\t\t\t\t\tresult = this.board.gameType.teamSettings.firstTeamColors[color] ? \"1-0\" : \"0-1\";\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn result;\n\t\t}\n\t}\n\n\tassignGeneralTermination(generalTermination: GeneralTermination | DrawnResult, sideToMove?: NumericColor): void {\n\t\tif (this.board.gameType.isFFA() && !this.board.isTwoPlayer) {\n\t\t\tif (sideToMove !== undefined) {\n\t\t\t\tswitch (generalTermination) {\n\t\t\t\t\tcase \"Stalemate\":\n\t\t\t\t\t\tthis.gameOver = `${getPlayerNameFromColor(sideToMove).toUpperCase()} STALEMATED!`;\n\t\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (verifyWinningTermination(generalTermination)) {\n\t\t\t\tthis.gameOver = `${generalTermination.toUpperCase()}!`;\n\t\t\t} else if (verifyDrawingTermination(generalTermination)) {\n\t\t\t\tthis.gameOver = `${generalTermination.toUpperCase()}`;\n\t\t\t} else {\n\t\t\t\tthrowOnNever(generalTermination);\n\t\t\t}\n\t\t} else {\n\t\t\tthis.gameOver = `${generalTermination.toUpperCase()} • ${this.getCurrentResult()}`;\n\t\t}\n\t}\n}\n\nexport { FENData, FENOptions };\n","import type { PlayerBooleanTuple } from \"@moveGeneration/Board/Board\";\nimport { NumericColor, verifyNumericColor } from \"@moveGeneration/GameInformation/GameUnits/GameUnits\";\nimport { Termination, totalPlayers } from \"../GameInformation/GameData\";\nimport type { FENOptionsSnapshot } from \"./FENOptions/FENOptions\";\n\nexport interface FENDataSnapshot {\n\tpoints: [number, number, number, number];\n\tsideToMove: NumericColor;\n\tfenOptionsSnapshot: FENOptionsSnapshot;\n\tplyCount: number;\n\tgameOver: Termination | false;\n}\n\nexport interface PostMoveResults {\n\tchecks: [boolean, boolean, boolean, boolean];\n\tcheckmates: [boolean, boolean, boolean, boolean];\n\tstalemates: [boolean, boolean, boolean, boolean];\n}\n\nexport interface FENEffectSettings {\n\tignoreCheckmateChecks: boolean;\n\tignoreNextTurn: boolean;\n}\n\nexport const createDefaultFENEffectSettings = (): FENEffectSettings => ({\n\tignoreCheckmateChecks: false,\n\tignoreNextTurn: false\n});\n\nexport interface ArmyDeathSettings {\n\texcludeRoyals: boolean;\n\tonlyPawns: boolean;\n\tdoNotSetDead: boolean;\n}\n\nexport const createDefaultArmyDeathSettings = (): ArmyDeathSettings => ({\n\texcludeRoyals: false,\n\tonlyPawns: false,\n\tdoNotSetDead: false\n});\n\nexport function getNeighboringSideToMove(player: NumericColor, dead: PlayerBooleanTuple) {\n\tlet sideToMove: number = player;\n\tdo {\n\t\tsideToMove = sideToMove === totalPlayers - 1 ? 0 : sideToMove + 1;\n\t} while (dead[sideToMove]);\n\n\tif (verifyNumericColor(sideToMove)) {\n\t\treturn sideToMove;\n\t} else throw new Error(`Unexpected numeric color: ${sideToMove}`);\n}\n","import { createTuple, createTupleFromCallback, Tuple, verifyTupleType } from \"@client/ts/baseTypes\";\nimport { compareArrays } from \"@client/ts/utils/ArrayUtils\";\nimport type { PlayerBooleanTuple } from \"../../Board/Board\";\nimport { stringifyCoordinate, unstringifyCoordinate } from \"../../Board/BoardInterface\";\nimport { boardDimension, colors, convertCoordinateToPGN4, totalPlayers } from \"../../GameInformation/GameData\";\nimport { Coordinate, verifyNumericColor } from \"../../GameInformation/GameUnits/GameUnits\";\nimport { createPieceFromString, PieceString } from \"../../GameInformation/GameUnits/PieceString\";\nimport { PieceLetter, verifyPieceLetter } from \"../../PieceControl/PieceControlInterface\";\nimport type { DynamicFENOptionTag, FENOptionsTags, StaticFENOptionTag } from \"./FENOptionsTagsInterface\";\nimport {\n\tverifyZombieType,\n\tZombieType\n} from \"@moveGeneration/VariantRules/VariantRuleDefinitions/BoardVariantModules/EngineMoveGeneration/BotInterface\";\nimport { PGN4_SYNTAX } from \"@client/ts/logic/utils/Tags/Moves/ParsePGNMoves\";\nimport { parseEnPassantCoordinates, parseSingleCoordinate } from \"@client/ts/logic/utils/Tags/Utils\";\nimport { verifyObjectType } from \"@client/ts/utils/ObjectUtils\";\n\ntype ExtractTagsByType<T> = {\n\t[K in keyof FENOptionsTags]: FENOptionsTags[K] extends StaticFENOptionTag<T> ? K : never;\n}[keyof FENOptionsTags];\ntype ExtractTagKeysByType<T> = keyof Pick<FENOptionsTags, ExtractTagsByType<T>>;\n\nconst verifyParameterType = <T>(param: unknown, type: string): param is Tuple<T, typeof totalPlayers> => {\n\treturn Array.isArray(param) && verifyTupleType(param, totalPlayers) && param.every((v) => typeof v === type);\n};\n\ninterface TagFactoryParameters<K extends keyof FENOptionsTags> {\n\tkey: K;\n\tdefaultValue: FENOptionsTags[K][\"value\"];\n}\ninterface DynamicTagFactoryParameters<K extends keyof FENOptionsTags> extends TagFactoryParameters<K> {\n\tisStatic: false;\n}\ninterface StaticTagFactoryParameters<K extends keyof FENOptionsTags> extends TagFactoryParameters<K> {\n\tisStatic: true;\n}\ntype OverloadTagFactoryParameters<K extends keyof FENOptionsTags> = DynamicTagFactoryParameters<K> | StaticTagFactoryParameters<K>;\n\ntype FactoryGeneratedObject<K extends keyof FENOptionsTags> = StaticFENOptionTag<FENOptionsTags[K][\"value\"]> &\n\tPartial<DynamicFENOptionTag<FENOptionsTags[K][\"value\"]>>;\n\ntype BooleanTupleTag = ExtractTagKeysByType<PlayerBooleanTuple>;\nexport function createBooleanTupleTag(parameters: DynamicTagFactoryParameters<BooleanTupleTag>): DynamicFENOptionTag<PlayerBooleanTuple>;\nexport function createBooleanTupleTag(parameters: StaticTagFactoryParameters<BooleanTupleTag>): StaticFENOptionTag<PlayerBooleanTuple>;\nexport function createBooleanTupleTag(parameters: OverloadTagFactoryParameters<BooleanTupleTag>) {\n\tconst { defaultValue, key, isStatic } = parameters;\n\tconst resultingObject: FactoryGeneratedObject<BooleanTupleTag> = {\n\t\tvalue: [...defaultValue],\n\t\tparse(value): PlayerBooleanTuple {\n\t\t\tif (verifyParameterType<boolean>(value, \"boolean\")) {\n\t\t\t\treturn value;\n\t\t\t} else return this.createSnapshot();\n\t\t},\n\t\tserialize() {\n\t\t\tif (key === \"castleKingside\" || key === \"castleQueenside\" || key === \"dead\" || key === \"areBanksEnabled\") return;\n\t\t\tif (!compareArrays(this.value, defaultValue)) {\n\t\t\t\treturn `'${key}':(${this.value.join(\",\")})`;\n\t\t\t} else return;\n\t\t},\n\t\tcreateSnapshot() {\n\t\t\treturn [...this.value];\n\t\t},\n\t\tloadSnapshot(snapshot) {\n\t\t\tconst tuple: PlayerBooleanTuple = [...snapshot];\n\t\t\tthis.value = tuple;\n\t\t}\n\t};\n\n\tif (isStatic) delete resultingObject.loadSnapshot;\n\treturn resultingObject;\n}\n\nconst defaultPawnBaseRank = 2;\nexport const createPawnBaseRankTag = (): FENOptionsTags[\"pawnBaseRank\"] => ({\n\tvalue: defaultPawnBaseRank,\n\tparse(value) {\n\t\treturn typeof value === \"number\" && value > 0 && value <= boardDimension ? value : this.value;\n\t},\n\tserialize() {\n\t\treturn this.value === defaultPawnBaseRank ? undefined : `'pawnBaseRank':${this.value}`;\n\t},\n\tcreateSnapshot() {\n\t\treturn this.value;\n\t}\n});\n\nexport const createEnPassantTag = (): FENOptionsTags[\"enPassant\"] => ({\n\tvalue: createTuple(null, totalPlayers),\n\tparse(input) {\n\t\tif (verifyParameterType<string>(input, \"string\")) {\n\t\t\treturn input.map((v) => parseEnPassantCoordinates(v) ?? null);\n\t\t} else return this.createSnapshot();\n\t},\n\tserialize() {\n\t\tif (this.value.some((v) => !v)) {\n\t\t\treturn `'enPassant':(${this.value\n\t\t\t\t.map((enP) => (enP ? `'${convertCoordinateToPGN4(enP[0])}:${convertCoordinateToPGN4(enP[1])}'` : \"''\"))\n\t\t\t\t.join(\",\")})`;\n\t\t} else return;\n\t},\n\tcreateSnapshot() {\n\t\treturn this.value.map((enP) => (enP ? [[...enP[0]], [...enP[1]]] : enP));\n\t},\n\tloadSnapshot(snapshot) {\n\t\tthis.value = snapshot.map((enP) => (enP ? [[...enP[0]], [...enP[1]]] : enP));\n\t}\n});\n\nconst defaultCastleWith = \"R\";\nexport const createCastleWithTag = (): FENOptionsTags[\"castleWith\"] => ({\n\tvalue: defaultCastleWith,\n\tparse(input) {\n\t\treturn typeof input === \"string\" ? input : this.value;\n\t},\n\tserialize() {\n\t\treturn this.value === defaultCastleWith ? undefined : `'castleWith':${this.value}`;\n\t},\n\tcreateSnapshot() {\n\t\treturn this.value;\n\t}\n});\n\nconst defaultBoxOffset = 0;\nexport const createBoxOffsetTag = (): FENOptionsTags[\"boxOffset\"] => ({\n\tvalue: defaultBoxOffset,\n\tparse(input) {\n\t\treturn typeof input === \"number\" && verifyNumericColor(input) ? input : this.value;\n\t},\n\tserialize() {\n\t\treturn this.value === defaultBoxOffset ? undefined : `'boxOffset':${this.value}`;\n\t},\n\tcreateSnapshot() {\n\t\treturn this.value;\n\t}\n});\n\ntype BooleanTag = ExtractTagsByType<boolean>;\nexport function createBooleanTag(parameters: DynamicTagFactoryParameters<BooleanTag>): DynamicFENOptionTag<boolean>;\nexport function createBooleanTag(parameters: StaticTagFactoryParameters<BooleanTag>): StaticFENOptionTag<boolean>;\nexport function createBooleanTag(parameters: OverloadTagFactoryParameters<BooleanTag>) {\n\tconst { defaultValue, key, isStatic } = parameters;\n\tconst result: FactoryGeneratedObject<BooleanTag> = {\n\t\tvalue: defaultValue,\n\t\tparse(input) {\n\t\t\treturn typeof input === \"boolean\" ? input : this.createSnapshot();\n\t\t},\n\t\tserialize() {\n\t\t\treturn this.value === defaultValue ? undefined : `'${key}':${String(this.value)}`;\n\t\t},\n\t\tcreateSnapshot() {\n\t\t\treturn this.value;\n\t\t},\n\t\tloadSnapshot(snapshot) {\n\t\t\tthis.value = snapshot;\n\t\t}\n\t};\n\n\tif (isStatic) delete result.loadSnapshot;\n\treturn result;\n}\n\nconst defaultDimension: [number, number] = [14, 14];\nexport const createDimensionTag = (): FENOptionsTags[\"dim\"] => ({\n\tvalue: [...defaultDimension],\n\tparse(baseInput) {\n\t\tif (typeof baseInput !== \"string\") return this.createSnapshot();\n\t\tconst input = baseInput.split(\"x\");\n\t\treturn Array.isArray(input) &&\n\t\t\tverifyTupleType(input, 2) &&\n\t\t\tinput.every((i) => {\n\t\t\t\tconst v = Number(i);\n\t\t\t\treturn !isNaN(v) && v >= 2 && v <= 14 && v % 2 === 0;\n\t\t\t})\n\t\t\t? input.map((v) => Number(v)).reverse()\n\t\t\t: this.createSnapshot();\n\t},\n\tserialize() {\n\t\tif (compareArrays(this.value, defaultDimension)) return;\n\t\treturn `'dim':'${this.value.join(\"x\")}'`;\n\t},\n\tcreateSnapshot() {\n\t\treturn [...this.value];\n\t}\n});\n\nconst defaultZombies = createTuple(ZombieType.Rando, totalPlayers);\nexport const createZombiesTag = (): FENOptionsTags[\"zombieType\"] => ({\n\tvalue: [...defaultZombies],\n\tparse(input) {\n\t\tif (Array.isArray(input) && verifyTupleType(input, totalPlayers) && input.every<string>((v): v is string => typeof v === \"string\")) {\n\t\t\tconst newZombies = this.createSnapshot();\n\t\t\tfor (const color of colors) {\n\t\t\t\tconst zombieType = input[color];\n\t\t\t\tif (verifyZombieType(zombieType)) newZombies[color] = zombieType;\n\t\t\t}\n\n\t\t\treturn newZombies;\n\t\t} else return this.createSnapshot();\n\t},\n\tserialize() {\n\t\tif (compareArrays(this.value, defaultZombies)) return;\n\t\treturn `'zombieType':(${this.value.map((t, i) => (t === defaultZombies[i] ? \"''\" : `'${t}'`)).join(\",\")})`;\n\t},\n\tcreateSnapshot() {\n\t\treturn [...this.value];\n\t}\n});\n\nexport const createRoyalTag = (): FENOptionsTags[\"royal\"] => ({\n\tvalue: createTuple(null, totalPlayers),\n\tparse(input) {\n\t\tif (verifyParameterType<string>(input, \"string\")) {\n\t\t\treturn input.map((c) => parseSingleCoordinate(c) ?? null);\n\t\t} else return this.createSnapshot();\n\t},\n\tserialize() {\n\t\treturn `'royal':(${this.value.map((r) => (r ? `'${convertCoordinateToPGN4(r)}'` : \"''\")).join(\",\")})`;\n\t},\n\tcreateSnapshot() {\n\t\treturn this.value.map((c) => (c ? [...c] : c));\n\t},\n\tloadSnapshot(snapshot) {\n\t\tthis.value = snapshot.map((c) => (c ? [...c] : c));\n\t}\n});\n\nexport const createLivesTag = (): FENOptionsTags[\"lives\"] => ({\n\tvalue: createTuple(null, totalPlayers),\n\tparse(input) {\n\t\tif (verifyParameterType<number>(input, \"number\")) {\n\t\t\treturn input;\n\t\t} else return this.createSnapshot();\n\t},\n\tserialize() {\n\t\tif (this.value.some((v) => v !== null)) {\n\t\t\treturn `'lives':(${this.value.map((l) => (l ? String(l) : \"1\")).join(\",\")})`;\n\t\t} else return;\n\t},\n\tcreateSnapshot() {\n\t\treturn [...this.value];\n\t},\n\tloadSnapshot(snapshot) {\n\t\tthis.value = [...snapshot];\n\t}\n});\n\nexport const createBankTag = (): FENOptionsTags[\"bank\"] => ({\n\tvalue: createTupleFromCallback(() => new Map<PieceString, number>(), totalPlayers),\n\tparse(input) {\n\t\tconst defaultBanks = createTupleFromCallback(() => new Map<PieceString, number>(), totalPlayers);\n\t\tif (verifyParameterType<string>(input, \"string\")) {\n\t\t\tfor (const color of colors) {\n\t\t\t\tfor (const pieceDefinition of input[color].split(\",\")) {\n\t\t\t\t\tconst [piece, count = 1] = pieceDefinition.split(\"x\").map((e, i) => (i === 1 ? Number(e) : e));\n\t\t\t\t\tif (typeof piece !== \"string\" || typeof count !== \"number\") continue;\n\t\t\t\t\tif (!/^(?:r|b|y|g).$/.test(piece)) continue;\n\t\t\t\t\tconst pieceLetter = piece.charAt(1);\n\t\t\t\t\tif (verifyPieceLetter(pieceLetter)) {\n\t\t\t\t\t\tdefaultBanks[color].set(createPieceFromString(piece), count);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn defaultBanks;\n\t},\n\tserialize() {\n\t\tif (this.value.some((b) => b.size !== 0)) {\n\t\t\treturn `'bank':(${this.value\n\t\t\t\t.map((bank) => {\n\t\t\t\t\tconst resultingStrings: string[] = [];\n\t\t\t\t\tfor (const [piece, count] of bank) {\n\t\t\t\t\t\tif (count === 1) {\n\t\t\t\t\t\t\tresultingStrings.push(piece.value);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tresultingStrings.push(`${piece.value}x${count}`);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn `'${resultingStrings.join(\",\")}'`;\n\t\t\t\t})\n\t\t\t\t.join(\",\")})`;\n\t\t} else return;\n\t},\n\tcreateSnapshot() {\n\t\treturn this.value.map((m) => [...m.entries()].map(([pieceString, count]) => [pieceString.toObject(), count]));\n\t},\n\tloadSnapshot(snapshot) {\n\t\tthis.value = snapshot.map(\n\t\t\t(v) => new Map(v.map(([pieceStringObject, count]) => [PieceString.fromObjectToClass(pieceStringObject), count]))\n\t\t);\n\t}\n});\n\nexport const createPromotedFromTag = (): FENOptionsTags[\"promotedFrom\"] => ({\n\tvalue: new Map(),\n\tparse(input) {\n\t\tconst promotedFromMap = new Map<Coordinate, PieceLetter>();\n\t\tif (!verifyObjectType(input)) return promotedFromMap;\n\t\tfor (const key in input) {\n\t\t\tif (!Object.prototype.hasOwnProperty.call(promotedFromMap, key)) continue;\n\t\t\tconst parsedCoordinate = parseSingleCoordinate(key);\n\t\t\tconst pieceLetter = input[key];\n\t\t\tif (!parsedCoordinate || typeof pieceLetter !== \"string\" || !verifyPieceLetter(pieceLetter)) continue;\n\n\t\t\tpromotedFromMap.set(parsedCoordinate, pieceLetter);\n\t\t}\n\n\t\treturn promotedFromMap;\n\t},\n\tserialize() {\n\t\tif (this.value.size === 0) return;\n\t\tconst promotedFromStrings: string[] = [];\n\t\tfor (const [coordinate, piece] of this.value) {\n\t\t\tpromotedFromStrings.push(`'${convertCoordinateToPGN4(coordinate)}':'${piece}'`);\n\t\t}\n\n\t\treturn `'promotedFrom':{${promotedFromStrings.join(\",\")}}`;\n\t},\n\tcreateSnapshot() {\n\t\tconst newMap: Array<[Coordinate, PieceLetter]> = [];\n\t\tfor (const [coordinate, pieceLetter] of this.value.entries()) {\n\t\t\tnewMap.push([[...coordinate], pieceLetter]);\n\t\t}\n\n\t\treturn newMap;\n\t},\n\tloadSnapshot(snapshot) {\n\t\tthis.value.clear();\n\t\tfor (const [coordinate, pieceLetter] of snapshot) {\n\t\t\tthis.value.set([...coordinate], pieceLetter);\n\t\t}\n\t}\n});\n\nexport const createSetupPointsTag = (): FENOptionsTags[\"setupPoints\"] => ({\n\tvalue: null,\n\tparse(input) {\n\t\tif (verifyParameterType<number>(input, \"number\")) {\n\t\t\treturn input;\n\t\t} else return this.createSnapshot();\n\t},\n\tserialize() {\n\t\tif (this.value) {\n\t\t\treturn `'setupPoints':(${this.value.join(\",\")})`;\n\t\t} else return;\n\t},\n\tcreateSnapshot() {\n\t\treturn this.value ? [...this.value] : this.value;\n\t},\n\tloadSnapshot(snapshot) {\n\t\tthis.value = snapshot ? [...snapshot] : snapshot;\n\t}\n});\n\nexport const createSeirawanDropsTag = (): FENOptionsTags[\"seirawanDrops\"] => ({\n\tvalue: createTupleFromCallback(() => new Set<string>(), totalPlayers),\n\tparse(input) {\n\t\tconst defaultValue = createTupleFromCallback(() => new Set<string>(), totalPlayers);\n\t\tif (\n\t\t\tArray.isArray(input) &&\n\t\t\t(verifyTupleType(input, totalPlayers) || verifyTupleType(input, totalPlayers + 1)) &&\n\t\t\tinput.every<unknown[]>((v): v is unknown[] => Array.isArray(v))\n\t\t) {\n\t\t\tfor (const color of colors) {\n\t\t\t\tconst seirawanDropsArray = input[color];\n\t\t\t\tif (!seirawanDropsArray.every<string>((v): v is string => typeof v === \"string\")) continue;\n\n\t\t\t\tfor (const pieceDefinition of seirawanDropsArray) {\n\t\t\t\t\tif (!PGN4_SYNTAX.COORDINATE_REGEX.test(pieceDefinition)) continue;\n\t\t\t\t\tconst coordinate = parseSingleCoordinate(pieceDefinition);\n\t\t\t\t\tif (coordinate) {\n\t\t\t\t\t\tdefaultValue[color].add(stringifyCoordinate(coordinate));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn defaultValue;\n\t},\n\tserialize() {\n\t\tif (this.value.every((m) => m.size === 0)) return;\n\t\treturn `'seirawanDrops':(${this.value\n\t\t\t.map((coordinates) => {\n\t\t\t\treturn `(${[...coordinates].map((coord) => `'${convertCoordinateToPGN4(unstringifyCoordinate(coord))}'`).join(\",\")})`;\n\t\t\t})\n\t\t\t.join(\",\")})`;\n\t},\n\tcreateSnapshot() {\n\t\treturn this.value.map((s) => [...s.values()]);\n\t},\n\tloadSnapshot(snapshot) {\n\t\tthis.value = snapshot.map((s) => new Set(s));\n\t}\n});\n","import { createTuple, Tuple } from \"@client/ts/baseTypes\";\nimport type { Coordinate, NumericColor } from \"@moveGeneration/GameInformation/GameUnits/GameUnits\";\nimport type { ZombieType } from \"@moveGeneration/VariantRules/VariantRuleDefinitions/BoardVariantModules/EngineMoveGeneration/BotInterface\";\nimport type { Memento } from \"../../../BaseInterfaces\";\nimport type { PlayerBooleanTuple } from \"../../Board/Board\";\nimport { totalPlayers } from \"../../GameInformation/GameData\";\nimport type { PieceString, PieceStringObject } from \"../../GameInformation/GameUnits/PieceString\";\nimport type { PieceLetter } from \"../../PieceControl/PieceControlInterface\";\nimport * as Tags from \"./FENOptionsTags\";\n\nexport interface StaticFENOptionTag<T, S = T> {\n\tvalue: T;\n\tparse(value: unknown): T;\n\tserialize(): string | undefined;\n\tcreateSnapshot(): S;\n}\nexport type DynamicFENOptionTag<T, S = T> = StaticFENOptionTag<T, S> & Memento<S>;\nexport const verifyDynamicFENOptionKey = (\n\tfenTag: StaticFENOptionTag<unknown> | DynamicFENOptionTag<unknown>,\n\tkey: keyof FENOptionsTags\n): key is keyof FENOptionsTagsSnapshot => \"loadSnapshot\" in fenTag;\nexport const verifyDynamicTag = (fenTag: StaticFENOptionTag<unknown> | DynamicFENOptionTag<unknown>): fenTag is DynamicFENOptionTag<unknown> =>\n\t\"loadSnapshot\" in fenTag;\n\nexport interface FENOptionsTags {\n\tdead: DynamicFENOptionTag<PlayerBooleanTuple>;\n\tresigned: DynamicFENOptionTag<PlayerBooleanTuple>;\n\n\tpawnBaseRank: StaticFENOptionTag<number>;\n\tenPassant: DynamicFENOptionTag<Tuple<[Coordinate, Coordinate] | null, typeof totalPlayers>>;\n\n\tcastleKingside: DynamicFENOptionTag<PlayerBooleanTuple>;\n\tcastleQueenside: DynamicFENOptionTag<PlayerBooleanTuple>;\n\tcastleWith: StaticFENOptionTag<string>;\n\n\tboxOffset: StaticFENOptionTag<NumericColor>;\n\twb: StaticFENOptionTag<boolean>;\n\tdim: StaticFENOptionTag<[number, number]>;\n\tnoCorners: StaticFENOptionTag<boolean>;\n\n\tzombieType: StaticFENOptionTag<Tuple<ZombieType, typeof totalPlayers>>;\n\tzombieImmune: StaticFENOptionTag<PlayerBooleanTuple>;\n\n\troyal: DynamicFENOptionTag<Tuple<Coordinate | null, typeof totalPlayers>>;\n\tlives: DynamicFENOptionTag<Tuple<number | null, typeof totalPlayers>>;\n\n\tbank: DynamicFENOptionTag<\n\t\tTuple<Map<PieceString, number>, typeof totalPlayers>,\n\t\tTuple<Array<[PieceStringObject, number]>, typeof totalPlayers>\n\t>;\n\tpromotedFrom: DynamicFENOptionTag<Map<Coordinate, PieceLetter>, Array<[Coordinate, PieceLetter]>>;\n\tsetupPoints: DynamicFENOptionTag<Tuple<number, typeof totalPlayers> | null>;\n\tsetupComplete: DynamicFENOptionTag<PlayerBooleanTuple>;\n\tseirawanDrops: DynamicFENOptionTag<Tuple<Set<string>, typeof totalPlayers>, Tuple<string[], typeof totalPlayers>>;\n\tareBanksEnabled: DynamicFENOptionTag<PlayerBooleanTuple>;\n}\n\ntype FENOptionsDynamicTags = Pick<\n\tFENOptionsTags,\n\t{\n\t\t[K in keyof FENOptionsTags]: FENOptionsTags[K] extends DynamicFENOptionTag<FENOptionsTags[K][\"value\"]> ? K : never;\n\t}[keyof FENOptionsTags]\n>;\nexport type FENOptionsTagsSnapshot = {\n\t[K in keyof FENOptionsDynamicTags]: ReturnType<FENOptionsTags[K][\"createSnapshot\"]>;\n};\nexport type FENOptionsSerializedState = {\n\t[K in keyof FENOptionsTags]: ReturnType<FENOptionsTags[K][\"createSnapshot\"]>;\n};\n\nexport function createFENOptionsTags(): FENOptionsTags {\n\treturn {\n\t\tdead: Tags.createBooleanTupleTag({ key: \"dead\", defaultValue: createTuple(false, totalPlayers), isStatic: false }),\n\t\tresigned: Tags.createBooleanTupleTag({ key: \"resigned\", defaultValue: createTuple(false, totalPlayers), isStatic: false }),\n\n\t\tpawnBaseRank: Tags.createPawnBaseRankTag(),\n\t\tenPassant: Tags.createEnPassantTag(),\n\n\t\tboxOffset: Tags.createBoxOffsetTag(),\n\t\twb: Tags.createBooleanTag({ key: \"wb\", defaultValue: false, isStatic: true }),\n\t\tdim: Tags.createDimensionTag(),\n\t\tnoCorners: Tags.createBooleanTag({ key: \"noCorners\", defaultValue: false, isStatic: true }),\n\n\t\tcastleKingside: Tags.createBooleanTupleTag({ key: \"castleKingside\", defaultValue: createTuple(true, totalPlayers), isStatic: false }),\n\t\tcastleQueenside: Tags.createBooleanTupleTag({ key: \"castleQueenside\", defaultValue: createTuple(true, totalPlayers), isStatic: false }),\n\t\tcastleWith: Tags.createCastleWithTag(),\n\n\t\tzombieType: Tags.createZombiesTag(),\n\t\tzombieImmune: Tags.createBooleanTupleTag({ key: \"zombieImmune\", defaultValue: createTuple(false, totalPlayers), isStatic: false }),\n\n\t\troyal: Tags.createRoyalTag(),\n\t\tlives: Tags.createLivesTag(),\n\n\t\tbank: Tags.createBankTag(),\n\t\tpromotedFrom: Tags.createPromotedFromTag(),\n\t\tsetupPoints: Tags.createSetupPointsTag(),\n\t\tsetupComplete: Tags.createBooleanTupleTag({ key: \"setupComplete\", defaultValue: createTuple(true, totalPlayers), isStatic: false }),\n\t\tseirawanDrops: Tags.createSeirawanDropsTag(),\n\t\tareBanksEnabled: Tags.createBooleanTupleTag({ key: \"areBanksEnabled\", defaultValue: createTuple(false, totalPlayers), isStatic: false })\n\t};\n}\n\nexport function createFENOptionsTagsSnapshot(tags: FENOptionsTags): FENOptionsTagsSnapshot {\n\tconst resultingTags: Partial<FENOptionsTagsSnapshot> = {};\n\tlet fenTag: keyof FENOptionsTags;\n\tfor (fenTag in tags) {\n\t\tif (!Object.prototype.hasOwnProperty.call(tags, fenTag)) continue;\n\t\tconst tag = tags[fenTag];\n\t\tif (!verifyDynamicFENOptionKey(tag, fenTag) || !verifyDynamicTag(tag)) continue;\n\t\tresultingTags[fenTag] = tag.createSnapshot() as never;\n\t}\n\n\treturn resultingTags as FENOptionsTagsSnapshot;\n}\n","import { throwOnNever, Tuple } from \"@client/ts/baseTypes\";\nimport { truncateNumber } from \"@utils/NumberUtils\";\nimport type { Coordinate, NumericColor } from \"./GameUnits/GameUnits\";\n\nexport type PlayerName = \"Red\" | \"Blue\" | \"Yellow\" | \"Green\" | \"White\" | \"Black\";\nexport type IndividualTermination = \"Won the Race\" | \"Checkmated\" | \"Stalemated\" | \"Forfeits on Time\" | \"Resigned\" | \"Claimed the Win\";\nexport type GeneralTermination = \"King of the Hill\" | \"King Captured\" | \"Checkmate\" | \"Stalemate\";\nexport type Result = \"1-0\" | \"0-1\" | \"½-½\";\nexport type DrawnResult = \"Threefold Repetition\" | \"Insufficient Material\" | \"Timeout vs Insufficient Material\" | \"50-move Rule\";\nexport type Termination =\n\t| `${Uppercase<PlayerName>} ${Uppercase<IndividualTermination>}!`\n\t| `${Uppercase<GeneralTermination | DrawnResult>} • ${Result}`\n\t| `${Uppercase<GeneralTermination>}!`\n\t| `${Uppercase<DrawnResult>}`\n\t| \"½-½ AGREED.\";\nexport const validateComprehensiveUnionArray =\n\t<T>() =>\n\t<U extends readonly T[]>(arr: U & ([T] extends [U[number]] ? unknown : never)) =>\n\t\tarr;\n\nexport interface TimeControl {\n\tbaseTime: number;\n\tincrement: number;\n\tisDelay: boolean;\n}\n\nexport const playerNames = validateComprehensiveUnionArray<PlayerName>()([\"Red\", \"Blue\", \"Yellow\", \"Green\", \"White\", \"Black\"] as const);\nconst individualTerminations = validateComprehensiveUnionArray<IndividualTermination>()([\n\t\"Won the Race\",\n\t\"Checkmated\",\n\t\"Stalemated\",\n\t\"Forfeits on Time\",\n\t\"Claimed the Win\",\n\t\"Resigned\"\n] as const);\nconst generalWinningTerminations = validateComprehensiveUnionArray<GeneralTermination>()([\n\t\"Checkmate\",\n\t\"King Captured\",\n\t\"King of the Hill\",\n\t\"Stalemate\"\n] as const);\nexport const verifyWinningTermination = (termination: string): termination is GeneralTermination => {\n\tconst generalWins: readonly string[] = generalWinningTerminations;\n\treturn generalWins.includes(termination);\n};\nconst generalDrawingTerminations = validateComprehensiveUnionArray<DrawnResult>()([\n\t\"50-move Rule\",\n\t\"Insufficient Material\",\n\t\"Threefold Repetition\",\n\t\"Timeout vs Insufficient Material\"\n] as const);\nexport const verifyDrawingTermination = (termination: string): termination is DrawnResult => {\n\tconst generalDraws: readonly string[] = generalDrawingTerminations;\n\treturn generalDraws.includes(termination);\n};\nconst generalTerminations = validateComprehensiveUnionArray<GeneralTermination | DrawnResult>()([\n\t...generalWinningTerminations,\n\t...generalDrawingTerminations\n] as const);\nconst results = validateComprehensiveUnionArray<Result>()([\"0-1\", \"1-0\", \"½-½\"]);\n\nexport interface GamePlayerData {\n\telo?: number;\n\tname?: string;\n}\nexport interface GameData {\n\tgameNumber: number | undefined;\n\ttimeControl: TimeControl;\n\tplayers: Tuple<GamePlayerData, typeof totalPlayers>;\n\tsite: string | undefined;\n\tdate: Date | string | undefined;\n\tresult: string | undefined;\n\ttermination: Termination | undefined;\n}\n\nexport const validateTerminationString = (termination: string): termination is Termination => {\n\tconst capitalizedTermination = termination.toUpperCase();\n\tif (\n\t\tplayerNames.some((str) => capitalizedTermination.startsWith(str.toUpperCase())) &&\n\t\tindividualTerminations.some((str) => capitalizedTermination.endsWith(str.toUpperCase() + \"!\"))\n\t) {\n\t\treturn true;\n\t} else if (\n\t\t/.*?\\s•\\s.*/.test(capitalizedTermination) &&\n\t\tgeneralTerminations.some((str) => capitalizedTermination.startsWith(str.toUpperCase())) &&\n\t\tresults.some((str) => capitalizedTermination.endsWith(str.toUpperCase()))\n\t) {\n\t\treturn true;\n\t} else if (capitalizedTermination === \"½-½ AGREED.\") {\n\t\treturn true;\n\t}\n\n\treturn false;\n};\n\nexport const stringifyTimeControl = (timeControl: TimeControl): string => {\n\tconst noIncrement = timeControl.increment === 0;\n\tlet timeControlString = \"\";\n\tif (timeControl.baseTime < 60) {\n\t\ttimeControlString += noIncrement ? `${timeControl.baseTime * 60} sec` : `${timeControl.baseTime * 60}s`;\n\t} else if (timeControl.baseTime > 60 && noIncrement) {\n\t\ttimeControlString += `${truncateNumber(timeControl.baseTime / 60, 1)} min`;\n\t} else {\n\t\ttimeControlString += truncateNumber(timeControl.baseTime / 60, 1);\n\t}\n\n\tif (!noIncrement) {\n\t\ttimeControlString += \"|\";\n\t\ttimeControlString += timeControl.increment;\n\t}\n\tif (timeControl.isDelay) {\n\t\ttimeControlString += \"D\";\n\t}\n\n\treturn timeControlString;\n};\nexport const obtainTimeControlType = (timeControl: TimeControl): TimeControlType => {\n\tconst { baseTime, increment, isDelay } = timeControl;\n\tif (isDelay) {\n\t\tconst formula = baseTime / 40 + increment;\n\t\tif (formula > 11.5) {\n\t\t\treturn TimeControlType.Rapid;\n\t\t} else if (formula <= 1.375) {\n\t\t\treturn TimeControlType.Hyperbullet;\n\t\t} else if (formula <= 4.5) {\n\t\t\treturn TimeControlType.Bullet;\n\t\t} else {\n\t\t\treturn TimeControlType.Blitz;\n\t\t}\n\t} else {\n\t\tconst formula = baseTime / 60 + increment;\n\t\tif (formula > 7.5) {\n\t\t\treturn TimeControlType.Rapid;\n\t\t} else if (formula <= 0.5) {\n\t\t\treturn TimeControlType.Hyperbullet;\n\t\t} else if (formula <= 3) {\n\t\t\treturn TimeControlType.Bullet;\n\t\t} else {\n\t\t\treturn TimeControlType.Blitz;\n\t\t}\n\t}\n};\n\nexport const convertCoordinateToPGN4 = (coordinate: Coordinate, dimension = boardDimension): string => {\n\tif (dimension === boardDimension) {\n\t\treturn `${String.fromCharCode(coordinate[1] + 97)}${boardDimension - coordinate[0]}`;\n\t} else {\n\t\tconst alternation = (boardDimension - dimension) / 2;\n\t\treturn `${String.fromCharCode(coordinate[1] - alternation + 97)}${boardDimension - coordinate[0] - alternation}`;\n\t}\n};\nexport const convertCoordinateToPGN4Array = (coordinate: Coordinate, dimension = boardDimension): [string, number] => {\n\tif (dimension === boardDimension) {\n\t\treturn [String.fromCharCode(coordinate[1] + 97), boardDimension - coordinate[0]];\n\t} else {\n\t\tconst alternation = (boardDimension - dimension) / 2;\n\t\treturn [String.fromCharCode(coordinate[1] - alternation + 97), boardDimension - coordinate[0] - alternation];\n\t}\n};\n\nexport const getOppositePlacedColor = (color: NumericColor) => {\n\tswitch (color) {\n\t\tcase 0:\n\t\t\treturn 2;\n\t\tcase 1:\n\t\t\treturn 3;\n\t\tcase 2:\n\t\t\treturn 0;\n\t\tcase 3:\n\t\t\treturn 1;\n\t\tdefault:\n\t\t\treturn throwOnNever(color);\n\t}\n};\nexport const getPlayerNameFromColor = (color: NumericColor, wb = false): PlayerName => {\n\tswitch (color) {\n\t\tcase 0:\n\t\t\treturn wb ? \"White\" : \"Red\";\n\t\tcase 1:\n\t\t\treturn \"Blue\";\n\t\tcase 2:\n\t\t\treturn wb ? \"Black\" : \"Yellow\";\n\t\tcase 3:\n\t\t\treturn \"Green\";\n\t\tdefault:\n\t\t\treturn throwOnNever(color);\n\t}\n};\n\ninterface NumericColorAugmentationSettings {\n\twb: boolean;\n}\nexport const createDefaultNumericColorAdjustment = (): NumericColorAugmentationSettings => ({\n\twb: false\n});\n\nexport enum TimeControlType {\n\tHyperbullet = \"Hyperbullet\",\n\tBullet = \"Bullet\",\n\tBlitz = \"Blitz\",\n\tRapid = \"Rapid\"\n}\nexport enum VariantType {\n\tFFA = \"FFA\",\n\tTeams = \"Teams\",\n\tSolo = \"Solo\"\n}\n\nexport const totalPlayers = 4;\nexport const boardDimension = 14;\nexport const colors: readonly NumericColor[] = [0, 1, 2, 3];\n","import type { PlayerName } from \"../GameData\";\n\nexport type Coordinate = [i: number, j: number] | [i: number, j: number, promotion: string];\nexport type NumericColor = 0 | 1 | 2 | 3;\nexport const verifyNumericColor = (num: number): num is NumericColor => num >= 0 && num < 4;\nexport const nonPlayablePieces = {\n\twall: \"X\",\n\ttransparentWall: \"x\",\n\tduck: \"Θ\"\n} as const;\n\nexport const colorEnum = {\n\tr: 0,\n\tb: 1,\n\ty: 2,\n\tg: 3\n} as const;\nexport const verifyColorEnumValue = (value: string): value is keyof typeof colorEnum => value in colorEnum;\n\nexport const playerEnum: Record<PlayerName, NumericColor> = {\n\tRed: 0,\n\tBlue: 1,\n\tYellow: 2,\n\tGreen: 3,\n\tWhite: 0,\n\tBlack: 2\n} as const;\nexport const verifyPlayerEnumValue = (player: string): player is PlayerName => player in playerEnum;\n\nexport const stringColorEnum = {\n\t[0]: \"r\",\n\t[1]: \"b\",\n\t[2]: \"y\",\n\t[3]: \"g\",\n\t[4]: \"d\"\n} as const;\nexport type ColorEnum = (typeof stringColorEnum)[keyof typeof stringColorEnum];\n","import {\n\tduckLetter,\n\temptyLetter,\n\tpawnPieceLetter,\n\tPieceLetter,\n\tverifyPieceLetter,\n\twallPieceLetter\n} from \"@moveGeneration/PieceControl/PieceControlInterface\";\nimport { colorEnum, nonPlayablePieces, NumericColor, stringColorEnum } from \"./GameUnits\";\n\nexport const deadColorIndex = 4;\ninterface PieceStringInterface {\n\treadonly value: string;\n\tisDead(): boolean;\n\tisEmpty(): boolean;\n\tisWall(): boolean;\n\tisPiece(): boolean;\n\tgetStringifiedColor(): keyof typeof colorEnum;\n\treadonly color: NumericColor | typeof deadColorIndex;\n\treadonly piece: PieceLetter;\n}\n\ninterface EmptyPieceStringInterface extends PieceStringInterface {\n\tisDead(): false;\n\tisEmpty(): true;\n\tisWall(): false;\n\tisPiece(): false;\n\treadonly color: never;\n\treadonly piece: never;\n}\nexport type EmptyPieceString = PieceString & EmptyPieceStringInterface;\n\ninterface WallPieceStringInterface extends PieceStringInterface {\n\tisDead(): true;\n\tisEmpty(): false;\n\tisWall(): true;\n\tisPiece(): false;\n\treadonly color: typeof deadColorIndex;\n\treadonly piece: PieceLetter & (typeof nonPlayablePieces)[keyof typeof nonPlayablePieces];\n}\nexport type WallPieceString = PieceString & WallPieceStringInterface;\n\ninterface DeadPieceStringInterface extends PieceStringInterface {\n\tisDead(): true;\n\tisEmpty(): false;\n\tisWall(): false;\n\tisPiece(): true;\n\treadonly color: typeof deadColorIndex;\n}\nexport type DeadPieceString = PieceString & DeadPieceStringInterface;\n\ninterface ActivePieceStringInterface extends PieceStringInterface {\n\tisDead(): false;\n\tisEmpty(): false;\n\tisWall(): false;\n\tisPiece(): true;\n\treadonly color: NumericColor;\n}\nexport type ActivePieceString = PieceString & ActivePieceStringInterface;\n\nexport interface PieceStringObject {\n\treadonly _color: NumericColor | typeof deadColorIndex;\n\treadonly _piece: PieceLetter;\n\treadonly value: string;\n}\n\nexport class PieceString implements PieceStringInterface {\n\tstatic comparePieceStrings(pieceString1: PieceString, pieceString2: PieceString) {\n\t\treturn pieceString1._piece === pieceString2._piece && pieceString1._color === pieceString2._color;\n\t}\n\n\tstatic comparePieceStringObjects(pieceString1: PieceStringObject, pieceString2: PieceStringObject) {\n\t\treturn pieceString1._piece === pieceString2._piece && pieceString1._color === pieceString2._color;\n\t}\n\n\tstatic fromObjectToClass(object: PieceStringObject) {\n\t\treturn new PieceString(object._color, object._piece);\n\t}\n\n\treadonly value: string;\n\tconstructor(private readonly _color: NumericColor | typeof deadColorIndex, private readonly _piece: PieceLetter) {\n\t\tthis.value = _piece.length ? (/[xXΘ]/.test(_piece) ? _piece : stringColorEnum[_color] + _piece) : \"\";\n\t}\n\n\tisDead(): this is DeadPieceStringInterface {\n\t\treturn this._color === deadColorIndex && !this.isWall();\n\t}\n\tisEmpty(): this is EmptyPieceStringInterface {\n\t\treturn this._piece.length === 0;\n\t}\n\tisWall(): this is WallPieceStringInterface {\n\t\treturn this.value.length === 1;\n\t}\n\tisPiece(): this is ActivePieceStringInterface {\n\t\treturn this.value.length === 2 && this._color !== deadColorIndex;\n\t}\n\n\tget piece() {\n\t\tif (this.isEmpty()) throw new TypeError(\"Accessing a piece string piece value while the piece string is empty.\");\n\t\treturn this._piece;\n\t}\n\n\tget color() {\n\t\tif (this.isEmpty()) throw new TypeError(\"Accessing a piece string color value while the piece string is empty.\");\n\t\treturn this._color;\n\t}\n\n\tgetStringifiedColor(): keyof typeof colorEnum {\n\t\treturn this.value.charAt(0) as keyof typeof colorEnum;\n\t}\n\n\ttoObject(): PieceStringObject {\n\t\treturn {\n\t\t\t_piece: this._piece,\n\t\t\t_color: this._color,\n\t\t\tvalue: this.value\n\t\t};\n\t}\n}\n\nexport const createPieceFromData = (color: NumericColor | typeof deadColorIndex, piece: string) => {\n\tif (verifyPieceLetter(piece)) {\n\t\treturn new PieceString(color, piece);\n\t}\n\tthrow new Error(\"Wrong color signature for the piece provided\");\n};\nexport const createPieceFromString = (piece: string) => {\n\tconst verifyColorEnum = (p: string): p is keyof typeof colorEnum => p in colorEnum;\n\n\tif (piece.length === 1 && verifyPieceLetter(piece)) {\n\t\treturn new PieceString(deadColorIndex, piece);\n\t} else {\n\t\tconst color = piece.charAt(0);\n\t\tconst pieceLetter = piece.charAt(1);\n\t\tif (!verifyPieceLetter(pieceLetter)) throw new Error(\"Wrong signature for the piece provided\");\n\t\tif (color === \"d\") {\n\t\t\treturn new PieceString(deadColorIndex, pieceLetter);\n\t\t} else {\n\t\t\tif (verifyColorEnum(color)) {\n\t\t\t\treturn new PieceString(colorEnum[color], pieceLetter);\n\t\t\t} else throw new Error(\"Wrong color signature for the piece provided\");\n\t\t}\n\t}\n};\n\nconst testEmptyPieceString = new PieceString(0, emptyLetter);\nif (!testEmptyPieceString.isEmpty()) throw new Error(\"Empty piece string is not isEmpty\");\nexport const emptyPieceString: EmptyPieceString = testEmptyPieceString;\n\nconst testWallPieceString = new PieceString(deadColorIndex, wallPieceLetter);\nif (!testWallPieceString.isWall()) throw new Error(\"Wall piece string is not isWall\");\nexport const wallPieceString: WallPieceString = testWallPieceString;\n\nconst testActivePieceString = new PieceString(0, pawnPieceLetter);\nif (!testActivePieceString.isPiece()) throw new Error(\"Active piece string is not isActive\");\nexport const pawnPieceString: ActivePieceString = testActivePieceString;\n\nconst testDuckPieceString = new PieceString(deadColorIndex, duckLetter);\nif (!testDuckPieceString.isWall()) throw new Error(\"Wall piece string is not isWall\");\nexport const duckPieceString: ActivePieceString = testActivePieceString;\n","import { throwOnNever } from \"@client/ts/baseTypes\";\nimport type { Coordinate } from \"@moveGeneration/GameInformation/GameUnits/GameUnits\";\nimport { compareArrays } from \"../../../utils/ArrayUtils\";\nimport { isVerticalPlacement } from \"../../BaseInterfaces\";\nimport { unstringifyCoordinate } from \"../Board/BoardInterface\";\nimport { convertCoordinateToPGN4Array, convertCoordinateToPGN4 } from \"../GameInformation/GameData\";\nimport { deadColorIndex, pawnPieceString } from \"../GameInformation/GameUnits/PieceString\";\nimport {\n\tMoveData,\n\tMoveTreeSnapshot,\n\tMoveWrapper,\n\tMoveWrapperMetadata,\n\tSpecialMove,\n\tverifyDroppingMove,\n\tverifyInternalMove,\n\tverifyStandardMove\n} from \"./MoveTreeInterface\";\n\nexport type MoveNotationStringify = (moveWrapper: MoveWrapper, snapshot: MoveTreeSnapshot, dimension: number) => string;\n\nfunction generateCastlingString(moveData: MoveData): string {\n\tswitch (moveData.specialType) {\n\t\tcase SpecialMove.CastlingKingside:\n\t\t\treturn \"O-O\";\n\t\tcase SpecialMove.CastlingQueenside:\n\t\t\treturn \"O-O-O\";\n\t\tdefault:\n\t\t\treturn \"\";\n\t}\n}\n\nfunction extractPiece(metadata: MoveWrapperMetadata): string {\n\treturn metadata.movingPiece.piece !== pawnPieceString.piece ? metadata.movingPiece.piece : \"\";\n}\n\nfunction obtainAmbiguousOrthogonality(parameters: {\n\tmoveMetadata: MoveWrapperMetadata;\n\tmove: MoveData;\n\tsnapshot: MoveTreeSnapshot;\n\tisCapture: boolean;\n}) {\n\tconst {\n\t\tmoveMetadata,\n\t\tmove,\n\t\tsnapshot: {\n\t\t\tboardSnapshot: { board },\n\t\t\tpregeneratedAttacks: { pieceMovements }\n\t\t},\n\t\tisCapture\n\t} = parameters;\n\tconst { piece, color } = moveMetadata.movingPiece;\n\tconst isPawn = piece === pawnPieceString.piece;\n\tconst registeredPieces: Coordinate[] = [];\n\tfor (const [piece, movements] of pieceMovements) {\n\t\tconst parsedCoordinate = unstringifyCoordinate(piece);\n\t\tconst boardPiece = board[parsedCoordinate[0]][parsedCoordinate[1]];\n\t\tif (boardPiece.isEmpty() || boardPiece.color !== color || boardPiece.piece !== piece) continue;\n\t\tif (movements.find((m) => compareArrays(move.endCoordinates, m.move)) !== undefined) {\n\t\t\tregisteredPieces.push(parsedCoordinate);\n\t\t}\n\t}\n\n\tif (color === deadColorIndex) return [false, false];\n\tconst ambiguousRank =\n\t\t(isCapture && isPawn && isVerticalPlacement(color)) ||\n\t\tregisteredPieces.some((c, i) => registeredPieces.some((c2, j) => i !== j && c[0] === c2[0]));\n\tconst ambiguousFile =\n\t\t(isCapture && isPawn && !isVerticalPlacement(color)) ||\n\t\tregisteredPieces.some((c, i) => registeredPieces.some((c2, j) => i !== j && c[1] === c2[1]));\n\n\treturn [ambiguousRank, ambiguousFile];\n}\n\nfunction extractPromotion(move: MoveData): string {\n\treturn move.promotion ? `=${move.promotion[0].piece}` : \"\";\n}\n\nfunction extractChecksAndCheckmates(metadata: MoveWrapperMetadata): string {\n\treturn \"+\".repeat(metadata.checks) + \"#\".repeat(metadata.checkmates);\n}\n\nexport const shortenedMoveNotationStringify: MoveNotationStringify = (moveWrapper, snapshot, dimension) => {\n\tlet resultingString = \"\";\n\tlet isFirstCapturingMoveSet = false;\n\tfor (const move of moveWrapper.moveData) {\n\t\tif (verifyStandardMove(move)) {\n\t\t\tif ((resultingString += generateCastlingString(move))) continue;\n\t\t\tresultingString += extractPiece(moveWrapper.metadata);\n\t\t\tconst isCapture = !isFirstCapturingMoveSet && moveWrapper.metadata.isCapture;\n\t\t\tconst [ambiguousRank, ambiguousFile] = obtainAmbiguousOrthogonality({\n\t\t\t\tisCapture,\n\t\t\t\tmove,\n\t\t\t\tsnapshot,\n\t\t\t\tmoveMetadata: moveWrapper.metadata\n\t\t\t});\n\n\t\t\tif (ambiguousFile && !ambiguousRank) {\n\t\t\t\tresultingString += convertCoordinateToPGN4Array(move.startCoordinates, dimension)[1];\n\t\t\t} else if (!ambiguousFile && ambiguousRank) {\n\t\t\t\tresultingString += convertCoordinateToPGN4Array(move.startCoordinates, dimension)[0];\n\t\t\t} else if (ambiguousFile && ambiguousRank) {\n\t\t\t\tresultingString += convertCoordinateToPGN4(move.startCoordinates, dimension);\n\t\t\t}\n\n\t\t\tif (isCapture) {\n\t\t\t\tresultingString += \"x\";\n\t\t\t\tisFirstCapturingMoveSet = true;\n\t\t\t}\n\t\t\tresultingString += convertCoordinateToPGN4(move.endCoordinates, dimension);\n\t\t\tresultingString += extractPromotion(move);\n\t\t} else if (verifyDroppingMove(move)) {\n\t\t\tresultingString += `@${move.piece.piece}`;\n\t\t\tresultingString += `${convertCoordinateToPGN4(move.endCoordinates, dimension)}`;\n\t\t} else if (verifyInternalMove(move)) {\n\t\t\tresultingString += move.type;\n\t\t} else throwOnNever(move);\n\t}\n\n\tresultingString += extractChecksAndCheckmates(moveWrapper.metadata);\n\tresultingString += moveWrapper.metadata.annotation ?? \"\";\n\treturn resultingString;\n};\n\nexport const fullMoveNotationStringify: MoveNotationStringify = (moveWrapper) => {\n\tlet resultingString = \"\";\n\tlet firstStandardMoveCaptureSet = false;\n\tfor (const move of moveWrapper.moveData) {\n\t\tif (verifyStandardMove(move)) {\n\t\t\tif ((resultingString += generateCastlingString(move))) continue;\n\t\t\tresultingString += extractPiece(moveWrapper.metadata);\n\t\t\tresultingString += convertCoordinateToPGN4(move.startCoordinates);\n\t\t\tif (!firstStandardMoveCaptureSet && moveWrapper.metadata.isCapture) {\n\t\t\t\tresultingString += \"x\";\n\t\t\t\tfirstStandardMoveCaptureSet = true;\n\t\t\t} else resultingString += \"-\";\n\t\t\tresultingString += convertCoordinateToPGN4(move.endCoordinates);\n\t\t\tresultingString += extractPromotion(move);\n\t\t} else if (verifyDroppingMove(move)) {\n\t\t\tresultingString += `@${move.piece.piece}`;\n\t\t\tresultingString += `-${convertCoordinateToPGN4(move.endCoordinates)}`;\n\t\t} else if (verifyInternalMove(move)) {\n\t\t\tresultingString += move.type;\n\t\t} else throwOnNever(move);\n\t}\n\n\tresultingString += extractChecksAndCheckmates(moveWrapper.metadata);\n\treturn resultingString;\n};\n\nexport const moveNotation = {\n\tfullMoveNotation: fullMoveNotationStringify,\n\tshortenedMoveNotation: shortenedMoveNotationStringify\n} as const;\n","import type { BoardSnapshot, PreGeneratedAttacks } from \"../Board/BoardInterface\";\nimport {\n\tMoveWrapper,\n\tcompareMoves,\n\tgetMoveFromPathAndTree,\n\tMoveTreeSetNewMoveParameters,\n\tMoveTreeSnapshot,\n\tMove,\n\tMoveData,\n\tverifyStandardMove,\n\tProcessSafeMoveWrapper\n} from \"./MoveTreeInterface\";\nimport { moveNotation } from \"./MoveNotationStringifier\";\nimport { compareArrays, findLastIndex } from \"@utils/ArrayUtils\";\nimport type { Board, PlayerBooleanTuple } from \"@moveGeneration/Board/Board\";\nimport type { PostMoveResults } from \"@moveGeneration/FENData/FENDataInterface\";\nimport { pawnPieceString } from \"@moveGeneration/GameInformation/GameUnits/PieceString\";\nimport { colors } from \"@moveGeneration/GameInformation/GameData\";\nimport { FENOptionsTags, verifyDynamicFENOptionKey } from \"@moveGeneration/FENData/FENOptions/FENOptionsTagsInterface\";\n\nexport function alterCurrentPath(current: number[], path: number[]) {\n\tlet currentMove = [...current];\n\n\tfor (let i = 0; i < currentMove.length; i++) {\n\t\tif (path[i] > currentMove[i]) break;\n\t\tif (path[i] === currentMove[i]) {\n\t\t\tif (i === path.length - 1) {\n\t\t\t\tcurrentMove = currentMove.slice(0, i + 1);\n\t\t\t\tcurrentMove[i]--;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t} else {\n\t\t\tcurrentMove = currentMove.slice(0, i + 1);\n\t\t\tcurrentMove[i] = path[i] - 1;\n\t\t\tbreak;\n\t\t}\n\t}\n\n\tconst indexOfMinus = currentMove.indexOf(-1);\n\tif (indexOfMinus !== -1) {\n\t\tcurrentMove = currentMove.slice(0, indexOfMinus);\n\n\t\tlet lastNumber = 0;\n\t\tdo {\n\t\t\tconst popped = currentMove.pop();\n\t\t\tif (popped === undefined) {\n\t\t\t\tlastNumber = -1;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tlastNumber = popped;\n\t\t} while (lastNumber <= 0);\n\n\t\tif (lastNumber !== -1) currentMove.push(lastNumber);\n\t}\n\n\treturn currentMove;\n}\n\nexport function verifyValidMove<T extends ProcessSafeMoveWrapper>(move: T | T[] | undefined): move is T {\n\treturn move !== undefined && !Array.isArray(move);\n}\nexport function assertValidMove<T extends ProcessSafeMoveWrapper>(move: T | T[] | undefined): asserts move is T {\n\tif (!move || Array.isArray(move)) {\n\t\tthrow new Error(\"The selected move is not a valid move\");\n\t}\n}\n\nexport const createMoveTree = (baseSnapshot: BoardSnapshot) => {\n\tconst snapshots = new WeakMap<MoveWrapper, MoveTreeSnapshot>();\n\tconst boardHashes = new Map<string, Array<readonly number[]>>();\n\tconst moves: MoveWrapper[] = [];\n\tconst startingSnapshot: MoveTreeSnapshot = {\n\t\tboardSnapshot: baseSnapshot,\n\t\tget hash(): string {\n\t\t\tthrow new Error(\"Should not access hash on base move\");\n\t\t},\n\t\tget pregeneratedAttacks(): PreGeneratedAttacks {\n\t\t\tthrow new Error(\"Should not access pregenerated attacks on base move\");\n\t\t}\n\t};\n\n\tfunction obtainMatchingAlternativeLine(baseMoveWrapper: MoveWrapper, newMoveWrapper: MoveWrapper) {\n\t\tfor (const [alternativeFirstMove] of baseMoveWrapper.alternativeLines) {\n\t\t\tif (alternativeFirstMove.moveData.length !== newMoveWrapper.moveData.length) continue;\n\t\t\tif (alternativeFirstMove.moveData.every((m, i) => compareMoves(m, newMoveWrapper.moveData[i]))) {\n\t\t\t\treturn alternativeFirstMove.path;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tfunction stripEmptyAlternativeLines(current = moves) {\n\t\tfor (const moveWrapper of current) {\n\t\t\tfor (let i = 0; i < moveWrapper.alternativeLines.length; i++) {\n\t\t\t\tif (moveWrapper.alternativeLines[i].length === 0) {\n\t\t\t\t\tmoveWrapper.alternativeLines.splice(i, 1);\n\t\t\t\t} else stripEmptyAlternativeLines(moveWrapper.alternativeLines[i]);\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction stripDeletedMoveHashes(current: MoveWrapper[], currentMove: number[]) {\n\t\tfor (const moveWrapper of current) {\n\t\t\tconst snapshot = snapshots.get(moveWrapper);\n\t\t\tif (!snapshot) continue;\n\n\t\t\tconst { hash } = snapshot;\n\t\t\tconst boardHash = boardHashes.get(hash);\n\t\t\tif (boardHash) {\n\t\t\t\tif (boardHash.length === 1) {\n\t\t\t\t\tboardHashes.delete(hash);\n\t\t\t\t} else {\n\t\t\t\t\tconst currentLine = boardHash.findIndex((p) => compareArrays(p, currentMove));\n\t\t\t\t\tif (currentLine === -1) {\n\t\t\t\t\t\tconsole.error(\"Current line for move wrapper not found in board hashes\");\n\t\t\t\t\t} else {\n\t\t\t\t\t\tboardHash.splice(currentLine, 1);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor (const line of moveWrapper.alternativeLines) stripDeletedMoveHashes(line, currentMove);\n\t\t}\n\t}\n\n\tfunction addBoardSnapshot(parameters: MoveTreeSetNewMoveParameters, currentMove: number[]) {\n\t\tconst { move, snapshot, fenDataString } = parameters;\n\t\tsnapshots.set(move, {\n\t\t\tboardSnapshot: snapshot.boardSnapshot,\n\t\t\tpregeneratedAttacks: snapshot.pregeneratedAttacks,\n\t\t\thash: fenDataString\n\t\t});\n\n\t\tconst boardHash = boardHashes.get(fenDataString);\n\t\tif (boardHash) {\n\t\t\tconst hasAdditionalPath = boardHash.find((p) => compareArrays(p, currentMove));\n\t\t\tboardHashes.set(fenDataString, hasAdditionalPath ? boardHash : [...boardHash, currentMove.slice()]);\n\t\t} else boardHashes.set(fenDataString, [currentMove.slice()]);\n\t}\n\n\tconst assignMoveWrapperKey = <K extends keyof MoveWrapper>(object: MoveWrapper, key: K, value: MoveWrapper[K]) => {\n\t\tobject[key] = value;\n\t};\n\n\treturn {\n\t\tmoves,\n\t\tcurrentMove: [-1],\n\t\tgetMove(path: number[]): MoveWrapper | MoveWrapper[] | undefined {\n\t\t\treturn getMoveFromPathAndTree(moves, path);\n\t\t},\n\t\tsetNewMove(parameters: MoveTreeSetNewMoveParameters): number[] {\n\t\t\tconst { move } = parameters;\n\t\t\tconst moveWrapper = this.getMove(move.path.slice(0, -1));\n\t\t\tlet path = move.path.slice();\n\n\t\t\tif (!moveWrapper) return path;\n\t\t\tif (Array.isArray(moveWrapper)) {\n\t\t\t\tif (moveWrapper.length > move.path[move.path.length - 1]) {\n\t\t\t\t\tconst currentMove = this.getMove(move.path);\n\t\t\t\t\tif (Array.isArray(currentMove)) {\n\t\t\t\t\t\tthis.setNewMove({ ...parameters, move: { ...move, path: [...move.path, currentMove.length] } });\n\t\t\t\t\t} else if (currentMove) {\n\t\t\t\t\t\tconst alternativeLine = obtainMatchingAlternativeLine(currentMove, move);\n\t\t\t\t\t\tif (alternativeLine) {\n\t\t\t\t\t\t\treturn alternativeLine;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tcurrentMove.alternativeLines.push([]);\n\t\t\t\t\t\t\tconst newMove = { ...move, path: [...move.path, currentMove.alternativeLines.length - 1, 0] };\n\t\t\t\t\t\t\tpath = newMove.path.slice();\n\t\t\t\t\t\t\treturn this.setNewMove({ ...parameters, move: newMove });\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tmoveWrapper.push(move);\n\t\t\t\t\taddBoardSnapshot(parameters, this.currentMove);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tlet key: keyof MoveWrapper;\n\t\t\t\tfor (key in move) {\n\t\t\t\t\tif (Object.prototype.hasOwnProperty.call(move, key)) assignMoveWrapperKey(moveWrapper, key, move[key]);\n\t\t\t\t}\n\t\t\t\taddBoardSnapshot(parameters, this.currentMove);\n\t\t\t}\n\n\t\t\treturn path;\n\t\t},\n\t\tgetBoardSnapshot(move: MoveWrapper | -1) {\n\t\t\tif (move === -1) {\n\t\t\t\treturn startingSnapshot;\n\t\t\t} else {\n\t\t\t\treturn snapshots.get(move);\n\t\t\t}\n\t\t},\n\t\tdeleteMove(path: number[]) {\n\t\t\tlet items: MoveWrapper[] = [];\n\t\t\tconst moveWrapper = this.getMove(path.slice(0, -1));\n\t\t\tif (!moveWrapper) return;\n\t\t\tconst finalIndex = path[path.length - 1];\n\t\t\tif (Array.isArray(moveWrapper)) {\n\t\t\t\titems = [...moveWrapper.splice(finalIndex, moveWrapper.length - finalIndex)];\n\t\t\t} else {\n\t\t\t\tif (moveWrapper.alternativeLines.length > 0) {\n\t\t\t\t\titems = moveWrapper.alternativeLines.splice(path[path.length - 1], 1)[0];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tstripDeletedMoveHashes(items, this.currentMove);\n\t\t\tstripEmptyAlternativeLines();\n\t\t\tconst newCurrentMove = alterCurrentPath(this.currentMove, path);\n\t\t\tthis.currentMove = newCurrentMove.length === 0 ? [-1] : newCurrentMove;\n\t\t},\n\t\tgetHash(preliminaryHashString: string): number {\n\t\t\tconst hash = boardHashes.get(preliminaryHashString);\n\t\t\tif (hash === undefined) return 0;\n\n\t\t\tlet totalCount = 0;\n\t\t\tfor (const line of hash) {\n\t\t\t\tfor (let i = 0; i < line.length; i++) {\n\t\t\t\t\tif (i + (1 % 2) !== 0 && i === line.length - 1) {\n\t\t\t\t\t\ttotalCount++;\n\t\t\t\t\t} else if (line[i] !== this.currentMove[i]) break;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn totalCount;\n\t\t},\n\t\tstringifyMove(moveWrapper: MoveWrapper, dimension: number) {\n\t\t\tconst snapshot = this.getBoardSnapshot(moveWrapper);\n\t\t\tif (!snapshot) {\n\t\t\t\tconsole.error(\"No snapshot assigned when moveWrapper is called\");\n\t\t\t\treturn \"\";\n\t\t\t}\n\n\t\t\tlet key: keyof typeof moveNotation;\n\t\t\tfor (key in moveNotation) {\n\t\t\t\tif (!Object.prototype.hasOwnProperty.call(moveNotation, key)) continue;\n\t\t\t\tmoveWrapper.cachedNames[key] = moveNotation[key](moveWrapper, snapshot, dimension);\n\t\t\t}\n\t\t},\n\t\taugmentMoveWithMetadata(parameters: { move: Move; board: Board; makeMoveFunction: () => PostMoveResults }) {\n\t\t\tconst { move, board, makeMoveFunction } = parameters;\n\t\t\tconst standardMove = move.find<MoveData>((m): m is MoveData => verifyStandardMove(m));\n\t\t\tconst movingPiece = standardMove ? board.board[standardMove.startCoordinates[0]][standardMove.startCoordinates[1]] : pawnPieceString;\n\t\t\tconst capturedPieces = standardMove ? board.data.getCapturedPieces(standardMove).length !== 0 : false;\n\t\t\tconst postMoveResults = makeMoveFunction();\n\t\t\tconst deadColors: PlayerBooleanTuple = [...board.data.fenOptions.tag(\"dead\")];\n\t\t\tconst currentSideToMove = board.data.sideToMove,\n\t\t\t\tcurrentMove = board.moves.getMove(board.moves.currentMove);\n\t\t\tassertValidMove(currentMove);\n\t\t\tif (\n\t\t\t\tboard.moves.currentMove[board.moves.currentMove.length - 1] === 0 ||\n\t\t\t\tfindLastIndex(deadColors, (b) => !b) === currentSideToMove\n\t\t\t) {\n\t\t\t\tconst lastCurrentMoves = board.moves.getMove(board.moves.currentMove.slice(0, -1));\n\t\t\t\tif (!Array.isArray(lastCurrentMoves)) throw new Error(\"The selected move is not within an array\");\n\n\t\t\t\tfor (let i = lastCurrentMoves.length - 1; i >= 0; i--) {\n\t\t\t\t\tconst lastCurrent = lastCurrentMoves[i].metadata.currentFullMove;\n\t\t\t\t\tif (lastCurrent) {\n\t\t\t\t\t\tcurrentMove.metadata.currentFullMove = lastCurrent + 1;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t} else if (i === 0) {\n\t\t\t\t\t\tif (currentMove.path.length === 1) {\n\t\t\t\t\t\t\tcurrentMove.metadata.currentFullMove = 1;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconst alternativeLineContainer = board.moves.getMove(board.moves.currentMove.slice(0, -3));\n\t\t\t\t\t\t\tif (!Array.isArray(alternativeLineContainer)) throw new Error(\"The selected move is not within an array\");\n\t\t\t\t\t\t\tcurrentMove.metadata.currentFullMove =\n\t\t\t\t\t\t\t\talternativeLineContainer[\n\t\t\t\t\t\t\t\t\tfindLastIndex(alternativeLineContainer, (m) => Boolean(m.metadata.currentFullMove))\n\t\t\t\t\t\t\t\t].metadata.currentFullMove;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tcurrentMove.metadata.currentSideToMove = currentSideToMove;\n\t\t\tcurrentMove.metadata.isCapture = capturedPieces;\n\t\t\tcurrentMove.metadata.movingPiece = movingPiece;\n\t\t\tfor (const color of colors) {\n\t\t\t\tif (postMoveResults.checkmates[color]) {\n\t\t\t\t\tcurrentMove.metadata.checkmates++;\n\t\t\t\t} else if (postMoveResults.checks[color]) {\n\t\t\t\t\tcurrentMove.metadata.checks++;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.stringifyMove(currentMove, Math.max(...board.data.fenOptions.tag(\"dim\")));\n\t\t},\n\t\tconstructPreliminaryHashString(boardObject: Board) {\n\t\t\tconst { board, data } = boardObject;\n\t\t\tlet builder = \"\";\n\t\t\tbuilder += data.sideToMove;\n\t\t\tlet key: keyof FENOptionsTags;\n\t\t\tfor (key in data.fenOptions.tags) {\n\t\t\t\tconst tag = data.fenOptions.tags[key];\n\t\t\t\tif (!verifyDynamicFENOptionKey(tag, key)) continue;\n\t\t\t\tconst serializedForm = tag.serialize();\n\t\t\t\tif (serializedForm) builder += serializedForm;\n\t\t\t}\n\t\t\tbuilder = board.reduce((p, n) => p + n.map((ps) => ps.value || \"-\").join(\"\"), builder);\n\t\t\treturn builder;\n\t\t}\n\t};\n};\n\nexport type MoveTreeInterface = ReturnType<typeof createMoveTree>;\n","import { BoardSnapshot, compareCoordinates, PreGeneratedAttacks } from \"../Board/BoardInterface\";\nimport type { Coordinate, NumericColor } from \"../GameInformation/GameUnits/GameUnits\";\nimport { pawnPieceString, PieceString, PieceStringObject } from \"../GameInformation/GameUnits/PieceString\";\nimport { moveNotation } from \"./MoveNotationStringifier\";\n\nexport enum SpecialMove {\n\tCastlingKingside,\n\tCastlingQueenside,\n\tEnPassant\n}\nexport enum InternalMoveSignature {\n\tResign = \"R\",\n\tTimeout = \"T\",\n\tClaimWin = \"C\",\n\tDrawByAgreement = \"D\",\n\tStalemate = \"S\",\n\tPass = \"P\",\n\tTeamsCheckmate = \"#\"\n}\n\nexport type MoveComponent = InternalMove | MoveData | DroppingMove;\nexport type Move = [MoveComponent, ...MoveComponent[]];\nexport const verifyRequiredMove = (move: MoveComponent[]): move is Move => move.length > 0;\n\nexport type HighlightArrow = [color: NumericColor, startCoordinate: Coordinate, endCoordinate: Coordinate];\nexport type HighlightSquare = [color: NumericColor, coordinate: Coordinate];\ninterface GeneralMetadata {\n\tcurrentSideToMove: NumericColor;\n\tcurrentFullMove?: number;\n\tplayerClock?: number;\n\thighlightedArrows: HighlightArrow[];\n\thighlightedSquares: HighlightSquare[];\n}\nexport interface MoveWrapperMetadata extends GeneralMetadata {\n\tmovingPiece: PieceString;\n\tisCapture: boolean;\n\tchecks: number;\n\tcheckmates: number;\n\tannotation?: string;\n}\n\nexport interface MoveWrapper {\n\tmoveData: Move;\n\talternativeLines: MoveWrapper[][];\n\tcomment: string;\n\tpath: number[];\n\tmetadata: MoveWrapperMetadata;\n\tcachedNames: Record<keyof typeof moveNotation, string>;\n}\n\nexport function verifyMoveWrapperProperties(moveWrapper: Partial<MoveWrapper>): moveWrapper is MoveWrapper {\n\treturn Boolean(\n\t\tmoveWrapper.alternativeLines && moveWrapper.comment !== undefined && moveWrapper.path && moveWrapper.metadata && moveWrapper.moveData\n\t);\n}\n\ntype DistributiveMove<T> = T extends object ? T[] : never;\nexport type DistributiveMoveArray = DistributiveMove<MoveComponent>;\ninterface ChainableMove {\n\tnextChainedMoves?: DistributiveMoveArray;\n\tisForcedContinuation?: boolean;\n\tisIrreversible?: boolean;\n}\n\nexport interface MoveData extends ChainableMove {\n\tstartCoordinates: Coordinate;\n\tendCoordinates: Coordinate;\n\tpromotion?: PieceString[];\n\tspecialType?: SpecialMove | undefined;\n}\n\nexport interface DroppingMove extends ChainableMove {\n\tpiece: PieceString;\n\tendCoordinates: Coordinate;\n}\n\nexport interface InternalMove extends ChainableMove {\n\ttype: InternalMoveSignature;\n}\n\ntype RecursiveHelper<T> = {\n\t[P in keyof T]: T[P] extends PieceString ? PieceStringObject : StripPieceStringObjects<T[P]>;\n};\nexport type StripPieceStringObjects<T> = T extends object ? RecursiveHelper<T> : T;\n\nexport interface ProcessSafeMoveWrapper {\n\talternativeLines: this[][];\n\tcomment: string;\n\tpath: number[];\n\tcachedNames: Record<keyof typeof moveNotation, string>;\n\tmetadata: GeneralMetadata;\n}\n\nexport function compareMoves(move1: MoveComponent, move2: MoveComponent): boolean {\n\tif (verifyStandardMove(move1)) {\n\t\tif (!verifyStandardMove(move2)) return false;\n\t\treturn (\n\t\t\tcompareCoordinates(move1.startCoordinates, move2.startCoordinates) &&\n\t\t\tcompareCoordinates(move1.endCoordinates, move2.endCoordinates) &&\n\t\t\t(move1.specialType === move2.specialType ||\n\t\t\t\tmove1.specialType === SpecialMove.EnPassant ||\n\t\t\t\tmove2.specialType === SpecialMove.EnPassant)\n\t\t);\n\t} else if (verifyDroppingMove(move1)) {\n\t\tif (!verifyDroppingMove(move2)) return false;\n\t\treturn compareCoordinates(move1.endCoordinates, move2.endCoordinates) && PieceString.comparePieceStrings(move1.piece, move2.piece);\n\t} else if (verifyInternalMove(move1)) {\n\t\tif (!verifyInternalMove(move2)) return false;\n\t\treturn move1.type === move2.type;\n\t}\n\n\tthrow new Error(`Unexpected move signature of first move ${JSON.stringify(move1)}`);\n}\n\nexport function createDummyMoveMetadata(): MoveWrapperMetadata {\n\treturn {\n\t\tisCapture: false,\n\t\tmovingPiece: pawnPieceString,\n\t\tchecks: 0,\n\t\tcheckmates: 0,\n\t\tcurrentSideToMove: 0,\n\t\thighlightedArrows: [],\n\t\thighlightedSquares: []\n\t};\n}\n\nexport const createBaseMoveWrapper = (\n\trequiredSettings: { path: number[]; moveData: Move },\n\tsettings: Partial<MoveWrapper> = {}\n): MoveWrapper => {\n\tconst wrapper: MoveWrapper = {\n\t\tpath: requiredSettings.path,\n\t\tmoveData: requiredSettings.moveData,\n\t\tcomment: \"\",\n\t\talternativeLines: [],\n\t\tmetadata: createDummyMoveMetadata(),\n\t\tcachedNames: {\n\t\t\tfullMoveNotation: \"\",\n\t\t\tshortenedMoveNotation: \"\"\n\t\t}\n\t};\n\n\treturn {\n\t\t...wrapper,\n\t\t...settings\n\t};\n};\n\ninterface MoveTypePredicate<T, S extends T> {\n\t(move: StripPieceStringObjects<T>): move is StripPieceStringObjects<S>;\n\t(move: T): move is S;\n}\nexport const verifyInternalMove: MoveTypePredicate<MoveComponent, InternalMove> = (move): move is never => \"type\" in move;\nexport const verifyDroppingMove: MoveTypePredicate<MoveComponent, DroppingMove> = (move): move is never => \"piece\" in move;\nexport const verifyStandardMove: MoveTypePredicate<MoveComponent, MoveData> = (move): move is never => \"startCoordinates\" in move;\nexport const verifyInternalMoveArray: MoveTypePredicate<DistributiveMoveArray, InternalMove[]> = (move): move is never => \"type\" in move[0];\nexport const verifyDroppingMoveArray: MoveTypePredicate<DistributiveMoveArray, DroppingMove[]> = (move): move is never => \"piece\" in move[0];\nexport const verifyStandardMoveArray: MoveTypePredicate<DistributiveMoveArray, MoveData[]> = (move): move is never =>\n\t\"startCoordinates\" in move[0];\n\nexport const getMoveFromPathAndTree = <T extends ProcessSafeMoveWrapper>(moves: T[], path: number[]): T[] | T | undefined => {\n\tif (path.length === 0) return moves;\n\tconst movePath = path.slice();\n\tif (movePath[0] >= moves.length) return;\n\tlet currentSelection = moves[movePath.shift() ?? 0];\n\twhile (movePath.length > 0) {\n\t\tconst currentIndex = movePath.shift();\n\t\tif (currentIndex !== undefined) {\n\t\t\tif (currentIndex >= currentSelection.alternativeLines.length) return;\n\t\t\tconst alternativeLine = currentSelection.alternativeLines[currentIndex];\n\t\t\tconst index = movePath.shift();\n\t\t\tif (index === undefined) {\n\t\t\t\treturn alternativeLine;\n\t\t\t}\n\n\t\t\tif (index >= alternativeLine.length) return;\n\t\t\tcurrentSelection = alternativeLine[index];\n\t\t}\n\t}\n\n\treturn currentSelection;\n};\n\nexport const getLatestChainedMoves = (move: DistributiveMoveArray): MoveComponent[] => {\n\tif (move.length > 0 && move[0].nextChainedMoves) {\n\t\treturn getLatestChainedMoves(move[0].nextChainedMoves);\n\t} else return move;\n};\n\nexport interface MoveTreeSetNewMoveParameters {\n\tmove: MoveWrapper;\n\tsnapshot: MoveTreeRequiredSnapshotValues;\n\tfenDataString: string;\n}\n\nexport interface MoveTreeSnapshot {\n\tboardSnapshot: BoardSnapshot;\n\thash: string;\n\tpregeneratedAttacks: PreGeneratedAttacks;\n}\nexport type MoveTreeRequiredSnapshotValues = Omit<MoveTreeSnapshot, \"hash\">;\n","import { boardDimension } from \"@moveGeneration/GameInformation/GameData\";\nimport type { NumericColor, Coordinate } from \"@moveGeneration/GameInformation/GameUnits/GameUnits\";\nimport type { FENData } from \"../FENData/FENData\";\nimport { deadColorIndex, PieceString } from \"../GameInformation/GameUnits/PieceString\";\nimport type { VariantHandlerTarget } from \"../VariantRules/VariantRuleInterface\";\nimport type { ControlConfiguration } from \"@moveGeneration/PieceControl/PieceControlInterface\";\nimport {\n\tAttackType,\n\tPieceControlConfiguration,\n\tPieceControlGeneratedMove,\n\tPieceControlHooks,\n\tPieceControlInternalMove\n} from \"./PieceControlInterface\";\n\nexport class PieceControl implements VariantHandlerTarget<PieceControl> {\n\tcolor: NumericColor;\n\tsliding: Coordinate[];\n\tjumping: Coordinate[];\n\treadonly hooks: PieceControlHooks;\n\tmoves: PieceControlGeneratedMove[];\n\trayGenCache: Coordinate[];\n\tbaseRankActive: boolean;\n\timmunePieces: [boolean, boolean, boolean, boolean];\n\tfenData!: FENData;\n\n\tboard!: PieceString[][];\n\ti!: number;\n\tj!: number;\n\n\t__baseClass: PieceControl;\n\tinitDecoratorSettings() {\n\t\t/* no-op */\n\t}\n\t/*---------------------------------- INITIALIZATION -----------------------------------------*/\n\n\tconstructor() {\n\t\tthis.moves = [];\n\t\tthis.color = 0;\n\t\tthis.sliding = [];\n\t\tthis.jumping = [];\n\t\tthis.rayGenCache = [];\n\t\tthis.hooks = {\n\t\t\tuseTrajectory: undefined,\n\t\t\tusePerspective: undefined,\n\t\t\tusePawnLogic: undefined,\n\t\t\tuseHopping: false\n\t\t};\n\n\t\tthis.baseRankActive = false;\n\t\tthis.immunePieces = [false, false, false, false];\n\t\tthis.__baseClass = this;\n\t}\n\n\tconfigure(configuration: ControlConfiguration) {\n\t\tthis.color = configuration.color;\n\t\tthis.immunePieces = configuration.immunePieces;\n\t\t[this.i, this.j] = configuration.coordinates;\n\t\tconst baseRankCalc = [13 - this.i, this.j, this.i, 13 - this.j][this.color] - this.fenData.fenOptions.tag(\"pawnBaseRank\");\n\t\tthis.baseRankActive = configuration.baseRank ?? (baseRankCalc === -1 || baseRankCalc === -2);\n\t\tthis.board = configuration.board;\n\t}\n\n\tsetFENData(fenData: FENData) {\n\t\tthis.fenData = fenData;\n\t}\n\n\tprivate isRayTrace(attackType: AttackType) {\n\t\treturn attackType === AttackType.RayTrace || attackType === AttackType.RayTraceLimited;\n\t}\n\n\t/*---------------------------------- INITIALIZATION -----------------------------------------*/\n\t/*-------------------------------------------------------------------------------------------*/\n\t/*--------------------------------- MOVE GENERATION -----------------------------------------*/\n\n\tprivate modifyDisplacements(i: number, j: number): Coordinate {\n\t\tconst baseDisplacements: Coordinate[] = [\n\t\t\t[i, j],\n\t\t\t[j, -i],\n\t\t\t[-i, -j],\n\t\t\t[-j, i]\n\t\t];\n\t\treturn baseDisplacements[this.color];\n\t}\n\n\tprivate pushMove(settings: PieceControlInternalMove): void {\n\t\tif (\n\t\t\t!settings.isRayGen &&\n\t\t\tthis.hooks.usePawnLogic &&\n\t\t\tthis.hooks.usePawnLogic.promotionRanks &&\n\t\t\tthis.hooks.usePawnLogic.promotionRanks[this.color] === (this.color % 2 === 0 ? settings.i : settings.j) &&\n\t\t\tthis.hooks.usePawnLogic.promotionPieces\n\t\t) {\n\t\t\tthis.moves.push({\n\t\t\t\tmove: [settings.i, settings.j, this.hooks.usePawnLogic.promotionPieces.join(\"\")],\n\t\t\t\tirreversible: settings.irreversible ?? false\n\t\t\t});\n\t\t\treturn;\n\t\t} else {\n\t\t\tthis.moves.push({\n\t\t\t\tmove: [settings.i, settings.j],\n\t\t\t\tirreversible: settings.irreversible ?? false\n\t\t\t});\n\t\t}\n\t}\n\n\tprotected generateSlidingAttack(settings: PieceControlConfiguration): void {\n\t\tlet [displacementI, displacementJ] = settings.displacement,\n\t\t\tlimit = settings.limit ?? Infinity;\n\t\tconst rayGenCache = settings.rayGenCache,\n\t\t\tspecial = settings.special ?? AttackType.Normal;\n\n\t\tlet rayTraceLimit = 0;\n\t\tif (this.hooks.usePerspective?.[this.color]) {\n\t\t\t[displacementI, displacementJ] = this.modifyDisplacements(displacementI, displacementJ);\n\t\t}\n\n\t\tlet startI = this.i + displacementI,\n\t\t\tstartJ = this.j + displacementJ;\n\t\tconst iLength = this.board[0].length,\n\t\t\tjLength = this.board.length;\n\t\tconst isRayGen = rayGenCache ?? this.isRayTrace(special);\n\n\t\twhile (limit > 0 && startI >= 0 && startI < iLength && startJ >= 0 && startJ < jLength) {\n\t\t\t// TODO add trajectories?\n\t\t\tif (this.getMovePossibility({ displacement: [startI, startJ], special, rayGenCache })) {\n\t\t\t\tthis.pushMove({ i: startI, j: startJ, isRayGen: Boolean(isRayGen), irreversible: settings.irreversible });\n\t\t\t}\n\n\t\t\tif (special === AttackType.RayTraceLimited && !this.board[startI][startJ].isEmpty()) {\n\t\t\t\trayTraceLimit++;\n\t\t\t\tif (rayTraceLimit === 2) break;\n\t\t\t}\n\t\t\tif (!this.isRayTrace(special) && !this.board[startI][startJ].isEmpty()) {\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tstartI += displacementI;\n\t\t\tstartJ += displacementJ;\n\t\t\tlimit--;\n\t\t}\n\t}\n\n\tprotected generateJumpAttack(settings: PieceControlConfiguration): void {\n\t\tlet [displacementI, displacementJ] = settings.displacement;\n\t\tconst rayGenCache = settings.rayGenCache,\n\t\t\tsquareBlockingIndex = settings.squareBlockingIndex,\n\t\t\tspecial = settings.special ?? AttackType.Normal;\n\t\tif (this.hooks.usePerspective?.[this.color]) {\n\t\t\t[displacementI, displacementJ] = this.modifyDisplacements(displacementI, displacementJ);\n\t\t}\n\n\t\tconst startI = this.i + displacementI,\n\t\t\tstartJ = this.j + displacementJ;\n\t\tconst isRayGen = rayGenCache ?? this.isRayTrace(special);\n\t\tlet isTestPassed = true;\n\n\t\tif (this.hooks.useTrajectory && squareBlockingIndex !== undefined) {\n\t\t\tconst trajectory = this.hooks.useTrajectory[squareBlockingIndex];\n\t\t\tlet trajectoryX, trajectoryY;\n\t\t\tif (this.hooks.usePerspective?.[this.color]) {\n\t\t\t\t[trajectoryX, trajectoryY] = this.modifyDisplacements(trajectory[0], trajectory[1]);\n\t\t\t} else {\n\t\t\t\t(trajectoryX = trajectory[0]), (trajectoryY = trajectory[1]);\n\t\t\t}\n\n\t\t\tif (!this.getMovePossibility({ displacement: [this.i + trajectoryX, this.j + trajectoryY], special, rayGenCache })) {\n\t\t\t\tisTestPassed = false;\n\t\t\t}\n\t\t}\n\n\t\tif (isTestPassed && this.getMovePossibility({ displacement: [startI, startJ], special, rayGenCache })) {\n\t\t\tthis.pushMove({ i: startI, j: startJ, isRayGen: Boolean(isRayGen), irreversible: settings.irreversible });\n\t\t}\n\t}\n\n\tgetMovePossibility(configuration: PieceControlConfiguration): boolean {\n\t\tconst {\n\t\t\tdisplacement: [i, j],\n\t\t\trayGenCache,\n\t\t\tspecial\n\t\t} = configuration;\n\t\tif (i < 0 || i >= boardDimension || j < 0 || j >= boardDimension) return false;\n\n\t\tconst piece = this.board[i][j];\n\t\tif (!piece.isEmpty() && piece.color !== deadColorIndex && !rayGenCache && !this.isRayTrace(special ?? AttackType.Normal)) {\n\t\t\tif (this.immunePieces[piece.color] || this.fenData.fenOptions.tag(\"zombieImmune\")[piece.color]) return false;\n\t\t}\n\n\t\tconst pushTo = () => {\n\t\t\tif (rayGenCache) {\n\t\t\t\tthis.rayGenCache.push(rayGenCache);\n\t\t\t}\n\n\t\t\treturn true;\n\t\t};\n\n\t\tif (special === undefined || special === AttackType.Normal) {\n\t\t\tif (!piece.isWall()) {\n\t\t\t\treturn pushTo();\n\t\t\t}\n\t\t} else if (special === AttackType.RayGen) {\n\t\t\tif (!piece.isEmpty()) {\n\t\t\t\treturn pushTo();\n\t\t\t}\n\t\t} else if (special === AttackType.AttackOnly) {\n\t\t\tif (!piece.isEmpty() && !piece.isWall()) {\n\t\t\t\treturn pushTo();\n\t\t\t}\n\t\t} else if (special === AttackType.MoveOnly) {\n\t\t\tif (piece.isEmpty()) {\n\t\t\t\treturn pushTo();\n\t\t\t}\n\t\t} else if (this.isRayTrace(special)) {\n\t\t\treturn pushTo();\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t/*--------------------------------- MOVE GENERATION -----------------------------------------*/\n\t/*-------------------------------------------------------------------------------------------*/\n\t/*------------------------------- OUTPUT GENERATION -----------------------------------------*/\n\n\tgetPossibleCells(): void {\n\t\tif (this.hooks.useHopping) {\n\t\t\tthis.sliding.forEach((displacement) =>\n\t\t\t\tthis.generateSlidingAttack({ displacement, special: AttackType.RayGen, rayGenCache: [...displacement] })\n\t\t\t);\n\n\t\t\tconst moves = this.moves.slice();\n\t\t\tthis.moves = [];\n\t\t\tmoves.forEach((s, i) => {\n\t\t\t\tconst startI = s.move[0] + this.rayGenCache[i][0];\n\t\t\t\tconst startJ = s.move[1] + this.rayGenCache[i][1];\n\t\t\t\tif (this.getMovePossibility({ displacement: [startI, startJ] })) {\n\t\t\t\t\tthis.pushMove({ i: startI, j: startJ });\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis.rayGenCache = [];\n\t\t} else {\n\t\t\tthis.sliding.forEach((a) => this.generateSlidingAttack({ displacement: a }));\n\t\t\tthis.jumping.forEach((a) => this.generateJumpAttack({ displacement: a }));\n\t\t}\n\t}\n\n\trayGenJumpingAttacks(): PieceControlGeneratedMove[] {\n\t\tthis.jumping.forEach((a) => this.generateJumpAttack({ displacement: a, special: AttackType.RayTrace }));\n\t\treturn this.moves.splice(0);\n\t}\n\n\trayGenSlidingAttacks(trace?: AttackType): PieceControlGeneratedMove[][] {\n\t\tconst slidingLines: PieceControlGeneratedMove[][] = [];\n\n\t\tthis.sliding.forEach((a) => {\n\t\t\tthis.generateSlidingAttack({ displacement: a, special: trace });\n\t\t\tif (this.moves.length !== 0) {\n\t\t\t\tslidingLines.push(this.moves.splice(0));\n\t\t\t}\n\t\t});\n\n\t\treturn slidingLines;\n\t}\n\n\tgetPseudoLegalMoves(): PieceControlGeneratedMove[] {\n\t\tthis.getPossibleCells();\n\t\treturn this.moves.splice(0);\n\t}\n\n\t/*------------------------------- OUTPUT GENERATION -----------------------------------------*/\n}\n","import type { Coordinate } from \"@moveGeneration/GameInformation/GameUnits/GameUnits\";\nimport { PieceControl } from \"./PieceControl\";\nimport { AttackType, createPieceDeclaration, dameLetter, defaultPieces, grasshopperPieceLetter, pawnPieceLetter } from \"./PieceControlInterface\";\n\nconst orthogonalMoves: Coordinate[] = [\n\t[-1, 0],\n\t[1, 0],\n\t[0, 1],\n\t[0, -1]\n];\nconst diagonalMoves: Coordinate[] = [\n\t[-1, -1],\n\t[1, 1],\n\t[-1, 1],\n\t[1, -1]\n];\nconst kingDirections = [...orthogonalMoves, ...diagonalMoves];\nconst knightHops: Coordinate[] = [\n\t[-1, -2],\n\t[-2, -1],\n\t[-1, 2],\n\t[2, -1],\n\t[-2, 1],\n\t[1, -2],\n\t[1, 2],\n\t[2, 1]\n];\nconst camelHops: Coordinate[] = [\n\t[-1, -3],\n\t[-3, -1],\n\t[-1, 3],\n\t[3, -1],\n\t[-3, 1],\n\t[1, -3],\n\t[1, 3],\n\t[3, 1]\n];\nconst dabbabaHops: Coordinate[] = [\n\t[-2, 0],\n\t[2, 0],\n\t[0, 2],\n\t[0, -2]\n];\nconst alfilHops: Coordinate[] = [\n\t[-2, -2],\n\t[2, 2],\n\t[-2, 2],\n\t[2, -2]\n];\nexport const initPieceControlDeclarations = () => {\n\tcreatePieceDeclaration({\n\t\tbaseClassRef: class extends PieceControl {\n\t\t\tconstructor() {\n\t\t\t\tsuper();\n\t\t\t\tthis.sliding = orthogonalMoves;\n\t\t\t}\n\t\t},\n\t\tconfiguration: {\n\t\t\tpoints: {\n\t\t\t\tsinglesPoints: 5,\n\t\t\t\tteamsPoints: 5,\n\t\t\t\tbotFFAValue: 7,\n\t\t\t\tbotTeamsValue: 7\n\t\t\t},\n\t\t\tpiece: defaultPieces.rook,\n\t\t\tmoveGenerationSettings: {\n\t\t\t\tisComplex: false,\n\t\t\t\tisJumping: false,\n\t\t\t\tisSliding: true,\n\t\t\t\tisPawn: false,\n\t\t\t\tisColorBound: false\n\t\t\t},\n\t\t\tnaming: {\n\t\t\t\tname: \"Rook\",\n\t\t\t\tshortName: defaultPieces.rook.toLowerCase()\n\t\t\t}\n\t\t}\n\t});\n\n\tcreatePieceDeclaration({\n\t\tbaseClassRef: class extends PieceControl {\n\t\t\tconstructor() {\n\t\t\t\tsuper();\n\t\t\t\tthis.sliding = diagonalMoves;\n\t\t\t}\n\t\t},\n\t\tconfiguration: {\n\t\t\tpoints: {\n\t\t\t\tsinglesPoints: 5,\n\t\t\t\tteamsPoints: 4,\n\t\t\t\tbotFFAValue: 6,\n\t\t\t\tbotTeamsValue: 6\n\t\t\t},\n\t\t\tpiece: defaultPieces.bishop,\n\t\t\tmoveGenerationSettings: {\n\t\t\t\tisComplex: false,\n\t\t\t\tisJumping: false,\n\t\t\t\tisSliding: true,\n\t\t\t\tisPawn: false,\n\t\t\t\tisColorBound: true\n\t\t\t},\n\t\t\tnaming: {\n\t\t\t\tname: \"Bishop\",\n\t\t\t\tshortName: defaultPieces.bishop.toLowerCase()\n\t\t\t}\n\t\t}\n\t});\n\n\tcreatePieceDeclaration({\n\t\tbaseClassRef: class extends PieceControl {\n\t\t\tconstructor() {\n\t\t\t\tsuper();\n\t\t\t\tthis.jumping = kingDirections;\n\t\t\t}\n\t\t},\n\t\tconfiguration: {\n\t\t\tpoints: {\n\t\t\t\tsinglesPoints: 3,\n\t\t\t\tteamsPoints: 0,\n\t\t\t\tbotFFAValue: 3,\n\t\t\t\tbotTeamsValue: 3\n\t\t\t},\n\t\t\tpiece: defaultPieces.king,\n\t\t\tmoveGenerationSettings: {\n\t\t\t\tisComplex: false,\n\t\t\t\tisJumping: true,\n\t\t\t\tisSliding: false,\n\t\t\t\tisPawn: false,\n\t\t\t\tisColorBound: false\n\t\t\t},\n\t\t\tnaming: {\n\t\t\t\tname: \"King\",\n\t\t\t\tshortName: defaultPieces.king.toLowerCase()\n\t\t\t}\n\t\t}\n\t});\n\n\tcreatePieceDeclaration({\n\t\tbaseClassRef: class extends PieceControl {\n\t\t\tconstructor() {\n\t\t\t\tsuper();\n\t\t\t\tthis.sliding = kingDirections;\n\t\t\t}\n\t\t},\n\t\tconfiguration: {\n\t\t\tpoints: {\n\t\t\t\tsinglesPoints: 9,\n\t\t\t\tteamsPoints: 10,\n\t\t\t\tbotFFAValue: 14,\n\t\t\t\tbotTeamsValue: 15\n\t\t\t},\n\t\t\tpiece: defaultPieces.queen,\n\t\t\tmoveGenerationSettings: {\n\t\t\t\tisComplex: false,\n\t\t\t\tisJumping: false,\n\t\t\t\tisSliding: true,\n\t\t\t\tisPawn: false,\n\t\t\t\tisColorBound: false\n\t\t\t},\n\t\t\tnaming: {\n\t\t\t\tname: \"Queen\",\n\t\t\t\tshortName: defaultPieces.queen.toLowerCase()\n\t\t\t}\n\t\t}\n\t});\n\n\tcreatePieceDeclaration({\n\t\tbaseClassRef: class extends PieceControl {\n\t\t\tconstructor() {\n\t\t\t\tsuper();\n\t\t\t\tthis.sliding = kingDirections;\n\t\t\t}\n\t\t},\n\t\tconfiguration: {\n\t\t\tpoints: {\n\t\t\t\tsinglesPoints: 9,\n\t\t\t\tteamsPoints: 10,\n\t\t\t\tbotFFAValue: 13,\n\t\t\t\tbotTeamsValue: 13\n\t\t\t},\n\t\t\tpiece: dameLetter,\n\t\t\tmoveGenerationSettings: {\n\t\t\t\tisComplex: false,\n\t\t\t\tisJumping: false,\n\t\t\t\tisSliding: true,\n\t\t\t\tisPawn: false,\n\t\t\t\tisColorBound: false\n\t\t\t},\n\t\t\tnaming: {\n\t\t\t\tname: \"1-point queen\",\n\t\t\t\tshortName: dameLetter.toLowerCase()\n\t\t\t}\n\t\t}\n\t});\n\n\tcreatePieceDeclaration({\n\t\tbaseClassRef: class extends PieceControl {\n\t\t\tconstructor() {\n\t\t\t\tsuper();\n\t\t\t\tthis.jumping = knightHops;\n\t\t\t}\n\t\t},\n\t\tconfiguration: {\n\t\t\tpoints: {\n\t\t\t\tsinglesPoints: 3,\n\t\t\t\tteamsPoints: 3,\n\t\t\t\tbotFFAValue: 4,\n\t\t\t\tbotTeamsValue: 4\n\t\t\t},\n\t\t\tpiece: defaultPieces.knight,\n\t\t\tmoveGenerationSettings: {\n\t\t\t\tisComplex: false,\n\t\t\t\tisJumping: true,\n\t\t\t\tisSliding: false,\n\t\t\t\tisPawn: false,\n\t\t\t\tisColorBound: false\n\t\t\t},\n\t\t\tnaming: {\n\t\t\t\tname: \"Knight\",\n\t\t\t\tshortName: defaultPieces.knight.toLowerCase()\n\t\t\t}\n\t\t}\n\t});\n\n\tcreatePieceDeclaration({\n\t\tbaseClassRef: class extends PieceControl {\n\t\t\tconstructor() {\n\t\t\t\tsuper();\n\t\t\t\tthis.jumping = [...knightHops, ...kingDirections];\n\t\t\t}\n\t\t},\n\t\tconfiguration: {\n\t\t\tpoints: {\n\t\t\t\tsinglesPoints: 5,\n\t\t\t\tteamsPoints: 5,\n\t\t\t\tbotFFAValue: 7,\n\t\t\t\tbotTeamsValue: 7\n\t\t\t},\n\t\t\tpiece: \"M\",\n\t\t\tmoveGenerationSettings: {\n\t\t\t\tisComplex: false,\n\t\t\t\tisJumping: true,\n\t\t\t\tisSliding: false,\n\t\t\t\tisPawn: false,\n\t\t\t\tisColorBound: false\n\t\t\t},\n\t\t\tnaming: {\n\t\t\t\tname: \"General\",\n\t\t\t\tshortName: \"m\",\n\t\t\t\tdescription: \"combines king and knight\"\n\t\t\t}\n\t\t}\n\t});\n\n\tcreatePieceDeclaration({\n\t\tbaseClassRef: class extends PieceControl {\n\t\t\tconstructor() {\n\t\t\t\tsuper();\n\t\t\t\tthis.jumping = diagonalMoves;\n\t\t\t}\n\t\t},\n\t\tconfiguration: {\n\t\t\tpoints: {\n\t\t\t\tsinglesPoints: 1,\n\t\t\t\tteamsPoints: 1,\n\t\t\t\tbotFFAValue: 0.6,\n\t\t\t\tbotTeamsValue: 0.6\n\t\t\t},\n\t\t\tpiece: \"F\",\n\t\t\tmoveGenerationSettings: {\n\t\t\t\tisComplex: false,\n\t\t\t\tisJumping: true,\n\t\t\t\tisSliding: false,\n\t\t\t\tisPawn: false,\n\t\t\t\tisColorBound: true\n\t\t\t},\n\t\t\tnaming: {\n\t\t\t\tname: \"Ferz\",\n\t\t\t\tshortName: \"f\",\n\t\t\t\tdescription: \"moves one square diagonally\"\n\t\t\t}\n\t\t}\n\t});\n\n\tcreatePieceDeclaration({\n\t\tbaseClassRef: class extends PieceControl {\n\t\t\tconstructor() {\n\t\t\t\tsuper();\n\t\t\t\tthis.jumping = orthogonalMoves;\n\t\t\t}\n\t\t},\n\t\tconfiguration: {\n\t\t\tpoints: {\n\t\t\t\tsinglesPoints: 1,\n\t\t\t\tteamsPoints: 1,\n\t\t\t\tbotFFAValue: 0.4,\n\t\t\t\tbotTeamsValue: 0.4\n\t\t\t},\n\t\t\tpiece: \"W\",\n\t\t\tmoveGenerationSettings: {\n\t\t\t\tisComplex: false,\n\t\t\t\tisJumping: true,\n\t\t\t\tisSliding: false,\n\t\t\t\tisPawn: false,\n\t\t\t\tisColorBound: false\n\t\t\t},\n\t\t\tnaming: {\n\t\t\t\tname: \"Wazir\",\n\t\t\t\tshortName: \"w\",\n\t\t\t\tdescription: \"moves one square horizontally or vertically\"\n\t\t\t}\n\t\t}\n\t});\n\n\tcreatePieceDeclaration({\n\t\tbaseClassRef: class extends PieceControl {\n\t\t\tconstructor() {\n\t\t\t\tsuper();\n\t\t\t\tthis.jumping = orthogonalMoves;\n\t\t\t}\n\t\t},\n\t\tconfiguration: {\n\t\t\tpoints: {\n\t\t\t\tsinglesPoints: 1,\n\t\t\t\tteamsPoints: 1,\n\t\t\t\tbotFFAValue: 0.4,\n\t\t\t\tbotTeamsValue: 0.4\n\t\t\t},\n\t\t\tpiece: \"W\",\n\t\t\tmoveGenerationSettings: {\n\t\t\t\tisComplex: false,\n\t\t\t\tisJumping: true,\n\t\t\t\tisSliding: false,\n\t\t\t\tisPawn: false,\n\t\t\t\tisColorBound: false\n\t\t\t},\n\t\t\tnaming: {\n\t\t\t\tname: \"Wazir\",\n\t\t\t\tshortName: \"w\",\n\t\t\t\tdescription: \"moves one square horizontally or vertically\"\n\t\t\t}\n\t\t}\n\t});\n\n\tcreatePieceDeclaration({\n\t\tbaseClassRef: class extends PieceControl {\n\t\t\tconstructor() {\n\t\t\t\tsuper();\n\t\t\t\tthis.jumping = dabbabaHops;\n\t\t\t}\n\t\t},\n\t\tconfiguration: {\n\t\t\tpoints: {\n\t\t\t\tsinglesPoints: 1,\n\t\t\t\tteamsPoints: 1,\n\t\t\t\tbotFFAValue: 1.6,\n\t\t\t\tbotTeamsValue: 1.6\n\t\t\t},\n\t\t\tpiece: \"S\",\n\t\t\tmoveGenerationSettings: {\n\t\t\t\tisComplex: false,\n\t\t\t\tisJumping: true,\n\t\t\t\tisSliding: false,\n\t\t\t\tisPawn: false,\n\t\t\t\tisColorBound: true\n\t\t\t},\n\t\t\tnaming: {\n\t\t\t\tname: \"Dabbaba\",\n\t\t\t\tshortName: \"s\",\n\t\t\t\tdescription: \"jumps two squares horizontally or vertically\"\n\t\t\t}\n\t\t}\n\t});\n\n\tcreatePieceDeclaration({\n\t\tbaseClassRef: class extends PieceControl {\n\t\t\tconstructor() {\n\t\t\t\tsuper();\n\t\t\t\tthis.sliding = dabbabaHops;\n\t\t\t}\n\t\t},\n\t\tconfiguration: {\n\t\t\tpoints: {\n\t\t\t\tsinglesPoints: 4,\n\t\t\t\tteamsPoints: 4,\n\t\t\t\tbotFFAValue: 5.4,\n\t\t\t\tbotTeamsValue: 5.4\n\t\t\t},\n\t\t\tpiece: \"T\",\n\t\t\tmoveGenerationSettings: {\n\t\t\t\tisComplex: false,\n\t\t\t\tisJumping: false,\n\t\t\t\tisSliding: true,\n\t\t\t\tisPawn: false,\n\t\t\t\tisColorBound: true\n\t\t\t},\n\t\t\tnaming: {\n\t\t\t\tname: \"Dabbaba-rider\",\n\t\t\t\tshortName: \"t\"\n\t\t\t}\n\t\t}\n\t});\n\n\tcreatePieceDeclaration({\n\t\tbaseClassRef: class extends PieceControl {\n\t\t\tconstructor() {\n\t\t\t\tsuper();\n\t\t\t\tthis.jumping = alfilHops;\n\t\t\t}\n\t\t},\n\t\tconfiguration: {\n\t\t\tpoints: {\n\t\t\t\tsinglesPoints: 1,\n\t\t\t\tteamsPoints: 1,\n\t\t\t\tbotFFAValue: 0.5,\n\t\t\t\tbotTeamsValue: 0.5\n\t\t\t},\n\t\t\tpiece: \"I\",\n\t\t\tmoveGenerationSettings: {\n\t\t\t\tisComplex: false,\n\t\t\t\tisJumping: true,\n\t\t\t\tisSliding: false,\n\t\t\t\tisPawn: false,\n\t\t\t\tisColorBound: true\n\t\t\t},\n\t\t\tnaming: {\n\t\t\t\tname: \"Alfil\",\n\t\t\t\tshortName: \"i\",\n\t\t\t\tdescription: \"jumps two squares diagonally\"\n\t\t\t}\n\t\t}\n\t});\n\n\tcreatePieceDeclaration({\n\t\tbaseClassRef: class extends PieceControl {\n\t\t\tconstructor() {\n\t\t\t\tsuper();\n\t\t\t\tthis.sliding = alfilHops;\n\t\t\t}\n\t\t},\n\t\tconfiguration: {\n\t\t\tpoints: {\n\t\t\t\tsinglesPoints: 3,\n\t\t\t\tteamsPoints: 3,\n\t\t\t\tbotFFAValue: 4.5,\n\t\t\t\tbotTeamsValue: 4.5\n\t\t\t},\n\t\t\tpiece: \"J\",\n\t\t\tmoveGenerationSettings: {\n\t\t\t\tisComplex: false,\n\t\t\t\tisJumping: false,\n\t\t\t\tisSliding: true,\n\t\t\t\tisPawn: false,\n\t\t\t\tisColorBound: true\n\t\t\t},\n\t\t\tnaming: {\n\t\t\t\tname: \"Alfil-rider\",\n\t\t\t\tshortName: \"j\"\n\t\t\t}\n\t\t}\n\t});\n\n\tcreatePieceDeclaration({\n\t\tbaseClassRef: class extends PieceControl {\n\t\t\tconstructor() {\n\t\t\t\tsuper();\n\t\t\t\tthis.jumping = [...alfilHops, ...dabbabaHops];\n\t\t\t}\n\t\t},\n\t\tconfiguration: {\n\t\t\tpoints: {\n\t\t\t\tsinglesPoints: 3,\n\t\t\t\tteamsPoints: 3,\n\t\t\t\tbotFFAValue: 3,\n\t\t\t\tbotTeamsValue: 3\n\t\t\t},\n\t\t\tpiece: \"Y\",\n\t\t\tmoveGenerationSettings: {\n\t\t\t\tisComplex: false,\n\t\t\t\tisJumping: true,\n\t\t\t\tisSliding: false,\n\t\t\t\tisPawn: false,\n\t\t\t\tisColorBound: true\n\t\t\t},\n\t\t\tnaming: {\n\t\t\t\tname: \"Alibaba\",\n\t\t\t\tshortName: \"y\",\n\t\t\t\tdescription: \"combines alfil and dabbaba\"\n\t\t\t}\n\t\t}\n\t});\n\n\tcreatePieceDeclaration({\n\t\tbaseClassRef: class extends PieceControl {\n\t\t\tconstructor() {\n\t\t\t\tsuper();\n\t\t\t\tthis.sliding = [...alfilHops, ...dabbabaHops];\n\t\t\t}\n\t\t},\n\t\tconfiguration: {\n\t\t\tpoints: {\n\t\t\t\tsinglesPoints: 6,\n\t\t\t\tteamsPoints: 6,\n\t\t\t\tbotFFAValue: 6.2,\n\t\t\t\tbotTeamsValue: 6.2\n\t\t\t},\n\t\t\tpiece: \"Z\",\n\t\t\tmoveGenerationSettings: {\n\t\t\t\tisComplex: false,\n\t\t\t\tisJumping: false,\n\t\t\t\tisSliding: true,\n\t\t\t\tisPawn: false,\n\t\t\t\tisColorBound: true\n\t\t\t},\n\t\t\tnaming: {\n\t\t\t\tname: \"Alibaba-rider\",\n\t\t\t\tshortName: \"z\"\n\t\t\t}\n\t\t}\n\t});\n\n\tcreatePieceDeclaration({\n\t\tbaseClassRef: class extends PieceControl {\n\t\t\tconstructor() {\n\t\t\t\tsuper();\n\t\t\t\tthis.jumping = knightHops;\n\t\t\t\tthis.sliding = kingDirections;\n\t\t\t}\n\t\t},\n\t\tconfiguration: {\n\t\t\tpoints: {\n\t\t\t\tsinglesPoints: 12,\n\t\t\t\tteamsPoints: 12,\n\t\t\t\tbotFFAValue: 17,\n\t\t\t\tbotTeamsValue: 17\n\t\t\t},\n\t\t\tpiece: \"A\",\n\t\t\tmoveGenerationSettings: {\n\t\t\t\tisComplex: false,\n\t\t\t\tisJumping: true,\n\t\t\t\tisSliding: true,\n\t\t\t\tisPawn: false,\n\t\t\t\tisColorBound: false\n\t\t\t},\n\t\t\tnaming: {\n\t\t\t\tname: \"Amazon\",\n\t\t\t\tshortName: \"a\",\n\t\t\t\tdescription: \"combines queen and knight\"\n\t\t\t}\n\t\t}\n\t});\n\n\tcreatePieceDeclaration({\n\t\tbaseClassRef: class extends PieceControl {\n\t\t\tconstructor() {\n\t\t\t\tsuper();\n\t\t\t\tthis.jumping = camelHops;\n\t\t\t}\n\t\t},\n\t\tconfiguration: {\n\t\t\tpoints: {\n\t\t\t\tsinglesPoints: 3,\n\t\t\t\tteamsPoints: 3,\n\t\t\t\tbotFFAValue: 4.2,\n\t\t\t\tbotTeamsValue: 4.2\n\t\t\t},\n\t\t\tpiece: \"C\",\n\t\t\tmoveGenerationSettings: {\n\t\t\t\tisComplex: false,\n\t\t\t\tisJumping: true,\n\t\t\t\tisSliding: false,\n\t\t\t\tisPawn: false,\n\t\t\t\tisColorBound: true\n\t\t\t},\n\t\t\tnaming: {\n\t\t\t\tname: \"Camel\",\n\t\t\t\tshortName: \"c\",\n\t\t\t\tdescription: \"an elongated 3-1 knight\"\n\t\t\t}\n\t\t}\n\t});\n\n\tcreatePieceDeclaration({\n\t\tbaseClassRef: class extends PieceControl {\n\t\t\tconstructor() {\n\t\t\t\tsuper();\n\t\t\t\tthis.jumping = knightHops;\n\t\t\t\tthis.sliding = orthogonalMoves;\n\t\t\t}\n\t\t},\n\t\tconfiguration: {\n\t\t\tpoints: {\n\t\t\t\tsinglesPoints: 7,\n\t\t\t\tteamsPoints: 7,\n\t\t\t\tbotFFAValue: 10,\n\t\t\t\tbotTeamsValue: 10\n\t\t\t},\n\t\t\tpiece: \"E\",\n\t\t\tmoveGenerationSettings: {\n\t\t\t\tisComplex: false,\n\t\t\t\tisJumping: true,\n\t\t\t\tisSliding: true,\n\t\t\t\tisPawn: false,\n\t\t\t\tisColorBound: false\n\t\t\t},\n\t\t\tnaming: {\n\t\t\t\tname: \"Chancellor\",\n\t\t\t\tshortName: \"a\",\n\t\t\t\tdescription: \"combines rook and knight\"\n\t\t\t}\n\t\t}\n\t});\n\n\tcreatePieceDeclaration({\n\t\tbaseClassRef: class extends PieceControl {\n\t\t\tconstructor() {\n\t\t\t\tsuper();\n\t\t\t\tthis.jumping = knightHops;\n\t\t\t\tthis.sliding = diagonalMoves;\n\t\t\t}\n\t\t},\n\t\tconfiguration: {\n\t\t\tpoints: {\n\t\t\t\tsinglesPoints: 7,\n\t\t\t\tteamsPoints: 7,\n\t\t\t\tbotFFAValue: 9,\n\t\t\t\tbotTeamsValue: 9\n\t\t\t},\n\t\t\tpiece: \"H\",\n\t\t\tmoveGenerationSettings: {\n\t\t\t\tisComplex: false,\n\t\t\t\tisJumping: true,\n\t\t\t\tisSliding: true,\n\t\t\t\tisPawn: false,\n\t\t\t\tisColorBound: false\n\t\t\t},\n\t\t\tnaming: {\n\t\t\t\tname: \"Archbishop\",\n\t\t\t\tshortName: \"h\",\n\t\t\t\tdescription: \"combines bishop and knight\"\n\t\t\t}\n\t\t}\n\t});\n\n\tcreatePieceDeclaration({\n\t\tbaseClassRef: class extends PieceControl {\n\t\t\tconstructor() {\n\t\t\t\tsuper();\n\t\t\t\tthis.sliding = knightHops;\n\t\t\t}\n\t\t},\n\t\tconfiguration: {\n\t\t\tpoints: {\n\t\t\t\tsinglesPoints: 7,\n\t\t\t\tteamsPoints: 7,\n\t\t\t\tbotFFAValue: 10,\n\t\t\t\tbotTeamsValue: 10\n\t\t\t},\n\t\t\tpiece: \"O\",\n\t\t\tmoveGenerationSettings: {\n\t\t\t\tisComplex: false,\n\t\t\t\tisJumping: false,\n\t\t\t\tisSliding: true,\n\t\t\t\tisPawn: false,\n\t\t\t\tisColorBound: false\n\t\t\t},\n\t\t\tnaming: {\n\t\t\t\tname: \"Knight-rider\",\n\t\t\t\tshortName: \"o\"\n\t\t\t}\n\t\t}\n\t});\n\n\tcreatePieceDeclaration({\n\t\tbaseClassRef: class extends PieceControl {\n\t\t\tconstructor() {\n\t\t\t\tsuper();\n\t\t\t\tthis.sliding = camelHops;\n\t\t\t}\n\t\t},\n\t\tconfiguration: {\n\t\t\tpoints: {\n\t\t\t\tsinglesPoints: 7,\n\t\t\t\tteamsPoints: 7,\n\t\t\t\tbotFFAValue: 8,\n\t\t\t\tbotTeamsValue: 8\n\t\t\t},\n\t\t\tpiece: \"L\",\n\t\t\tmoveGenerationSettings: {\n\t\t\t\tisComplex: false,\n\t\t\t\tisJumping: false,\n\t\t\t\tisSliding: true,\n\t\t\t\tisPawn: false,\n\t\t\t\tisColorBound: true\n\t\t\t},\n\t\t\tnaming: {\n\t\t\t\tname: \"Camel-rider\",\n\t\t\t\tshortName: \"l\"\n\t\t\t}\n\t\t}\n\t});\n\n\tcreatePieceDeclaration({\n\t\tbaseClassRef: class extends PieceControl {\n\t\t\tconstructor() {\n\t\t\t\tsuper();\n\t\t\t\tthis.jumping = [...camelHops, ...knightHops];\n\t\t\t}\n\t\t},\n\t\tconfiguration: {\n\t\t\tpoints: {\n\t\t\t\tsinglesPoints: 5,\n\t\t\t\tteamsPoints: 5,\n\t\t\t\tbotFFAValue: 8,\n\t\t\t\tbotTeamsValue: 8\n\t\t\t},\n\t\t\tpiece: \"V\",\n\t\t\tmoveGenerationSettings: {\n\t\t\t\tisComplex: false,\n\t\t\t\tisJumping: true,\n\t\t\t\tisSliding: false,\n\t\t\t\tisPawn: false,\n\t\t\t\tisColorBound: false\n\t\t\t},\n\t\t\tnaming: {\n\t\t\t\tname: \"Wildebeest\",\n\t\t\t\tshortName: \"v\",\n\t\t\t\tdescription: \"combines camel and knight\"\n\t\t\t}\n\t\t}\n\t});\n\n\tcreatePieceDeclaration({\n\t\tbaseClassRef: class extends PieceControl {\n\t\t\tconstructor() {\n\t\t\t\tsuper();\n\t\t\t\tthis.hooks.usePerspective = [true, true, true, true];\n\t\t\t\tthis.hooks.usePawnLogic = {};\n\t\t\t}\n\n\t\t\tgetPossibleCells() {\n\t\t\t\tthis.generateJumpAttack({ displacement: [-1, -1], special: AttackType.AttackOnly });\n\t\t\t\tthis.generateJumpAttack({ displacement: [-1, 1], special: AttackType.AttackOnly });\n\t\t\t\tthis.generateSlidingAttack({\n\t\t\t\t\tdisplacement: [-1, 0],\n\t\t\t\t\tspecial: AttackType.MoveOnly,\n\t\t\t\t\tlimit: this.baseRankActive ? 2 : 1,\n\t\t\t\t\tirreversible: true\n\t\t\t\t});\n\t\t\t\treturn this.moves;\n\t\t\t}\n\n\t\t\trayGenJumpingAttacks() {\n\t\t\t\tthis.generateJumpAttack({ displacement: [-1, -1], special: AttackType.RayTrace });\n\t\t\t\tthis.generateJumpAttack({ displacement: [-1, 1], special: AttackType.RayTrace });\n\t\t\t\tconst moves = this.moves.slice();\n\t\t\t\tthis.moves = [];\n\t\t\t\treturn moves;\n\t\t\t}\n\t\t},\n\t\tconfiguration: {\n\t\t\tpoints: {\n\t\t\t\tsinglesPoints: 1,\n\t\t\t\tteamsPoints: 1,\n\t\t\t\tbotFFAValue: 1,\n\t\t\t\tbotTeamsValue: 0.4\n\t\t\t},\n\t\t\tpiece: pawnPieceLetter,\n\t\t\tmoveGenerationSettings: {\n\t\t\t\tisComplex: false,\n\t\t\t\tisJumping: true,\n\t\t\t\tisSliding: false,\n\t\t\t\tisPawn: true,\n\t\t\t\tisColorBound: false\n\t\t\t},\n\t\t\tnaming: {\n\t\t\t\tname: \"Pawn\",\n\t\t\t\tshortName: pawnPieceLetter.toLowerCase()\n\t\t\t}\n\t\t}\n\t});\n\n\tcreatePieceDeclaration({\n\t\tbaseClassRef: class extends PieceControl {\n\t\t\tconstructor() {\n\t\t\t\tsuper();\n\t\t\t\tthis.hooks.usePerspective = [true, true, true, true];\n\t\t\t\tthis.hooks.usePawnLogic = {};\n\t\t\t}\n\n\t\t\tgetPossibleCells() {\n\t\t\t\tthis.generateSlidingAttack({\n\t\t\t\t\tdisplacement: [-1, -1],\n\t\t\t\t\tspecial: AttackType.MoveOnly,\n\t\t\t\t\tlimit: this.baseRankActive ? 2 : 1,\n\t\t\t\t\tirreversible: true\n\t\t\t\t});\n\t\t\t\tthis.generateSlidingAttack({\n\t\t\t\t\tdisplacement: [-1, 1],\n\t\t\t\t\tspecial: AttackType.MoveOnly,\n\t\t\t\t\tlimit: this.baseRankActive ? 2 : 1,\n\t\t\t\t\tirreversible: true\n\t\t\t\t});\n\t\t\t\tthis.generateJumpAttack({ displacement: [-1, -1], special: AttackType.AttackOnly });\n\t\t\t\treturn this.moves;\n\t\t\t}\n\n\t\t\trayGenJumpingAttacks() {\n\t\t\t\tthis.generateJumpAttack({ displacement: [-1, -1], special: AttackType.RayTrace });\n\t\t\t\tconst moves = this.moves.slice();\n\t\t\t\tthis.moves = [];\n\t\t\t\treturn moves;\n\t\t\t}\n\t\t},\n\t\tconfiguration: {\n\t\t\tpoints: {\n\t\t\t\tsinglesPoints: 1,\n\t\t\t\tteamsPoints: 1,\n\t\t\t\tbotFFAValue: 1,\n\t\t\t\tbotTeamsValue: 0.4\n\t\t\t},\n\t\t\tpiece: \"α\",\n\t\t\tmoveGenerationSettings: {\n\t\t\t\tisComplex: false,\n\t\t\t\tisJumping: true,\n\t\t\t\tisSliding: false,\n\t\t\t\tisPawn: true,\n\t\t\t\tisColorBound: false\n\t\t\t},\n\t\t\tnaming: {\n\t\t\t\tname: \"Berolina\",\n\t\t\t\tshortName: \"alpha\",\n\t\t\t\tdescription: \"a pawn that moves diagonally and captures forwards\"\n\t\t\t}\n\t\t}\n\t});\n\n\tconst stoneGeneralControl = createPieceDeclaration({\n\t\tbaseClassRef: class extends PieceControl {\n\t\t\tconstructor() {\n\t\t\t\tsuper();\n\t\t\t\tthis.hooks.usePerspective = [true, true, true, true];\n\t\t\t\tthis.hooks.usePawnLogic = {};\n\t\t\t}\n\n\t\t\tgetPossibleCells() {\n\t\t\t\tthis.generateSlidingAttack({\n\t\t\t\t\tdisplacement: [-1, -1],\n\t\t\t\t\tspecial: AttackType.MoveOnly,\n\t\t\t\t\tlimit: this.baseRankActive ? 2 : 0,\n\t\t\t\t\tirreversible: true\n\t\t\t\t});\n\t\t\t\tthis.generateSlidingAttack({\n\t\t\t\t\tdisplacement: [-1, 1],\n\t\t\t\t\tspecial: AttackType.MoveOnly,\n\t\t\t\t\tlimit: this.baseRankActive ? 2 : 0,\n\t\t\t\t\tirreversible: true\n\t\t\t\t});\n\t\t\t\tthis.generateJumpAttack({\n\t\t\t\t\tdisplacement: [-1, -1],\n\t\t\t\t\tirreversible: true\n\t\t\t\t});\n\t\t\t\tthis.generateJumpAttack({\n\t\t\t\t\tdisplacement: [-1, 1],\n\t\t\t\t\tirreversible: true\n\t\t\t\t});\n\t\t\t\treturn this.moves;\n\t\t\t}\n\n\t\t\trayGenJumpingAttacks() {\n\t\t\t\tthis.generateJumpAttack({ displacement: [-1, -1], special: AttackType.RayTrace });\n\t\t\t\tthis.generateJumpAttack({ displacement: [-1, 1], special: AttackType.RayTrace });\n\t\t\t\tconst moves = this.moves.slice();\n\t\t\t\tthis.moves = [];\n\t\t\t\treturn moves;\n\t\t\t}\n\t\t},\n\t\tconfiguration: {\n\t\t\tpoints: {\n\t\t\t\tsinglesPoints: 1,\n\t\t\t\tteamsPoints: 1,\n\t\t\t\tbotFFAValue: 1,\n\t\t\t\tbotTeamsValue: 0.4\n\t\t\t},\n\t\t\tpiece: \"γ\",\n\t\t\tmoveGenerationSettings: {\n\t\t\t\tisComplex: false,\n\t\t\t\tisJumping: true,\n\t\t\t\tisSliding: false,\n\t\t\t\tisPawn: true,\n\t\t\t\tisColorBound: false\n\t\t\t},\n\t\t\tnaming: {\n\t\t\t\tname: \"Stone General\",\n\t\t\t\tshortName: \"gamma\",\n\t\t\t\tdescription: \"a pawn that moves and captures diagonally\"\n\t\t\t}\n\t\t}\n\t});\n\n\tconst soldierControl = createPieceDeclaration({\n\t\tbaseClassRef: class extends PieceControl {\n\t\t\tconstructor() {\n\t\t\t\tsuper();\n\t\t\t\tthis.hooks.usePerspective = [true, true, true, true];\n\t\t\t\tthis.hooks.usePawnLogic = {};\n\t\t\t}\n\n\t\t\tgetPossibleCells() {\n\t\t\t\tthis.generateSlidingAttack({\n\t\t\t\t\tdisplacement: [-1, 0],\n\t\t\t\t\tspecial: AttackType.MoveOnly,\n\t\t\t\t\tlimit: this.baseRankActive ? 2 : 0,\n\t\t\t\t\tirreversible: true\n\t\t\t\t});\n\t\t\t\tthis.generateJumpAttack({\n\t\t\t\t\tdisplacement: [-1, 0],\n\t\t\t\t\tirreversible: true\n\t\t\t\t});\n\t\t\t\treturn this.moves;\n\t\t\t}\n\n\t\t\trayGenJumpingAttacks() {\n\t\t\t\tthis.generateJumpAttack({ displacement: [-1, 0], special: AttackType.RayTrace });\n\t\t\t\tconst moves = this.moves.slice();\n\t\t\t\tthis.moves = [];\n\t\t\t\treturn moves;\n\t\t\t}\n\t\t},\n\t\tconfiguration: {\n\t\t\tpoints: {\n\t\t\t\tsinglesPoints: 1,\n\t\t\t\tteamsPoints: 1,\n\t\t\t\tbotFFAValue: 1,\n\t\t\t\tbotTeamsValue: 0.4\n\t\t\t},\n\t\t\tpiece: \"β\",\n\t\t\tmoveGenerationSettings: {\n\t\t\t\tisComplex: false,\n\t\t\t\tisJumping: true,\n\t\t\t\tisSliding: false,\n\t\t\t\tisPawn: true,\n\t\t\t\tisColorBound: false\n\t\t\t},\n\t\t\tnaming: {\n\t\t\t\tname: \"Soldier\",\n\t\t\t\tshortName: \"beta\",\n\t\t\t\tdescription: \"a pawn that moves and captures forwards only\"\n\t\t\t}\n\t\t}\n\t});\n\n\tcreatePieceDeclaration({\n\t\tbaseClassRef: class extends PieceControl {\n\t\t\tconstructor() {\n\t\t\t\tsuper();\n\t\t\t\tthis.hooks.usePerspective = [true, true, true, true];\n\t\t\t\tthis.hooks.usePawnLogic = {};\n\t\t\t}\n\n\t\t\tgetPossibleCells() {\n\t\t\t\tstoneGeneralControl.getPossibleCells.call(this);\n\t\t\t\tsoldierControl.getPossibleCells.call(this);\n\t\t\t\treturn this.moves;\n\t\t\t}\n\n\t\t\trayGenJumpingAttacks() {\n\t\t\t\tstoneGeneralControl.rayGenJumpingAttacks.call(this);\n\t\t\t\tsoldierControl.rayGenJumpingAttacks.call(this);\n\t\t\t\tconst moves = this.moves.slice();\n\t\t\t\tthis.moves = [];\n\t\t\t\treturn moves;\n\t\t\t}\n\t\t},\n\t\tconfiguration: {\n\t\t\tpoints: {\n\t\t\t\tsinglesPoints: 1,\n\t\t\t\tteamsPoints: 1,\n\t\t\t\tbotFFAValue: 1,\n\t\t\t\tbotTeamsValue: 0.4\n\t\t\t},\n\t\t\tpiece: \"δ\",\n\t\t\tmoveGenerationSettings: {\n\t\t\t\tisComplex: false,\n\t\t\t\tisJumping: true,\n\t\t\t\tisSliding: false,\n\t\t\t\tisPawn: true,\n\t\t\t\tisColorBound: false\n\t\t\t},\n\t\t\tnaming: {\n\t\t\t\tname: \"Sergeant\",\n\t\t\t\tshortName: \"delta\",\n\t\t\t\tdescription: \"a pawn that moves and captures forwards and diagonally\"\n\t\t\t}\n\t\t}\n\t});\n\n\tconst xiangqiHorseControl = createPieceDeclaration({\n\t\tbaseClassRef: class extends PieceControl {\n\t\t\tconstructor() {\n\t\t\t\tsuper();\n\t\t\t\tthis.hooks.useTrajectory = [\n\t\t\t\t\t[-1, 0],\n\t\t\t\t\t[1, 0],\n\t\t\t\t\t[0, 1],\n\t\t\t\t\t[0, -1]\n\t\t\t\t];\n\t\t\t}\n\n\t\t\tgetPossibleCells() {\n\t\t\t\tthis.generateJumpAttack({ displacement: [-1, -2], special: AttackType.Normal, squareBlockingIndex: 3 });\n\t\t\t\tthis.generateJumpAttack({ displacement: [1, -2], special: AttackType.Normal, squareBlockingIndex: 3 });\n\t\t\t\tthis.generateJumpAttack({ displacement: [-1, 2], special: AttackType.Normal, squareBlockingIndex: 2 });\n\t\t\t\tthis.generateJumpAttack({ displacement: [1, 2], special: AttackType.Normal, squareBlockingIndex: 2 });\n\t\t\t\tthis.generateJumpAttack({ displacement: [2, -1], special: AttackType.Normal, squareBlockingIndex: 1 });\n\t\t\t\tthis.generateJumpAttack({ displacement: [2, 1], special: AttackType.Normal, squareBlockingIndex: 1 });\n\t\t\t\tthis.generateJumpAttack({ displacement: [-2, -1], special: AttackType.Normal, squareBlockingIndex: 0 });\n\t\t\t\tthis.generateJumpAttack({ displacement: [-2, 1], special: AttackType.Normal, squareBlockingIndex: 0 });\n\n\t\t\t\treturn this.moves;\n\t\t\t}\n\t\t},\n\t\tconfiguration: {\n\t\t\tpoints: {\n\t\t\t\tsinglesPoints: 2,\n\t\t\t\tteamsPoints: 2,\n\t\t\t\tbotFFAValue: 2.1,\n\t\t\t\tbotTeamsValue: 2.1\n\t\t\t},\n\t\t\tpiece: \"U\",\n\t\t\tmoveGenerationSettings: {\n\t\t\t\tisComplex: true,\n\t\t\t\tisJumping: true,\n\t\t\t\tisSliding: false,\n\t\t\t\tisPawn: false,\n\t\t\t\tisColorBound: false\n\t\t\t},\n\t\t\tnaming: {\n\t\t\t\tname: \"Xiangqi horse\",\n\t\t\t\tshortName: \"u\",\n\t\t\t\tdescription: \"moves one square orthogonally and then one diagonally\"\n\t\t\t}\n\t\t}\n\t});\n\n\tcreatePieceDeclaration({\n\t\tbaseClassRef: class extends PieceControl {\n\t\t\tconstructor() {\n\t\t\t\tsuper();\n\t\t\t\tthis.hooks.useTrajectory = [\n\t\t\t\t\t[-1, 0],\n\t\t\t\t\t[1, 0],\n\t\t\t\t\t[0, 1],\n\t\t\t\t\t[0, -1]\n\t\t\t\t];\n\t\t\t}\n\n\t\t\tgetPossibleCells() {\n\t\t\t\txiangqiHorseControl.getPossibleCells.call(this);\n\t\t\t\tthis.sliding.forEach((displacement) => {\n\t\t\t\t\tthis.generateSlidingAttack({ displacement });\n\t\t\t\t});\n\n\t\t\t\treturn this.moves;\n\t\t\t}\n\t\t},\n\t\tconfiguration: {\n\t\t\tpoints: {\n\t\t\t\tsinglesPoints: 6,\n\t\t\t\tteamsPoints: 6,\n\t\t\t\tbotFFAValue: 7.5,\n\t\t\t\tbotTeamsValue: 7.5\n\t\t\t},\n\t\t\tpiece: \"Δ\",\n\t\t\tmoveGenerationSettings: {\n\t\t\t\tisComplex: true,\n\t\t\t\tisJumping: true,\n\t\t\t\tisSliding: true,\n\t\t\t\tisPawn: false,\n\t\t\t\tisColorBound: false\n\t\t\t},\n\t\t\tnaming: {\n\t\t\t\tname: \"Dragon bishop\",\n\t\t\t\tshortName: \"deltaUpper\",\n\t\t\t\tdescription: \"combines bishop and xiangqi horse\"\n\t\t\t}\n\t\t}\n\t});\n\n\tcreatePieceDeclaration({\n\t\tbaseClassRef: class extends PieceControl {\n\t\t\tconstructor() {\n\t\t\t\tsuper();\n\t\t\t\tthis.hooks.useHopping = true;\n\t\t\t\tthis.sliding = kingDirections;\n\t\t\t}\n\t\t},\n\t\tconfiguration: {\n\t\t\tpoints: {\n\t\t\t\tsinglesPoints: 3,\n\t\t\t\tteamsPoints: 3,\n\t\t\t\tbotFFAValue: 5.8,\n\t\t\t\tbotTeamsValue: 5.8\n\t\t\t},\n\t\t\tpiece: grasshopperPieceLetter,\n\t\t\tmoveGenerationSettings: {\n\t\t\t\tisComplex: true,\n\t\t\t\tisJumping: true,\n\t\t\t\tisSliding: false,\n\t\t\t\tisPawn: false,\n\t\t\t\tisColorBound: false\n\t\t\t},\n\t\t\tnaming: {\n\t\t\t\tname: \"Grasshopper\",\n\t\t\t\tshortName: grasshopperPieceLetter.toLowerCase(),\n\t\t\t\tdescription: \"jumps in any direction hopping over the first piece, landing immediately behind it\"\n\t\t\t}\n\t\t}\n\t});\n};\n","import type { PieceString } from \"@moveGeneration/GameInformation/GameUnits/PieceString\";\nimport { Coordinate, nonPlayablePieces, NumericColor } from \"../GameInformation/GameUnits/GameUnits\";\nimport type { PieceControl } from \"./PieceControl\";\n\nexport const enum AttackType {\n\tNormal,\n\tMoveOnly,\n\tAttackOnly,\n\tRayGen,\n\tRayTrace,\n\tRayTraceLimited\n}\nexport interface PieceControlHooks {\n\tuseTrajectory: Coordinate[] | undefined;\n\tusePerspective: boolean[] | undefined;\n\tusePawnLogic: { promotionRanks?: [number, number, number, number]; promotionPieces?: PieceLetter[] } | undefined;\n\tuseHopping: boolean;\n}\nexport interface PieceControlConfiguration {\n\tdisplacement: Coordinate;\n\tspecial?: AttackType;\n\tlimit?: number;\n\tsquareBlockingIndex?: number;\n\trayGenCache?: Coordinate;\n\tirreversible?: true;\n}\n\nexport interface PieceControlConfigSettings {\n\tpoints: {\n\t\tsinglesPoints: number;\n\t\tteamsPoints: number;\n\t\tbotFFAValue: number;\n\t\tbotTeamsValue: number;\n\t};\n\tpiece: string;\n\tmoveGenerationSettings: {\n\t\tisComplex: boolean;\n\t\tisJumping: boolean;\n\t\tisSliding: boolean;\n\t\tisPawn: boolean;\n\t\tisColorBound: boolean;\n\t};\n\tnaming: {\n\t\tname: string;\n\t\tshortName: string;\n\t\tdescription?: string;\n\t};\n}\n\nexport const nonPlayableValues: string[] = Object.values(nonPlayablePieces);\ndeclare const pieceLetterTag: unique symbol;\nexport type PieceLetter = string & { _: typeof pieceLetterTag };\nexport const verifyPieceLetter = (piece: string): piece is PieceLetter =>\n\tpiece in pieceControlConfigSettings || nonPlayableValues.includes(piece);\n\nexport const pieceControlConfigSettings = nonPlayableValues.reduce<Record<PieceLetter, PieceControlSettings>>(\n\t(p, n) => ({\n\t\t...p,\n\t\t[n]: {\n\t\t\tpoints: {\n\t\t\t\tsinglesPoints: 0,\n\t\t\t\tteamsPoints: 0,\n\t\t\t\tbotFFAValue: 0,\n\t\t\t\tbotTeamsValue: 0\n\t\t\t},\n\t\t\tpiece: n,\n\t\t\tmoveGenerationSettings: {\n\t\t\t\tisComplex: false,\n\t\t\t\tisJumping: false,\n\t\t\t\tisSliding: false,\n\t\t\t\tisPawn: false\n\t\t\t},\n\t\t\tnaming: {\n\t\t\t\tname: \"Wall\",\n\t\t\t\tshortName: n\n\t\t\t}\n\t\t}\n\t}),\n\t{}\n);\nexport interface PieceControlSettings extends PieceControlConfigSettings {\n\tconstruct: new () => PieceControl;\n}\ninterface PieceControlDeclarationConfiguration<T extends PieceControl> {\n\tconfiguration: PieceControlConfigSettings;\n\tbaseClassRef: new () => T;\n}\nexport const createPieceDeclaration = <T extends PieceControl>(configuration: PieceControlDeclarationConfiguration<T>) => {\n\tpieceControlConfigSettings[configuration.configuration.piece as PieceLetter] = {\n\t\t...configuration.configuration,\n\t\tconstruct: configuration.baseClassRef\n\t};\n\n\treturn new configuration.baseClassRef();\n};\n\nexport interface PieceControlGeneratedMove {\n\tmove: Coordinate;\n\tirreversible: boolean;\n}\n\nexport interface PieceControlInternalMove {\n\ti: number;\n\tj: number;\n\tisRayGen?: boolean;\n\tirreversible?: boolean;\n}\n\nexport interface ControlConfiguration {\n\tcoordinates: [number, number];\n\tboard: PieceString[][];\n\timmunePieces: [boolean, boolean, boolean, boolean];\n\tcolor: NumericColor;\n\tbaseRank?: boolean;\n}\n\nfunction createPredefinedPieceLetter(letter: string) {\n\treturn letter as PieceLetter;\n}\n\nexport const pawnPieceLetter = createPredefinedPieceLetter(\"P\");\nexport const wallPieceLetter = createPredefinedPieceLetter(nonPlayablePieces.wall);\nexport const grasshopperPieceLetter = createPredefinedPieceLetter(\"G\");\nexport const defaultPieces = {\n\tqueen: createPredefinedPieceLetter(\"Q\"),\n\trook: createPredefinedPieceLetter(\"R\"),\n\tbishop: createPredefinedPieceLetter(\"B\"),\n\tknight: createPredefinedPieceLetter(\"N\"),\n\tking: createPredefinedPieceLetter(\"K\")\n} as const;\nexport const emptyLetter = createPredefinedPieceLetter(\"\");\nexport const duckLetter = createPredefinedPieceLetter(nonPlayablePieces.duck);\nexport const dameLetter = createPredefinedPieceLetter(\"D\");","import { copyClass } from \"@client/ts/utils/ObjectUtils\";\nimport { verifyFunctionType, importAll, FunctionType } from \"../../../baseTypes\";\nimport type {\n\tAllowedSuperClasses,\n\tVariantDataRules,\n\tVariantRuleInformation,\n\tVariantRuleHandler,\n\tAllowedHandlerClasses,\n\tVariantRuleAllowedChecks\n} from \"./VariantRuleInterface\";\n\nexport interface VariantRulePublicProperties<K extends keyof VariantDataRules> {\n\treadonly information: VariantRuleInformation<K>;\n\treadonly parameterValue: VariantDataRules[K];\n}\n\nconst verifyHandlerProperty = <C extends AllowedSuperClasses>(\n\thandler: VariantRuleHandler<InstanceType<C>>,\n\tkey: PropertyKey\n): key is keyof typeof handler => key in handler;\nconst verifyPrototypeProperty = <C extends AllowedSuperClasses>(\n\tsuperClass: C,\n\tkey: PropertyKey\n): key is keyof AllowedSuperClasses[\"prototype\"] => key in superClass.prototype;\n\nexport abstract class VariantRule<C extends AllowedSuperClasses, K extends keyof VariantDataRules> {\n\tdeclare [\"constructor\"]: new (...args: unknown[]) => VariantRule<C, K>;\n\n\treadonly dependencies = new Map<new (...args: unknown[]) => VariantRule<AllowedSuperClasses, keyof VariantDataRules>, unknown[]>();\n\tstatic readonly variantRuleList: Array<\n\t\tnew (...args: unknown[]) => VariantRule<AllowedSuperClasses, keyof VariantDataRules> & VariantRuleHandler<AllowedHandlerClasses>\n\t> = [];\n\tprotected static initVariantRule(\n\t\trv: new (...args: unknown[]) => VariantRule<AllowedSuperClasses, keyof VariantDataRules> & VariantRuleHandler<AllowedHandlerClasses>\n\t) {\n\t\tVariantRule.variantRuleList.push(rv);\n\t}\n\tprotected decorator!: InstanceType<C>;\n\tprotected wrappingDecorators: Array<VariantRuleHandler<InstanceType<C>>> = [];\n\n\tinitializeBaseHandler(handler: InstanceType<C>) {\n\t\tthis.decorator = handler;\n\t}\n\n\tinitializeWrappingHandler(handler: VariantRule<C, keyof VariantDataRules> & VariantRuleHandler<InstanceType<C>>) {\n\t\tthis.wrappingDecorators.push(handler);\n\t}\n\n\tinjectIntoBaseClass(callback: (this: InstanceType<C>) => void) {\n\t\treturn callback.bind(this.decorator);\n\t}\n\n\tcallHandler<K extends keyof this & keyof InstanceType<C>>(\n\t\tmethod: K,\n\t\targs: IArguments\n\t): this[K] extends FunctionType ? ReturnType<this[K]> : never {\n\t\tfor (const decorator of this.wrappingDecorators) {\n\t\t\tif (!verifyHandlerProperty(decorator, method)) continue;\n\t\t\tconst decoratorMethod = decorator[method];\n\t\t\tif (!verifyFunctionType(decoratorMethod)) continue;\n\t\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-return\n\t\t\treturn decoratorMethod.call(decorator, ...args);\n\t\t}\n\n\t\tconst decoratorType: C = this.getDecoratorType();\n\t\tif (!verifyPrototypeProperty(decoratorType, method)) throw new Error(\"Method called to callHandler is not a part of prototype\");\n\t\tconst prototypeMethod: unknown = decoratorType.prototype[method];\n\t\tif (!verifyFunctionType(prototypeMethod)) throw new Error(\"Method called to callHandler is not a part of prototype\");\n\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-return\n\t\treturn prototypeMethod.call(this.decorator, ...args);\n\t}\n\n\tabstract matchesPGNDeclaration(match: string): boolean;\n\tabstract getPublicProperties(): VariantRulePublicProperties<K>;\n\tabstract getDecoratorType(): C;\n\tabstract serializeToParsingForm(): string;\n\tabstract isDisabled(parameters: VariantRuleAllowedChecks): boolean;\n\tgetParametrizedOptions?(): VariantDataRules[K] extends boolean ? never : Map<string, VariantDataRules[K]>;\n\n\tgetInsufficientMaterialData() {\n\t\treturn {\n\t\t\tisPartiallyDisabled: false,\n\t\t\tisDisabled: false\n\t\t};\n\t}\n}\n\nconst objectPrototype = new Set(Reflect.ownKeys(Reflect.getPrototypeOf({}) ?? []));\nexport function decorateClassWithVariants<C extends AllowedSuperClasses>(\n\tbaseClass: InstanceType<C>,\n\tclassReference: new (...args: ConstructorParameters<C>) => InstanceType<C>,\n\tvariants: Array<VariantRule<C, keyof VariantDataRules> & VariantRuleHandler<InstanceType<C>>>\n): InstanceType<C> {\n\tif (variants.length === 0) return baseClass;\n\n\tconst decoratorProperties = copyClass(baseClass, classReference, true);\n\tconst methods = new Set<keyof InstanceType<C>>();\n\tdecoratorProperties.initDecoratorSettings = () => {\n\t\t// Do nothing, this method only exists for the purpose of being overridden\n\t};\n\tmethods.add(\"initDecoratorSettings\");\n\tconst lastInheritedMethods = new Set<string | symbol>();\n\n\tlet basePrototype: object | null = null;\n\tconst verifyKeyInDecoratorProperties = (k: PropertyKey): k is keyof InstanceType<C> =>\n\t\ttypeof k !== \"number\" && k in decoratorProperties && !objectPrototype.has(k) && !lastInheritedMethods.has(k);\n\twhile ((basePrototype = Reflect.getPrototypeOf(basePrototype ?? baseClass))) {\n\t\tReflect.ownKeys(basePrototype).forEach((k) => {\n\t\t\tif (verifyKeyInDecoratorProperties(k)) {\n\t\t\t\tdecoratorProperties[k] = baseClass[k];\n\t\t\t\tmethods.add(k);\n\t\t\t\tlastInheritedMethods.add(k);\n\t\t\t}\n\t\t});\n\t}\n\n\tconst verifyOwnProperty = (k: PropertyKey): k is keyof InstanceType<C> => k in baseClass;\n\tfor (const property of Object.getOwnPropertyNames(baseClass)) {\n\t\tif (!verifyOwnProperty(property)) throw new Error(\"Expected prototype to not be overridden\");\n\n\t\tconst localProperty = property;\n\t\tObject.defineProperty(decoratorProperties, property, {\n\t\t\tget: function (): (typeof baseClass)[keyof typeof baseClass] {\n\t\t\t\treturn baseClass[localProperty];\n\t\t\t},\n\t\t\tset: function (v: InstanceType<C>[string & keyof InstanceType<C>]) {\n\t\t\t\tbaseClass[localProperty] = v;\n\t\t\t},\n\t\t\tenumerable: true,\n\t\t\tconfigurable: false\n\t\t});\n\t}\n\tdecoratorProperties.__baseClass = baseClass;\n\n\tfor (const method of methods) {\n\t\tconst variantRuleChain = variants.filter((rv) => method in rv);\n\t\tif (variantRuleChain.length === 0) continue;\n\t\tvariantRuleChain[0].initializeBaseHandler(decoratorProperties);\n\t\tconst variantDecorator = variantRuleChain.reduce((p, c) => {\n\t\t\tc.initializeBaseHandler(decoratorProperties);\n\t\t\tc.initializeWrappingHandler(p);\n\t\t\treturn c;\n\t\t});\n\n\t\tif (method in decoratorProperties) {\n\t\t\tconst variant = Reflect.get(variantDecorator, method);\n\t\t\tif (typeof variant === \"function\") {\n\t\t\t\tconst variantFunc = variant;\n\t\t\t\tif (verifyFunctionType(decoratorProperties[method])) {\n\t\t\t\t\tObject.defineProperty(decoratorProperties, method, {\n\t\t\t\t\t\tvalue: (...args: unknown[]) => {\n\t\t\t\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-return, @typescript-eslint/no-unsafe-call\n\t\t\t\t\t\t\treturn variantFunc.bind(variantDecorator)(...args);\n\t\t\t\t\t\t},\n\t\t\t\t\t\tenumerable: false,\n\t\t\t\t\t\twritable: false,\n\t\t\t\t\t\tconfigurable: false\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tdecoratorProperties.initDecoratorSettings();\n\treturn decoratorProperties;\n}\n\nimportAll(require.context(\"./VariantRuleDefinitions\", true, /\\.ts$/));\n","import type { NumericColor } from \"@moveGeneration/GameInformation/GameUnits/GameUnits\";\nimport { Board } from \"../../../Board/Board\";\nimport { InternalMove, InternalMoveSignature } from \"../../../MoveTree/MoveTreeInterface\";\nimport { VariantRule } from \"../../VariantRule\";\nimport { VariantRuleAllowedChecks, variantRuleColors, VariantRuleHandler } from \"../../VariantRuleInterface\";\nimport { chessGlyphIndex } from \"@client/fonts/chessGlyphIndex\";\n\nconst tag = \"allowPassing\";\nexport class AllowPassing extends VariantRule<typeof Board, typeof tag> implements VariantRuleHandler<Board> {\n\tstatic {\n\t\tVariantRule.initVariantRule(AllowPassing);\n\t}\n\n\tgetDecoratorType() {\n\t\treturn Board;\n\t}\n\n\tgetPublicProperties() {\n\t\treturn {\n\t\t\tparameterValue: true,\n\t\t\tinformation: {\n\t\t\t\tname: \"Allow Passing\",\n\t\t\t\tdescription: \"Players can pass instead of making a move\",\n\t\t\t\ttag,\n\t\t\t\tcolor: variantRuleColors.minor,\n\t\t\t\tdisplayIcon: chessGlyphIndex.pause\n\t\t\t}\n\t\t} as const;\n\t}\n\n\tmatchesPGNDeclaration(match: string): boolean {\n\t\treturn /^AllowPassing$/i.test(match);\n\t}\n\n\tserializeToParsingForm(): string {\n\t\treturn \"AllowPassing\";\n\t}\n\n\tisDisabled({ variantDataRules }: VariantRuleAllowedChecks): boolean {\n\t\treturn variantDataRules.giveaway;\n\t}\n\n\tgetAllowedInternalMoves(sideToMove: NumericColor = this.decorator.data.sideToMove): InternalMove[] {\n\t\tconst passingMoves = this.decorator.isKingInCheck(sideToMove) ? [] : [{ type: InternalMoveSignature.Pass }];\n\t\tfor (const decorator of this.wrappingDecorators) {\n\t\t\tif (decorator.getAllowedInternalMoves) {\n\t\t\t\treturn [...passingMoves, ...decorator.getAllowedInternalMoves(sideToMove)];\n\t\t\t}\n\t\t}\n\t\treturn [...passingMoves, ...Board.prototype.getAllowedInternalMoves.call(this.decorator, sideToMove)];\n\t}\n}\n","import { VariantType } from \"@moveGeneration/GameInformation/GameData\";\nimport { Board } from \"../../../Board/Board\";\nimport { VariantRule } from \"../../VariantRule\";\nimport { VariantRuleAllowedChecks, variantRuleColors, VariantRuleHandler } from \"../../VariantRuleInterface\";\n\nconst tag = \"alternativeTeams\";\nexport class AlternativeTeams extends VariantRule<typeof Board, typeof tag> implements VariantRuleHandler<Board> {\n\tstatic {\n\t\tVariantRule.initVariantRule(AlternativeTeams);\n\t}\n\n\tprivate teammate: number;\n\tconstructor(teammate?: unknown) {\n\t\tsuper();\n\t\tif (typeof teammate === \"number\") {\n\t\t\tthis.teammate = teammate;\n\t\t} else {\n\t\t\tthis.teammate = 2;\n\t\t}\n\t}\n\n\tgetDecoratorType() {\n\t\treturn Board;\n\t}\n\n\tgetPublicProperties() {\n\t\tconst rbTeams = this.teammate === 1;\n\t\tconst teamOne = rbTeams ? \"Red & Blue\" : \"Red & Green\";\n\t\tconst teamTwo = rbTeams ? \"Yellow & Green\" : \"Blue & Yellow\";\n\t\treturn {\n\t\t\tparameterValue: this.teammate,\n\t\t\tinformation: {\n\t\t\t\tname: `Teams`,\n\t\t\t\tdescription: `Alternative Teams: ${teamOne} form a team against ${teamTwo}`,\n\t\t\t\ttag,\n\t\t\t\tcolor: variantRuleColors.autogenous,\n\t\t\t\tdisplayIcon: \"Đ\"\n\t\t\t}\n\t\t} as const;\n\t}\n\n\tmatchesPGNDeclaration(match: string): boolean {\n\t\tconst matchArray = match.match(/^Teammate=(1|3)$/);\n\t\tif (matchArray) {\n\t\t\tthis.teammate = Number(matchArray[1]);\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tserializeToParsingForm(): string {\n\t\treturn `Teammate=${this.teammate}`;\n\t}\n\n\tisDisabled({ gameType }: VariantRuleAllowedChecks): boolean {\n\t\treturn gameType !== VariantType.Teams;\n\t}\n\n\tgetParametrizedOptions() {\n\t\treturn new Map([\n\t\t\t[\"Red & Yellow v Blue & Green\", 2],\n\t\t\t[\"Red & Blue v Yellow & Green\", 1],\n\t\t\t[\"Red & Green v Blue & Yellow\", 3]\n\t\t]);\n\t}\n\n\tinitDecoratorSettings() {\n\t\tconst teamSettings = this.decorator.gameType.teamSettings;\n\t\tif (this.teammate === 1) {\n\t\t\tteamSettings.firstTeamColors = [true, true, false, false];\n\t\t\tteamSettings.secondTeamColors = [false, false, true, true];\n\t\t} else if (this.teammate === 3) {\n\t\t\tteamSettings.firstTeamColors = [true, false, false, true];\n\t\t\tteamSettings.secondTeamColors = [false, true, true, false];\n\t\t}\n\n\t\tfor (const decorator of this.wrappingDecorators) decorator.initDecoratorSettings?.();\n\t}\n}\n","import { chessGlyphIndex } from \"@client/fonts/chessGlyphIndex\";\nimport { Board } from \"../../../Board/Board\";\nimport { stringifyCoordinate } from \"../../../Board/BoardInterface\";\nimport type { PostMoveResults } from \"../../../FENData/FENDataInterface\";\nimport { InternalMoveSignature } from \"../../../MoveTree/MoveTreeInterface\";\nimport { VariantRule } from \"../../VariantRule\";\nimport { variantRuleColors, VariantRuleHandler } from \"../../VariantRuleInterface\";\n\nconst tag = \"barePieceRule\";\nexport class BarePieceRule extends VariantRule<typeof Board, typeof tag> implements VariantRuleHandler<Board> {\n\tstatic {\n\t\tVariantRule.initVariantRule(BarePieceRule);\n\t}\n\n\tgetDecoratorType() {\n\t\treturn Board;\n\t}\n\n\tgetPublicProperties() {\n\t\treturn {\n\t\t\tparameterValue: true,\n\t\t\tinformation: {\n\t\t\t\tname: \"Bare piece rule\",\n\t\t\t\tdescription: \"Players with only one remaining piece are forfeit\",\n\t\t\t\ttag,\n\t\t\t\tcolor: variantRuleColors.minor,\n\t\t\t\tdisplayIcon: chessGlyphIndex.filter\n\t\t\t}\n\t\t} as const;\n\t}\n\n\tmatchesPGNDeclaration(match: string): boolean {\n\t\treturn /^BarePieceLoses$/i.test(match);\n\t}\n\n\tisDisabled(): boolean {\n\t\treturn false;\n\t}\n\n\tgetInsufficientMaterialData() {\n\t\treturn {\n\t\t\tisPartiallyDisabled: true,\n\t\t\tisDisabled: false\n\t\t} as const;\n\t}\n\n\tserializeToParsingForm(): string {\n\t\treturn \"BarePieceLoses\";\n\t}\n\n\tmakeMove(): PostMoveResults {\n\t\tconst {\n\t\t\tdata: { sideToMove },\n\t\t\tboard,\n\t\t\tpreGeneratedAttacks\n\t\t} = this.decorator;\n\t\tconst results = this.callHandler(\"makeMove\", arguments);\n\n\t\tconst playerPieces = this.decorator.getPlayerPieces()[sideToMove];\n\t\tif (playerPieces.length === 1) {\n\t\t\tconst pieceMovements = preGeneratedAttacks[sideToMove].pieceMovements.get(stringifyCoordinate(playerPieces[0]));\n\t\t\tif (pieceMovements) {\n\t\t\t\tfor (const { move: coordinate } of pieceMovements) {\n\t\t\t\t\tif (board[coordinate[0]][coordinate[1]].isPiece()) {\n\t\t\t\t\t\treturn results;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn this.decorator.makeMove([{ type: InternalMoveSignature.Resign }]);\n\t\t\t}\n\t\t}\n\n\t\treturn results;\n\t}\n}\n","import type { BoardSquares } from \"@client/ts/logic/BaseInterfaces\";\nimport { Board } from \"../../../Board/Board\";\nimport { DisplaySettings } from \"../../../Board/BoardInterface\";\nimport { VariantRule } from \"../../VariantRule\";\nimport { VariantRuleAllowedChecks, variantRuleColors, VariantRuleHandler } from \"../../VariantRuleInterface\";\nimport { chessGlyphIndex } from \"@client/fonts/chessGlyphIndex\";\n\nconst tag = \"blindfold\";\nexport class Blindfold extends VariantRule<typeof Board, typeof tag> implements VariantRuleHandler<Board> {\n\tstatic {\n\t\tVariantRule.initVariantRule(Blindfold);\n\t}\n\n\tgetDecoratorType() {\n\t\treturn Board;\n\t}\n\n\tgetPublicProperties() {\n\t\treturn {\n\t\t\tparameterValue: true,\n\t\t\tinformation: {\n\t\t\t\tname: \"Blindfold\",\n\t\t\t\tdescription: \"Pieces are invisible\",\n\t\t\t\ttag,\n\t\t\t\tcolor: variantRuleColors.visual,\n\t\t\t\tdisplayIcon: chessGlyphIndex.blindfold\n\t\t\t}\n\t\t} as const;\n\t}\n\n\tmatchesPGNDeclaration(match: string): boolean {\n\t\treturn /^Blindfold$/i.test(match);\n\t}\n\n\tserializeToParsingForm(): string {\n\t\treturn \"Blindfold\";\n\t}\n\n\tisDisabled({ variantDataRules }: VariantRuleAllowedChecks): boolean {\n\t\treturn variantDataRules.fogOfWar;\n\t}\n\n\tgetSquareVisibility(): BoardSquares<DisplaySettings[]> {\n\t\tconst squareVisibility: BoardSquares<DisplaySettings[]> = this.callHandler(\"getSquareVisibility\", arguments);\n\t\treturn squareVisibility.map((r, i) =>\n\t\t\tr.map((v, j) => {\n\t\t\t\tif (this.decorator.board[i][j].isWall()) {\n\t\t\t\t\treturn v;\n\t\t\t\t} else {\n\t\t\t\t\treturn [...v, DisplaySettings.Blindfolded];\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\t}\n}\n","import { chessGlyphIndex } from \"@client/fonts/chessGlyphIndex\";\nimport { Board } from \"../../../Board/Board\";\nimport { VariantRule } from \"../../VariantRule\";\nimport { VariantRuleAllowedChecks, variantRuleColors, VariantRuleHandler } from \"../../VariantRuleInterface\";\n\nconst tag = \"captureTheKing\";\nexport class CaptureTheKing extends VariantRule<typeof Board, typeof tag> implements VariantRuleHandler<Board> {\n\tstatic {\n\t\tVariantRule.initVariantRule(CaptureTheKing);\n\t}\n\n\tgetDecoratorType() {\n\t\treturn Board;\n\t}\n\n\tgetPublicProperties() {\n\t\treturn {\n\t\t\tparameterValue: true,\n\t\t\tinformation: {\n\t\t\t\tname: \"Capture the King\",\n\t\t\t\tdescription: \"To checkmate, kings must be captured\",\n\t\t\t\ttag,\n\t\t\t\tcolor: variantRuleColors.minor,\n\t\t\t\tdisplayIcon: chessGlyphIndex.king\n\t\t\t}\n\t\t} as const;\n\t}\n\n\tmatchesPGNDeclaration(match: string): boolean {\n\t\treturn /^CaptureTheKing$/i.test(match);\n\t}\n\n\tserializeToParsingForm(): string {\n\t\treturn \"CaptureTheKing\";\n\t}\n\n\tisDisabled({ variantDataRules }: VariantRuleAllowedChecks): boolean {\n\t\treturn variantDataRules.giveaway || variantDataRules.taboo;\n\t}\n\n\tgetInsufficientMaterialData() {\n\t\treturn {\n\t\t\tisPartiallyDisabled: true,\n\t\t\tisDisabled: false\n\t\t} as const;\n\t}\n\n\tisKingInCheck(): boolean {\n\t\treturn false;\n\t}\n\n\tisTheMoveLegal(): boolean {\n\t\treturn true;\n\t}\n}\n","import { getVerticalPlacementModulus, isVerticalPlacement } from \"@client/ts/logic/BaseInterfaces\";\nimport { NumericColor } from \"@moveGeneration/GameInformation/GameUnits/GameUnits\";\nimport { Board } from \"../../../Board/Board\";\nimport { boardDimension, colors } from \"../../../GameInformation/GameData\";\nimport type { PieceString } from \"../../../GameInformation/GameUnits/PieceString\";\nimport { VariantRule } from \"../../VariantRule\";\nimport { variantRuleColors, VariantRuleHandler } from \"../../VariantRuleInterface\";\nimport { chessGlyphIndex } from \"@client/fonts/chessGlyphIndex\";\n\nconst tag = \"chess960\";\nexport class Chess960 extends VariantRule<typeof Board, typeof tag> implements VariantRuleHandler<Board> {\n\tstatic {\n\t\tVariantRule.initVariantRule(Chess960);\n\t}\n\n\tprivate static readonly chess960ranges = [\n\t\t...Array.from({ length: 9 }, (_, i) => [960 * (i + 1) + 1, 960 + 960 * (i + 1)]),\n\t\t...Array.from({ length: 5 }, (_, i) => [10000 + 960 * (i + 1) + 1, 10960 + 960 * (i + 1)])\n\t];\n\tprivate static readonly minorPieceCache = (function () {\n\t\tconst minorPieceCache = [];\n\t\tfor (let i = 0; i < 4; i++) {\n\t\t\tfor (let j = i + 1; j < 5; j++) {\n\t\t\t\tminorPieceCache.push([i, j]);\n\t\t\t}\n\t\t}\n\t\treturn minorPieceCache;\n\t})();\n\t// prettier-ignore\n\tprivate static readonly pieceMasks = [\n        [404, 405, 406, 407, 408, 409, 410, 411, 412, 413, 414, 415, 420, 421, 422, 423, 424, 425, 426, 427, 428, 429, 430, 431, 436, 437, 438, 439, 440, 441, 442, 443, 444, 445, 446, 447, 452, 453, 454, 455, 456, 457, 458, 459, 460, 461, 462, 463, 468, 469, 470, 471, 472, 473, 474, 475, 476, 477, 478, 479, 500, 501, 502, 503, 504, 505, 506, 507, 508, 509, 510, 511, 516, 517, 518, 519, 520, 521, 522, 523, 524, 525, 526, 527, 532, 533, 534, 535, 536, 537, 538, 539, 540, 541, 542, 543, 548, 549, 550, 551, 552, 553, 554, 555, 556, 557, 558, 559, 564, 565, 566, 567, 568, 569, 570, 571, 572, 573, 574, 575, 596, 597, 598, 599, 600, 601, 602, 603, 604, 605, 606, 607, 612, 613, 614, 615, 616, 617, 618, 619, 620, 621, 622, 623, 628, 629, 630, 631, 632, 633, 634, 635, 636, 637, 638, 639, 644, 645, 646, 647, 648, 649, 650, 651, 652, 653, 654, 655, 660, 661, 662, 663, 664, 665, 666, 667, 668, 669, 670, 671, 692, 693, 694, 695, 696, 697, 698, 699, 700, 701, 702, 703, 708, 709, 710, 711, 712, 713, 714, 715, 716, 717, 718, 719, 724, 725, 726, 727, 728, 729, 730, 731, 732, 733, 734, 735, 740, 741, 742, 743, 744, 745, 746, 747, 748, 749, 750, 751, 756, 757, 758, 759, 760, 761, 762, 763, 764, 765, 766, 767, 788, 789, 790, 791, 792, 793, 794, 795, 796, 797, 798, 799, 804, 805, 806, 807, 808, 809, 810, 811, 812, 813, 814, 815, 820, 821, 822, 823, 824, 825, 826, 827, 828, 829, 830, 831, 836, 837, 838, 839, 840, 841, 842, 843, 844, 845, 846, 847, 852, 853, 854, 855, 856, 857, 858, 859, 860, 861, 862, 863, 884, 885, 886, 887, 888, 889, 890, 891, 892, 893, 894, 895, 900, 901, 902, 903, 904, 905, 906, 907, 908, 909, 910, 911, 916, 917, 918, 919, 920, 921, 922, 923, 924, 925, 926, 927, 932, 933, 934, 935, 936, 937, 938, 939, 940, 941, 942, 943, 948, 949, 950, 951, 952, 953, 954, 955, 956, 957, 958, 959],\n        [5, 6, 7, 9, 10, 11, 13, 14, 15, 17, 18, 19, 33, 34, 35, 37, 38, 39, 41, 42, 43, 45, 46, 47, 49, 50, 51, 53, 54, 55, 57, 58, 59, 61, 62, 63, 65, 66, 67, 69, 70, 71, 73, 74, 75, 77, 78, 79, 81, 82, 83, 85, 86, 87, 89, 90, 91, 93, 94, 95, 101, 102, 103, 105, 106, 107, 109, 110, 111, 113, 114, 115, 129, 130, 131, 145, 146, 147, 161, 162, 163, 177, 178, 179, 197, 198, 199, 201, 202, 203, 205, 206, 207, 209, 210, 211, 225, 226, 227, 241, 242, 243, 257, 258, 259, 273, 274, 275, 293, 294, 295, 297, 298, 299, 301, 302, 303, 305, 306, 307, 321, 322, 323, 337, 338, 339, 353, 354, 355, 369, 370, 371, 421, 422, 423, 425, 426, 427, 429, 430, 431, 437, 438, 439, 441, 442, 443, 445, 446, 447, 453, 454, 455, 457, 458, 459, 461, 462, 463, 469, 470, 471, 473, 474, 475, 477, 478, 479, 517, 518, 519, 521, 522, 523, 525, 526, 527, 533, 534, 535, 537, 538, 539, 541, 542, 543, 549, 550, 551, 553, 554, 555, 557, 558, 559, 565, 566, 567, 569, 570, 571, 573, 574, 575, 613, 614, 615, 617, 618, 619, 621, 622, 623, 629, 630, 631, 633, 634, 635, 637, 638, 639, 645, 646, 647, 649, 650, 651, 653, 654, 655, 661, 662, 663, 665, 666, 667, 669, 670, 671],\n        [4, 5, 6, 7, 20, 21, 22, 23, 36, 37, 38, 39, 52, 53, 54, 55, 68, 69, 70, 71, 84, 85, 86, 87, 100, 101, 102, 103, 116, 117, 118, 119, 132, 133, 134, 135, 148, 149, 150, 151, 164, 165, 166, 167, 180, 181, 182, 183, 196, 197, 198, 199, 212, 213, 214, 215, 228, 229, 230, 231, 244, 245, 246, 247, 260, 261, 262, 263, 276, 277, 278, 279, 292, 293, 294, 295, 308, 309, 310, 311, 324, 325, 326, 327, 340, 341, 342, 343, 356, 357, 358, 359, 372, 373, 374, 375, 388, 389, 390, 391, 404, 405, 406, 407, 420, 421, 422, 423, 436, 437, 438, 439, 452, 453, 454, 455, 468, 469, 470, 471, 484, 485, 486, 487, 500, 501, 502, 503, 516, 517, 518, 519, 532, 533, 534, 535, 548, 549, 550, 551, 564, 565, 566, 567, 580, 581, 582, 583, 596, 597, 598, 599, 612, 613, 614, 615, 628, 629, 630, 631, 644, 645, 646, 647, 660, 661, 662, 663, 676, 677, 678, 679, 692, 693, 694, 695, 708, 709, 710, 711, 724, 725, 726, 727, 740, 741, 742, 743, 756, 757, 758, 759, 772, 773, 774, 775, 788, 789, 790, 791, 804, 805, 806, 807, 820, 821, 822, 823, 836, 837, 838, 839, 852, 853, 854, 855, 868, 869, 870, 871, 884, 885, 886, 887, 900, 901, 902, 903, 916, 917, 918, 919, 932, 933, 934, 935, 948, 949, 950, 951],\n        [16, 20, 34, 35, 38, 39, 40, 44, 58, 59, 62, 63, 112, 116, 130, 131, 134, 135, 136, 140, 154, 155, 158, 159, 208, 212, 226, 227, 230, 231, 232, 236, 250, 251, 254, 255, 304, 308, 322, 323, 326, 327, 328, 332, 346, 347, 350, 351, 400, 404, 418, 419, 422, 423, 424, 428, 442, 443, 446, 447, 496, 500, 514, 515, 518, 519, 520, 524, 538, 539, 542, 543, 592, 596, 610, 611, 614, 615, 616, 620, 634, 635, 638, 639, 688, 692, 706, 707, 710, 711, 712, 716, 730, 731, 734, 735, 784, 788, 802, 803, 806, 807, 808, 812, 826, 827, 830, 831, 880, 884, 898, 899, 902, 903, 904, 908, 922, 923, 926, 927],\n        [14, 15, 30, 31, 46, 47, 62, 63, 66, 67, 70, 71, 76, 77, 82, 83, 86, 87, 92, 93, 110, 111, 126, 127, 142, 143, 158, 159, 162, 163, 166, 167, 172, 173, 178, 179, 182, 183, 188, 189, 194, 195, 198, 199, 204, 205, 210, 211, 214, 215, 220, 221, 226, 227, 230, 231, 236, 237, 240, 241, 244, 245, 256, 257, 260, 261, 272, 273, 276, 277, 290, 291, 294, 295, 300, 301, 306, 307, 310, 311, 316, 317, 322, 323, 326, 327, 332, 333, 336, 337, 340, 341, 352, 353, 356, 357, 368, 369, 372, 373, 398, 399, 414, 415, 430, 431, 446, 447, 450, 451, 454, 455, 460, 461, 466, 467, 470, 471, 476, 477, 482, 483, 486, 487, 492, 493, 498, 499, 502, 503, 508, 509, 514, 515, 518, 519, 524, 525, 528, 529, 532, 533, 544, 545, 548, 549, 560, 561, 564, 565, 578, 579, 582, 583, 588, 589, 594, 595, 598, 599, 604, 605, 610, 611, 614, 615, 620, 621, 624, 625, 628, 629, 640, 641, 644, 645, 656, 657, 660, 661, 672, 673, 676, 677, 688, 689, 692, 693, 768, 769, 772, 773, 784, 785, 788, 789, 864, 865, 868, 869, 880, 881, 884, 885],\n        [2, 6, 10, 14, 18, 22, 26, 30, 34, 38, 42, 46, 50, 54, 58, 62, 66, 70, 74, 78, 82, 86, 90, 94, 98, 102, 106, 110, 114, 118, 122, 126, 130, 134, 138, 142, 146, 150, 154, 158, 162, 166, 170, 174, 178, 182, 186, 190, 194, 198, 202, 206, 210, 214, 218, 222, 226, 230, 234, 238, 242, 246, 250, 254, 258, 262, 266, 270, 274, 278, 282, 286, 290, 294, 298, 302, 306, 310, 314, 318, 322, 326, 330, 334, 338, 342, 346, 350, 354, 358, 362, 366, 370, 374, 378, 382, 386, 390, 394, 398, 402, 406, 410, 414, 418, 422, 426, 430, 434, 438, 442, 446, 450, 454, 458, 462, 466, 470, 474, 478, 482, 486, 490, 494, 498, 502, 506, 510, 514, 518, 522, 526, 530, 534, 538, 542, 546, 550, 554, 558, 562, 566, 570, 574, 578, 582, 586, 590, 594, 598, 602, 606, 610, 614, 618, 622, 626, 630, 634, 638, 642, 646, 650, 654, 658, 662, 666, 670, 674, 678, 682, 686, 690, 694, 698, 702, 706, 710, 714, 718, 722, 726, 730, 734, 738, 742, 746, 750, 754, 758, 762, 766, 770, 774, 778, 782, 786, 790, 794, 798, 802, 806, 810, 814, 818, 822, 826, 830, 834, 838, 842, 846, 850, 854, 858, 862, 866, 870, 874, 878, 882, 886, 890, 894, 898, 902, 906, 910, 914, 918, 922, 926, 930, 934, 938, 942, 946, 950, 954, 958],\n        [192, 193, 194, 196, 197, 198, 200, 201, 202, 208, 209, 210, 212, 213, 214, 216, 217, 218, 224, 225, 226, 228, 229, 230, 232, 233, 234, 240, 241, 242, 244, 245, 246, 248, 249, 250, 291, 295, 299, 307, 311, 315, 323, 327, 331, 339, 343, 347, 355, 359, 363, 368, 369, 370, 372, 373, 374, 376, 377, 378, 480, 481, 482, 484, 485, 486, 488, 489, 490, 496, 497, 498, 500, 501, 502, 504, 505, 506, 512, 513, 514, 516, 517, 518, 520, 521, 522, 528, 529, 530, 532, 533, 534, 536, 537, 538, 579, 583, 587, 595, 599, 603, 611, 615, 619, 627, 631, 635, 643, 647, 651, 656, 657, 658, 660, 661, 662, 664, 665, 666, 672, 673, 674, 676, 677, 678, 680, 681, 682, 688, 689, 690, 692, 693, 694, 696, 697, 698, 704, 705, 706, 708, 709, 710, 712, 713, 714, 720, 721, 722, 724, 725, 726, 728, 729, 730, 771, 775, 779, 787, 791, 795, 803, 807, 811, 819, 823, 827, 835, 839, 843, 848, 849, 850, 852, 853, 854, 856, 857, 858, 864, 865, 866, 867, 868, 869, 870, 871, 872, 873, 874, 875, 880, 881, 882, 883, 884, 885, 886, 887, 888, 889, 890, 891, 896, 897, 898, 899, 900, 901, 902, 903, 904, 905, 906, 907, 912, 913, 914, 915, 916, 917, 918, 919, 920, 921, 922, 923, 931, 935, 939, 944, 945, 946, 948, 949, 950, 952, 953, 954],\n        [1, 2, 4, 5, 6, 8, 9, 10, 12, 13, 14, 16, 17, 18, 20, 21, 22, 24, 25, 26, 28, 29, 30, 32, 33, 34, 36, 37, 38, 40, 41, 42, 44, 45, 46, 48, 49, 50, 52, 53, 54, 56, 57, 58, 60, 61, 62, 64, 65, 66, 68, 69, 70, 72, 73, 74, 76, 77, 78, 96, 97, 98, 100, 101, 102, 104, 105, 106, 108, 109, 110, 112, 113, 114, 116, 117, 118, 120, 121, 122, 124, 125, 126, 128, 129, 130, 132, 133, 134, 136, 137, 138, 140, 141, 142, 144, 145, 146, 148, 149, 150, 152, 153, 154, 156, 157, 158, 160, 161, 162, 164, 165, 166, 168, 169, 170, 172, 173, 174, 192, 193, 194, 196, 197, 198, 200, 201, 202, 204, 205, 206, 208, 209, 210, 212, 213, 214, 216, 217, 218, 220, 221, 222, 224, 225, 226, 228, 229, 230, 232, 233, 234, 236, 237, 238, 240, 241, 242, 244, 245, 246, 248, 249, 250, 252, 253, 254, 256, 257, 258, 260, 261, 262, 264, 265, 266, 268, 269, 270, 384, 385, 386, 388, 389, 390, 392, 393, 394, 396, 397, 398, 400, 401, 402, 404, 405, 406, 408, 409, 410, 412, 413, 414, 416, 417, 418, 420, 421, 422, 424, 425, 426, 428, 429, 430, 432, 433, 434, 436, 437, 438, 440, 441, 442, 444, 445, 446, 448, 449, 450, 452, 453, 454, 456, 457, 458, 460, 461, 462, 480, 481, 482, 484, 485, 486, 488, 489, 490, 492, 493, 494, 496, 497, 498, 500, 501, 502, 504, 505, 506, 508, 509, 510, 512, 513, 514, 516, 517, 518, 520, 521, 522, 524, 525, 526, 528, 529, 530, 532, 533, 534, 536, 537, 538, 540, 541, 542, 544, 545, 546, 548, 549, 550, 552, 553, 554, 556, 557, 558, 672, 673, 674, 676, 677, 678, 680, 681, 682, 684, 685, 686, 688, 689, 690, 692, 693, 694, 696, 697, 698, 700, 701, 702, 704, 705, 706, 708, 709, 710, 712, 713, 714, 716, 717, 718, 720, 721, 722, 724, 725, 726, 728, 729, 730, 732, 733, 734, 736, 737, 738, 740, 741, 742, 744, 745, 746, 748, 749, 750]\n    ];\n\tprivate static readonly c960range = (function () {\n\t\tconst arr = [...Array(961).keys()];\n\t\tarr.shift();\n\t\treturn arr;\n\t})();\n\t// prettier-ignore\n\tprivate static readonly twins = [959, 955, 951, 947, 958, 954, 950, 946, 957, 953, 949, 945, 956, 952, 948, 944, 943, 939, 935, 931, 942, 938, 934, 930, 941, 937, 933, 929, 940, 936, 932, 928, 927, 923, 919, 915, 926, 922, 918, 914, 925, 921, 917, 913, 924, 920, 916, 912, 911, 907, 903, 899, 910, 906, 902, 898, 909, 905, 901, 897, 908, 904, 900, 896, 895, 891, 887, 883, 894, 890, 886, 882, 893, 889, 885, 881, 892, 888, 884, 880, 879, 875, 871, 867, 878, 874, 870, 866, 877, 873, 869, 865, 876, 872, 868, 864, 863, 859, 855, 851, 862, 858, 854, 850, 861, 857, 853, 849, 860, 856, 852, 848, 847, 843, 839, 835, 846, 842, 838, 834, 845, 841, 837, 833, 844, 840, 836, 832, 831, 827, 823, 819, 830, 826, 822, 818, 829, 825, 821, 817, 828, 824, 820, 816, 815, 811, 807, 803, 814, 810, 806, 802, 813, 809, 805, 801, 812, 808, 804, 800, 799, 795, 791, 787, 798, 794, 790, 786, 797, 793, 789, 785, 796, 792, 788, 784, 783, 779, 775, 771, 782, 778, 774, 770, 781, 777, 773, 769, 780, 776, 772, 768, 671, 667, 663, 659, 670, 666, 662, 658, 669, 665, 661, 657, 668, 664, 660, 656, 655, 651, 647, 643, 654, 650, 646, 642, 653, 649, 645, 641, 652, 648, 644, 640, 639, 635, 631, 627, 638, 634, 630, 626, 637, 633, 629, 625, 636, 632, 628, 624, 623, 619, 615, 611, 622, 618, 614, 610, 621, 617, 613, 609, 620, 616, 612, 608, 607, 603, 599, 595, 606, 602, 598, 594, 605, 601, 597, 593, 604, 600, 596, 592, 591, 587, 583, 579, 590, 586, 582, 578, 589, 585, 581, 577, 588, 584, 580, 576, 383, 379, 375, 371, 382, 378, 374, 370, 381, 377, 373, 369, 380, 376, 372, 368, 367, 363, 359, 355, 366, 362, 358, 354, 365, 361, 357, 353, 364, 360, 356, 352, 351, 347, 343, 339, 350, 346, 342, 338, 349, 345, 341, 337, 348, 344, 340, 336, 335, 331, 327, 323, 334, 330, 326, 322, 333, 329, 325, 321, 332, 328, 324, 320, 319, 315, 311, 307, 318, 314, 310, 306, 317, 313, 309, 305, 316, 312, 308, 304, 303, 299, 295, 291, 302, 298, 294, 290, 301, 297, 293, 289, 300, 296, 292, 288, 767, 763, 759, 755, 766, 762, 758, 754, 765, 761, 757, 753, 764, 760, 756, 752, 751, 747, 743, 739, 750, 746, 742, 738, 749, 745, 741, 737, 748, 744, 740, 736, 735, 731, 727, 723, 734, 730, 726, 722, 733, 729, 725, 721, 732, 728, 724, 720, 719, 715, 711, 707, 718, 714, 710, 706, 717, 713, 709, 705, 716, 712, 708, 704, 703, 699, 695, 691, 702, 698, 694, 690, 701, 697, 693, 689, 700, 696, 692, 688, 687, 683, 679, 675, 686, 682, 678, 674, 685, 681, 677, 673, 684, 680, 676, 672, 575, 571, 567, 563, 574, 570, 566, 562, 573, 569, 565, 561, 572, 568, 564, 560, 559, 555, 551, 547, 558, 554, 550, 546, 557, 553, 549, 545, 556, 552, 548, 544, 543, 539, 535, 531, 542, 538, 534, 530, 541, 537, 533, 529, 540, 536, 532, 528, 527, 523, 519, 515, 526, 522, 518, 514, 525, 521, 517, 513, 524, 520, 516, 512, 511, 507, 503, 499, 510, 506, 502, 498, 509, 505, 501, 497, 508, 504, 500, 496, 495, 491, 487, 483, 494, 490, 486, 482, 493, 489, 485, 481, 492, 488, 484, 480, 287, 283, 279, 275, 286, 282, 278, 274, 285, 281, 277, 273, 284, 280, 276, 272, 271, 267, 263, 259, 270, 266, 262, 258, 269, 265, 261, 257, 268, 264, 260, 256, 255, 251, 247, 243, 254, 250, 246, 242, 253, 249, 245, 241, 252, 248, 244, 240, 239, 235, 231, 227, 238, 234, 230, 226, 237, 233, 229, 225, 236, 232, 228, 224, 223, 219, 215, 211, 222, 218, 214, 210, 221, 217, 213, 209, 220, 216, 212, 208, 207, 203, 199, 195, 206, 202, 198, 194, 205, 201, 197, 193, 204, 200, 196, 192, 479, 475, 471, 467, 478, 474, 470, 466, 477, 473, 469, 465, 476, 472, 468, 464, 463, 459, 455, 451, 462, 458, 454, 450, 461, 457, 453, 449, 460, 456, 452, 448, 447, 443, 439, 435, 446, 442, 438, 434, 445, 441, 437, 433, 444, 440, 436, 432, 431, 427, 423, 419, 430, 426, 422, 418, 429, 425, 421, 417, 428, 424, 420, 416, 415, 411, 407, 403, 414, 410, 406, 402, 413, 409, 405, 401, 412, 408, 404, 400, 399, 395, 391, 387, 398, 394, 390, 386, 397, 393, 389, 385, 396, 392, 388, 384, 191, 187, 183, 179, 190, 186, 182, 178, 189, 185, 181, 177, 188, 184, 180, 176, 175, 171, 167, 163, 174, 170, 166, 162, 173, 169, 165, 161, 172, 168, 164, 160, 159, 155, 151, 147, 158, 154, 150, 146, 157, 153, 149, 145, 156, 152, 148, 144, 143, 139, 135, 131, 142, 138, 134, 130, 141, 137, 133, 129, 140, 136, 132, 128, 127, 123, 119, 115, 126, 122, 118, 114, 125, 121, 117, 113, 124, 120, 116, 112, 111, 107, 103, 99, 110, 106, 102, 98, 109, 105, 101, 97, 108, 104, 100, 96, 95, 91, 87, 83, 94, 90, 86, 82, 93, 89, 85, 81, 92, 88, 84, 80, 79, 75, 71, 67, 78, 74, 70, 66, 77, 73, 69, 65, 76, 72, 68, 64, 63, 59, 55, 51, 62, 58, 54, 50, 61, 57, 53, 49, 60, 56, 52, 48, 47, 43, 39, 35, 46, 42, 38, 34, 45, 41, 37, 33, 44, 40, 36, 32, 31, 27, 23, 19, 30, 26, 22, 18, 29, 25, 21, 17, 28, 24, 20, 16, 15, 11, 7, 3, 14, 10, 6, 2, 13, 9, 5, 1, 12, 8, 4, 0];\n\tprivate static readonly legacy = {\n\t\tlegacy2PThreshold: 1000,\n\t\tlegacy2PRank: 3,\n\t\tlegacy4Prank: 0,\n\t\tlegacy2PTakeaway: 6160\n\t} as const;\n\tprivate static readonly displacement = [3, 11];\n\tprivate static createBaseChess960mappings() {\n\t\treturn {\n\t\t\tcolorBoundPieces: [2, 5],\n\t\t\tsupermajorPieces: [3],\n\t\t\tminorPieces: [1, 6],\n\t\t\troyalPiece: [4],\n\t\t\tedgePieces: [0, 7]\n\t\t};\n\t}\n\n\tprivate static regExp = /Chess960=(\\d{1,5})/i;\n\tprivate positionID: number;\n\tconstructor(positionID?: unknown) {\n\t\tsuper();\n\t\tif (typeof positionID === \"number\") {\n\t\t\tthis.positionID = positionID;\n\t\t} else {\n\t\t\tthis.positionID = -1;\n\t\t}\n\t}\n\n\tgetDecoratorType() {\n\t\treturn Board;\n\t}\n\n\tgetPublicProperties() {\n\t\treturn {\n\t\t\tparameterValue: this.positionID,\n\t\t\tinformation: {\n\t\t\t\tname: \"Chess960\",\n\t\t\t\tdescription: \"Initial position with randomly shuffled pieces on home ranks\",\n\t\t\t\ttag,\n\t\t\t\tcolor: variantRuleColors.startingPosition,\n\t\t\t\tdisplayIcon: chessGlyphIndex.chess960\n\t\t\t}\n\t\t} as const;\n\t}\n\n\tmatchesPGNDeclaration(match: string): boolean {\n\t\tconst matchArray = match.match(Chess960.regExp);\n\t\tif (matchArray) {\n\t\t\tconst newID = Number(matchArray[1]);\n\t\t\tif (newID < 0 || newID > 15760) return false;\n\t\t\tthis.positionID = newID;\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tserializeToParsingForm(): string {\n\t\treturn `Chess960=${this.positionID}`;\n\t}\n\n\tisDisabled(): boolean {\n\t\treturn false;\n\t}\n\n\tinitDecoratorSettings() {\n\t\tif (this.positionID === -1) throw new Error(\"Position ID for Chess960 is not defined\");\n\t\tlet nr = this.positionID;\n\t\tconst boardSquares = this.decorator.board;\n\t\tlet rank = Chess960.chess960ranges.findIndex((r) => nr >= r[0] && nr <= r[1]);\n\t\tif (rank === -1) {\n\t\t\tif (nr > Chess960.legacy.legacy2PThreshold) {\n\t\t\t\trank = Chess960.legacy.legacy2PRank;\n\t\t\t\tnr -= Chess960.legacy.legacy2PTakeaway;\n\t\t\t} else {\n\t\t\t\trank = Chess960.legacy.legacy4Prank;\n\t\t\t}\n\t\t}\n\n\t\tconst pieceArrays: PieceString[][] = [[], [], [], []];\n\t\tconst ranks = [13 - rank, rank, rank, 13 - rank];\n\t\tpieceArrays[0] = boardSquares[ranks[0]].slice(Chess960.displacement[0], Chess960.displacement[1]);\n\t\tpieceArrays[1] = boardSquares.map((row) => row[ranks[1]]).slice(Chess960.displacement[0], Chess960.displacement[1]);\n\t\tpieceArrays[2] = boardSquares[ranks[2]].slice(Chess960.displacement[0], Chess960.displacement[1]);\n\t\tpieceArrays[3] = boardSquares.map((row) => row[ranks[3]]).slice(Chess960.displacement[0], Chess960.displacement[1]);\n\n\t\tconst walls = pieceArrays.map((a) => a.map((p) => (p.isWall() ? true : false)));\n\t\tconst intersections: number[][] = [];\n\t\tfor (const wall of walls) {\n\t\t\tintersections.push(\n\t\t\t\twall.reduce((p, c, i) => {\n\t\t\t\t\tif (c) {\n\t\t\t\t\t\treturn p.filter((v) => Chess960.pieceMasks[i].includes(v));\n\t\t\t\t\t} else return p;\n\t\t\t\t}, Chess960.c960range)\n\t\t\t);\n\t\t}\n\n\t\ttype IndexingType = ReturnType<typeof generatePositionIndexes>;\n\t\tconst calcNr = nr - Chess960.chess960ranges[rank][0];\n\t\tconst positions: IndexingType[] = [];\n\n\t\tconst generatePositionIndexes = (calcNr: number): typeof position => {\n\t\t\tconst colorBoundIndexes = [2 * Math.floor((calcNr % 16) / 4), 1 + 2 * ((calcNr % 16) % 4)].sort();\n\t\t\tconst supermajorIndex = Math.floor(calcNr / 16) % 6;\n\t\t\tconst minorPieceIndexes = Chess960.minorPieceCache[Math.floor(calcNr / 96) % 10];\n\n\t\t\tconst position = {\n\t\t\t\tcolorBoundPieces: Array(8).fill(false),\n\t\t\t\tsupermajorPieces: Array(8).fill(false),\n\t\t\t\tminorPieces: Array(8).fill(false),\n\t\t\t\troyalPiece: Array(8).fill(false),\n\t\t\t\tedgePieces: Array(8).fill(false)\n\t\t\t};\n\n\t\t\tlet edgeSet = false,\n\t\t\t\troyalSet = false,\n\t\t\t\tcolorDelta = 0,\n\t\t\t\tmajorDelta = 0;\n\t\t\tfor (let i = 0; i < boardDimension - Chess960.displacement[0] * 2; i++) {\n\t\t\t\tif (i === colorBoundIndexes[0] || i === colorBoundIndexes[1]) {\n\t\t\t\t\tposition.colorBoundPieces[i] = true;\n\t\t\t\t\tcolorDelta++;\n\t\t\t\t} else if (i === supermajorIndex + colorDelta) {\n\t\t\t\t\tposition.supermajorPieces[i] = true;\n\t\t\t\t\tmajorDelta++;\n\t\t\t\t} else if (i === minorPieceIndexes[0] + colorDelta + majorDelta || i === minorPieceIndexes[1] + colorDelta + majorDelta) {\n\t\t\t\t\tposition.minorPieces[i] = true;\n\t\t\t\t} else {\n\t\t\t\t\tposition[edgeSet ? (royalSet ? \"edgePieces\" : \"royalPiece\") : \"edgePieces\"][i] = true;\n\t\t\t\t\troyalSet = edgeSet;\n\t\t\t\t\tedgeSet = true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn position;\n\t\t};\n\n\t\tfor (const intersection of intersections) {\n\t\t\tif (intersection.length === 0) return null;\n\t\t\tlet calcTempNr = calcNr;\n\t\t\tlet cycles = 0;\n\t\t\twhile (cycles < 2) {\n\t\t\t\tif (intersection.includes(calcTempNr)) {\n\t\t\t\t\tpositions.push(generatePositionIndexes(calcTempNr));\n\t\t\t\t\tbreak;\n\t\t\t\t} else if (intersection.includes(Chess960.twins[calcTempNr - 1])) {\n\t\t\t\t\tpositions.push(generatePositionIndexes(Chess960.twins[calcTempNr - 1]));\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tcalcTempNr++;\n\t\t\t\tif (calcTempNr === 960) (calcTempNr = 0), cycles++;\n\t\t\t}\n\n\t\t\tif (cycles === 2) intersections.push([]);\n\t\t}\n\n\t\tconst fenData = this.decorator.data;\n\t\tconst royalPieces = fenData.fenOptions.tag(\"royal\");\n\t\tconst royalOnCorrectRank = royalPieces.map((r, i) =>\n\t\t\tr !== null ? (r[getVerticalPlacementModulus(i)] === ranks[i] ? r[getVerticalPlacementModulus(i)] : -1) : -1\n\t\t);\n\n\t\tconst replaceRow = (player: NumericColor): void => {\n\t\t\tconst pieces = Chess960.createBaseChess960mappings();\n\t\t\tconst royal = royalPieces[player];\n\t\t\tif (!royal) return;\n\t\t\tconst r = royal[getVerticalPlacementModulus(player)];\n\t\t\tconst supermajorOverRoyal = royalOnCorrectRank[player] ? r <= 6 : false;\n\n\t\t\tfor (let i = Chess960.displacement[0]; i < Chess960.displacement[1]; i++) {\n\t\t\t\tlet k: keyof IndexingType;\n\t\t\t\tfor (k in pieces) {\n\t\t\t\t\tif (!Object.prototype.hasOwnProperty.call(pieces, k) || !positions[player][k][i - 3]) continue;\n\n\t\t\t\t\tif (royalOnCorrectRank[player] !== -1 && k === \"royalPiece\" && r !== i) {\n\t\t\t\t\t\troyal[getVerticalPlacementModulus(player)] = i;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst mI = supermajorOverRoyal ? (intersections[player].length === 960 ? boardDimension - 1 - i : i) : i;\n\t\t\t\t\tconst piece = pieces[k].shift();\n\t\t\t\t\tif (piece !== undefined) {\n\t\t\t\t\t\tboardSquares[isVerticalPlacement(player) ? ranks[player] : mI][isVerticalPlacement(player) ? mI : ranks[player]] =\n\t\t\t\t\t\t\tpieceArrays[player][piece];\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tfor (const color of colors) replaceRow(color);\n\t\tfor (const decorator of this.wrappingDecorators) decorator.initDecoratorSettings?.();\n\t}\n}\n","import type { DroppingMove } from \"../../../MoveTree/MoveTreeInterface\";\nimport { Board } from \"../../../Board/Board\";\nimport { boardDimension } from \"../../../GameInformation/GameData\";\nimport type { PieceString } from \"../../../GameInformation/GameUnits/PieceString\";\nimport { VariantRule } from \"../../VariantRule\";\nimport { VariantRuleHandler, variantRuleColors } from \"../../VariantRuleInterface\";\nimport { pieceControlConfigSettings } from \"@moveGeneration/PieceControl/PieceControlInterface\";\nimport { FiftyMoveRule } from \"../FENDataDecorators/FiftyMoveRule\";\nimport { isVerticalPlacement } from \"@client/ts/logic/BaseInterfaces\";\nimport { chessGlyphIndex } from \"@client/fonts/chessGlyphIndex\";\n\nconst tag = \"crazyhouse\";\nexport class Crazyhouse extends VariantRule<typeof Board, typeof tag> implements VariantRuleHandler<Board> {\n\tstatic {\n\t\tVariantRule.initVariantRule(Crazyhouse);\n\t}\n\treadonly dependencies = new Map([[FiftyMoveRule, [Infinity]]]);\n\n\tgetDecoratorType() {\n\t\treturn Board;\n\t}\n\n\tgetPublicProperties() {\n\t\treturn {\n\t\t\tparameterValue: true,\n\t\t\tinformation: {\n\t\t\t\tname: \"Crazyhouse\",\n\t\t\t\tdescription: \"You can drop pieces from banks\",\n\t\t\t\ttag,\n\t\t\t\tcolor: variantRuleColors.extending,\n\t\t\t\tdisplayIcon: chessGlyphIndex.crazyhouse\n\t\t\t}\n\t\t} as const;\n\t}\n\n\tmatchesPGNDeclaration(match: string): boolean {\n\t\treturn /^Crazyhouse$/i.test(match);\n\t}\n\n\tserializeToParsingForm(): string {\n\t\treturn \"Crazyhouse\";\n\t}\n\n\tisDisabled(): boolean {\n\t\treturn false;\n\t}\n\n\tgetInsufficientMaterialData() {\n\t\treturn {\n\t\t\tisPartiallyDisabled: false,\n\t\t\tisDisabled: true\n\t\t} as const;\n\t}\n\n\tinitDecoratorSettings() {\n\t\tthis.decorator.data.fenOptions.setTag(\"areBanksEnabled\", [true, true, true, true]);\n\t\tfor (const decorator of this.wrappingDecorators) decorator.initDecoratorSettings?.();\n\t}\n\n\tgetDroppingMoves(piece: PieceString, color = this.decorator.data.sideToMove): DroppingMove[] {\n\t\tif (piece.color !== color) return [];\n\t\tconst royal = this.decorator.data.fenOptions.tag(\"royal\")[color];\n\t\tif (royal && this.decorator.preGeneratedAttacks[color].hoppingPieces[royal[0]][royal[1]]) return [];\n\n\t\tconst isPawn = pieceControlConfigSettings[piece.piece].moveGenerationSettings.isPawn;\n\t\tconst resultingMoveDrops: DroppingMove[] = [];\n\n\t\tconst isRY = isVerticalPlacement(color);\n\t\tconst pawnPromotionRank = this.decorator.variantData.promotionRank === false ? -1 : this.decorator.variantData.promotionRank;\n\t\tconst pawnBaseRank = this.decorator.data.fenOptions.tag(\"pawnBaseRank\");\n\n\t\tfor (let i = 0; i < boardDimension; i++) {\n\t\t\tif (isPawn && isRY && (pawnPromotionRank === i || pawnBaseRank === i)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tfor (let j = 0; j < boardDimension; j++) {\n\t\t\t\tif (isPawn && !isRY && (pawnPromotionRank === j || pawnBaseRank === j)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tconst square = this.decorator.board[i][j];\n\t\t\t\tif (!square.isEmpty()) continue;\n\n\t\t\t\tresultingMoveDrops.push({ piece, endCoordinates: [i, j] });\n\t\t\t}\n\t\t}\n\n\t\tif (this.decorator.isKingInCheck(color)) {\n\t\t\treturn resultingMoveDrops.filter((moveDrop) => {\n\t\t\t\tconst { checks, checkmates } = this.decorator.makeMove([moveDrop], true);\n\t\t\t\treturn !checks[color] || checkmates[color] || this.decorator.isKingInCheck(color);\n\t\t\t});\n\t\t} else {\n\t\t\treturn resultingMoveDrops;\n\t\t}\n\t}\n}\n","import { Board } from \"../../../Board/Board\";\nimport { DroppingMove, getLatestChainedMoves, MoveData } from \"../../../MoveTree/MoveTreeInterface\";\nimport { VariantRule } from \"../../VariantRule\";\nimport { VariantRuleAllowedChecks, variantRuleColors, VariantRuleHandler } from \"../../VariantRuleInterface\";\nimport { CaptureTheKing } from \"./CaptureTheKing\";\nimport { duckPieceString } from \"../../../GameInformation/GameUnits/PieceString\";\nimport { boardDimension } from \"../../../GameInformation/GameData\";\nimport { Coordinate, nonPlayablePieces } from \"../../../GameInformation/GameUnits/GameUnits\";\nimport { chessGlyphIndex } from \"@client/fonts/chessGlyphIndex\";\n\nconst tag = \"duckChess\";\nexport class DuckChess extends VariantRule<typeof Board, typeof tag> implements VariantRuleHandler<Board> {\n\tstatic {\n\t\tVariantRule.initVariantRule(DuckChess);\n\t}\n\treadonly dependencies = new Map([[CaptureTheKing, []]]);\n\n\tgetDecoratorType() {\n\t\treturn Board;\n\t}\n\n\tgetPublicProperties() {\n\t\treturn {\n\t\t\tparameterValue: true,\n\t\t\tinformation: {\n\t\t\t\tname: \"Duck Chess\",\n\t\t\t\tdescription: \"The duck must be moved to an empty square after every move\",\n\t\t\t\ttag,\n\t\t\t\tcolor: variantRuleColors.extending,\n\t\t\t\tdisplayIcon: chessGlyphIndex.duck\n\t\t\t}\n\t\t} as const;\n\t}\n\n\tmatchesPGNDeclaration(match: string): boolean {\n\t\treturn /^DuckChess$/i.test(match);\n\t}\n\n\tserializeToParsingForm(): string {\n\t\treturn \"DuckChess\";\n\t}\n\n\tisDisabled({ variantDataRules }: VariantRuleAllowedChecks): boolean {\n\t\treturn variantDataRules.taboo;\n\t}\n\n\tgetLegalMoves(i: number, j: number): MoveData[] {\n\t\tconst moves = this.callHandler(\"getLegalMoves\", arguments);\n\t\tconst latestMoves = getLatestChainedMoves(moves);\n\n\t\tconst ducks: Coordinate[] = [],\n\t\t\temptySquares: Coordinate[] = [];\n\t\tfor (let i = 0; i < boardDimension; i++) {\n\t\t\tfor (let j = 0; j < boardDimension; j++) {\n\t\t\t\tconst pieceString = this.decorator.board[i][j];\n\t\t\t\tif (pieceString.isWall() && pieceString.piece === nonPlayablePieces.duck) {\n\t\t\t\t\tducks.push([i, j]);\n\t\t\t\t} else if (pieceString.isEmpty()) {\n\t\t\t\t\temptySquares.push([i, j]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst droppingChainedMoves: DroppingMove[] = [];\n\t\tconst duckChainedMoves: MoveData[] = [];\n\t\tif (ducks.length === 0) {\n\t\t\tfor (const emptySquare of emptySquares) {\n\t\t\t\tdroppingChainedMoves.push({ piece: duckPieceString, endCoordinates: emptySquare });\n\t\t\t}\n\t\t\tdroppingChainedMoves.push({ piece: duckPieceString, endCoordinates: [i, j] });\n\t\t} else {\n\t\t\tfor (const duck of ducks) {\n\t\t\t\tfor (const emptySquare of emptySquares) {\n\t\t\t\t\tduckChainedMoves.push({ startCoordinates: duck, endCoordinates: emptySquare });\n\t\t\t\t}\n\t\t\t\tduckChainedMoves.push({ startCoordinates: duck, endCoordinates: [i, j] });\n\t\t\t}\n\t\t}\n\n\t\tfor (const move of latestMoves) {\n\t\t\tmove.nextChainedMoves = droppingChainedMoves.length > 0 ? droppingChainedMoves : duckChainedMoves;\n\t\t}\n\n\t\treturn moves;\n\t}\n}\n","import { chessGlyphIndex } from \"@client/fonts/chessGlyphIndex\";\nimport { BoardSquares, initializeBoardSquares } from \"../../../../BaseInterfaces\";\nimport { Board } from \"../../../Board/Board\";\nimport { DisplaySettings, unstringifyCoordinate } from \"../../../Board/BoardInterface\";\nimport { VariantRule } from \"../../VariantRule\";\nimport { VariantRuleAllowedChecks, variantRuleColors, VariantRuleHandler } from \"../../VariantRuleInterface\";\nimport { CaptureTheKing } from \"./CaptureTheKing\";\n\nconst tag = \"fogOfWar\";\nexport class FogOfWar extends VariantRule<typeof Board, typeof tag> implements VariantRuleHandler<Board> {\n\tstatic {\n\t\tVariantRule.initVariantRule(FogOfWar);\n\t}\n\treadonly dependencies = new Map([[CaptureTheKing, []]]);\n\n\tgetDecoratorType() {\n\t\treturn Board;\n\t}\n\n\tgetPublicProperties() {\n\t\treturn {\n\t\t\tparameterValue: true,\n\t\t\tinformation: {\n\t\t\t\tname: \"Fog of War\",\n\t\t\t\tdescription: \"Players can only see their pieces and the squares they can legally move to\",\n\t\t\t\ttag,\n\t\t\t\tcolor: variantRuleColors.widespread,\n\t\t\t\tdisplayIcon: chessGlyphIndex.fogOfWar\n\t\t\t}\n\t\t} as const;\n\t}\n\n\tmatchesPGNDeclaration(match: string): boolean {\n\t\treturn /^FogOfWar$/i.test(match);\n\t}\n\n\tserializeToParsingForm(): string {\n\t\treturn \"FogOfWar\";\n\t}\n\n\tisDisabled({ variantDataRules }: VariantRuleAllowedChecks): boolean {\n\t\treturn variantDataRules.taboo;\n\t}\n\n\tgetSquareVisibility(): BoardSquares<DisplaySettings[]> {\n\t\tconst currentPlayerMoves: BoardSquares<boolean> = initializeBoardSquares(() => false);\n\t\tconst preGeneratedAttacks = this.decorator.preGeneratedAttacks[this.decorator.data.sideToMove];\n\t\tfor (const [piece, moves] of preGeneratedAttacks.pieceMovements) {\n\t\t\tconst startingCoordinate = unstringifyCoordinate(piece);\n\t\t\tcurrentPlayerMoves[startingCoordinate[0]][startingCoordinate[1]] = true;\n\t\t\tfor (const { move } of moves) {\n\t\t\t\tcurrentPlayerMoves[move[0]][move[1]] = true;\n\t\t\t}\n\t\t}\n\t\tfor (const drop of [...preGeneratedAttacks.pieceDrops.pawn, ...preGeneratedAttacks.pieceDrops.piece]) {\n\t\t\tcurrentPlayerMoves[drop.endCoordinates[0]][drop.endCoordinates[1]] = true;\n\t\t}\n\n\t\tconst squareVisibility: BoardSquares<DisplaySettings[]> = this.callHandler(\"getSquareVisibility\", arguments);\n\t\treturn squareVisibility.map((r, i) =>\n\t\t\tr.map((v, j) => {\n\t\t\t\tif (this.decorator.board[i][j].isWall() || currentPlayerMoves[i][j]) {\n\t\t\t\t\treturn v;\n\t\t\t\t} else {\n\t\t\t\t\treturn [...v, DisplaySettings.Fogged];\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\t}\n}\n","import type { NumericColor } from \"@moveGeneration/GameInformation/GameUnits/GameUnits\";\nimport { Board } from \"../../../Board/Board\";\nimport { stringifyCoordinate } from \"../../../Board/BoardInterface\";\nimport type { MoveData } from \"../../../MoveTree/MoveTreeInterface\";\nimport { VariantRule } from \"../../VariantRule\";\nimport { variantRuleColors, VariantRuleHandler } from \"../../VariantRuleInterface\";\nimport { chessGlyphIndex } from \"@client/fonts/chessGlyphIndex\";\n\nconst tag = \"forcedCapture\";\nexport class ForcedCapture extends VariantRule<typeof Board, typeof tag> implements VariantRuleHandler<Board> {\n\tstatic {\n\t\tVariantRule.initVariantRule(ForcedCapture);\n\t}\n\n\tgetDecoratorType() {\n\t\treturn Board;\n\t}\n\n\tgetPublicProperties() {\n\t\treturn {\n\t\t\tparameterValue: true,\n\t\t\tinformation: {\n\t\t\t\tname: \"Forced Capture\",\n\t\t\t\tdescription: \"Capturing is always compulsory\",\n\t\t\t\ttag,\n\t\t\t\tcolor: variantRuleColors.widespread,\n\t\t\t\tdisplayIcon: chessGlyphIndex.target\n\t\t\t}\n\t\t} as const;\n\t}\n\n\tmatchesPGNDeclaration(match: string) {\n\t\treturn /^ForcedCapture$/i.test(match);\n\t}\n\n\tserializeToParsingForm(): string {\n\t\treturn \"ForcedCapture\";\n\t}\n\n\tisDisabled(): boolean {\n\t\treturn false;\n\t}\n\n\tgetInsufficientMaterialData() {\n\t\treturn {\n\t\t\tisPartiallyDisabled: true,\n\t\t\tisDisabled: false\n\t\t} as const;\n\t}\n\n\tpregenerateAttacks(): void {\n\t\tconst {\n\t\t\tdata: { sideToMove },\n\t\t\tboard,\n\t\t\tpreGeneratedAttacks\n\t\t} = this.decorator;\n\t\tthis.callHandler(\"pregenerateAttacks\", arguments);\n\n\t\tfor (const piece of this.decorator.getPlayerPieces()[sideToMove]) {\n\t\t\tconst moves = preGeneratedAttacks[sideToMove].pieceMovements.get(stringifyCoordinate(piece));\n\t\t\tif (moves) {\n\t\t\t\tfor (const { move: coordinate } of moves) {\n\t\t\t\t\tif (board[coordinate[0]][coordinate[1]].isPiece()) {\n\t\t\t\t\t\tpreGeneratedAttacks[sideToMove].variantRuleCache.hasCaptures = true;\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tpreGeneratedAttacks[sideToMove].variantRuleCache.hasCaptures = false;\n\t}\n\n\tisTheMoveLegal(_: NumericColor, moveData: MoveData): boolean {\n\t\tconst isCapturing = this.decorator.data.getCapturedPieces(moveData).length > 0;\n\t\tif (!isCapturing && this.decorator.preGeneratedAttacks[this.decorator.data.sideToMove].variantRuleCache.hasCaptures) return false;\n\t\treturn this.callHandler(\"isTheMoveLegal\", arguments);\n\t}\n}\n","import { chessGlyphIndex } from \"@client/fonts/chessGlyphIndex\";\nimport { shuffleArray } from \"../../../../../utils/ArrayUtils\";\nimport { Board } from \"../../../Board/Board\";\nimport { totalPlayers, VariantType } from \"../../../GameInformation/GameData\";\nimport { verifyNumericColor } from \"../../../GameInformation/GameUnits/GameUnits\";\nimport { VariantRule } from \"../../VariantRule\";\nimport { VariantRuleAllowedChecks, variantRuleColors, VariantRuleHandler } from \"../../VariantRuleInterface\";\n\nconst tag = \"anonymous\";\nexport class Anonymous extends VariantRule<typeof Board, typeof tag> implements VariantRuleHandler<Board> {\n\tstatic {\n\t\tVariantRule.initVariantRule(Anonymous);\n\t}\n\n\tgetDecoratorType() {\n\t\treturn Board;\n\t}\n\n\tgetPublicProperties() {\n\t\treturn {\n\t\t\tparameterValue: true,\n\t\t\tinformation: {\n\t\t\t\tname: \"Anonymous\",\n\t\t\t\tdescription: \"Players' names and ratings are hidden\",\n\t\t\t\ttag,\n\t\t\t\tcolor: variantRuleColors.metadata,\n\t\t\t\tdisplayIcon: chessGlyphIndex.userInformation\n\t\t\t}\n\t\t} as const;\n\t}\n\n\tmatchesPGNDeclaration(match: string): boolean {\n\t\treturn /^Anonymous$/i.test(match);\n\t}\n\n\tserializeToParsingForm(): string {\n\t\treturn \"Anonymous\";\n\t}\n\n\tisDisabled(): boolean {\n\t\treturn false;\n\t}\n\n\tinitDecoratorSettings() {\n\t\tfor (let i = 0; i < totalPlayers; i++) {\n\t\t\tthis.decorator.gameData.players[i].name = \"Anonymous\";\n\t\t\tthis.decorator.gameData.players[i].elo = undefined;\n\t\t}\n\n\t\tfor (const decorator of this.wrappingDecorators) decorator.initDecoratorSettings?.();\n\t}\n}\n\nconst semiAnonTag = \"semiAnonymous\";\nexport class SemiAnonymous extends VariantRule<typeof Board, typeof semiAnonTag> implements VariantRuleHandler<Board> {\n\tstatic {\n\t\tVariantRule.initVariantRule(SemiAnonymous);\n\t}\n\n\tgetDecoratorType() {\n\t\treturn Board;\n\t}\n\n\tgetPublicProperties() {\n\t\treturn {\n\t\t\tparameterValue: true,\n\t\t\tinformation: {\n\t\t\t\tname: \"Semi-Anonymous\",\n\t\t\t\tdescription: \"Players's colors are hidden\",\n\t\t\t\ttag: semiAnonTag,\n\t\t\t\tcolor: variantRuleColors.metadata,\n\t\t\t\tdisplayIcon: chessGlyphIndex.userExtraInformation\n\t\t\t}\n\t\t} as const;\n\t}\n\n\tmatchesPGNDeclaration(match: string): boolean {\n\t\treturn /^Semi-Anonymous$/i.test(match);\n\t}\n\n\tserializeToParsingForm(): string {\n\t\treturn \"Semi-Anonymous\";\n\t}\n\n\tisDisabled(): boolean {\n\t\treturn false;\n\t}\n\n\tinitDecoratorSettings() {\n\t\tshuffleArray(this.decorator.gameData.players);\n\t\tfor (const decorator of this.wrappingDecorators) decorator.initDecoratorSettings?.();\n\t}\n}\n\nconst spTag = \"selfPartner\";\nexport class SelfPartner extends VariantRule<typeof Board, typeof spTag> implements VariantRuleHandler<Board> {\n\tstatic {\n\t\tVariantRule.initVariantRule(SelfPartner);\n\t}\n\n\tgetDecoratorType() {\n\t\treturn Board;\n\t}\n\n\tgetPublicProperties() {\n\t\treturn {\n\t\t\tparameterValue: true,\n\t\t\tinformation: {\n\t\t\t\tname: \"Self-Partner\",\n\t\t\t\tdescription: \"Both sides of the team were played by one player\",\n\t\t\t\ttag: spTag,\n\t\t\t\tcolor: variantRuleColors.metadata,\n\t\t\t\tdisplayIcon: chessGlyphIndex.selfPartner\n\t\t\t}\n\t\t} as const;\n\t}\n\n\tmatchesPGNDeclaration(match: string): boolean {\n\t\treturn /^SelfPartner$/i.test(match);\n\t}\n\n\tserializeToParsingForm(): string {\n\t\treturn \"SelfPartner\";\n\t}\n\n\tisDisabled({ gameType, fenTags }: VariantRuleAllowedChecks): boolean {\n\t\treturn gameType !== VariantType.Teams || fenTags.resigned.value.filter(Boolean).length !== 0;\n\t}\n\n\tinitDecoratorSettings() {\n\t\tfor (const decorator of this.wrappingDecorators) decorator.initDecoratorSettings?.();\n\t\tconst gameType = this.decorator.gameType;\n\t\tconst firstTeamPlayer = gameType.teamSettings.firstTeamColors.indexOf(true),\n\t\t\tsecondTeamPlayer = gameType.teamSettings.secondTeamColors.indexOf(true);\n\t\tif (verifyNumericColor(firstTeamPlayer)) {\n\t\t\tthis.decorator.gameData.players[gameType.getTeammateColor(firstTeamPlayer)].name =\n\t\t\t\tthis.decorator.gameData.players[firstTeamPlayer].name;\n\t\t}\n\t\tif (verifyNumericColor(secondTeamPlayer)) {\n\t\t\tthis.decorator.gameData.players[gameType.getTeammateColor(secondTeamPlayer)].name =\n\t\t\t\tthis.decorator.gameData.players[secondTeamPlayer].name;\n\t\t}\n\t}\n}\n","import { chessGlyphIndex } from \"@client/fonts/chessGlyphIndex\";\nimport type { BoardSquares } from \"../../../../BaseInterfaces\";\nimport { Board } from \"../../../Board/Board\";\nimport { DisplaySettings } from \"../../../Board/BoardInterface\";\nimport { VariantRule } from \"../../VariantRule\";\nimport { variantRuleColors, VariantRuleHandler } from \"../../VariantRuleInterface\";\n\nconst tag = \"ghostboard\";\nexport class Ghostboard extends VariantRule<typeof Board, typeof tag> implements VariantRuleHandler<Board> {\n\tstatic {\n\t\tVariantRule.initVariantRule(Ghostboard);\n\t}\n\n\tgetDecoratorType() {\n\t\treturn Board;\n\t}\n\n\tgetPublicProperties() {\n\t\treturn {\n\t\t\tparameterValue: true,\n\t\t\tinformation: {\n\t\t\t\tname: \"Ghostboard\",\n\t\t\t\tdescription: \"Board, clocks and players are invisible\",\n\t\t\t\ttag,\n\t\t\t\tcolor: variantRuleColors.visual,\n\t\t\t\tdisplayIcon: chessGlyphIndex.crossedBinoculars\n\t\t\t}\n\t\t} as const;\n\t}\n\n\tmatchesPGNDeclaration(match: string): boolean {\n\t\treturn /^Ghostboard$/i.test(match);\n\t}\n\n\tserializeToParsingForm(): string {\n\t\treturn \"Ghostboard\";\n\t}\n\n\tisDisabled(): boolean {\n\t\treturn false;\n\t}\n\n\tgetSquareVisibility(): BoardSquares<DisplaySettings[]> {\n\t\tconst squareVisibility: BoardSquares<DisplaySettings[]> = this.callHandler(\"getSquareVisibility\", arguments);\n\t\treturn squareVisibility.map((r) => r.map((v) => [...v, DisplaySettings.Ghosted]));\n\t}\n}\n","import { chessGlyphIndex } from \"@client/fonts/chessGlyphIndex\";\nimport { Board } from \"../../../Board/Board\";\nimport type { PieceString } from \"../../../GameInformation/GameUnits/PieceString\";\nimport { VariantRule } from \"../../VariantRule\";\nimport { variantRuleColors, VariantRuleHandler } from \"../../VariantRuleInterface\";\n\nconst tag = \"paradigmChess30\";\nexport class ParadigmChess30 extends VariantRule<typeof Board, typeof tag> implements VariantRuleHandler<Board> {\n\tstatic {\n\t\tVariantRule.initVariantRule(ParadigmChess30);\n\t}\n\n\tprivate static readonly paradigmRanges = [...Array.from({ length: 14 }, (_, i) => [30 * (i + 1) + 1, 30 + 30 * (i + 1)])];\n\t// 0 = color bound, 1 = minor, 2 = major\n\tprivate static readonly permutations = [\n\t\t[0, 0, 1, 1, 2],\n\t\t[0, 0, 1, 2, 1],\n\t\t[0, 0, 2, 1, 1],\n\t\t[0, 1, 0, 1, 2],\n\t\t[0, 1, 0, 2, 1],\n\t\t[0, 1, 1, 0, 2],\n\t\t[0, 1, 1, 2, 0],\n\t\t[0, 1, 2, 0, 1],\n\t\t[0, 1, 2, 1, 0],\n\t\t[0, 2, 0, 1, 1],\n\t\t[0, 2, 1, 0, 1],\n\t\t[0, 2, 1, 1, 0],\n\t\t[1, 0, 0, 1, 2],\n\t\t[1, 0, 0, 2, 1],\n\t\t[1, 0, 1, 0, 2],\n\t\t[1, 0, 1, 2, 0],\n\t\t[1, 0, 2, 0, 1],\n\t\t[1, 0, 2, 1, 0],\n\t\t[1, 1, 0, 0, 2],\n\t\t[1, 1, 0, 2, 0],\n\t\t[1, 1, 2, 0, 0],\n\t\t[1, 2, 0, 0, 1],\n\t\t[1, 2, 0, 1, 0],\n\t\t[1, 2, 1, 0, 0],\n\t\t[2, 0, 0, 1, 1],\n\t\t[2, 0, 1, 0, 1],\n\t\t[2, 0, 1, 1, 0],\n\t\t[2, 1, 0, 0, 1],\n\t\t[2, 1, 0, 1, 0],\n\t\t[2, 1, 1, 0, 0]\n\t];\n\tprivate static readonly legacy = {\n\t\ttwoPlayerRank: 3,\n\t\ttwoPlayerAdjustment: 30 * 4\n\t} as const;\n\n\treadonly preMethodExecution: boolean = false;\n\tprivate positionId: number;\n\tconstructor(positionId?: unknown) {\n\t\tsuper();\n\t\tif (typeof positionId === \"number\") {\n\t\t\tthis.positionId = positionId;\n\t\t} else {\n\t\t\tthis.positionId = -1;\n\t\t}\n\t}\n\n\tgetPublicProperties() {\n\t\treturn {\n\t\t\tparameterValue: this.positionId,\n\t\t\tinformation: {\n\t\t\t\tname: \"Paradigm Chess30\",\n\t\t\t\tdescription:\n\t\t\t\t\t\"Paradigm Chess30: Dragon bishops combine the movement of bishop and xiangqi horse. 30 semi-random starting positions\",\n\t\t\t\ttag,\n\t\t\t\tcolor: variantRuleColors.startingPosition,\n\t\t\t\tdisplayIcon: chessGlyphIndex.bishop\n\t\t\t}\n\t\t} as const;\n\t}\n\n\tgetDecoratorType() {\n\t\treturn Board;\n\t}\n\n\tmatchesPGNDeclaration(match: string): boolean {\n\t\tconst matchArray = match.match(/^ParadigmChess30=((\\d{1,3}))$/i);\n\t\tif (matchArray) {\n\t\t\tconst newID = Number(matchArray[1]);\n\t\t\tif (newID < 0 || newID > 450) return false;\n\t\t\tthis.positionId = newID;\n\t\t\treturn true;\n\t\t} else return false;\n\t}\n\n\tserializeToParsingForm(): string {\n\t\treturn `ParadigmChess30=${this.positionId}`;\n\t}\n\n\tisDisabled(): boolean {\n\t\treturn false;\n\t}\n\n\tgetInformation() {\n\t\treturn {\n\t\t\tname: \"Paradigm Chess30\",\n\t\t\tdescription: \"Paradigm Chess30: Dragon bishops combine the movement of bishop and xiangqi horse. 30 semi-random starting positions\",\n\t\t\ttag\n\t\t} as const;\n\t}\n\n\tinitDecoratorSettings() {\n\t\tif (this.positionId === -1) throw new Error(\"Position ID for Paradigm Chess30 is not defined\");\n\t\tlet nr = this.positionId;\n\t\tconst boardSquares = this.decorator.board;\n\t\tconst data = this.decorator.data;\n\n\t\tlet rank = ParadigmChess30.paradigmRanges.findIndex((r) => nr >= r[0] && nr <= r[1]);\n\t\tif (rank === -1) {\n\t\t\trank = ParadigmChess30.legacy.twoPlayerRank;\n\t\t\tnr += ParadigmChess30.legacy.twoPlayerAdjustment;\n\t\t}\n\t\tconst calcNr = nr - ParadigmChess30.paradigmRanges[rank][0];\n\t\tconst ranks = [13 - rank, rank, rank, 13 - rank];\n\t\tconst pieceArrays: PieceString[][] = [[], [], [], []];\n\t\tpieceArrays[0] = boardSquares[ranks[0]].slice(4, 10);\n\t\tpieceArrays[1] = boardSquares.map((row) => row[ranks[1]]).slice(4, 10);\n\t\tpieceArrays[2] = boardSquares[ranks[2]].slice(4, 10);\n\t\tpieceArrays[3] = boardSquares.map((row) => row[ranks[3]]).slice(4, 10);\n\n\t\tconst royalPieces = data.fenOptions.tag(\"royal\"),\n\t\t\tdead = data.fenOptions.tag(\"dead\");\n\t\tconst replaceRow = (player: number): void => {\n\t\t\tconst r = royalPieces[player]?.[player % 2 === 0 ? 1 : 0];\n\t\t\tconst pieceCoordinates = [[5, 8], [4, 9], [r === undefined || r >= 7 ? 6 : 7]];\n\n\t\t\tconst moveCoordinate = (i: number, iter: number) => {\n\t\t\t\tif (dead[player]) return;\n\t\t\t\tconst coordinateA = player % 2 === 0 ? ranks[player] : iter;\n\t\t\t\tconst coordinateB = player % 2 === 0 ? iter : ranks[player];\n\n\t\t\t\tif (pieceArrays[player][pieceCoordinates[i][0] - 4].isWall() || boardSquares[coordinateA][coordinateB].isWall()) return;\n\t\t\t\troyalPieces.some((r) => {\n\t\t\t\t\tif (r && r[0] === coordinateA && r[1] === coordinateB) {\n\t\t\t\t\t\t(r[0] = coordinateB), (r[1] = coordinateA);\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t\treturn false;\n\t\t\t\t});\n\n\t\t\t\tboardSquares[coordinateA][coordinateB] = pieceArrays[player][(pieceCoordinates[i].shift() ?? 4) - 4];\n\t\t\t};\n\n\t\t\tlet c = 0;\n\t\t\tconst rp = r === undefined || r >= 7 ? 7 : 6;\n\t\t\tconst permutations = rp === 6 ? ParadigmChess30.permutations[calcNr].slice().reverse() : ParadigmChess30.permutations[calcNr];\n\t\t\tfor (let i = 4; i < 10; i++) {\n\t\t\t\tif (i === rp) continue;\n\t\t\t\tmoveCoordinate(permutations[c++], i);\n\t\t\t}\n\t\t};\n\n\t\tfor (let i = 0; i < 4; i++) replaceRow(i);\n\t\tfor (const decorator of this.wrappingDecorators) decorator.initDecoratorSettings?.();\n\t}\n}\n","import type { BoardSquares } from \"@client/ts/logic/BaseInterfaces\";\nimport { Board } from \"../../../Board/Board\";\nimport { DisplaySettings } from \"../../../Board/BoardInterface\";\nimport { VariantRule } from \"../../VariantRule\";\nimport { VariantRuleHandler, variantRuleColors } from \"../../VariantRuleInterface\";\nimport { chessGlyphIndex } from \"@client/fonts/chessGlyphIndex\";\n\nconst tag = \"piecesFaceCenter\";\nexport class PiecesFaceCenter extends VariantRule<typeof Board, typeof tag> implements VariantRuleHandler<Board> {\n\tstatic {\n\t\tVariantRule.initVariantRule(PiecesFaceCenter);\n\t}\n\n\tgetDecoratorType() {\n\t\treturn Board;\n\t}\n\tgetPublicProperties() {\n\t\treturn {\n\t\t\tparameterValue: true,\n\t\t\tinformation: {\n\t\t\t\tname: \"Pieces Face Center\",\n\t\t\t\tdescription: \"Pieces are rotated to face center\",\n\t\t\t\ttag,\n\t\t\t\tcolor: variantRuleColors.visual,\n\t\t\t\tdisplayIcon: chessGlyphIndex.pawn3dLarge\n\t\t\t}\n\t\t} as const;\n\t}\n\tmatchesPGNDeclaration(match: string): boolean {\n\t\treturn /^PiecesFaceCenter$/i.test(match);\n\t}\n\tserializeToParsingForm(): string {\n\t\treturn \"PiecesFaceCenter\";\n\t}\n\tisDisabled(): boolean {\n\t\treturn false;\n\t}\n\n\tgetSquareVisibility(): BoardSquares<DisplaySettings[]> {\n\t\tconst squareVisibility: BoardSquares<DisplaySettings[]> = this.callHandler(\"getSquareVisibility\", arguments);\n\t\treturn squareVisibility.map((r, i) =>\n\t\t\tr.map((v, j) => {\n\t\t\t\tif (!this.decorator.board[i][j].isPiece()) {\n\t\t\t\t\treturn v;\n\t\t\t\t} else {\n\t\t\t\t\treturn [...v, DisplaySettings.PieceFacesCenter];\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\t}\n}\n","import type { Coordinate } from \"@moveGeneration/GameInformation/GameUnits/GameUnits\";\nimport { Board } from \"../../../Board/Board\";\nimport { stringifyCoordinate } from \"../../../Board/BoardInterface\";\nimport type { PostMoveResults } from \"../../../FENData/FENDataInterface\";\nimport { colors } from \"../../../GameInformation/GameData\";\nimport { DroppingMove, Move, MoveData, verifyRequiredMove, verifyStandardMove } from \"../../../MoveTree/MoveTreeInterface\";\nimport { VariantRule } from \"../../VariantRule\";\nimport { VariantRuleAllowedChecks, VariantRuleHandler, variantRuleColors } from \"../../VariantRuleInterface\";\nimport { chessGlyphIndex } from \"@client/fonts/chessGlyphIndex\";\n\nconst tag = \"seirawanSetup\";\nexport class SeirawanSetup extends VariantRule<typeof Board, typeof tag> implements VariantRuleHandler<Board> {\n\tstatic {\n\t\tVariantRule.initVariantRule(SeirawanSetup);\n\t}\n\n\tgetDecoratorType() {\n\t\treturn Board;\n\t}\n\tgetPublicProperties() {\n\t\treturn {\n\t\t\tparameterValue: true,\n\t\t\tinformation: {\n\t\t\t\tname: \"Seirawan Setup\",\n\t\t\t\tdescription:\n\t\t\t\t\t\"When moving a piece for the first time, a piece from the bank can be placed on the vacated square, as part of the move\",\n\t\t\t\ttag,\n\t\t\t\tcolor: variantRuleColors.extending,\n\t\t\t\tdisplayIcon: chessGlyphIndex.pieceMeal\n\t\t\t}\n\t\t} as const;\n\t}\n\tmatchesPGNDeclaration(match: string) {\n\t\treturn /^SeirawanSetup$/i.test(match);\n\t}\n\tserializeToParsingForm(): string {\n\t\treturn \"SeirawanSetup\";\n\t}\n\tisDisabled({ variantDataRules }: VariantRuleAllowedChecks): boolean {\n\t\treturn variantDataRules.crazyhouse || variantDataRules.setupChess !== false;\n\t}\n\n\tinitDecoratorSettings() {\n\t\tconst fenOptions = this.decorator.data.fenOptions;\n\t\tconst areBanksEnabled = fenOptions.tag(\"areBanksEnabled\"),\n\t\t\tdead = fenOptions.tag(\"dead\"),\n\t\t\tseirawanDrops = fenOptions.tag(\"seirawanDrops\"),\n\t\t\tbank = fenOptions.tag(\"bank\");\n\t\tfor (const color of colors) {\n\t\t\tif (!dead[color] && seirawanDrops[color].size > 0 && bank[color].size > 0) {\n\t\t\t\tareBanksEnabled[color] = true;\n\t\t\t}\n\t\t}\n\n\t\tfor (const decorator of this.wrappingDecorators) decorator.initDecoratorSettings?.();\n\t}\n\n\tmakeMove(move: Move): PostMoveResults {\n\t\tconst { fenOptions, sideToMove } = this.decorator.data;\n\t\tconst areBanksEnabled = fenOptions.tag(\"areBanksEnabled\"),\n\t\t\tseirawanDrops = fenOptions.tag(\"seirawanDrops\"),\n\t\t\tbank = fenOptions.tag(\"bank\");\n\t\tlet disabledIndex = false;\n\t\tif (verifyStandardMove(move[0])) {\n\t\t\tseirawanDrops[sideToMove].delete(stringifyCoordinate(move[0].startCoordinates));\n\n\t\t\tif (seirawanDrops[sideToMove].size === 0 || bank[sideToMove].size === 0) {\n\t\t\t\tdisabledIndex = true;\n\t\t\t}\n\t\t}\n\n\t\tconst returnValue = this.callHandler(\"makeMove\", arguments);\n\t\tif (disabledIndex) {\n\t\t\tseirawanDrops[sideToMove].clear();\n\t\t\tbank[sideToMove].clear();\n\t\t\tareBanksEnabled[sideToMove] = false;\n\t\t}\n\n\t\treturn returnValue;\n\t}\n\n\tgetLegalMoves(i: number, j: number): MoveData[] {\n\t\tconst { fenOptions, sideToMove } = this.decorator.data;\n\t\tconst seirawanDrops = fenOptions.tag(\"seirawanDrops\"),\n\t\t\tbank = fenOptions.tag(\"bank\");\n\n\t\tconst startCoordinates: Coordinate = [i, j];\n\t\tconst stringifiedCoordinate = stringifyCoordinate(startCoordinates);\n\t\tconst coordinate = [...seirawanDrops[sideToMove]].find((c) => c === stringifiedCoordinate);\n\n\t\tconst validateWithDrops = bank[sideToMove].size !== 0 && coordinate !== undefined;\n\t\tconst moves = this.callHandler(\"getLegalMoves\", arguments);\n\n\t\tconst continuations: DroppingMove[] = [];\n\t\tfor (const piece of bank[sideToMove].keys()) {\n\t\t\tcontinuations.push({ piece, endCoordinates: startCoordinates });\n\t\t}\n\n\t\tif (validateWithDrops && verifyRequiredMove(continuations)) {\n\t\t\tfor (const move of moves) {\n\t\t\t\tmove.nextChainedMoves = continuations;\n\t\t\t}\n\t\t}\n\n\t\treturn moves;\n\t}\n}\n","import type { Tuple } from \"@client/ts/baseTypes\";\nimport type { totalPlayers } from \"@moveGeneration/GameInformation/GameData\";\nimport { Board } from \"../../../Board/Board\";\nimport { compareCoordinates, stringifyCoordinate } from \"../../../Board/BoardInterface\";\nimport { VariantRule } from \"../../VariantRule\";\nimport { VariantRuleAllowedChecks, variantRuleColors, VariantRuleHandler } from \"../../VariantRuleInterface\";\nimport { chessGlyphIndex } from \"@client/fonts/chessGlyphIndex\";\n\nconst tag = \"selfCheck\";\nexport class SelfCheck extends VariantRule<typeof Board, typeof tag> implements VariantRuleHandler<Board> {\n\tstatic {\n\t\tVariantRule.initVariantRule(SelfCheck);\n\t}\n\n\tgetDecoratorType() {\n\t\treturn Board;\n\t}\n\tgetPublicProperties() {\n\t\treturn {\n\t\t\tparameterValue: true,\n\t\t\tinformation: {\n\t\t\t\tname: \"Self-check\",\n\t\t\t\tdescription: \"Self-checks cost lives. Checkmate yourself to earn points\",\n\t\t\t\ttag,\n\t\t\t\tcolor: variantRuleColors.minor,\n\t\t\t\tdisplayIcon: chessGlyphIndex.donut\n\t\t\t}\n\t\t} as const;\n\t}\n\tmatchesPGNDeclaration(match: string): boolean {\n\t\treturn /^SelfCheck$/i.test(match);\n\t}\n\tserializeToParsingForm(): string {\n\t\treturn \"SelfCheck\";\n\t}\n\tisDisabled({ variantDataRules }: VariantRuleAllowedChecks): boolean {\n\t\treturn !variantDataRules.nCheck || !variantDataRules.captureTheKing;\n\t}\n\n\tgetCurrentChecks(baseColor = this.decorator.data.sideToMove): Tuple<string[], typeof totalPlayers> {\n\t\tconst {\n\t\t\tdata: { fenOptions, sideToMove },\n\t\t\tpreGeneratedAttacks\n\t\t} = this.decorator;\n\t\tconst baseChecks = this.callHandler(\"getCurrentChecks\", arguments);\n\t\tconst royal = fenOptions.tag(\"royal\")[baseColor];\n\t\tconst newCoordinates: string[] = [];\n\n\t\tif (royal) {\n\t\t\tfor (const [attackingPiece, attackCoordinates] of preGeneratedAttacks[sideToMove].hoppingPieceLines) {\n\t\t\t\tif (compareCoordinates(attackCoordinates, royal)) {\n\t\t\t\t\tnewCoordinates.push(stringifyCoordinate(attackingPiece));\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor (const [attackingPiece, attackLine] of preGeneratedAttacks[sideToMove].slidingPiecesLines) {\n\t\t\t\tfor (const attackCoordinates of attackLine) {\n\t\t\t\t\tif (compareCoordinates(attackCoordinates, royal)) {\n\t\t\t\t\t\tnewCoordinates.push(stringifyCoordinate(attackingPiece));\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tbaseChecks[baseColor] = newCoordinates;\n\t\treturn baseChecks;\n\t}\n}\n","import type { Coordinate, NumericColor } from \"@moveGeneration/GameInformation/GameUnits/GameUnits\";\nimport { pieceControlConfigSettings } from \"@moveGeneration/PieceControl/PieceControlInterface\";\nimport { createTupleFromCallback, Tuple } from \"../../../../../baseTypes\";\nimport { Board, PlayerBooleanTuple } from \"../../../Board/Board\";\nimport type { PostMoveResults } from \"../../../FENData/FENDataInterface\";\nimport { boardDimension, colors, totalPlayers } from \"../../../GameInformation/GameData\";\nimport { PieceString } from \"../../../GameInformation/GameUnits/PieceString\";\nimport { DroppingMove, InternalMoveSignature, Move, MoveData, verifyDroppingMove } from \"../../../MoveTree/MoveTreeInterface\";\nimport { VariantRule } from \"../../VariantRule\";\nimport { variantRuleColors, VariantRuleHandler } from \"../../VariantRuleInterface\";\nimport { chessGlyphIndex } from \"@client/fonts/chessGlyphIndex\";\n\nconst tag = \"setupChess\";\nexport class SetupChess extends VariantRule<typeof Board, typeof tag> implements VariantRuleHandler<Board> {\n\tstatic {\n\t\tVariantRule.initVariantRule(SetupChess);\n\t}\n\n\tprivate disabled = false;\n\tprivate setupPoints: number | false;\n\tprivate wereBanksEnabled: PlayerBooleanTuple = [false, false, false, false];\n\tprivate permutationCoordinates: Tuple<Coordinate[], typeof totalPlayers> = [[], [], [], []];\n\tprivate pawnPermutationCoordinates: Tuple<Coordinate[], typeof totalPlayers> = [[], [], [], []];\n\tconstructor(setupPoints?: unknown) {\n\t\tsuper();\n\t\tif (typeof setupPoints === \"number\") {\n\t\t\tthis.setupPoints = setupPoints;\n\t\t} else {\n\t\t\tthis.setupPoints = false;\n\t\t}\n\t}\n\n\tgetDecoratorType() {\n\t\treturn Board;\n\t}\n\n\tgetPublicProperties() {\n\t\treturn {\n\t\t\tparameterValue: this.setupPoints,\n\t\t\tinformation: {\n\t\t\t\tname: `Setup Material`,\n\t\t\t\tdescription: `Set up ${this.setupPoints || 0} points before the game starts`,\n\t\t\t\ttag,\n\t\t\t\tcolor: variantRuleColors.phased,\n\t\t\t\tdisplayIcon: chessGlyphIndex.movePawn\n\t\t\t}\n\t\t} as const;\n\t}\n\n\tmatchesPGNDeclaration(match: string): boolean {\n\t\tconst matchArray = match.match(/^Setup=(\\d+)$/);\n\t\tif (matchArray) {\n\t\t\tthis.setupPoints = Number(matchArray[1]);\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tserializeToParsingForm(): string {\n\t\treturn `Setup=${this.setupPoints || 0}`;\n\t}\n\n\tisDisabled() {\n\t\treturn false;\n\t}\n\n\tgetInsufficientMaterialData() {\n\t\treturn {\n\t\t\tisPartiallyDisabled: false,\n\t\t\tisDisabled: true\n\t\t} as const;\n\t}\n\n\tgetParametrizedOptions() {\n\t\tconst options = new Map<string, number | false>([[\"Off\", false]]);\n\t\tfor (let i = 1; i < 50; i++) options.set(String(i), i);\n\t\tfor (let i = 50; i <= 120; i += 5) options.set(String(i), i);\n\t\treturn options;\n\t}\n\n\tinitDecoratorSettings() {\n\t\tconst fenOptions = this.decorator.data.fenOptions;\n\t\tconst areBanksEnabled = fenOptions.tag(\"areBanksEnabled\"),\n\t\t\tdead = fenOptions.tag(\"dead\"),\n\t\t\tsetupComplete = fenOptions.tag(\"setupComplete\"),\n\t\t\tsetupPoints = fenOptions.tag(\"setupPoints\"),\n\t\t\tpawnBaseRank = fenOptions.tag(\"pawnBaseRank\"),\n\t\t\troyal = fenOptions.tag(\"royal\"),\n\t\t\tcastleKingside = fenOptions.tag(\"castleKingside\"),\n\t\t\tcastleQueenside = fenOptions.tag(\"castleQueenside\");\n\t\tconst areSetupPointsUnset = setupPoints === null;\n\n\t\tconst modifyDisplacements = (i: number, j: number, color: NumericColor): Coordinate => {\n\t\t\tconst baseDisplacements: Coordinate[] = [\n\t\t\t\t[13 - i, j],\n\t\t\t\t[j, i],\n\t\t\t\t[i, j],\n\t\t\t\t[13 - j, i]\n\t\t\t];\n\t\t\treturn baseDisplacements[color];\n\t\t};\n\n\t\tfor (const color of colors) {\n\t\t\tlet bankEnabled = false;\n\t\t\tif (areBanksEnabled[color]) {\n\t\t\t\tthis.wereBanksEnabled[color] = true;\n\t\t\t\tbankEnabled = true;\n\t\t\t} else if (!setupComplete[color]) {\n\t\t\t\tareBanksEnabled[color] = true;\n\t\t\t\tbankEnabled = true;\n\t\t\t}\n\n\t\t\tif (bankEnabled) {\n\t\t\t\tconst files = createTupleFromCallback((_, i) => i, boardDimension);\n\t\t\t\tconst pawnRanks = [pawnBaseRank, pawnBaseRank + 1].filter((rank) => rank >= 0 && rank <= 13);\n\t\t\t\tconst ranks = [pawnBaseRank - 1, ...pawnRanks];\n\t\t\t\tthis.permutationCoordinates[color] = files.flatMap((file) =>\n\t\t\t\t\tranks.map((rank): Coordinate => modifyDisplacements(rank, file, color))\n\t\t\t\t);\n\t\t\t\tthis.pawnPermutationCoordinates[color] = files.flatMap((file) =>\n\t\t\t\t\tpawnRanks.map((rank): Coordinate => modifyDisplacements(rank, file, color))\n\t\t\t\t);\n\t\t\t}\n\t\t\tif (!areSetupPointsUnset && !dead[color]) {\n\t\t\t\tsetupPoints[color] = this.setupPoints === false ? 0 : this.setupPoints;\n\t\t\t}\n\n\t\t\tif (!royal[color]) {\n\t\t\t\tcastleKingside[color] = false;\n\t\t\t\tcastleQueenside[color] = false;\n\t\t\t}\n\t\t}\n\n\t\tfor (const decorator of this.wrappingDecorators) decorator.initDecoratorSettings?.();\n\t}\n\n\tgetLegalMoves(): MoveData[] {\n\t\tif (!this.disabled) return [];\n\t\treturn this.callHandler(\"getLegalMoves\", arguments);\n\t}\n\n\tprivate getCoordinateList(piece: PieceString) {\n\t\treturn pieceControlConfigSettings[piece.piece].moveGenerationSettings.isPawn\n\t\t\t? this.pawnPermutationCoordinates\n\t\t\t: this.permutationCoordinates;\n\t}\n\n\tgetDroppingMoves(piece: PieceString, color = this.decorator.data.sideToMove): DroppingMove[] {\n\t\tif (piece.color !== color) return [];\n\t\tif (!this.disabled && !this.decorator.data.fenOptions.tag(\"setupComplete\")[color]) {\n\t\t\tconst coordinateList = this.getCoordinateList(piece);\n\t\t\tconst resultingMoveDrops: DroppingMove[] = [];\n\n\t\t\tfor (const coordinate of coordinateList[color]) {\n\t\t\t\tif (this.decorator.board[coordinate[0]][coordinate[1]].isEmpty()) {\n\t\t\t\t\tresultingMoveDrops.push({ piece, endCoordinates: coordinate });\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn resultingMoveDrops;\n\t\t} else return this.callHandler(\"getDroppingMoves\", arguments);\n\t}\n\n\tmakeMove(move: Move, ignoreNextMoves = false): PostMoveResults {\n\t\tconst fenOptions = this.decorator.data.fenOptions;\n\t\tconst areBanksEnabled = fenOptions.tag(\"areBanksEnabled\"),\n\t\t\tdead = fenOptions.tag(\"dead\"),\n\t\t\tsetupComplete = fenOptions.tag(\"setupComplete\"),\n\t\t\tsetupPoints = fenOptions.tag(\"setupPoints\"),\n\t\t\tbank = fenOptions.tag(\"bank\"),\n\t\t\troyal = fenOptions.tag(\"royal\");\n\t\tconst color = this.decorator.data.sideToMove,\n\t\t\tmoveData = move[0];\n\t\tconst results = this.callHandler(\"makeMove\", arguments);\n\n\t\tif (!this.disabled && !setupComplete[color] && verifyDroppingMove(moveData) && setupPoints) {\n\t\t\tconst pointValue = pieceControlConfigSettings[moveData.piece.piece].points.singlesPoints;\n\t\t\tif (moveData.piece.piece === \"K\") {\n\t\t\t\tbank[color].delete(moveData.piece);\n\t\t\t\troyal[color] = moveData.endCoordinates;\n\t\t\t} else {\n\t\t\t\tsetupPoints[color] -= pointValue;\n\t\t\t}\n\n\t\t\tconst pointsLeft = setupPoints[color];\n\t\t\tfor (const [piece] of bank[color]) {\n\t\t\t\tif (piece.piece !== \"K\" && pointValue > pointsLeft) {\n\t\t\t\t\tbank[color].delete(piece);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (bank[color].size === 0) {\n\t\t\t\tsetupComplete[color] = true;\n\t\t\t} else {\n\t\t\t\tconst coordinateList = this.getCoordinateList(moveData.piece);\n\n\t\t\t\tlet anyDrop = false;\n\t\t\t\tfor (const coordinate of coordinateList[color]) {\n\t\t\t\t\tif (this.decorator.board[coordinate[0]][coordinate[1]].isEmpty()) {\n\t\t\t\t\t\tanyDrop = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (!anyDrop) {\n\t\t\t\t\tsetupComplete[color] = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (setupComplete.every((v, i) => v || dead[i])) {\n\t\t\tthis.disabled = true;\n\t\t\tfor (const color of colors) {\n\t\t\t\tif (!this.wereBanksEnabled[color]) {\n\t\t\t\t\tareBanksEnabled[color] = false;\n\t\t\t\t\tbank[color].clear();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (!this.disabled && !ignoreNextMoves && setupComplete[this.decorator.data.sideToMove]) {\n\t\t\tBoard.prototype.makeMove.call(this.decorator, [{ type: InternalMoveSignature.Pass }]);\n\t\t}\n\n\t\treturn results;\n\t}\n}\n","import type { MoveData } from \"../../../MoveTree/MoveTreeInterface\";\nimport { Board } from \"../../../Board/Board\";\nimport { colors } from \"../../../GameInformation/GameData\";\nimport { VariantRule } from \"../../VariantRule\";\nimport { variantRuleColors, VariantRuleHandler } from \"../../VariantRuleInterface\";\nimport type { NumericColor } from \"@moveGeneration/GameInformation/GameUnits/GameUnits\";\nimport { chessGlyphIndex } from \"@client/fonts/chessGlyphIndex\";\n\nexport interface Test {\n\ttaboo: boolean | false;\n}\n\nconst tag = \"taboo\";\nexport class Taboo extends VariantRule<typeof Board, typeof tag> implements VariantRuleHandler<Board> {\n\tstatic {\n\t\tVariantRule.initVariantRule(Taboo);\n\t}\n\n\tgetDecoratorType() {\n\t\treturn Board;\n\t}\n\tgetPublicProperties() {\n\t\treturn {\n\t\t\tparameterValue: true,\n\t\t\tinformation: {\n\t\t\t\tname: \"Taboo\",\n\t\t\t\tdescription: \"Giving check is forbidden\",\n\t\t\t\ttag,\n\t\t\t\tcolor: variantRuleColors.widespread,\n\t\t\t\tdisplayIcon: chessGlyphIndex.equal\n\t\t\t}\n\t\t} as const;\n\t}\n\tmatchesPGNDeclaration(match: string): boolean {\n\t\treturn /^Taboo$/i.test(match);\n\t}\n\tserializeToParsingForm(): string {\n\t\treturn \"Taboo\";\n\t}\n\tisDisabled(): boolean {\n\t\treturn false;\n\t}\n\n\tisSetupComplex(): boolean {\n\t\treturn true;\n\t}\n\n\tisTheMoveLegal(_: NumericColor, moveData: MoveData): boolean {\n\t\tconst initialDead = this.decorator.data.fenOptions.tag(\"dead\").slice();\n\t\tconst snapshot = this.decorator.createSnapshot();\n\n\t\ttry {\n\t\t\tthis.decorator.makeMove([moveData], true);\n\t\t\tconst newDead = this.decorator.data.fenOptions.tag(\"dead\").slice();\n\n\t\t\tfor (const color of colors) {\n\t\t\t\tif ((!initialDead[color] && newDead[color]) || this.decorator.isKingInCheck(color)) return false;\n\t\t\t}\n\n\t\t\treturn true;\n\t\t} finally {\n\t\t\tthis.decorator.loadSnapshot(snapshot);\n\t\t}\n\t}\n}\n","import { createTuple, Tuple } from \"@client/ts/baseTypes\";\nimport { BoardSquares, initializeBoardSquares } from \"@client/ts/logic/BaseInterfaces\";\nimport type { Board } from \"@moveGeneration/Board/Board\";\nimport { stringifyCoordinate } from \"@moveGeneration/Board/BoardInterface\";\nimport type { FENData } from \"@moveGeneration/FENData/FENData\";\nimport { totalPlayers, colors, VariantType, boardDimension } from \"@moveGeneration/GameInformation/GameData\";\nimport type { NumericColor, Coordinate } from \"@moveGeneration/GameInformation/GameUnits/GameUnits\";\nimport { pawnPieceString, PieceString } from \"@moveGeneration/GameInformation/GameUnits/PieceString\";\nimport {\n\tInternalMoveSignature,\n\tMoveComponent,\n\tSpecialMove,\n\tverifyInternalMove,\n\tverifyStandardMove\n} from \"@moveGeneration/MoveTree/MoveTreeInterface\";\nimport type { PieceControlConfigurator } from \"@moveGeneration/PieceControl/PieceControlBuilder\";\nimport { pieceControlConfigSettings, PieceLetter } from \"@moveGeneration/PieceControl/PieceControlInterface\";\nimport type { VariantDataRules } from \"@moveGeneration/VariantRules/VariantRuleInterface\";\nimport { createBotAlgorithm, ZombieMoveGenerationAlgorithm, ZombieType } from \"../BotInterface\";\nimport { randomlyPickNextChainedMoves } from \"./RandomEvaluation\";\n\nconst onlyUnique = <T>(value: T, index: number, self: T[]) => self.indexOf(value) === index;\nconst stringifyKey = (i: number, j: number, color?: NumericColor) => `${i},${j}/${color ?? \"\"}`;\nfunction getPieceInFront(i: number, j: number, color: NumericColor): [number, number] {\n\tswitch (color) {\n\t\tcase 0:\n\t\t\treturn [i - 1, j];\n\t\tcase 1:\n\t\t\treturn [i, j + 1];\n\t\tcase 2:\n\t\t\treturn [i + 1, j];\n\t\tcase 3:\n\t\t\treturn [i, j - 1];\n\t}\n}\n\ninterface ReadonlyFlattenedBoardSettings {\n\tvariantData: VariantDataRules;\n\tpromotionRank: Tuple<number, typeof totalPlayers>;\n\tisFFA: boolean;\n\tisTeams: boolean;\n\tzombieType: Tuple<ZombieType, typeof totalPlayers>;\n\tdefaultSideToMove: NumericColor;\n}\n\ninterface SquareCoverage {\n\tattackers: Coordinate[];\n\tdefenders: Coordinate[];\n}\n\ninterface FlattenedBoardSettings extends Readonly<ReadonlyFlattenedBoardSettings> {\n\tboard: Board;\n\tboardSquares: PieceString[][];\n\tdata: FENData;\n\tremainingReal: number;\n\tremaining: Array<number | false>;\n\tcoverage: BoardSquares<Coordinate[]>;\n\tpieces: Coordinate[][];\n\troyal: Tuple<Coordinate | null, typeof totalPlayers>;\n\tcontrols: Record<PieceLetter, () => PieceControlConfigurator>;\n\tcoverageCache: Map<string, SquareCoverage>;\n\tpieceValueCache: Map<string, number>;\n\thangingCache: Map<string, number>;\n}\n\nfunction createComfuterAlgorithm(): ZombieMoveGenerationAlgorithm {\n\tlet boardAccessors: FlattenedBoardSettings;\n\tfunction augmentBoardAccessorsFromBoard(board: Board): Omit<FlattenedBoardSettings, keyof ReadonlyFlattenedBoardSettings> {\n\t\treturn {\n\t\t\tboard,\n\t\t\tboardSquares: board.board,\n\t\t\tdata: board.data,\n\t\t\tremainingReal: board.data.getRealPlayers(),\n\t\t\tremaining: board.data.fenOptions\n\t\t\t\t.tag(\"dead\")\n\t\t\t\t.map((v, i) => (v ? false : i))\n\t\t\t\t.filter((v) => v === false),\n\t\t\tcoverage: initializeBoardSquares(() => []),\n\t\t\tpieces: board.getPlayerPieces(),\n\t\t\tcontrols: board.controls,\n\t\t\troyal: board.data.fenOptions.tag(\"royal\"),\n\t\t\thangingCache: new Map(),\n\t\t\tcoverageCache: new Map(),\n\t\t\tpieceValueCache: new Map()\n\t\t};\n\t}\n\n\tfunction initializeBoardAccessorsFromBoard(board: Board) {\n\t\tconst promotionRank: Tuple<number, typeof totalPlayers> =\n\t\t\tboard.variantData.promotionRank !== false\n\t\t\t\t? [\n\t\t\t\t\t\tboardDimension - board.variantData.promotionRank,\n\t\t\t\t\t\tboard.variantData.promotionRank - 1,\n\t\t\t\t\t\tboard.variantData.promotionRank - 1,\n\t\t\t\t\t\tboardDimension - board.variantData.promotionRank\n\t\t\t\t  ]\n\t\t\t\t: createTuple(99, totalPlayers);\n\t\tboardAccessors = {\n\t\t\t...augmentBoardAccessorsFromBoard(board),\n\t\t\tvariantData: board.variantData,\n\t\t\tpromotionRank,\n\t\t\tisFFA: board.gameType.isFFA(),\n\t\t\tisTeams: !board.gameType.isFFA(),\n\t\t\tzombieType: board.data.fenOptions.tag(\"zombieType\"),\n\t\t\tdefaultSideToMove: board.data.sideToMove\n\t\t};\n\t}\n\n\tfunction getDistanceFromPromotion(color: NumericColor, i: number, j: number): number {\n\t\tif (i === -1) return 99;\n\t\treturn Math.abs(boardAccessors.promotionRank[color] - (color & 1 ? i : j)) || 99;\n\t}\n\n\tfunction getDistanceFromKing(i: number, j: number, color: NumericColor): number {\n\t\tif (i === -1) return 999;\n\t\tconst royalPiece = boardAccessors.royal[color];\n\t\tif (!royalPiece) return 999;\n\t\tconst x = Math.abs(i - royalPiece[0]),\n\t\t\ty = Math.abs(j - royalPiece[1]);\n\t\tif (x === 0 && y === 0) return 999;\n\t\treturn Math.max(x, y);\n\t}\n\n\tfunction inspectCoverage(): void {\n\t\tconst { board, boardSquares, pieces, coverage } = boardAccessors;\n\n\t\tfor (const color of colors) {\n\t\t\tfor (const coordinate of pieces[color]) {\n\t\t\t\tconst pc = boardSquares[coordinate[0]][coordinate[1]];\n\t\t\t\tif (!pc.isPiece()) continue;\n\t\t\t\tconst destinations = board.preGeneratedAttacks[color].pieceMovements.get(stringifyCoordinate(coordinate));\n\t\t\t\tif (!destinations) continue;\n\n\t\t\t\tfor (const dest of destinations) {\n\t\t\t\t\tcoverage[dest.move[0]][dest.move[1]].push(coordinate);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction getCoverage(i: number, j: number, color: NumericColor): SquareCoverage {\n\t\tconst { coverageCache, coverage, boardSquares, data, board, zombieType, defaultSideToMove } = boardAccessors;\n\t\tconst resigned = data.fenOptions.tag(\"resigned\");\n\n\t\tconst key = stringifyKey(i, j, color);\n\t\tif (coverageCache.has(key)) return coverageCache.get(key)!;\n\t\tconst attackers: Coordinate[] = [],\n\t\t\tdefenders: Coordinate[] = [];\n\t\tconst cvg = coverage[i][j];\n\t\tif (cvg.length) {\n\t\t\tfor (const pieceC of cvg) {\n\t\t\t\tconst piece = boardSquares[pieceC[0]][pieceC[1]];\n\t\t\t\tif (!piece.isPiece()) continue;\n\t\t\t\tconst pieceColor = piece.color;\n\t\t\t\tif (resigned[pieceColor] && zombieType[pieceColor] === ZombieType.Rando) continue;\n\t\t\t\tif (board.gameType.isSameTeam(pieceColor, defaultSideToMove)) {\n\t\t\t\t\tdefenders.push(pieceC);\n\t\t\t\t} else {\n\t\t\t\t\tattackers.push(pieceC);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst cache = color === defaultSideToMove ? { attackers, defenders } : { defenders: attackers, attackers: defenders };\n\t\tcoverageCache.set(key, cache);\n\t\treturn cache;\n\t}\n\n\tfunction getPieceValue(i: number, j: number): number {\n\t\tconst { boardSquares, pieceValueCache, isFFA, isTeams, remainingReal, royal, board } = boardAccessors;\n\n\t\tconst coordinates: [number, number] = [i, j];\n\t\tconst pieceString = boardSquares[i][j];\n\t\tif (!pieceString.isPiece()) return 0;\n\t\tconst piece = pieceString.piece;\n\t\tconst key = `${coordinates[0]},${coordinates[1]}/${pieceString.color}`;\n\t\tif (pieceValueCache.has(key)) return pieceValueCache.get(key)!;\n\n\t\tlet value = 0;\n\t\tconst controlSetting = pieceControlConfigSettings[piece];\n\t\tif (!controlSetting.moveGenerationSettings.isPawn) {\n\t\t\tvalue = isTeams ? controlSetting.points.botTeamsValue : controlSetting.points.botFFAValue;\n\t\t} else {\n\t\t\tvalue = isFFA ? 1 : 0.4;\n\t\t\tconst promotionDistance = getDistanceFromPromotion(pieceString.color, ...coordinates);\n\t\t\tvalue += (2 / (getDistanceFromKing(...coordinates, pieceString.color) * 3)) * (remainingReal / 4);\n\t\t\tvalue += 3 / (promotionDistance * 3);\n\n\t\t\tif (promotionDistance < 2) {\n\t\t\t\tconst inFront = getPieceInFront(...coordinates, pieceString.color);\n\t\t\t\tconst { attackers, defenders } = getCoverage(...inFront, pieceString.color);\n\t\t\t\tif (!defenders.length) {\n\t\t\t\t\tvalue += 3 / promotionDistance;\n\t\t\t\t}\n\t\t\t\tif (attackers.length < defenders.length) {\n\t\t\t\t\tvalue += 2 / promotionDistance;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tlet isRoyal = false;\n\t\tfor (const royalPiece of royal) {\n\t\t\tif (!royalPiece) continue;\n\t\t\tif (royalPiece[0] === coordinates[0] && royalPiece[1] === coordinates[1]) {\n\t\t\t\tisRoyal = true;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif (!isRoyal && piece !== pawnPieceString.piece) {\n\t\t\tfor (const color of colors) {\n\t\t\t\tif (!board.gameType.isSameTeam(color, pieceString.color)) {\n\t\t\t\t\tlet d = getDistanceFromKing(...coordinates, color);\n\t\t\t\t\tif (d < 3) d = 2;\n\t\t\t\t\tvalue += (5 - remainingReal) / d;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tpieceValueCache.set(key, value);\n\t\treturn value;\n\t}\n\n\tfunction getCoordinationEval(player: NumericColor): number {\n\t\tconst { pieces, remainingReal } = boardAccessors;\n\n\t\tlet e = 0;\n\t\tfor (const piece of pieces[player]) {\n\t\t\tconst { defenders } = getCoverage(piece[0], piece[1], player);\n\t\t\tfor (const d of defenders) e += 30 / (getPieceValue(d[0], d[1]) * 2);\n\t\t}\n\t\tif (remainingReal === 2) {\n\t\t\te *= 0.4;\n\t\t} else if (remainingReal === 3) {\n\t\t\te *= 0.7;\n\t\t}\n\n\t\treturn e / 55;\n\t}\n\n\tfunction firstPlayerMovesBefore(p1: NumericColor, p2: NumericColor): boolean {\n\t\tconst { data, defaultSideToMove } = boardAccessors;\n\n\t\tlet next = data.nextTurn();\n\t\tdo {\n\t\t\tif (p1 === next) return true;\n\t\t\tif (p2 === next) return false;\n\t\t\tnext = data.nextTurn(next);\n\t\t} while (next !== defaultSideToMove);\n\n\t\treturn true;\n\t}\n\n\tfunction canRespondDirectlyToThreat(player: NumericColor, attackers: Coordinate[]): boolean {\n\t\tconst { boardSquares } = boardAccessors;\n\n\t\tlet attackingPlayers: NumericColor[] = [];\n\t\tfor (const pc of attackers) {\n\t\t\tconst square = boardSquares[pc[0]][pc[1]];\n\t\t\tif (!square.isPiece()) continue;\n\t\t\tattackingPlayers.push(square.color);\n\t\t}\n\t\tattackingPlayers = attackingPlayers.filter(onlyUnique);\n\n\t\tfor (const a of attackingPlayers) {\n\t\t\tif (firstPlayerMovesBefore(player, a)) return false;\n\t\t}\n\t\treturn true;\n\t}\n\n\tfunction hanging(i: number, j: number, pieceValue = getPieceValue(i, j)): number {\n\t\tconst { hangingCache, boardSquares, remaining, data } = boardAccessors;\n\n\t\tconst key = stringifyKey(i, j);\n\t\tif (hangingCache.has(key)) return hangingCache.get(key)!;\n\t\tconst square = boardSquares[i][j];\n\t\tif (!square.isPiece()) return 0;\n\t\tconst { attackers, defenders } = getCoverage(i, j, square.color);\n\n\t\tlet attackerValue = 999;\n\t\tfor (const pc of attackers) {\n\t\t\tattackerValue = Math.min(attackerValue, getPieceValue(pc[0], pc[1]));\n\t\t}\n\t\tlet attackedFromLeft = false;\n\t\tconst nextTurn = data.nextTurn(square.color);\n\t\tif (remaining.length > 2) {\n\t\t\tfor (const pc of attackers) {\n\t\t\t\tif (boardSquares[pc[0]][pc[1]].color === nextTurn) {\n\t\t\t\t\tattackedFromLeft = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst threatened = pieceValue - attackerValue;\n\t\tlet pawnDefends: Coordinate | undefined;\n\t\tfor (const pc of defenders) {\n\t\t\tif (boardSquares[pc[0]][pc[1]].piece === pawnPieceString.piece) {\n\t\t\t\tpawnDefends = pc;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tlet h = 0;\n\t\tconst underDefended = attackers.length - defenders.length > 0;\n\t\tif (underDefended) h = pieceValue;\n\t\tif (underDefended && pawnDefends) h = 0;\n\t\tif (pawnDefends && attackers.length - defenders.length > 1) {\n\t\t\th = getPieceValue(pawnDefends[0], pawnDefends[1]);\n\t\t}\n\t\tif (!h && threatened > 0) h = threatened;\n\t\tif (!h && attackedFromLeft && threatened >= -2) {\n\t\t\th = -threatened;\n\t\t}\n\t\tif (h && canRespondDirectlyToThreat(square.color, attackers)) {\n\t\t\th /= 6;\n\t\t}\n\n\t\thangingCache.set(key, h);\n\t\treturn h;\n\t}\n\n\tfunction getMobilityEval(player: NumericColor): number {\n\t\tconst { pieces, boardSquares, isTeams, royal, defaultSideToMove, board } = boardAccessors;\n\n\t\tlet e = 0;\n\t\tfor (const coordinate of pieces[player]) {\n\t\t\tif (hanging(coordinate[0], coordinate[1]) > 2) continue;\n\t\t\tconst piece = boardSquares[coordinate[0]][coordinate[1]];\n\t\t\tif (!piece.isPiece()) continue;\n\n\t\t\tlet destinations = board.preGeneratedAttacks[player].pieceMovements.get(stringifyCoordinate(coordinate))?.length ?? 0;\n\t\t\tif (/[QDAEHΔ]/.test(piece.piece)) destinations /= isTeams ? 2 : 3;\n\t\t\tif (/[RBV]]/.test(piece.piece)) destinations /= isTeams ? 1.5 : 2;\n\t\t\te += destinations / (isTeams ? 10 : board.gameType.type === VariantType.Solo ? 21 : 16);\n\n\t\t\tlet isRoyal = false;\n\t\t\tfor (const royalPiece of royal) {\n\t\t\t\tif (!royalPiece) continue;\n\t\t\t\tif (royalPiece[0] === coordinate[0] && royalPiece[1] === coordinate[1]) {\n\t\t\t\t\tisRoyal = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!isRoyal && !isTeams && piece.piece === pawnPieceString.piece) {\n\t\t\t\tconst blockedBy = getPieceInFront(coordinate[0], coordinate[1], player);\n\t\t\t\tconst bSqr = boardSquares[blockedBy[0]][blockedBy[1]];\n\t\t\t\tif (bSqr.isEmpty()) continue;\n\n\t\t\t\tif (!bSqr.isPiece()) {\n\t\t\t\t\te -= 2;\n\t\t\t\t} else if (board.gameType.isSameTeam(bSqr.color, defaultSideToMove)) {\n\t\t\t\t\te -= 0.5;\n\t\t\t\t} else if (bSqr.piece === pawnPieceString.piece) {\n\t\t\t\t\te -= 1.8;\n\t\t\t\t} else if (player === bSqr.color) {\n\t\t\t\t\te -= 0.5;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn e;\n\t}\n\n\tfunction getDistFromHill(player: NumericColor): number {\n\t\tconst royalPiece = boardAccessors.royal[player];\n\t\tif (!royalPiece) return 999;\n\t\tconst x = Math.abs(6.5 - royalPiece[0]);\n\t\tconst y = Math.abs(6.5 - royalPiece[1]);\n\t\tconst d = (x + y) / 2 + Math.max(x, y) / 2;\n\t\tif (!d) return 999;\n\t\treturn d;\n\t}\n\n\tfunction getMatesEval(): number {\n\t\tconst { board, variantData, data, pieces, remainingReal } = boardAccessors;\n\t\tboard.data.sideToMove = board.data.previousTurn();\n\t\tconst { checkmates, stalemates, checks } = board.getCheckmatesAndStalemates();\n\t\tboard.data.sideToMove = board.data.nextTurn();\n\t\tlet e = 0;\n\t\tfor (const color of colors) {\n\t\t\tif (checkmates[color]) {\n\t\t\t\te += 500;\n\t\t\t} else if (stalemates[color]) e -= 300;\n\t\t}\n\n\t\tconst checksLength = checks.filter(Boolean).length;\n\t\tif (checksLength === 3) {\n\t\t\te += 10;\n\t\t} else if (checksLength === 2) {\n\t\t\te += 1;\n\t\t} else if (checksLength === 1) {\n\t\t\tconst prev = data.previousTurn();\n\t\t\tif (remainingReal > 2 && checks[prev]) {\n\t\t\t\te += 1.2;\n\t\t\t} else if (remainingReal === 2) {\n\t\t\t\te += 0.1;\n\t\t\t} else {\n\t\t\t\te += 0.4;\n\t\t\t}\n\t\t}\n\n\t\tif (checksLength && variantData.nCheck) {\n\t\t\tfor (const color of colors) {\n\t\t\t\tconst lives = data.fenOptions.tag(\"lives\")[color];\n\t\t\t\tif (lives && checks[color]) e += 4 / (lives + 1);\n\t\t\t}\n\t\t\te += 0.3;\n\t\t}\n\t\tif (variantData.barePieceRule) {\n\t\t\tfor (const color of colors) {\n\t\t\t\tif (pieces[color].length <= 1) e += 300;\n\t\t\t}\n\t\t}\n\n\t\treturn e;\n\t}\n\n\tfunction getMaterialEval(): { myMaterial: number; oppMaterial: number } {\n\t\tconst { board, pieces, isTeams, remainingReal, defaultSideToMove, variantData } = boardAccessors;\n\t\tlet myMaterial = 0,\n\t\t\toppMaterial = 0;\n\n\t\tfor (const color of colors) {\n\t\t\tif (board.gameType.isSameTeam(color, defaultSideToMove)) {\n\t\t\t\tfor (const pc of pieces[color]) {\n\t\t\t\t\tlet pieceValue = getPieceValue(pc[0], pc[1]);\n\t\t\t\t\tpieceValue -= hanging(pc[0], pc[1]);\n\t\t\t\t\tmyMaterial += pieceValue;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tfor (const pc of pieces[color]) {\n\t\t\t\t\tlet pcVal = getPieceValue(pc[0], pc[1]);\n\t\t\t\t\tif (!isTeams && remainingReal === 4 && Math.abs(color - defaultSideToMove) === 2 && !variantData.giveaway) {\n\t\t\t\t\t\tpcVal /= board.gameType.type === VariantType.Solo ? 2 : 3;\n\t\t\t\t\t}\n\t\t\t\t\tpcVal -= hanging(pc[0], pc[1], pcVal);\n\t\t\t\t\toppMaterial -= pcVal;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (!isTeams && remainingReal === 4) {\n\t\t\toppMaterial /= 1.4;\n\t\t\tmyMaterial *= 1.2;\n\t\t}\n\t\tif (!isTeams && remainingReal === 3) {\n\t\t\toppMaterial /= 1.25;\n\t\t\tmyMaterial *= 1.1;\n\t\t}\n\t\tmyMaterial *= 2;\n\t\toppMaterial *= 2;\n\n\t\treturn { myMaterial, oppMaterial };\n\t}\n\n\tfunction getPinsEval(): { pinnedEval: number; discovsEval: number } {\n\t\tconst { board, royal, pieces, defaultSideToMove, remainingReal } = boardAccessors;\n\n\t\tlet pinnedEval = 0,\n\t\t\tdiscovsEval = 0;\n\t\tfor (const i of colors) {\n\t\t\tconst discovered: Coordinate[] = [];\n\t\t\tconst pins: Coordinate[] = [];\n\n\t\t\tfor (const piece of pieces[i]) {\n\t\t\t\tconst royalPiece = royal[i];\n\t\t\t\tif (!royalPiece) break;\n\t\t\t\tif (royalPiece[0] === piece[0] && royalPiece[1] === piece[1]) continue;\n\t\t\t\tconst [royalX, royalY] = royalPiece;\n\t\t\t\tconst pieceX = piece[0],\n\t\t\t\t\tpieceY = piece[1];\n\n\t\t\t\tfor (const [attackPiece, attackLine] of board.preGeneratedAttacks[i].slidingPiecesRayTracing) {\n\t\t\t\t\tlet isPieceUnderAttack = false,\n\t\t\t\t\t\tisRoyalUnderAttack = false;\n\t\t\t\t\tfor (const [attackedX, attackedY] of attackLine) {\n\t\t\t\t\t\tif (!isPieceUnderAttack && attackedX === pieceX && attackedY === pieceY) isPieceUnderAttack = true;\n\t\t\t\t\t\tif (!isRoyalUnderAttack && attackedX === royalX && attackedY === royalY) isRoyalUnderAttack = true;\n\n\t\t\t\t\t\tif (isPieceUnderAttack && isRoyalUnderAttack) {\n\t\t\t\t\t\t\tpins.push(piece);\n\t\t\t\t\t\t} else if (isRoyalUnderAttack && !isPieceUnderAttack) {\n\t\t\t\t\t\t\tdiscovered.push([attackPiece[0], attackPiece[1]]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor (const coordinate of pins) {\n\t\t\t\tif (hanging(coordinate[0], coordinate[1]) > 2) continue;\n\t\t\t\tconst pieceValue = Math.sqrt(getPieceValue(coordinate[0], coordinate[1]));\n\t\t\t\tif (!board.gameType.isSameTeam(i, defaultSideToMove)) {\n\t\t\t\t\tpinnedEval += pieceValue / 2;\n\t\t\t\t} else {\n\t\t\t\t\tpinnedEval -= pieceValue;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor (const coordinate of discovered) {\n\t\t\t\tif (hanging(coordinate[0], coordinate[1]) > 2) continue;\n\t\t\t\tconst pieceValue = Math.sqrt(getPieceValue(coordinate[0], coordinate[1]));\n\t\t\t\tif (board.gameType.isSameTeam(i, defaultSideToMove)) {\n\t\t\t\t\tdiscovsEval += pieceValue / 2;\n\t\t\t\t} else {\n\t\t\t\t\tdiscovsEval -= pieceValue;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tpinnedEval *= remainingReal / 6;\n\t\tdiscovsEval *= remainingReal / 6;\n\t\tif (discovsEval < 0) discovsEval /= 10;\n\n\t\treturn { pinnedEval, discovsEval };\n\t}\n\n\tfunction getKingSafetyEval(player: NumericColor): { kingEval: number; checkableEval: number; exposedEval: number } {\n\t\tconst { board, royal, boardSquares, remainingReal, data, variantData, defaultSideToMove } = boardAccessors;\n\t\tlet kingEval = 0,\n\t\t\tcheckableEval = 0,\n\t\t\texposedEval = 0;\n\t\tif (variantData.giveaway) return { kingEval, checkableEval, exposedEval };\n\t\tconst baseReferences: Coordinate[][][] = initializeBoardSquares(() => []);\n\n\t\tfor (const [coordinate, attack] of board.preGeneratedAttacks[player].hoppingPieceLines) {\n\t\t\tbaseReferences[attack[0]][attack[1]].push([coordinate[0], coordinate[1]]);\n\t\t}\n\t\tfor (const [coordinate, line] of board.preGeneratedAttacks[player].slidingPiecesLines) {\n\t\t\tfor (const attack of line) {\n\t\t\t\tbaseReferences[attack[0]][attack[1]].push([coordinate[0], coordinate[1]]);\n\t\t\t}\n\t\t}\n\n\t\tconst royalPiece = royal[player];\n\t\tconst squareAccessDefinitions = new Set<string>();\n\t\tif (royalPiece) {\n\t\t\tconst isChecked = Boolean(\n\t\t\t\tboard.preGeneratedAttacks[player].slidingPieces[royalPiece[0]][royalPiece[1]] ||\n\t\t\t\t\tboard.preGeneratedAttacks[player].hoppingPieces[royalPiece[0]][royalPiece[1]]\n\t\t\t);\n\t\t\tfor (let i = 0; i < boardDimension; i++) {\n\t\t\t\tfor (let j = 0; j < boardDimension; j++) {\n\t\t\t\t\tif (isChecked) {\n\t\t\t\t\t\tlet checkableSq = 0;\n\t\t\t\t\t\tif (remainingReal === 2) {\n\t\t\t\t\t\t\tcheckableSq -= 0.8;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconst players = baseReferences[i][j].map((coord) => {\n\t\t\t\t\t\t\t\tconst piece = boardSquares[coord[0]][coord[1]];\n\t\t\t\t\t\t\t\tif (!piece.isPiece()) return player;\n\t\t\t\t\t\t\t\treturn piece.color;\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tconst prev = data.nextTurn(player);\n\t\t\t\t\t\t\tconst next = data.previousTurn(player);\n\t\t\t\t\t\t\tfor (const player of players) {\n\t\t\t\t\t\t\t\tif (remainingReal === 3) {\n\t\t\t\t\t\t\t\t\tcheckableSq -= player === next ? 3 : 2;\n\t\t\t\t\t\t\t\t} else if (remainingReal === 4) {\n\t\t\t\t\t\t\t\t\tcheckableSq -= player === next ? 5 : player === prev ? 2 : 3;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst { defenders } = getCoverage(i, j, player);\n\t\t\t\t\t\tif (defenders.length) checkableSq += 2.5;\n\t\t\t\t\t\tif (checkableSq > 0) checkableSq = 0;\n\n\t\t\t\t\t\tconst accessKey = stringifyKey(i, j);\n\t\t\t\t\t\tif (!squareAccessDefinitions.has(accessKey)) {\n\t\t\t\t\t\t\texposedEval -= 0.123;\n\t\t\t\t\t\t\tsquareAccessDefinitions.add(accessKey);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcheckableEval += checkableSq;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst ki = royalPiece[0],\n\t\t\t\tkj = royalPiece[1];\n\t\t\tfor (let d = 1; d < 3; d++) {\n\t\t\t\tconst x = [ki, ki + d, ki - d];\n\t\t\t\tconst y = [kj, kj + d, kj - d];\n\t\t\t\tfor (const i of x) {\n\t\t\t\t\tfor (const j of y) {\n\t\t\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n\t\t\t\t\t\tif (!boardSquares[i]?.[j]) continue;\n\t\t\t\t\t\tif (i === ki && j === kj) continue;\n\t\t\t\t\t\tconst pieceString = boardSquares[i][j];\n\t\t\t\t\t\tif (!pieceString.isPiece()) continue;\n\t\t\t\t\t\tif (board.gameType.isSameTeam(pieceString.color, player)) {\n\t\t\t\t\t\t\tkingEval += pieceString.piece === pawnPieceString.piece ? 2 : 1;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tkingEval -= getPieceValue(i, j);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor (let k = -1; k < 2; k++) {\n\t\t\t\tfor (let h = -1; h < 2; h++) {\n\t\t\t\t\tconst i = ki + k;\n\t\t\t\t\tconst j = kj + h;\n\t\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n\t\t\t\t\tif (!boardSquares[i]?.[j]) continue;\n\t\t\t\t\tconst { attackers, defenders } = getCoverage(i, j, player);\n\t\t\t\t\tkingEval -= 2 * attackers.length;\n\t\t\t\t\tkingEval += 1 * defenders.length;\n\t\t\t\t}\n\t\t\t}\n\t\t\tkingEval /= 10;\n\t\t}\n\n\t\tif (variantData.nCheck && !board.gameType.isSameTeam(board.data.sideToMove, defaultSideToMove)) {\n\t\t\tconst lives = data.fenOptions.tag(\"lives\")[board.data.sideToMove];\n\t\t\tswitch (lives) {\n\t\t\t\tcase null:\n\t\t\t\t\tbreak;\n\t\t\t\tcase 2:\n\t\t\t\t\tcheckableEval *= 1.5;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 1:\n\t\t\t\t\tcheckableEval *= 3;\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tcheckableEval *= 1.3;\n\t\t\t}\n\t\t}\n\n\t\treturn { kingEval, checkableEval, exposedEval };\n\t}\n\n\tfunction isZombieEatZombie(move: MoveComponent): boolean {\n\t\tif (!verifyStandardMove(move)) return false;\n\t\tconst { data, defaultSideToMove, boardSquares, variantData } = boardAccessors;\n\t\tif (variantData.giveaway) return false;\n\t\tconst resigned = data.fenOptions.tag(\"resigned\");\n\n\t\tif (!resigned[defaultSideToMove]) return false;\n\t\tconst targetPiece = boardSquares[move.endCoordinates[0]][move.endCoordinates[1]];\n\t\tif (!targetPiece.isPiece()) return false;\n\t\tif (resigned[targetPiece.color]) return true;\n\t\treturn false;\n\t}\n\n\tfunction getEval(move: MoveComponent): number {\n\t\tlet totalEval = 0;\n\t\tconst { board, data, defaultSideToMove, variantData, royal, isTeams } = boardAccessors;\n\t\tconst snapshot = board.createSnapshot();\n\n\t\tconst isKingsideCastle = data.fenOptions.isKingsideCastlingAvailable(data.sideToMove, board),\n\t\t\tisQueensideCastle = data.fenOptions.isQueensideCastlingAvailable(data.sideToMove, board);\n\t\tboard.makeMove([move], true);\n\t\tboard.pregenerateAttacks();\n\t\tboardAccessors = { ...boardAccessors, ...augmentBoardAccessorsFromBoard(board) };\n\t\tinspectCoverage();\n\n\t\tconst { myMaterial, oppMaterial } = getMaterialEval();\n\t\tconst hillEval = variantData.kingOfTheHill ? 416 / (3 * getDistFromHill(defaultSideToMove)) : 0;\n\n\t\tif (variantData.giveaway) {\n\t\t\ttotalEval = -3 * myMaterial - oppMaterial - getCoordinationEval(defaultSideToMove) * 10 + hillEval;\n\t\t} else {\n\t\t\ttotalEval += getMatesEval();\n\n\t\t\tconst royalPiece = royal[defaultSideToMove];\n\t\t\tif (royalPiece) {\n\t\t\t\tconst { attackers } = getCoverage(royalPiece[0], royalPiece[1], defaultSideToMove);\n\t\t\t\tif (attackers.length) totalEval -= 700;\n\t\t\t}\n\n\t\t\ttotalEval += getMobilityEval(defaultSideToMove);\n\t\t\ttotalEval += getCoordinationEval(defaultSideToMove);\n\n\t\t\tif (isTeams) {\n\t\t\t\tconst partner = colors.find((v) => v !== defaultSideToMove && board.gameType.isSameTeam(defaultSideToMove, v));\n\t\t\t\tif (partner) Object.values(getKingSafetyEval(partner)).forEach((v) => (totalEval += v));\n\t\t\t}\n\n\t\t\tObject.values(getPinsEval()).forEach((v) => (totalEval += v));\n\t\t\tObject.values(getKingSafetyEval(defaultSideToMove)).forEach((v) => (totalEval += v));\n\t\t\ttotalEval += myMaterial + oppMaterial + hillEval;\n\t\t}\n\n\t\tconst isCastling =\n\t\t\t\"specialType\" in move && (move.specialType === SpecialMove.CastlingKingside || move.specialType === SpecialMove.CastlingQueenside);\n\t\tif (!isCastling && (isKingsideCastle || isQueensideCastle)) totalEval -= 0.5;\n\t\tif (isZombieEatZombie(move)) {\n\t\t\ttotalEval -= 10000;\n\t\t}\n\t\tswitch (board.moves.getHash(board.moves.constructPreliminaryHashString(board))) {\n\t\t\tcase 1:\n\t\t\t\ttotalEval -= 10000;\n\t\t\t\tbreak;\n\t\t\tcase 2:\n\t\t\t\ttotalEval -= 20000;\n\t\t\t\tbreak;\n\t\t}\n\t\tif (variantData.fiftyMoveRule && variantData.fiftyMoveRule - board.data.plyCount < 8) totalEval -= 150000;\n\n\t\tboard.loadSnapshot(snapshot);\n\t\treturn totalEval;\n\t}\n\n\treturn {\n\t\tstringifiedType: ZombieType.Futer,\n\t\tevaluate(moves, board): Map<MoveComponent, number> {\n\t\t\tinitializeBoardAccessorsFromBoard(board.createClone());\n\n\t\t\tconst moveValues = new Map<MoveComponent, number>();\n\t\t\tfor (const move of moves) {\n\t\t\t\tif (verifyInternalMove(move)) {\n\t\t\t\t\tswitch (move.type) {\n\t\t\t\t\t\tcase InternalMoveSignature.Resign:\n\t\t\t\t\t\tcase InternalMoveSignature.Timeout:\n\t\t\t\t\t\t\tmoveValues.set(move, -Infinity);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase InternalMoveSignature.ClaimWin:\n\t\t\t\t\t\t\tmoveValues.set(move, Infinity);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t} else moveValues.set(move, getEval(move));\n\t\t\t}\n\n\t\t\treturn moveValues;\n\t\t},\n\t\tpickPreferredMove(evaluations: Map<MoveComponent, number>) {\n\t\t\tconst sorted = [...evaluations.entries()].sort((a, b) => b[1] - a[1]);\n\t\t\tconst best: MoveComponent[] = [];\n\n\t\t\tfor (const [move, evaluated] of sorted) {\n\t\t\t\tif (sorted[0][1] - evaluated > 0.5) break;\n\t\t\t\tbest.push(move);\n\t\t\t}\n\n\t\t\tif (best.length > 5) best.length = 5;\n\t\t\tlet pick = Math.floor(Math.random() * best.length);\n\t\t\tif (pick > 0 && Math.random() > 0.8) pick = 0;\n\t\t\tif (pick > 1 && Math.random() > 0.8) pick = 1;\n\t\t\tif (pick > 2 && Math.random() > 0.8) pick = 2;\n\t\t\treturn randomlyPickNextChainedMoves(best[pick]);\n\t\t}\n\t};\n}\nexport const comfuterAlgorithm = createBotAlgorithm(createComfuterAlgorithm());\n","import { MoveComponent, verifyStandardMove, SpecialMove, verifyInternalMove } from \"@moveGeneration/MoveTree/MoveTreeInterface\";\nimport { pieceControlConfigSettings } from \"@moveGeneration/PieceControl/PieceControlInterface\";\nimport { createBotAlgorithm, ZombieMoveGenerationAlgorithm, ZombieType } from \"../BotInterface\";\nimport { comfuterAlgorithm } from \"./ComfuterEvaluation\";\n\nexport const createComfuterBasedAlgorithm = (\n\talgorithm: Omit<ZombieMoveGenerationAlgorithm, \"pickPreferredMove\">\n): ZombieMoveGenerationAlgorithm => ({\n\t...algorithm,\n\tpickPreferredMove(...args) {\n\t\treturn comfuterAlgorithm.pickPreferredMove.apply(this, args);\n\t}\n});\n\nexport const comfuterCheckerAlgorithm = createBotAlgorithm(\n\tcreateComfuterBasedAlgorithm({\n\t\tstringifiedType: ZombieType.F_Checker,\n\t\tevaluate(moves, board): Map<MoveComponent, number> {\n\t\t\tconst baseEvaluations = comfuterAlgorithm.evaluate.call(this, moves, board);\n\n\t\t\tfor (const [move, evaluation] of baseEvaluations) {\n\t\t\t\tif (verifyInternalMove(move)) continue;\n\t\t\t\tconst snapshot = board.createSnapshot();\n\t\t\t\tconst { checks, checkmates } = board.makeMove([move]);\n\t\t\t\tconst checksLength = checks.filter(Boolean).length;\n\t\t\t\tbaseEvaluations.set(move, evaluation + (checkmates.includes(true) ? checksLength * 500 : checksLength * 1500));\n\t\t\t\tboard.moves.deleteMove(board.moves.currentMove);\n\t\t\t\tboard.loadSnapshot(snapshot);\n\t\t\t}\n\n\t\t\treturn baseEvaluations;\n\t\t}\n\t})\n);\n\nexport const comfuterMuncherAlgorithm = createBotAlgorithm(\n\tcreateComfuterBasedAlgorithm({\n\t\tstringifiedType: ZombieType.F_Muncher,\n\t\tevaluate(moves, board): Map<MoveComponent, number> {\n\t\t\tconst baseEvaluations = comfuterAlgorithm.evaluate.call(this, moves, board);\n\n\t\t\tfor (const [move, evaluation] of baseEvaluations) {\n\t\t\t\tif (!verifyStandardMove(move)) continue;\n\t\t\t\tif (move.specialType === SpecialMove.EnPassant || board.board[move.endCoordinates[0]][move.endCoordinates[1]].isEmpty())\n\t\t\t\t\tcontinue;\n\n\t\t\t\tbaseEvaluations.set(move, evaluation + 5000);\n\t\t\t}\n\n\t\t\treturn baseEvaluations;\n\t\t}\n\t})\n);\n\nexport const comfuterPusherAlgorithm = createBotAlgorithm(\n\tcreateComfuterBasedAlgorithm({\n\t\tstringifiedType: ZombieType.F_Pusher,\n\t\tevaluate(moves, board): Map<MoveComponent, number> {\n\t\t\tconst baseEvaluations = comfuterAlgorithm.evaluate.call(this, moves, board);\n\n\t\t\tfor (const [move, evaluation] of baseEvaluations) {\n\t\t\t\tif (!verifyStandardMove(move)) continue;\n\t\t\t\tconst pieceString = board.board[move.startCoordinates[0]][move.startCoordinates[1]];\n\t\t\t\tif (pieceString.isPiece() && !pieceControlConfigSettings[pieceString.piece].moveGenerationSettings.isPawn) {\n\t\t\t\t\tbaseEvaluations.set(move, evaluation + 5000);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn baseEvaluations;\n\t\t}\n\t})\n);\n\nexport const patzerAlgorithm = createBotAlgorithm(\n\tcreateComfuterBasedAlgorithm({\n\t\tstringifiedType: ZombieType.Patzer,\n\t\tevaluate(moves, defaultBoard): Map<MoveComponent, number> {\n\t\t\tconst baseEvaluations = comfuterAlgorithm.evaluate.call(this, moves, defaultBoard);\n\t\t\tfor (const [move, evaluation] of baseEvaluations) {\n\t\t\t\tbaseEvaluations.set(move, -evaluation);\n\t\t\t}\n\n\t\t\treturn baseEvaluations;\n\t\t}\n\t})\n);\n","import { createBotAlgorithm, ZombieType } from \"../BotInterface\";\nimport { comfuterAlgorithm } from \"./ComfuterEvaluation\";\nimport { createComfuterBasedAlgorithm } from \"./ComfuterEvaluationExtensions\";\nimport { randoBotAlgorithm } from \"./RandomEvaluation\";\n\nexport const RanterAlgorithm = createBotAlgorithm(\n\tcreateComfuterBasedAlgorithm({\n\t\tstringifiedType: ZombieType.Ranter,\n\t\tevaluate(...args) {\n\t\t\tif (Math.random() < 0.5) {\n\t\t\t\treturn randoBotAlgorithm.evaluate.apply(this, args);\n\t\t\t} else return comfuterAlgorithm.evaluate.apply(this, args);\n\t\t}\n\t})\n);\n","import { Move, MoveComponent, verifyRequiredMove, verifyStandardMove } from \"@moveGeneration/MoveTree/MoveTreeInterface\";\nimport { createBotAlgorithm, ZombieType } from \"../BotInterface\";\n\nexport function randomlyPickNextChainedMoves(move: MoveComponent, resultingMove: MoveComponent[] = []): Move {\n\tconst newMove = [...resultingMove, move];\n\tif (move.nextChainedMoves && !move.isForcedContinuation && Math.random() > 0.5) {\n\t\treturn randomlyPickNextChainedMoves(move.nextChainedMoves[Math.floor(Math.random() * move.nextChainedMoves.length)], newMove);\n\t} else {\n\t\tif (!verifyRequiredMove(newMove)) throw new Error(\"Required move length is 0\");\n\t\treturn newMove;\n\t}\n}\n\nexport const randoBotAlgorithm = createBotAlgorithm({\n\tstringifiedType: ZombieType.Rando,\n\tevaluate(moves, board): Map<MoveComponent, number> {\n\t\tconst copyOfMoves = moves.slice();\n\t\tfor (let i = moves.length - 1; i > 0; i--) {\n\t\t\tconst j = Math.floor(Math.random() * (i + 1));\n\t\t\t[copyOfMoves[i], copyOfMoves[j]] = [moves[j], moves[i]];\n\t\t}\n\n\t\tconst data = board.data,\n\t\t\tboardSquares = board.board;\n\n\t\tconst zombieEatZombieMoves: typeof moves = [];\n\t\tconst otherMoves: typeof moves = [];\n\t\tfor (const move of copyOfMoves) {\n\t\t\tif (verifyStandardMove(move)) {\n\t\t\t\tconst targetPiece = boardSquares[move.endCoordinates[1]][move.endCoordinates[0]];\n\t\t\t\tif (targetPiece.isPiece() && data.fenOptions.tag(\"resigned\")[targetPiece.color]) {\n\t\t\t\t\tzombieEatZombieMoves.push(move);\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t}\n\t\t\totherMoves.push(move);\n\t\t}\n\n\t\tlet startingEvaluation = 0;\n\t\treturn new Map([\n\t\t\t...otherMoves.reduce<Array<[MoveComponent, number]>>((p, n) => (p.push([n, --startingEvaluation]), p), []),\n\t\t\t...zombieEatZombieMoves.reduce<Array<[MoveComponent, number]>>((p, n) => (p.push([n, --startingEvaluation / 2]), p), [])\n\t\t]);\n\t},\n\tpickPreferredMove(evaluations: Map<MoveComponent, number>): Move {\n\t\treturn randomlyPickNextChainedMoves([...evaluations.entries()].reduce((p, n) => (n[1] > p[1] ? n : p))[0]);\n\t}\n});\n","import { MoveComponent, verifyStandardMove, SpecialMove } from \"@moveGeneration/MoveTree/MoveTreeInterface\";\nimport { pieceControlConfigSettings } from \"@moveGeneration/PieceControl/PieceControlInterface\";\nimport { createBotAlgorithm, ZombieMoveGenerationAlgorithm, ZombieType } from \"../BotInterface\";\nimport { randoBotAlgorithm } from \"./RandomEvaluation\";\n\nexport const createRandomBasedAlgorithm = (\n\talgorithm: Omit<ZombieMoveGenerationAlgorithm, \"pickPreferredMove\">\n): ZombieMoveGenerationAlgorithm => ({\n\t...algorithm,\n\tpickPreferredMove(...args) {\n\t\treturn randoBotAlgorithm.pickPreferredMove.apply(this, args);\n\t}\n});\n\nexport const checkerAlgorithm = createBotAlgorithm(\n\tcreateRandomBasedAlgorithm({\n\t\tstringifiedType: ZombieType.Checker,\n\t\tevaluate(moves, board): Map<MoveComponent, number> {\n\t\t\tconst baseEvaluations = randoBotAlgorithm.evaluate.call(this, moves, board);\n\n\t\t\tfor (const [move, evaluation] of baseEvaluations) {\n\t\t\t\tconst snapshot = board.createSnapshot();\n\t\t\t\tconst { checks, checkmates } = board.makeMove([move]);\n\t\t\t\tif (checks.filter((c, i) => c && !checkmates[i] === c).length === 0) {\n\t\t\t\t\tbaseEvaluations.set(move, evaluation / (evaluation / 2));\n\t\t\t\t}\n\t\t\t\tboard.loadSnapshot(snapshot);\n\t\t\t}\n\n\t\t\treturn baseEvaluations;\n\t\t}\n\t})\n);\n\nexport const muncherAlgorithm = createBotAlgorithm(\n\tcreateRandomBasedAlgorithm({\n\t\tstringifiedType: ZombieType.Muncher,\n\t\tevaluate(moves, board): Map<MoveComponent, number> {\n\t\t\tconst baseEvaluations = randoBotAlgorithm.evaluate.call(this, moves, board);\n\n\t\t\tfor (const [move, evaluation] of baseEvaluations) {\n\t\t\t\tif (!verifyStandardMove(move)) continue;\n\t\t\t\tif (move.specialType === SpecialMove.EnPassant || board.board[move.endCoordinates[0]][move.endCoordinates[1]].isEmpty())\n\t\t\t\t\tcontinue;\n\n\t\t\t\tbaseEvaluations.set(move, evaluation / (evaluation / 2));\n\t\t\t}\n\n\t\t\treturn baseEvaluations;\n\t\t}\n\t})\n);\n\nexport const pusherAlgorithm = createBotAlgorithm(\n\tcreateRandomBasedAlgorithm({\n\t\tstringifiedType: ZombieType.Pusher,\n\t\tevaluate(moves, board): Map<MoveComponent, number> {\n\t\t\tconst baseEvaluations = randoBotAlgorithm.evaluate.call(this, moves, board);\n\n\t\t\tfor (const [move, evaluation] of baseEvaluations) {\n\t\t\t\tif (!verifyStandardMove(move)) continue;\n\t\t\t\tconst pieceString = board.board[move.startCoordinates[0]][move.startCoordinates[1]];\n\t\t\t\tif (pieceString.isPiece() && !pieceControlConfigSettings[pieceString.piece].moveGenerationSettings.isPawn) {\n\t\t\t\t\tbaseEvaluations.set(move, evaluation / (evaluation / 2));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn baseEvaluations;\n\t\t}\n\t})\n);\n","import { Board } from \"@moveGeneration/Board/Board\";\nimport { Move, MoveComponent } from \"@moveGeneration/MoveTree/MoveTreeInterface\";\n\nexport enum ZombieType {\n\tRando = \"rando\",\n\tFuter = \"comfuter\",\n\tRanter = \"ranter\",\n\tPatzer = \"patzer\",\n\tPusher = \"pusher\",\n\tChecker = \"checker\",\n\tMuncher = \"muncher\",\n\tF_Pusher = \"pusher_comfuter\",\n\tF_Checker = \"checker_comfuter\",\n\tF_Muncher = \"muncher_comfuter\"\n}\n\nexport const verifyZombieType = (zombieType: string): zombieType is ZombieType => zombieType in ZombieType;\n\nexport interface ZombieMoveGenerationAlgorithm {\n\treadonly stringifiedType: ZombieType;\n\tevaluate(moves: MoveComponent[], board: Board): Map<MoveComponent, number>;\n\tpickPreferredMove(evaluations: Map<MoveComponent, number>): Move;\n}\n\nexport const botAlgorithms = new Map<ZombieType, ZombieMoveGenerationAlgorithm>();\n\nexport function createBotAlgorithm(algorithm: ZombieMoveGenerationAlgorithm) {\n\tbotAlgorithms.set(algorithm.stringifiedType, algorithm);\n\treturn algorithm;\n}\n","import { Board } from \"@moveGeneration/Board/Board\";\nimport { InsufficientMaterialConstructor, InsufficientMaterialState } from \"./InsufficientMaterialConstructor\";\nimport { Tuple, assertNonUndefined, createTuple, createTupleFromCallback } from \"@client/ts/baseTypes\";\nimport { colors, totalPlayers } from \"@moveGeneration/GameInformation/GameData\";\nimport { Coordinate, NumericColor } from \"@moveGeneration/GameInformation/GameUnits/GameUnits\";\nimport { stalemateOptionsValues } from \"../../FENDataDecorators/StalemateOptions\";\nimport { pieceControlConfigSettings, verifyPieceLetter } from \"@moveGeneration/PieceControl/PieceControlInterface\";\nimport { disabledRank } from \"../../PieceControlDecorators/PromotionRank\";\nimport { compareCoordinates } from \"@moveGeneration/Board/BoardInterface\";\n\nexport class InsufficientMaterialChecker {\n\tprivate readonly noRoyalsToMate: boolean = false;\n\tprivate readonly isDisabled: boolean = false;\n\tprivate readonly promotionPieces;\n\tprivate readonly hasPromotion;\n\n\tconstructor(readonly state: InsufficientMaterialState, board: Board) {\n\t\tfor (const variantRule of board.variantRules) {\n\t\t\tconst { isDisabled, isPartiallyDisabled } = variantRule.getInsufficientMaterialData();\n\t\t\tif (isDisabled) {\n\t\t\t\tthis.isDisabled = true;\n\t\t\t\tbreak;\n\t\t\t} else if (isPartiallyDisabled) this.noRoyalsToMate = true;\n\t\t}\n\t\tthis.hasPromotion = board.variantData.promotionRank !== disabledRank;\n\t\tthis.promotionPieces = board.variantData.promotionPieces || [];\n\t}\n\n\tprivate getRoyalPieceMedians(board: Board) {\n\t\tconst { walls, royalMoveMedians } = this.state,\n\t\t\troyal = board.data.fenOptions.tag(\"royal\"),\n\t\t\tvariantData = board.variantData,\n\t\t\tboardSquares = board.board;\n\t\tconst extraWalls = boardSquares.reduce((accumulator, row, i) => {\n\t\t\treturn (\n\t\t\t\taccumulator +\n\t\t\t\trow.reduce((accumulator, square, j) => {\n\t\t\t\t\tif (square.isWall() && !walls[i][j]) {\n\t\t\t\t\t\treturn accumulator + 1;\n\t\t\t\t\t} else return accumulator;\n\t\t\t\t}, 0)\n\t\t\t);\n\t\t}, 0);\n\n\t\treturn royalMoveMedians.map((median, i) => {\n\t\t\tif (!royal[i]) return;\n\n\t\t\tlet minimumMedian: number;\n\t\t\tif (variantData.stalemateOptions === stalemateOptionsValues.stalemateLoses) {\n\t\t\t\tminimumMedian = 1;\n\t\t\t\tmedian--;\n\t\t\t} else {\n\t\t\t\tmedian++;\n\t\t\t\tminimumMedian = 2;\n\t\t\t}\n\n\t\t\tmedian -= extraWalls;\n\t\t\tif (median < minimumMedian) median = minimumMedian;\n\n\t\t\treturn median;\n\t\t});\n\t}\n\n\tprivate obtainPieceSymbolFromCoordinate(board: Board, coordinate: Coordinate) {\n\t\tconst { optimizedPieces, pieceSquareMedians, backwardsPieceRegistry } = this.state;\n\t\tconst piece = board.board[coordinate[0]][coordinate[1]];\n\t\tif (pieceControlConfigSettings[piece.piece].moveGenerationSettings.isPawn && this.hasPromotion) {\n\t\t\tconst availableSymbols = [...optimizedPieces]\n\t\t\t\t.filter((p) => verifyPieceLetter(p) && !pieceControlConfigSettings[p].moveGenerationSettings.isPawn)\n\t\t\t\t.map((p) => pieceSquareMedians[p]);\n\t\t\tif (availableSymbols.length === 0) {\n\t\t\t\treturn { selectedSymbol: InsufficientMaterialConstructor.NON_INDEXED_PIECE_SYMBOL, piece };\n\t\t\t} else {\n\t\t\t\tconst candidates = availableSymbols.map((s) => {\n\t\t\t\t\treturn s[Object.getOwnPropertySymbols(s)[0]].reduce<number>((p, n) => p + (n ?? 0), 0);\n\t\t\t\t});\n\t\t\t\tconst candidateIndex = candidates.indexOf(Math.max(...candidates));\n\t\t\t\tconst symbol = Object.getOwnPropertySymbols(availableSymbols[candidateIndex])[0];\n\t\t\t\treturn {\n\t\t\t\t\tselectedSymbol: symbol,\n\t\t\t\t\tpiece\n\t\t\t\t};\n\t\t\t}\n\t\t} else {\n\t\t\tconst availableSymbols = Object.getOwnPropertySymbols(pieceSquareMedians[piece.piece]);\n\t\t\tconst selectedSymbol =\n\t\t\t\tavailableSymbols.length === 1 ? availableSymbols[0] : backwardsPieceRegistry[piece.piece][coordinate[0]][coordinate[1]];\n\t\t\tassertNonUndefined(selectedSymbol);\n\n\t\t\treturn { selectedSymbol, piece };\n\t\t}\n\t}\n\n\tprivate getPartialIntersection(parameters: {\n\t\tboard: Board;\n\t\tarmy: Coordinate[];\n\t\tpieces: Tuple<Coordinate[], typeof totalPlayers>;\n\t\troyalColor: NumericColor;\n\t}) {\n\t\tconst { pieceSquareMedians } = this.state,\n\t\t\t{ board, army, pieces, royalColor } = parameters;\n\t\tfor (const coordinate of army) {\n\t\t\tconst { piece, selectedSymbol } = this.obtainPieceSymbolFromCoordinate(board, coordinate);\n\t\t\tconst symbolsLength = Object.getOwnPropertySymbols(pieceSquareMedians[piece.piece]).length;\n\t\t\tif (symbolsLength > 1 || pieceControlConfigSettings[piece.piece].moveGenerationSettings.isColorBound) {\n\t\t\t\tfor (const enemyCoordinate of pieces[royalColor]) {\n\t\t\t\t\tconst { selectedSymbol: enemySymbol } = this.obtainPieceSymbolFromCoordinate(board, enemyCoordinate);\n\t\t\t\t\tif (selectedSymbol === enemySymbol) return Infinity;\n\t\t\t\t}\n\t\t\t} else return Infinity;\n\t\t}\n\n\t\treturn -1;\n\t}\n\n\tcheckCurrentState(board: Board) {\n\t\tconst fenOptions = board.data.fenOptions;\n\t\tconst dead = fenOptions.tag(\"dead\"),\n\t\t\troyal = fenOptions.tag(\"royal\");\n\t\tconst pieces = board.getPlayerPieces(),\n\t\t\tresultingInsufficientPieces = createTuple(false, totalPlayers);\n\t\tif (this.isDisabled) return resultingInsufficientPieces;\n\n\t\tconst royalPieceMedians = this.getRoyalPieceMedians(board),\n\t\t\t{ oppositionMedians, pieceSquareMedians } = this.state;\n\t\tconst squaresPlayerCanOutrange = createTupleFromCallback(() => createTuple(0, totalPlayers), totalPlayers);\n\t\tfor (const color of colors) {\n\t\t\tconst army = pieces[color];\n\t\t\tif (dead[color]) continue;\n\t\t\tfor (const royalColor of colors) {\n\t\t\t\tif (color === royalColor || dead[royalColor]) continue;\n\t\t\t\tif (!royal[royalColor] || this.noRoyalsToMate) {\n\t\t\t\t\tsquaresPlayerCanOutrange[royalColor][color] = this.getPartialIntersection({ board, army, pieces, royalColor });\n\t\t\t\t} else {\n\t\t\t\t\tconst royalSquares = royalPieceMedians[royalColor];\n\t\t\t\t\tif (royalSquares === undefined) continue;\n\t\t\t\t\tconst fenRoyal = royal[color],\n\t\t\t\t\t\tcurrentColorBounds: symbol[] = [];\n\t\t\t\t\tfor (const coordinate of army) {\n\t\t\t\t\t\tif (fenRoyal && compareCoordinates(coordinate, fenRoyal)) {\n\t\t\t\t\t\t\tif (board.variantData.royalsCannotCapture) {\n\t\t\t\t\t\t\t\tsquaresPlayerCanOutrange[color][royalColor]++;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tsquaresPlayerCanOutrange[color][royalColor] += oppositionMedians[color][royalColor];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconst { piece, selectedSymbol } = this.obtainPieceSymbolFromCoordinate(board, coordinate);\n\t\t\t\t\t\t\tif (this.hasPromotion && pieceControlConfigSettings[piece.piece].moveGenerationSettings.isPawn) {\n\t\t\t\t\t\t\t\tconst medians = this.promotionPieces.map((piece) => {\n\t\t\t\t\t\t\t\t\tconst subSymbol = Object.getOwnPropertySymbols(pieceSquareMedians[piece])[0];\n\t\t\t\t\t\t\t\t\treturn pieceSquareMedians[piece][subSymbol][royalColor] ?? 0;\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\tsquaresPlayerCanOutrange[color][royalColor] += Math.max(...medians);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tif (pieceControlConfigSettings[piece.piece].moveGenerationSettings.isColorBound) {\n\t\t\t\t\t\t\t\t\tif (currentColorBounds.includes(selectedSymbol)) continue;\n\t\t\t\t\t\t\t\t\tcurrentColorBounds.push(selectedSymbol);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tsquaresPlayerCanOutrange[color][royalColor] += pieceSquareMedians[piece.piece][selectedSymbol][royalColor] ?? 0;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tsquaresPlayerCanOutrange[color][royalColor] += pieces[royalColor].length - 1;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfor (const color of colors) {\n\t\t\tif (dead[color]) continue;\n\t\t\tlet sum = 0;\n\t\t\tfor (let i = 0; i < totalPlayers; i++) {\n\t\t\t\tif (i === color) continue;\n\t\t\t\tsum += squaresPlayerCanOutrange[i][color];\n\t\t\t}\n\n\t\t\tconst royal = royalPieceMedians[color];\n\t\t\tif ((royal !== undefined && sum <= royal) || sum < 0) resultingInsufficientPieces[color] = true;\n\t\t}\n\t\treturn resultingInsufficientPieces;\n\t}\n}\n","import { Tuple, createTuple, createTupleFromCallback } from \"@client/ts/baseTypes\";\nimport { BoardSquares, initializeBoardSquares } from \"@client/ts/logic/BaseInterfaces\";\nimport { Board, baseImmunes } from \"@moveGeneration/Board/Board\";\nimport { boardDimension, colors, totalPlayers } from \"@moveGeneration/GameInformation/GameData\";\nimport { PieceString, createPieceFromData, emptyPieceString } from \"@moveGeneration/GameInformation/GameUnits/PieceString\";\nimport {\n\tPieceLetter,\n\tdefaultPieces,\n\tgrasshopperPieceLetter,\n\tpieceControlConfigSettings,\n\tverifyPieceLetter\n} from \"@moveGeneration/PieceControl/PieceControlInterface\";\nimport { binaryMasks, findMinimumOnBoardSquares, oneBitMask, optimizePieceSet } from \"./Utilities\";\nimport { disabledRank } from \"../../PieceControlDecorators/PromotionRank\";\nimport { stringifyCoordinate } from \"@moveGeneration/Board/BoardInterface\";\nimport { bitCount } from \"@utils/NumberUtils\";\nimport { PieceMedianCounterReturnType } from \"./PieceMedianCounter\";\n\nexport interface InsufficientMaterialState {\n\treadonly walls: BoardSquares<boolean>;\n\treadonly backwardsPieceRegistry: Record<PieceLetter, BoardSquares<symbol | null>>;\n\treadonly pieceSquareMedians: Record<PieceLetter, Record<symbol, Tuple<number | undefined, typeof totalPlayers>>>;\n\treadonly royalMoveMedians: Tuple<number, typeof totalPlayers>;\n\treadonly optimizedPieces: Set<PieceLetter>;\n\toppositionMedians: Tuple<Tuple<number, typeof totalPlayers>, typeof totalPlayers>;\n}\n\nexport class InsufficientMaterialConstructor {\n\tstatic readonly NON_INDEXED_PIECE_SYMBOL = Symbol();\n\tprivate readonly board: Board;\n\tprivate readonly emptyBoard: BoardSquares<PieceString>;\n\tprivate readonly pieceMoveRegistry: Record<PieceLetter, Record<symbol, BoardSquares<Uint16Array>>> = {};\n\tprivate readonly possibleRoyals = createTupleFromCallback<string[], typeof totalPlayers>(() => [], totalPlayers);\n\tprivate readonly boardDestinations = new Map<PieceLetter, Uint16Array[]>();\n\tprivate readonly royalPieceSets = createTupleFromCallback(() => new Set<string>(), totalPlayers);\n\treadonly state: InsufficientMaterialState;\n\n\tconstructor(board: Board, readonly callback: (state: InsufficientMaterialState) => void) {\n\t\tthis.board = board.createClone();\n\t\tthis.emptyBoard = this.board.board.map((row) => row.map((square) => (square.isWall() ? square : emptyPieceString)));\n\t\tthis.state = {\n\t\t\twalls: this.emptyBoard.map((row) => row.map((square) => square.isWall())),\n\t\t\tbackwardsPieceRegistry: {},\n\t\t\troyalMoveMedians: createTuple(0, totalPlayers),\n\t\t\tpieceSquareMedians: {\n\t\t\t\t[grasshopperPieceLetter]: {\n\t\t\t\t\t[InsufficientMaterialConstructor.NON_INDEXED_PIECE_SYMBOL]: [2, 2, 2, 2]\n\t\t\t\t}\n\t\t\t},\n\t\t\toptimizedPieces: optimizePieceSet(this.board.variantData.promotionPieces || [], true),\n\t\t\toppositionMedians: createTupleFromCallback(() => createTuple(0, totalPlayers), totalPlayers)\n\t\t};\n\t}\n\n\tprivate initializeRoyals() {\n\t\tconst boardSquares = this.board.board,\n\t\t\tpromotionPieces = this.board.variantData.promotionPieces || [];\n\t\tthis.board.data.fenOptions.tag(\"royal\").forEach((royal, color) => {\n\t\t\tif (royal) {\n\t\t\t\tconst piece = boardSquares[royal[0]][royal[1]].piece;\n\t\t\t\tif (pieceControlConfigSettings[piece].moveGenerationSettings.isPawn) {\n\t\t\t\t\tthis.possibleRoyals[color] = [piece, ...promotionPieces];\n\t\t\t\t} else this.possibleRoyals[color] = [piece];\n\t\t\t} else if (promotionPieces.includes(defaultPieces.king)) {\n\t\t\t\tthis.possibleRoyals[color] = [defaultPieces.king];\n\t\t\t}\n\t\t});\n\n\t\tfor (const color of colors) {\n\t\t\tif (this.possibleRoyals[color].length > 1) {\n\t\t\t\tthis.royalPieceSets[color] = optimizePieceSet(this.possibleRoyals[color], false);\n\t\t\t} else if (this.possibleRoyals[color].length === 1) {\n\t\t\t\tthis.royalPieceSets[color].add(this.possibleRoyals[color][0]);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate recurseThroughSquares(i: number, j: number, piece: PieceString) {\n\t\tconst {\n\t\t\temptyBoard,\n\t\t\tboard: { controls },\n\t\t\tpieceMoveRegistry\n\t\t} = this;\n\t\tconst currentSquares = new Set<string>(),\n\t\t\tunvisitedSquares = new Set<string>();\n\t\tif (!piece.isPiece()) throw new TypeError(`Wrong piece signature detected at ${piece.value}`);\n\t\tconst baseBuilder = controls[piece.piece]().setColor(piece.color).setBoard(emptyBoard).setBaseImmunePieces(baseImmunes);\n\t\tconst registryResult = initializeBoardSquares(() => new Uint16Array(boardDimension).fill(oneBitMask));\n\n\t\tfunction recurse(x: number, y: number) {\n\t\t\tconst control = baseBuilder.setCoordinates(x, y).constructPieceControl();\n\t\t\tconst moves = control.getPseudoLegalMoves(),\n\t\t\t\tmoveLength = moves.length;\n\t\t\tif (moveLength === 0) return;\n\n\t\t\tfor (let i = 0; i < moveLength; i++) {\n\t\t\t\tconst move = moves[i].move;\n\t\t\t\tconst moveString = stringifyCoordinate(move);\n\t\t\t\tregistryResult[x][y][move[0]] |= binaryMasks[move[1]];\n\t\t\t\tif (!currentSquares.has(moveString)) {\n\t\t\t\t\tunvisitedSquares.add(moveString);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor (const value of unvisitedSquares) {\n\t\t\t\tconst [x, y] = value.split(\":\");\n\t\t\t\tif (!currentSquares.has(value)) {\n\t\t\t\t\tcurrentSquares.add(value);\n\t\t\t\t\trecurse(parseInt(x, 10), parseInt(y, 10));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\trecurse(i, j);\n\t\tif (!(piece.piece in pieceMoveRegistry)) pieceMoveRegistry[piece.piece] = {};\n\t\tpieceMoveRegistry[piece.piece][Symbol()] = registryResult;\n\n\t\tconst permutations = new Uint16Array(14).fill(oneBitMask);\n\t\tcurrentSquares.forEach((value) => {\n\t\t\tconst valueArr = value.split(\":\");\n\t\t\tpermutations[parseInt(valueArr[0], 10)] |= binaryMasks[parseInt(valueArr[1], 10)];\n\t\t});\n\t\tunvisitedSquares.forEach((value) => {\n\t\t\tconst valueArr = value.split(\":\");\n\t\t\tpermutations[parseInt(valueArr[0], 10)] |= binaryMasks[parseInt(valueArr[1], 10)];\n\t\t});\n\n\t\treturn permutations;\n\t}\n\n\tprivate addToBoardDestinations(i: number, j: number, piece: PieceString) {\n\t\tconst permutations = this.recurseThroughSquares(i, j, piece);\n\n\t\tconst boardPiece = this.boardDestinations.get(piece.piece);\n\t\tif (boardPiece) {\n\t\t\tthis.boardDestinations.set(piece.piece, boardPiece.concat(permutations));\n\t\t} else {\n\t\t\tthis.boardDestinations.set(piece.piece, [permutations]);\n\t\t}\n\t}\n\n\tprivate getBoardDestinations() {\n\t\tconst boardSquares = this.board.board,\n\t\t\tpromotionRank = this.board.variantData.promotionRank || disabledRank,\n\t\t\tpromotionPieces = this.board.variantData.promotionPieces || [];\n\t\tfor (let i = 0; i < boardDimension; i++) {\n\t\t\tfor (let j = 0; j < boardDimension; j++) {\n\t\t\t\tif (boardSquares[i][j].isPiece()) this.addToBoardDestinations(i, j, boardSquares[i][j]);\n\t\t\t}\n\t\t}\n\n\t\tconst hasPromotion = promotionRank !== disabledRank && promotionPieces.some((p) => verifyPieceLetter(p));\n\t\tconst promotionRanks = [boardDimension - promotionRank, promotionRank - 1, promotionRank - 1, boardDimension - promotionRank];\n\t\tconst optimizedPieces = optimizePieceSet(promotionPieces, true);\n\t\tif (hasPromotion) {\n\t\t\tfor (let color of colors) {\n\t\t\t\tcolor &= 1;\n\t\t\t\tfor (let x = 0; x < boardDimension; x++) {\n\t\t\t\t\tconst [i, j] = [color ? promotionRanks[color] : x, color ? x : promotionRanks[color]];\n\t\t\t\t\tif (this.state.walls[i][j]) continue;\n\t\t\t\t\tfor (const piece of optimizedPieces) {\n\t\t\t\t\t\tthis.addToBoardDestinations(i, j, createPieceFromData(0, piece));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate initializeBackwardsPieceRegistry() {\n\t\tconst entries = this.boardDestinations.entries(),\n\t\t\t{\n\t\t\t\tstate: { backwardsPieceRegistry },\n\t\t\t\tpieceMoveRegistry\n\t\t\t} = this;\n\t\tfor (const [entry, uintArray] of entries) {\n\t\t\tif (pieceControlConfigSettings[entry].moveGenerationSettings.isPawn || entry === grasshopperPieceLetter || !verifyPieceLetter(entry))\n\t\t\t\tcontinue;\n\t\t\tlet isAlwaysIntersecting = true;\n\t\t\tconst permutationArray: Array<number | Uint16Array> = [];\n\n\t\t\tfor (const permutationEntry of uintArray) {\n\t\t\t\tif (permutationArray.length === 0) {\n\t\t\t\t\tpermutationArray.push(permutationEntry);\n\t\t\t\t} else {\n\t\t\t\t\tconst index = permutationArray.findIndex((uintArr) => {\n\t\t\t\t\t\tif (typeof uintArr !== \"number\") return uintArr.every((n, j) => n === permutationEntry[j]);\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t});\n\t\t\t\t\tif (~index) {\n\t\t\t\t\t\tpermutationArray.push(index);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tpermutationArray.push(permutationEntry);\n\t\t\t\t\t\tisAlwaysIntersecting = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (isAlwaysIntersecting) {\n\t\t\t\tpieceMoveRegistry[entry] = {\n\t\t\t\t\t[Symbol()]: pieceMoveRegistry[entry][Object.getOwnPropertySymbols(pieceMoveRegistry[entry])[0]]\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\tif (!(entry in backwardsPieceRegistry)) {\n\t\t\t\t\tbackwardsPieceRegistry[entry] = initializeBoardSquares(() => null);\n\t\t\t\t}\n\n\t\t\t\tconst remappedSymbols: Array<symbol | number> = [];\n\t\t\t\tfor (const squares of permutationArray) {\n\t\t\t\t\tlet remappedSymbol: symbol | undefined;\n\t\t\t\t\tif (typeof squares === \"number\") {\n\t\t\t\t\t\tremappedSymbols.push(squares);\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tfor (let i = 0; i < boardDimension; i++) {\n\t\t\t\t\t\tfor (let j = 0; j < boardDimension; j++) {\n\t\t\t\t\t\t\tif ((squares[i] & binaryMasks[j]) ^ oneBitMask) {\n\t\t\t\t\t\t\t\tif (!remappedSymbol) {\n\t\t\t\t\t\t\t\t\tremappedSymbol = Symbol();\n\t\t\t\t\t\t\t\t\tremappedSymbols.push(remappedSymbol);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tthis.state.backwardsPieceRegistry[entry][i][j] ??= remappedSymbol;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst uintValues = Object.getOwnPropertySymbols(pieceMoveRegistry[entry]).map((sym) => pieceMoveRegistry[entry][sym]);\n\t\t\t\tpieceMoveRegistry[entry] = {};\n\t\t\t\tfor (let i = 0; i < uintValues.length; i++) {\n\t\t\t\t\tconst remapped = remappedSymbols[i];\n\t\t\t\t\tif (typeof remapped === \"number\") continue;\n\t\t\t\t\tif (typeof remapped === \"undefined\") break;\n\t\t\t\t\tpieceMoveRegistry[entry][remapped] = uintValues[i];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate generateOppositionSquares() {\n\t\tconst boardSquares = this.board.board,\n\t\t\tcontrols = this.board.controls,\n\t\t\t{ emptyBoard } = this;\n\t\tconst royalMoves = createTuple<BoardSquares<Uint16Array>, typeof totalPlayers>(\n\t\t\tinitializeBoardSquares(() => new Uint16Array(boardDimension).fill(oneBitMask)),\n\t\t\ttotalPlayers\n\t\t);\n\t\tconst oppositionRowEchelon = createTuple<BoardSquares<Uint16Array> | undefined, typeof totalPlayers>(undefined, totalPlayers);\n\n\t\tthis.board.data.fenOptions.tag(\"royal\").forEach((royal, color) => {\n\t\t\tif (!royal) return;\n\t\t\tconst royalPiece = boardSquares[royal[0]][royal[1]];\n\t\t\tconst controlBuilder = controls[royalPiece.piece];\n\t\t\tconst builder = controlBuilder().setColor(0).setBaseImmunePieces(baseImmunes).setBoard(emptyBoard);\n\t\t\tconst finalArray = initializeBoardSquares(() => new Uint16Array(14).fill(oneBitMask));\n\t\t\tfor (let i = 0; i < boardSquares.length; i++) {\n\t\t\t\tfor (let j = 0; j < boardSquares[0].length; j++) {\n\t\t\t\t\tif (emptyBoard[i][j].isWall()) continue;\n\t\t\t\t\tconst control = builder.setCoordinates(i, j).constructPieceControl();\n\t\t\t\t\tconst moves = control.getPseudoLegalMoves();\n\t\t\t\t\tconst permutationArray = new Uint16Array(boardDimension).fill(oneBitMask);\n\t\t\t\t\tfor (const { move } of moves) permutationArray[move[0]] |= binaryMasks[move[1]];\n\t\t\t\t\tfinalArray[i][j] = permutationArray;\n\t\t\t\t\troyalMoves[color][i][j] = permutationArray;\n\t\t\t\t}\n\t\t\t}\n\t\t\toppositionRowEchelon[color] = finalArray;\n\t\t});\n\n\t\tfor (const color of colors) {\n\t\t\tthis.state.royalMoveMedians[color] = findMinimumOnBoardSquares(royalMoves[color]);\n\t\t}\n\t\treturn { oppositionRowEchelon, royalMoves };\n\t}\n\n\tprivate generateOppositeMedians(rowEchelon: Tuple<BoardSquares<Uint16Array> | undefined, typeof totalPlayers>) {\n\t\tconst {\n\t\t\t\temptyBoard,\n\t\t\t\tstate: { oppositionMedians }\n\t\t\t} = this,\n\t\t\troyals = this.board.data.fenOptions.tag(\"royal\");\n\t\tfor (let i = 0; i < totalPlayers; i++) {\n\t\t\tfor (let j = 0; j < totalPlayers; j++) {\n\t\t\t\tif (i === j || rowEchelon[i] === undefined) continue;\n\t\t\t\tconst royalPieceA = royals[i],\n\t\t\t\t\troyalPieceB = royals[j];\n\t\t\t\tif (!royalPieceA || !royalPieceB) continue;\n\t\t\t\tconst finalArray = Array.from({ length: 14 }, () => Array.from({ length: 14 }, () => 0));\n\t\t\t\tfor (let i2 = 0; i2 < boardDimension; i2++) {\n\t\t\t\t\tfor (let j2 = 0; j2 < boardDimension; j2++) {\n\t\t\t\t\t\tif (emptyBoard[i2][j2].isWall()) continue;\n\t\t\t\t\t\tconst jjIndex = rowEchelon[j];\n\t\t\t\t\t\tconst iiIndex = rowEchelon[i];\n\t\t\t\t\t\tif (!jjIndex || !iiIndex)\n\t\t\t\t\t\t\tthrow new Error(\n\t\t\t\t\t\t\t\t`Central opposition matrix indexes are undefined: ${jjIndex?.toString() ?? \"undefined\"}  ${\n\t\t\t\t\t\t\t\t\tiiIndex?.toString() ?? \"undefined\"\n\t\t\t\t\t\t\t\t}`\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t(jjIndex[i2][j2][royalPieceA[1]] & binaryMasks[royalPieceA[0]]) ^ oneBitMask &&\n\t\t\t\t\t\t\t(iiIndex[i2][j2][royalPieceB[1]] & binaryMasks[royalPieceB[0]]) ^ oneBitMask\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst uintArray = jjIndex[i2][j2].map((e, x) => e & iiIndex[i2][j2][x]);\n\t\t\t\t\t\tlet newResultingSquares = 0;\n\t\t\t\t\t\tfor (let dimSquare = 0; dimSquare < boardDimension; dimSquare++) {\n\t\t\t\t\t\t\tnewResultingSquares += bitCount(uintArray[dimSquare]) - 1;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tfinalArray[i2][j2] = newResultingSquares;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tlet minimum = Infinity;\n\t\t\t\tfor (let i2 = 0; i2 < boardDimension; i2++) {\n\t\t\t\t\tfor (let j2 = 0; j2 < boardDimension; j2++) {\n\t\t\t\t\t\tif (finalArray[i2][j2] !== 0 && finalArray[i2][j2] < minimum) {\n\t\t\t\t\t\t\tminimum = finalArray[i2][j2];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\toppositionMedians[i][j] = minimum - 1;\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate generatePieceMoveMedians(royalMoves: Tuple<BoardSquares<Uint16Array>, typeof totalPlayers>) {\n\t\tconst {\n\t\t\tpieceMoveRegistry,\n\t\t\tstate: { pieceSquareMedians, walls },\n\t\t\troyalPieceSets\n\t\t} = this;\n\t\tlet currentMessages = 0,\n\t\t\trequiredMessages = 0;\n\t\tfor (const pieceLetter in pieceMoveRegistry) {\n\t\t\tif (!verifyPieceLetter(pieceLetter) || !Object.prototype.hasOwnProperty.call(pieceMoveRegistry, pieceLetter)) continue;\n\t\t\tif (pieceLetter in pieceSquareMedians) continue;\n\t\t\tpieceSquareMedians[pieceLetter] = {};\n\t\t\tconst registeredSymbols = Object.getOwnPropertySymbols(pieceMoveRegistry[pieceLetter]);\n\t\t\tfor (const registeredSymbol of registeredSymbols) {\n\t\t\t\tconst pieceMedianCounter = new Worker(new URL(\"./PieceMedianCounter.ts\", import.meta.url));\n\t\t\t\tpieceMedianCounter.postMessage({\n\t\t\t\t\twalls,\n\t\t\t\t\tmoveRegistryArray: pieceMoveRegistry[pieceLetter][registeredSymbol].map((r) => r.map((uint) => uint.buffer)),\n\t\t\t\t\troyalMoves: royalMoves.map((board) => board.map((r) => r.map((uint) => uint.buffer))),\n\t\t\t\t\troyalPieceSet: royalPieceSets.map((s) => [...s])\n\t\t\t\t});\n\t\t\t\trequiredMessages++;\n\t\t\t\tpieceMedianCounter.onmessage = (e: MessageEvent<PieceMedianCounterReturnType>) => {\n\t\t\t\t\tpieceSquareMedians[pieceLetter][registeredSymbol] = e.data;\n\t\t\t\t\tpieceMedianCounter.terminate();\n\t\t\t\t\tif (requiredMessages === ++currentMessages) {\n\t\t\t\t\t\tthis.callback(this.state);\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t}\n\n\tgenerateInsufficientMaterialState() {\n\t\tthis.initializeRoyals();\n\t\tthis.getBoardDestinations();\n\t\tthis.initializeBackwardsPieceRegistry();\n\t\tconst { royalMoves, oppositionRowEchelon } = this.generateOppositionSquares();\n\t\tthis.generateOppositeMedians(oppositionRowEchelon);\n\t\tthis.generatePieceMoveMedians(royalMoves);\n\t}\n}\n","import { createTupleFromCallback, Tuple } from \"@client/ts/baseTypes\";\nimport { BoardSquares, initializeBoardSquares } from \"@client/ts/logic/BaseInterfaces\";\nimport { boardDimension, colors, totalPlayers } from \"@moveGeneration/GameInformation/GameData\";\nimport type { PieceLetter } from \"@moveGeneration/PieceControl/PieceControlInterface\";\nimport { countMinimumOf2DArrayExcludingZero } from \"@client/ts/utils/ArrayUtils\";\nimport { countBitsOnBoard } from \"./Utilities\";\n\nexport type PieceMedianCounterReturnType = Tuple<number | undefined, typeof totalPlayers>;\ninterface PieceMedianCounterSettings {\n\twalls: BoardSquares<boolean>;\n\tmoveRegistryArray: ArrayBufferLike[][];\n\troyalPieceSet: Tuple<PieceLetter[], typeof totalPlayers>;\n\troyalMoves: Tuple<ArrayBufferLike[][], typeof totalPlayers>;\n}\n\nself.onmessage = (e: MessageEvent<PieceMedianCounterSettings>) => {\n\tconst { walls, royalPieceSet, royalMoves, moveRegistryArray } = e.data;\n\tconst resultingMedianArray = createTupleFromCallback<BoardSquares<number> | undefined, typeof totalPlayers>(\n\t\t() => initializeBoardSquares(() => 0),\n\t\ttotalPlayers\n\t);\n\tfor (let i = 0; i < boardDimension; i++) {\n\t\tfor (let j = 0; j < boardDimension; j++) {\n\t\t\tif (walls[i][j]) continue;\n\t\t\tconst moves = new Uint16Array(moveRegistryArray[i][j]);\n\t\t\tfor (const color of colors) {\n\t\t\t\tif (royalPieceSet[color].length === 0) {\n\t\t\t\t\tresultingMedianArray[color] = undefined;\n\t\t\t\t\tcontinue;\n\t\t\t\t} else {\n\t\t\t\t\tlet resultingSquares = 0;\n\t\t\t\t\tfor (let royalI = 0; royalI < boardDimension; royalI++) {\n\t\t\t\t\t\tfor (let royalJ = 0; royalJ < boardDimension; royalJ++) {\n\t\t\t\t\t\t\tconst royalMoveSet = new Uint16Array(royalMoves[color][royalI][royalJ]);\n\t\t\t\t\t\t\tconst result = moves.map((e, x) => e & royalMoveSet[x]);\n\t\t\t\t\t\t\tconst newResultingSquares = countBitsOnBoard(result);\n\n\t\t\t\t\t\t\tif (newResultingSquares > resultingSquares) {\n\t\t\t\t\t\t\t\tresultingSquares = newResultingSquares;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tconst resultingMedian = resultingMedianArray[color];\n\t\t\t\t\tif (resultingMedian) resultingMedian[i][j] = resultingSquares;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tpostMessage(\n\t\tresultingMedianArray.map((arr) => {\n\t\t\tif (arr) {\n\t\t\t\tconst minimum = countMinimumOf2DArrayExcludingZero(arr);\n\t\t\t\treturn minimum === Infinity ? 0 : minimum;\n\t\t\t} else return arr;\n\t\t})\n\t);\n};\n","import type { PieceLetter } from \"@moveGeneration/PieceControl/PieceControlInterface\";\nimport type { InsufficientMaterialState } from \"./InsufficientMaterialConstructor\";\nimport type { BoardSquares } from \"@client/ts/logic/BaseInterfaces\";\nimport type { ImplementInterface, Tuple } from \"@client/ts/baseTypes\";\nimport type { totalPlayers } from \"@moveGeneration/GameInformation/GameData\";\n\ninterface SerializedInsufficientMaterialDraft {\n\treadonly backwardsPieceRegistry: Record<PieceLetter, BoardSquares<number | null>>;\n\treadonly optimizedPieces: PieceLetter[];\n\treadonly pieceSquareMedians: Record<PieceLetter, Record<number, Tuple<number | undefined, typeof totalPlayers>>>;\n}\nexport type SerializedInsufficientMaterialState = ImplementInterface<InsufficientMaterialState, SerializedInsufficientMaterialDraft>;\n\nexport function serializeInsufficientMaterialState(state: InsufficientMaterialState): SerializedInsufficientMaterialState {\n\tconst backwardsPieceRegistry: Record<PieceLetter, BoardSquares<number | null>> = {};\n\tconst counters: Record<symbol, number> = {};\n\n\tlet individualCounter = 0;\n\tlet key: PieceLetter;\n\tfor (key in state.backwardsPieceRegistry) {\n\t\tif (!Object.prototype.hasOwnProperty.call(state.backwardsPieceRegistry, key)) continue;\n\t\tbackwardsPieceRegistry[key] = state.backwardsPieceRegistry[key].map((r) =>\n\t\t\tr.map((e) => {\n\t\t\t\tif (e !== null) {\n\t\t\t\t\tif (e in counters) {\n\t\t\t\t\t\treturn counters[e];\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcounters[e] = individualCounter++;\n\t\t\t\t\t\treturn counters[e];\n\t\t\t\t\t}\n\t\t\t\t} else return e;\n\t\t\t})\n\t\t);\n\t}\n\n\tconst pieceSquareMedians: Record<PieceLetter, Record<number, Tuple<number | undefined, typeof totalPlayers>>> = {};\n\tfor (key in state.pieceSquareMedians) {\n\t\tif (!Object.prototype.hasOwnProperty.call(state.pieceSquareMedians, key)) continue;\n\t\tconst result: Record<number, Tuple<number | undefined, typeof totalPlayers>> = {};\n\t\tfor (const symbol of Object.getOwnPropertySymbols(state.pieceSquareMedians[key])) {\n\t\t\tif (symbol in counters) {\n\t\t\t\tresult[counters[symbol]] = state.pieceSquareMedians[key][symbol];\n\t\t\t} else result[individualCounter--] = state.pieceSquareMedians[key][symbol];\n\t\t}\n\t\tpieceSquareMedians[key] = result;\n\t}\n\n\treturn {\n\t\t...state,\n\t\tbackwardsPieceRegistry,\n\t\tpieceSquareMedians,\n\t\toptimizedPieces: [...state.optimizedPieces]\n\t};\n}\n\nexport function deserializeInsufficientMaterialState(state: SerializedInsufficientMaterialState): InsufficientMaterialState {\n\tconst backwardsPieceRegistry: Record<PieceLetter, BoardSquares<symbol | null>> = {};\n\tconst counters: Record<PieceLetter, Record<number, symbol>> = {};\n\tlet key: PieceLetter;\n\tfor (key in state.backwardsPieceRegistry) {\n\t\tif (!Object.prototype.hasOwnProperty.call(state.backwardsPieceRegistry, key)) continue;\n\t\tcounters[key] = {};\n\t\tbackwardsPieceRegistry[key] = state.backwardsPieceRegistry[key].map((r) =>\n\t\t\tr.map((e) => {\n\t\t\t\tif (e !== null) {\n\t\t\t\t\tif (!(e in counters[key])) counters[key][e] = Symbol();\n\t\t\t\t\treturn counters[key][e];\n\t\t\t\t} else return e;\n\t\t\t})\n\t\t);\n\t}\n\n\tconst pieceSquareMedians: Record<PieceLetter, Record<symbol, Tuple<number | undefined, typeof totalPlayers>>> = {};\n\tfor (key in state.pieceSquareMedians) {\n\t\tif (!Object.prototype.hasOwnProperty.call(state.pieceSquareMedians, key)) continue;\n\t\tconst result: Record<symbol, Tuple<number | undefined, typeof totalPlayers>> = {};\n\t\tfor (const numericKey in state.pieceSquareMedians[key]) {\n\t\t\tif (!Object.prototype.hasOwnProperty.call(state.pieceSquareMedians[key], numericKey)) continue;\n\t\t\tconst indexingNumber = Number(numericKey);\n\t\t\tif (key in counters && indexingNumber in counters[key]) {\n\t\t\t\tresult[counters[key][indexingNumber]] = state.pieceSquareMedians[key][indexingNumber];\n\t\t\t} else result[Symbol()] = state.pieceSquareMedians[key][indexingNumber];\n\t\t}\n\t\tpieceSquareMedians[key] = result;\n\t}\n\n\treturn {\n\t\t...state,\n\t\tbackwardsPieceRegistry,\n\t\tpieceSquareMedians,\n\t\toptimizedPieces: new Set(state.optimizedPieces)\n\t};\n}\n","import { boardDimension } from \"@moveGeneration/GameInformation/GameData\";\nimport { PieceLetter, verifyPieceLetter } from \"@moveGeneration/PieceControl/PieceControlInterface\";\nimport { bitCount } from \"@utils/NumberUtils\";\n\nexport const binaryMasks = Array(boardDimension)\n\t.fill(1)\n\t.map((v, i) => (v << boardDimension) | (v << (boardDimension - 1 - i)));\nexport const oneBitMask = 1 << boardDimension;\n\nexport function countBitsOnBoard(board: Uint16Array): number {\n\tlet setBits = 0;\n\tfor (let x = 0; x < boardDimension; x++) {\n\t\tsetBits += bitCount(board[x] ^ oneBitMask);\n\t}\n\n\treturn setBits;\n}\n\nexport function findMinimumOnBoardSquares(board: Uint16Array[][]): number {\n\tlet minimum = Infinity;\n\tfor (let i = 0; i < boardDimension; i++) {\n\t\tfor (let j = 0; j < boardDimension; j++) {\n\t\t\tconst setBits = countBitsOnBoard(board[i][j]);\n\t\t\tif (setBits !== 0 && setBits < minimum) {\n\t\t\t\tminimum = setBits;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn minimum;\n}\n\nexport function optimizePieceSet(possiblePieces: string[], maximumTarget: boolean): Set<PieceLetter> {\n\tconst optimalRoyalMoveSets = [\n\t\t[\"β\", \"W\", \"R\", \"E\", \"M\", \"Q\", \"D\", \"A\"],\n\t\t[\"γ\", \"F\", \"B\", \"H\", \"M\", \"Q\", \"D\", \"A\", \"Δ\"],\n\t\t[\"Y\", \"Z\"],\n\t\t[\"I\", \"J\"],\n\t\t[\"S\", \"T\"],\n\t\t[\"S\", \"Y\"],\n\t\t[\"I\", \"Y\"],\n\t\t[\"U\", \"N\", \"O\"],\n\t\t[\"H\", \"A\"],\n\t\t[\"E\", \"A\"],\n\t\t[\"Δ\", \"H\"],\n\t\t[\"C\", \"L\"],\n\t\t[\"C\", \"V\"]\n\t];\n\tconst moveSet = new Set<PieceLetter>();\n\tfor (const optimalMoveSet of optimalRoyalMoveSets) {\n\t\tconst detractionSet = maximumTarget ? optimalMoveSet.slice().reverse() : optimalMoveSet;\n\t\tfor (const piece of possiblePieces) {\n\t\t\tif (detractionSet.includes(piece)) {\n\t\t\t\tconst target = detractionSet.slice(0, -detractionSet.indexOf(piece));\n\t\t\t\ttarget.forEach((t) => {\n\t\t\t\t\tif (possiblePieces.includes(t) && verifyPieceLetter(t)) moveSet.add(t);\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tif (moveSet.size === 0) {\n\t\tpossiblePieces.forEach((p) => {\n\t\t\tif (verifyPieceLetter(p)) moveSet.add(p);\n\t\t});\n\t}\n\n\treturn moveSet;\n}\n","import { boardDimension } from \"@moveGeneration/GameInformation/GameData\";\nimport type { Coordinate } from \"@moveGeneration/GameInformation/GameUnits/GameUnits\";\nimport { pieceControlConfigSettings } from \"@moveGeneration/PieceControl/PieceControlInterface\";\nimport { FENData } from \"../../../FENData/FENData\";\nimport type { MoveData } from \"../../../MoveTree/MoveTreeInterface\";\nimport { VariantRule } from \"../../VariantRule\";\nimport { variantRuleColors, VariantRuleHandler } from \"../../VariantRuleInterface\";\nimport { RoyalsCannotCapture } from \"../PieceControlDecorators/RoyalsCannotCapture\";\nimport { chessGlyphIndex } from \"@client/fonts/chessGlyphIndex\";\n\nconst tag = \"atomic\";\nexport class Atomic extends VariantRule<typeof FENData, typeof tag> implements VariantRuleHandler<FENData> {\n\tstatic {\n\t\tVariantRule.initVariantRule(Atomic);\n\t}\n\treadonly dependencies = new Map([[RoyalsCannotCapture, []]]);\n\n\tstatic readonly atomicCoordinates: Coordinate[] = [\n\t\t[-1, -1],\n\t\t[-1, 0],\n\t\t[0, -1],\n\t\t[-1, 1],\n\t\t[1, -1],\n\t\t[1, 0],\n\t\t[0, 1],\n\t\t[1, 1]\n\t];\n\n\tgetDecoratorType() {\n\t\treturn FENData;\n\t}\n\tgetPublicProperties() {\n\t\treturn {\n\t\t\tparameterValue: true,\n\t\t\tinformation: {\n\t\t\t\tname: \"Atomic\",\n\t\t\t\tdescription: \"Captures cause all surrounding pieces except pawns to explode\",\n\t\t\t\ttag,\n\t\t\t\tcolor: variantRuleColors.extending,\n\t\t\t\tdisplayIcon: chessGlyphIndex.atomic\n\t\t\t}\n\t\t} as const;\n\t}\n\tmatchesPGNDeclaration(match: string): boolean {\n\t\treturn /^Atomic$/i.test(match);\n\t}\n\tserializeToParsingForm(): string {\n\t\treturn \"Atomic\";\n\t}\n\tisDisabled(): boolean {\n\t\treturn false;\n\t}\n\n\tisComplexEvaluation(): boolean {\n\t\treturn true;\n\t}\n\n\tgetCapturedPieces(moveData: MoveData): Coordinate[] {\n\t\tconst baseCoordinates = this.callHandler(\"getCapturedPieces\", arguments);\n\t\tconst addCoordinate = (disI: number, disJ: number) => {\n\t\t\tconst coordinateI = moveData.endCoordinates[0] + disI;\n\t\t\tconst coordinateJ = moveData.endCoordinates[1] + disJ;\n\t\t\tif (coordinateI >= 0 && coordinateI <= boardDimension && coordinateJ >= 0 && coordinateJ <= boardDimension) {\n\t\t\t\tconst pieceString = this.decorator.board.board[coordinateI][coordinateJ];\n\t\t\t\tif (\n\t\t\t\t\t(pieceString.isPiece() || pieceString.isDead()) &&\n\t\t\t\t\t!pieceControlConfigSettings[pieceString.piece].moveGenerationSettings.isPawn\n\t\t\t\t) {\n\t\t\t\t\tbaseCoordinates.push([coordinateI, coordinateJ]);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tif (baseCoordinates.length !== 0) {\n\t\t\tfor (const [i, j] of Atomic.atomicCoordinates) {\n\t\t\t\taddCoordinate(i, j);\n\t\t\t}\n\t\t\tbaseCoordinates.push([...moveData.startCoordinates]);\n\t\t}\n\n\t\treturn baseCoordinates;\n\t}\n}\n","import type { PlayerBooleanTuple } from \"@moveGeneration/Board/Board\";\nimport { FENData } from \"@moveGeneration/FENData/FENData\";\nimport { totalPlayers, VariantType } from \"@moveGeneration/GameInformation/GameData\";\nimport { verifyNumericColor } from \"@moveGeneration/GameInformation/GameUnits/GameUnits\";\nimport { createPieceFromData, deadColorIndex } from \"@moveGeneration/GameInformation/GameUnits/PieceString\";\nimport { InternalMove, InternalMoveSignature } from \"@moveGeneration/MoveTree/MoveTreeInterface\";\nimport { pieceControlConfigSettings } from \"@moveGeneration/PieceControl/PieceControlInterface\";\nimport { VariantRule } from \"@moveGeneration/VariantRules/VariantRule\";\nimport { VariantRuleAllowedChecks, variantRuleColors, VariantRuleHandler } from \"@moveGeneration/VariantRules/VariantRuleInterface\";\n\nconst tag = \"deadKingWalking\";\nexport class DeadKingWalking extends VariantRule<typeof FENData, typeof tag> implements VariantRuleHandler<FENData> {\n\tstatic {\n\t\tVariantRule.initVariantRule(DeadKingWalking);\n\t}\n\n\tgetDecoratorType() {\n\t\treturn FENData;\n\t}\n\tgetPublicProperties() {\n\t\treturn {\n\t\t\tparameterValue: true,\n\t\t\tinformation: {\n\t\t\t\tname: \"Zombies\",\n\t\t\t\tdescription: \"Resigned players are controlled by a bot\",\n\t\t\t\ttag,\n\t\t\t\tcolor: variantRuleColors.autogenous,\n\t\t\t\tdisplayIcon: \"\"\n\t\t\t}\n\t\t} as const;\n\t}\n\tmatchesPGNDeclaration(match: string): boolean {\n\t\treturn /^DeadKingWalking$/i.test(match);\n\t}\n\tserializeToParsingForm(): string {\n\t\treturn \"DeadKingWalking\";\n\t}\n\tisDisabled({ variantDataRules, gameType, fenTags }: VariantRuleAllowedChecks): boolean {\n\t\treturn (\n\t\t\tgameType === VariantType.Teams ||\n\t\t\tfenTags.dead.value.reduce((p, n, i) => p + Number(n || fenTags.resigned.value[i]), 0) <= totalPlayers - 1 ||\n\t\t\t(variantDataRules.pointsForMate !== false && variantDataRules.pointsForMate < 6)\n\t\t);\n\t}\n\n\tprocessInternalMove(internalMove: InternalMove): { stalemates: PlayerBooleanTuple } {\n\t\tif (\n\t\t\tinternalMove.type === InternalMoveSignature.Resign ||\n\t\t\tinternalMove.type === InternalMoveSignature.ClaimWin ||\n\t\t\tinternalMove.type === InternalMoveSignature.Timeout\n\t\t) {\n\t\t\tconst { sideToMove, fenOptions, board } = this.decorator;\n\t\t\tconst dead = fenOptions.tag(\"dead\"),\n\t\t\t\tresigned = fenOptions.tag(\"resigned\");\n\n\t\t\tresigned[sideToMove] = true;\n\t\t\tdead[sideToMove] = true;\n\n\t\t\tfor (const coordinate of board.getPlayerPieces()[sideToMove]) {\n\t\t\t\tconst piece = board.board[coordinate[0]][coordinate[1]].piece;\n\t\t\t\tif (pieceControlConfigSettings[piece].moveGenerationSettings.isPawn) {\n\t\t\t\t\tboard.board[coordinate[0]][coordinate[1]] = createPieceFromData(deadColorIndex, piece);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst deadPlayers = dead.map((d, i) => d || resigned[i]).filter(Boolean);\n\t\t\tif (deadPlayers.length === totalPlayers - 1) {\n\t\t\t\tconst alivePlayer = deadPlayers.findIndex((d) => !d);\n\t\t\t\tif (verifyNumericColor(alivePlayer)) {\n\t\t\t\t\tthis.decorator.assignPoints(\n\t\t\t\t\t\talivePlayer,\n\t\t\t\t\t\tthis.decorator.countTotalPointsOnBoard().reduce((p, n, i) => p + (i === alivePlayer ? n : 0), 0)\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn { stalemates: [false, false, false, false] };\n\t\t} else return this.callHandler(\"processInternalMove\", arguments);\n\t}\n}\n","import { MoveData, SpecialMove } from \"../../../MoveTree/MoveTreeInterface\";\nimport { FENData } from \"../../../FENData/FENData\";\nimport { emptyPieceString, PieceString } from \"../../../GameInformation/GameUnits/PieceString\";\nimport { VariantRule } from \"../../VariantRule\";\nimport { variantRuleColors, VariantRuleHandler } from \"../../VariantRuleInterface\";\nimport { pieceControlConfigSettings } from \"@moveGeneration/PieceControl/PieceControlInterface\";\nimport { Coordinate, nonPlayablePieces } from \"../../../GameInformation/GameUnits/GameUnits\";\nimport { assertNonUndefined } from \"@client/ts/baseTypes\";\nimport { isVerticalPlacement } from \"@client/ts/logic/BaseInterfaces\";\nimport { chessGlyphIndex } from \"@client/fonts/chessGlyphIndex\";\n\nconst tag = \"enPassant\";\nexport class EnPassant extends VariantRule<typeof FENData, typeof tag> implements VariantRuleHandler<FENData> {\n\tstatic {\n\t\tVariantRule.initVariantRule(EnPassant);\n\t}\n\n\tgetDecoratorType() {\n\t\treturn FENData;\n\t}\n\tgetPublicProperties() {\n\t\treturn {\n\t\t\tparameterValue: true,\n\t\t\tinformation: {\n\t\t\t\tname: \"En Passant\",\n\t\t\t\tdescription: \"Pawns can capture en passant\",\n\t\t\t\ttag,\n\t\t\t\tcolor: variantRuleColors.minor,\n\t\t\t\tdisplayIcon: chessGlyphIndex.pawnConnection\n\t\t\t}\n\t\t} as const;\n\t}\n\tmatchesPGNDeclaration(match: string): boolean {\n\t\treturn /^EnPassant$/i.test(match);\n\t}\n\tserializeToParsingForm(): string {\n\t\treturn \"EnPassant\";\n\t}\n\tisDisabled(): boolean {\n\t\treturn false;\n\t}\n\n\tprocessStandardMove(moveData: MoveData): { endPiece: PieceString[] } {\n\t\tconst enPassants = this.decorator.fenOptions.tag(\"enPassant\");\n\t\tconst {\n\t\t\tstartCoordinates: [startI, startJ],\n\t\t\tendCoordinates: [endI, endJ]\n\t\t} = moveData;\n\t\tif (moveData.specialType === SpecialMove.EnPassant) {\n\t\t\tconst eligibleEnPassants: number[] = [];\n\t\t\tenPassants.forEach((e, i) => {\n\t\t\t\tif (!e) return;\n\t\t\t\tif (e[0][0] === endI && e[0][1] === endJ) eligibleEnPassants.push(i);\n\t\t\t});\n\t\t\tfor (const enPassantCoordinate of eligibleEnPassants) {\n\t\t\t\tconst enPassant = enPassants[enPassantCoordinate];\n\t\t\t\tassertNonUndefined(enPassant);\n\t\t\t\tthis.decorator.board.board[enPassant[1][0]][enPassant[1][1]] = emptyPieceString;\n\t\t\t\tenPassants[enPassantCoordinate] = null;\n\t\t\t}\n\t\t} else {\n\t\t\tconst pieceString = this.decorator.board.board[startI][startJ];\n\n\t\t\tif (!pieceString.isEmpty() && pieceString.piece !== nonPlayablePieces.duck) {\n\t\t\t\tenPassants[this.decorator.sideToMove] = null;\n\t\t\t\tconst setting = pieceControlConfigSettings[pieceString.piece];\n\t\t\t\tif (\n\t\t\t\t\tsetting.moveGenerationSettings.isPawn &&\n\t\t\t\t\tMath.abs(isVerticalPlacement(this.decorator.sideToMove) ? startI - endI : startJ - endJ) === 2\n\t\t\t\t) {\n\t\t\t\t\tconst enPassantInfo: [Coordinate, Coordinate] = [\n\t\t\t\t\t\t[Math.ceil((startI + endI) / 2), Math.ceil((startJ + endJ) / 2)],\n\t\t\t\t\t\t[endI, endJ]\n\t\t\t\t\t];\n\t\t\t\t\tenPassants[this.decorator.sideToMove] = enPassantInfo;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn this.callHandler(\"processStandardMove\", arguments);\n\t}\n}\n","import { createTuple } from \"../../../../../baseTypes\";\nimport { FENData } from \"../../../FENData/FENData\";\nimport type { PostMoveResults } from \"../../../FENData/FENDataInterface\";\nimport { totalPlayers } from \"../../../GameInformation/GameData\";\nimport { createPieceFromData, deadColorIndex } from \"../../../GameInformation/GameUnits/PieceString\";\nimport { VariantRule } from \"../../VariantRule\";\nimport { variantRuleColors, VariantRuleHandler } from \"../../VariantRuleInterface\";\nimport { RoyalsCannotCapture } from \"../PieceControlDecorators/RoyalsCannotCapture\";\nimport { pieceControlConfigSettings } from \"@moveGeneration/PieceControl/PieceControlInterface\";\nimport { MoveComponent, verifyStandardMove } from \"../../../MoveTree/MoveTreeInterface\";\nimport type { Coordinate } from \"@moveGeneration/GameInformation/GameUnits/GameUnits\";\nimport { chessGlyphIndex } from \"@client/fonts/chessGlyphIndex\";\n\nconst tag = \"fatalCapture\";\nexport class FatalCapture extends VariantRule<typeof FENData, typeof tag> implements VariantRuleHandler<FENData> {\n\tstatic {\n\t\tVariantRule.initVariantRule(FatalCapture);\n\t}\n\treadonly dependencies = new Map([[RoyalsCannotCapture, []]]);\n\n\tgetDecoratorType() {\n\t\treturn FENData;\n\t}\n\tgetPublicProperties() {\n\t\treturn {\n\t\t\tparameterValue: true,\n\t\t\tinformation: {\n\t\t\t\tname: \"Fatal Capture\",\n\t\t\t\tdescription: \"Pieces (but not pawns) die when they capture\",\n\t\t\t\ttag,\n\t\t\t\tcolor: variantRuleColors.extending,\n\t\t\t\tdisplayIcon: chessGlyphIndex.trashBin\n\t\t\t}\n\t\t} as const;\n\t}\n\tmatchesPGNDeclaration(match: string): boolean {\n\t\treturn /^FatalCapture$/i.test(match);\n\t}\n\tserializeToParsingForm(): string {\n\t\treturn \"FatalCapture\";\n\t}\n\tisDisabled(): boolean {\n\t\treturn false;\n\t}\n\n\taffectOptions(move: MoveComponent): PostMoveResults {\n\t\tlet endCaptureCoordinates: Coordinate | undefined;\n\t\tif (verifyStandardMove(move)) {\n\t\t\tconst {\n\t\t\t\tstartCoordinates: [startI, startJ],\n\t\t\t\tendCoordinates: [endI, endJ]\n\t\t\t} = move;\n\t\t\tconst isCapture = this.decorator.board.board[endI][endJ].isPiece();\n\t\t\tconst royal = this.decorator.fenOptions.tag(\"royal\")[this.decorator.sideToMove];\n\t\t\tif (royal && startI === royal[0] && startJ === royal[1] && isCapture) {\n\t\t\t\treturn {\n\t\t\t\t\tcheckmates: this.decorator.board.gameType.getBaseColors(this.decorator.sideToMove),\n\t\t\t\t\tchecks: createTuple(false, totalPlayers),\n\t\t\t\t\tstalemates: createTuple(false, totalPlayers)\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tendCaptureCoordinates = isCapture ? move.endCoordinates : undefined;\n\t\t}\n\n\t\tconst returnType = this.callHandler(\"affectOptions\", arguments);\n\t\tif (endCaptureCoordinates) {\n\t\t\tconst pieceString = this.decorator.board.board[endCaptureCoordinates[0]][endCaptureCoordinates[1]];\n\t\t\tif (!pieceControlConfigSettings[pieceString.piece].moveGenerationSettings.isPawn) {\n\t\t\t\tthis.decorator.board.board[endCaptureCoordinates[0]][endCaptureCoordinates[1]] = createPieceFromData(\n\t\t\t\t\tdeadColorIndex,\n\t\t\t\t\tthis.decorator.board.board[endCaptureCoordinates[0]][endCaptureCoordinates[1]].piece\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\treturn returnType;\n\t}\n}\n","import { FENData } from \"../../../FENData/FENData\";\nimport type { PostMoveResults } from \"../../../FENData/FENDataInterface\";\nimport { totalPlayers } from \"../../../GameInformation/GameData\";\nimport type { PieceString } from \"../../../GameInformation/GameUnits/PieceString\";\nimport type { MoveComponent, MoveData } from \"../../../MoveTree/MoveTreeInterface\";\nimport { VariantRule } from \"../../VariantRule\";\nimport type { VariantRuleHandler } from \"../../VariantRuleInterface\";\n\nconst tag = \"fiftyMoveRule\";\nexport class FiftyMoveRule extends VariantRule<typeof FENData, typeof tag> implements VariantRuleHandler<FENData> {\n\tstatic {\n\t\tVariantRule.initVariantRule(FiftyMoveRule);\n\t}\n\tprivate totalFullMoves: number;\n\n\tconstructor(fullMoves?: unknown) {\n\t\tsuper();\n\t\tif (typeof fullMoves === \"number\" && fullMoves > 0) {\n\t\t\tthis.totalFullMoves = fullMoves;\n\t\t} else {\n\t\t\tthis.totalFullMoves = 50;\n\t\t}\n\t}\n\n\tgetDecoratorType() {\n\t\treturn FENData;\n\t}\n\n\tgetPublicProperties() {\n\t\tconst isDisabled = this.totalFullMoves === Infinity;\n\t\treturn {\n\t\t\tparameterValue: this.totalFullMoves,\n\t\t\tinformation: {\n\t\t\t\tname: \"N Move Rule\",\n\t\t\t\ttextualForm: \"\",\n\t\t\t\tdescription: isDisabled\n\t\t\t\t\t? \"50 move rule disabled\"\n\t\t\t\t\t: `After ${this.totalFullMoves} full moves without captures or pawn pushes game is over`,\n\t\t\t\ttag\n\t\t\t}\n\t\t} as const;\n\t}\n\n\tmatchesPGNDeclaration(match: string) {\n\t\tconst matchArray = match.match(/^FiftyMoveRule=((?:\\d+)|(?:Infinity))$/i);\n\t\tif (matchArray) {\n\t\t\tthis.totalFullMoves = Number(matchArray[1]);\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tserializeToParsingForm(): string {\n\t\treturn `FiftyMoveRule=${this.totalFullMoves}`;\n\t}\n\n\tisDisabled(): boolean {\n\t\treturn false;\n\t}\n\n\tgetParametrizedOptions() {\n\t\tconst options = new Map<string, number>();\n\t\tfor (const value of [50, 150, 200, 25, 10]) options.set(`${value} Move rule`, value);\n\t\toptions.set(\"Unlimited\", Infinity);\n\t\treturn options;\n\t}\n\n\tprocessStandardMove(moveData: MoveData): { endPiece: PieceString[] } {\n\t\tif (this.decorator.getCapturedPieces(moveData).length > 0) {\n\t\t\tthis.decorator.plyCount = 0;\n\t\t}\n\n\t\treturn this.callHandler(\"processStandardMove\", arguments);\n\t}\n\n\taffectOptions(move: MoveComponent): PostMoveResults {\n\t\tconst results = this.callHandler(\"affectOptions\", arguments);\n\t\tif (move.isIrreversible) {\n\t\t\tthis.decorator.plyCount = 0;\n\t\t} else {\n\t\t\tthis.decorator.plyCount++;\n\t\t}\n\n\t\tconst alivePlayers = totalPlayers - this.decorator.fenOptions.tag(\"dead\").filter(Boolean).length;\n\t\tif (alivePlayers > 0 && Math.floor(this.decorator.plyCount / alivePlayers) > this.totalFullMoves) {\n\t\t\tthis.decorator.assignGeneralTermination(\"50-move Rule\");\n\t\t\tthis.injectIntoBaseClass(function (this: FENData) {\n\t\t\t\tthis.spreadPointsBetweenPlayersEvenly();\n\t\t\t})();\n\t\t}\n\n\t\treturn results;\n\t}\n}\n","import type { NumericColor } from \"@moveGeneration/GameInformation/GameUnits/GameUnits\";\nimport { FENData } from \"../../../FENData/FENData\";\nimport type { PostMoveResults } from \"../../../FENData/FENDataInterface\";\nimport { totalPlayers } from \"../../../GameInformation/GameData\";\nimport type { PieceString } from \"../../../GameInformation/GameUnits/PieceString\";\nimport type { MoveData } from \"../../../MoveTree/MoveTreeInterface\";\nimport { VariantRule } from \"../../VariantRule\";\nimport {\n\tAllowedSuperClasses,\n\tVariantDataRules,\n\tVariantRuleAllowedChecks,\n\tvariantRuleColors,\n\tVariantRuleHandler\n} from \"../../VariantRuleInterface\";\nimport { ForcedCapture } from \"../BoardDecorators/ForcedCapture\";\nimport { StalemateOptions, stalemateOptionsValues } from \"./StalemateOptions\";\nimport { chessGlyphIndex } from \"@client/fonts/chessGlyphIndex\";\n\nconst tag = \"giveaway\";\nexport class Giveaway extends VariantRule<typeof FENData, typeof tag> implements VariantRuleHandler<FENData> {\n\tstatic {\n\t\tVariantRule.initVariantRule(Giveaway);\n\t}\n\tprivate static readonly pointsForPiece = 3;\n\tprivate static readonly stalematePoints = {\n\t\t[1]: 200,\n\t\t[2]: 400,\n\t\t[3]: 600\n\t};\n\treadonly dependencies = new Map<new (...args: unknown[]) => VariantRule<AllowedSuperClasses, keyof VariantDataRules>, unknown[]>([\n\t\t[ForcedCapture, []],\n\t\t[StalemateOptions, [stalemateOptionsValues.stalemateWins]]\n\t]);\n\n\tprivate initiallyAliveColors = totalPlayers;\n\n\tgetDecoratorType() {\n\t\treturn FENData;\n\t}\n\tgetPublicProperties() {\n\t\treturn {\n\t\t\tparameterValue: true,\n\t\t\tinformation: {\n\t\t\t\tname: \"Giveaway\",\n\t\t\t\tdescription: \"First to lose all pieces or stalemate wins\",\n\t\t\t\ttag,\n\t\t\t\tcolor: variantRuleColors.widespread,\n\t\t\t\tdisplayIcon: chessGlyphIndex.gift\n\t\t\t}\n\t\t} as const;\n\t}\n\tmatchesPGNDeclaration(match: string) {\n\t\treturn /^Giveaway$/i.test(match);\n\t}\n\tserializeToParsingForm(): string {\n\t\treturn \"Giveaway\";\n\t}\n\tisDisabled({ variantDataRules }: VariantRuleAllowedChecks): boolean {\n\t\treturn variantDataRules.taboo;\n\t}\n\n\tinitDecoratorSettings() {\n\t\tthis.decorator.fenOptions.setTag(\"royal\", [null, null, null, null]);\n\t\tthis.initiallyAliveColors = this.decorator.fenOptions\n\t\t\t.tag(\"dead\")\n\t\t\t.map((d, i) => d || this.decorator.fenOptions.tag(\"resigned\")[i])\n\t\t\t.filter(Boolean).length;\n\n\t\tfor (const decorator of this.wrappingDecorators) decorator.initDecoratorSettings?.();\n\t}\n\n\tprocessStandardMove(moveData: MoveData): { endPiece: PieceString[] } {\n\t\tconst capturedPieces = this.decorator.getCapturedPieces(moveData);\n\t\tconst board = this.decorator.board.board;\n\t\tfor (const capturedPiece of capturedPieces) {\n\t\t\tconst pieceString = board[capturedPiece[0]][capturedPiece[1]];\n\t\t\tif (pieceString.isPiece()) {\n\t\t\t\tthis.assignPoints(pieceString.color, Giveaway.pointsForPiece, true);\n\t\t\t}\n\t\t}\n\n\t\tthis.callHandler(\"processStandardMove\", arguments);\n\t\treturn { endPiece: [] };\n\t}\n\n\taffectOptions(): PostMoveResults {\n\t\tconst returnType = this.callHandler(\"affectOptions\", arguments);\n\t\tthis.decorator.fenOptions.setTag(\"royal\", [null, null, null, null]);\n\t\treturn returnType;\n\t}\n\n\tobtainPointsForMate(): number {\n\t\t// Checkmates do not exist, so the only scenario in which this gets called is stalemate\n\t\tconst aliveColors = this.decorator.fenOptions.tag(\"dead\").filter(Boolean).length;\n\t\tswitch (aliveColors) {\n\t\t\tcase 1:\n\t\t\t\tif (this.initiallyAliveColors === totalPlayers) {\n\t\t\t\t\treturn Giveaway.stalematePoints[1];\n\t\t\t\t}\n\t\t\t// * Fallthrough\n\t\t\tcase 2:\n\t\t\t\tif (this.initiallyAliveColors >= totalPlayers - 1) {\n\t\t\t\t\treturn Giveaway.stalematePoints[2];\n\t\t\t\t}\n\t\t\t// * Fallthrough\n\t\t\tcase 3:\n\t\t\t\treturn Giveaway.stalematePoints[3];\n\t\t\tdefault:\n\t\t\t\tconsole.error(`Unexpected players length ${aliveColors}`);\n\t\t\t\treturn 0;\n\t\t}\n\t}\n\n\tassignPoints(sideToMove: NumericColor, points: number, isGiveawayAssigned = false) {\n\t\tif (isGiveawayAssigned) {\n\t\t\tfor (const decorator of this.wrappingDecorators) {\n\t\t\t\tif (decorator.assignPoints) {\n\t\t\t\t\tdecorator.assignPoints(sideToMove, points);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t\tFENData.prototype.assignPoints.call(this.decorator, sideToMove, points);\n\t\t}\n\t}\n}\n","import { compareArrays } from \"@client/ts/utils/ArrayUtils\";\nimport { compareCoordinates } from \"../../../Board/BoardInterface\";\nimport { FENData } from \"../../../FENData/FENData\";\nimport { PostMoveResults } from \"../../../FENData/FENDataInterface\";\nimport { colors, convertCoordinateToPGN4, getPlayerNameFromColor } from \"../../../GameInformation/GameData\";\nimport { InternalMoveSignature } from \"../../../MoveTree/MoveTreeInterface\";\nimport { VariantRule } from \"../../VariantRule\";\nimport { variantRuleColors, VariantRuleHandler } from \"../../VariantRuleInterface\";\nimport type { Coordinate } from \"@moveGeneration/GameInformation/GameUnits/GameUnits\";\nimport { parseSingleCoordinate } from \"@client/ts/logic/utils/Tags/Utils\";\nimport { chessGlyphIndex } from \"@client/fonts/chessGlyphIndex\";\n\nconst tag = \"kingOfTheHill\";\nexport class KingOfTheHill extends VariantRule<typeof FENData, typeof tag> implements VariantRuleHandler<FENData> {\n\tstatic {\n\t\tVariantRule.initVariantRule(KingOfTheHill);\n\t}\n\tprivate static readonly defaultCoordinates: Coordinate[] = [\n\t\t[7, 7],\n\t\t[7, 6],\n\t\t[6, 7],\n\t\t[6, 6]\n\t];\n\tprivate static readonly defaultRoyal = \"K\";\n\n\tprivate hillSquares: Coordinate[];\n\n\tconstructor(hillSquares?: unknown) {\n\t\tsuper();\n\t\tif (\n\t\t\tArray.isArray(hillSquares) &&\n\t\t\thillSquares.every<Coordinate>((c): c is Coordinate => Array.isArray(c) && c.length === 2 && c.every((n) => typeof n === \"number\"))\n\t\t) {\n\t\t\tthis.hillSquares = hillSquares;\n\t\t} else {\n\t\t\tthis.hillSquares = KingOfTheHill.defaultCoordinates;\n\t\t}\n\t}\n\n\tgetDecoratorType() {\n\t\treturn FENData;\n\t}\n\tgetPublicProperties() {\n\t\treturn {\n\t\t\tparameterValue: this.hillSquares,\n\t\t\tinformation: {\n\t\t\t\tname: \"King of the Hill\",\n\t\t\t\tdescription: \"A king reaching the hill will checkmate all opponents\",\n\t\t\t\ttag,\n\t\t\t\tcolor: variantRuleColors.autogenous,\n\t\t\t\tdisplayIcon: chessGlyphIndex.kingOfTheHill\n\t\t\t}\n\t\t} as const;\n\t}\n\tmatchesPGNDeclaration(match: string): boolean {\n\t\tconst matchArray = match.toLowerCase().match(/^KotH(?:=(.+))?$/i);\n\t\tif (matchArray) {\n\t\t\tif (matchArray[1]) {\n\t\t\t\tconst coordinatesArray: Coordinate[] = [];\n\t\t\t\tconst presumedOption = matchArray[1].split(\",\");\n\t\t\t\tfor (const coordinate of presumedOption) {\n\t\t\t\t\tconst parsedCoordinate = parseSingleCoordinate(coordinate);\n\t\t\t\t\tif (parsedCoordinate) {\n\t\t\t\t\t\tcoordinatesArray.push(parsedCoordinate);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (coordinatesArray.length > 0) {\n\t\t\t\t\tthis.hillSquares = coordinatesArray;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\tserializeToParsingForm(): string {\n\t\tif (compareArrays(this.hillSquares, KingOfTheHill.defaultCoordinates)) {\n\t\t\treturn \"KotH\";\n\t\t} else {\n\t\t\treturn `KotH=${this.hillSquares.map((c) => convertCoordinateToPGN4(c)).join(\",\")}`;\n\t\t}\n\t}\n\tisDisabled(): boolean {\n\t\treturn false;\n\t}\n\n\tgetInsufficientMaterialData() {\n\t\treturn {\n\t\t\tisPartiallyDisabled: true,\n\t\t\tisDisabled: true\n\t\t} as const;\n\t}\n\n\taffectOptions(): PostMoveResults {\n\t\tconst { board, sideToMove, fenOptions } = this.decorator;\n\t\tconst returnValues = this.callHandler(\"affectOptions\", arguments);\n\n\t\tconst royal = fenOptions.tag(\"royal\")[sideToMove],\n\t\t\tdead = fenOptions.tag(\"dead\"),\n\t\t\twb = fenOptions.tag(\"wb\");\n\t\tif (\n\t\t\tboard.variantData.giveaway &&\n\t\t\tthis.hillSquares.some((c) => {\n\t\t\t\tconst pieceString = board.board[c[0]][c[1]];\n\t\t\t\treturn pieceString.isPiece() && pieceString.piece === KingOfTheHill.defaultRoyal;\n\t\t\t})\n\t\t) {\n\t\t\tthis.decorator.processInternalMove({ type: InternalMoveSignature.Stalemate });\n\t\t\treturnValues.stalemates[sideToMove] = true;\n\t\t} else if (royal && this.hillSquares.some((c) => compareCoordinates(c, royal))) {\n\t\t\tconst pointsForMate = this.decorator.obtainPointsForMate();\n\t\t\tfor (const color of colors) {\n\t\t\t\tif (color === sideToMove) continue;\n\t\t\t\tif (!dead[color]) {\n\t\t\t\t\tdead[color] = true;\n\t\t\t\t\tthis.decorator.assignPoints(sideToMove, pointsForMate);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (this.decorator.board.variantData.taboo) {\n\t\t\t\tthis.decorator.gameOver = `${getPlayerNameFromColor(sideToMove, wb).toUpperCase()} WON THE RACE!`;\n\t\t\t} else {\n\t\t\t\tthis.decorator.assignGeneralTermination(\"King of the Hill\");\n\t\t\t}\n\t\t}\n\n\t\treturn returnValues;\n\t}\n}\n","import { createTuple, Tuple, verifyTupleType } from \"@client/ts/baseTypes\";\nimport { compareCoordinates } from \"../../../Board/BoardInterface\";\nimport { FENData } from \"../../../FENData/FENData\";\nimport { createDefaultFENEffectSettings, PostMoveResults } from \"../../../FENData/FENDataInterface\";\nimport { colors, totalPlayers } from \"../../../GameInformation/GameData\";\nimport { MoveComponent, verifyStandardMove } from \"../../../MoveTree/MoveTreeInterface\";\nimport { VariantRule } from \"../../VariantRule\";\nimport type { VariantRuleAllowedChecks, VariantRuleHandler } from \"../../VariantRuleInterface\";\n\nconst tag = \"nCheck\";\nexport class NCheck extends VariantRule<typeof FENData, typeof tag> implements VariantRuleHandler<FENData> {\n\tstatic {\n\t\tVariantRule.initVariantRule(NCheck);\n\t}\n\tprivate defaultChecks: Tuple<number, typeof totalPlayers>;\n\tconstructor(defaultChecks?: unknown) {\n\t\tsuper();\n\t\tif (\n\t\t\tArray.isArray(defaultChecks) &&\n\t\t\tverifyTupleType(defaultChecks, totalPlayers) &&\n\t\t\tdefaultChecks.every<number>((check): check is number => typeof check === \"number\")\n\t\t) {\n\t\t\tthis.defaultChecks = defaultChecks;\n\t\t} else {\n\t\t\tthis.defaultChecks = createTuple(3, totalPlayers);\n\t\t}\n\t}\n\n\tgetDecoratorType() {\n\t\treturn FENData;\n\t}\n\tgetPublicProperties() {\n\t\tconst checks = this.defaultChecks\n\t\t\t.filter(Boolean)\n\t\t\t.reduce((p, n, i, arr) => p + (arr[i - 1] === arr[i] ? \"\" : `-${n}`), \"\")\n\t\t\t.slice(1);\n\t\treturn {\n\t\t\tparameterValue: this.defaultChecks,\n\t\t\tinformation: {\n\t\t\t\tname: `N-Check`,\n\t\t\t\ttextualForm: `${checks}+`,\n\t\t\t\tdescription: `Checking a king ${checks} times is checkmate`,\n\t\t\t\ttag\n\t\t\t}\n\t\t} as const;\n\t}\n\tmatchesPGNDeclaration(match: string): boolean {\n\t\tconst matchArray = match.toLowerCase().match(/^(\\d\\d?\\d?(?:-\\d\\d?\\d?){0,3})-check$/i);\n\t\tif (matchArray) {\n\t\t\tconst checks = matchArray[1].split(\"-\");\n\t\t\tfor (let i = 0; i <= checks.length; i++) {\n\t\t\t\tif (checks[i]) {\n\t\t\t\t\tthis.defaultChecks[i] = Number(checks[i]);\n\t\t\t\t} else {\n\t\t\t\t\twhile (i !== totalPlayers) {\n\t\t\t\t\t\tthis.defaultChecks[i] = this.defaultChecks[i - 1];\n\t\t\t\t\t\ti++;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\tserializeToParsingForm(): string {\n\t\treturn `${this.defaultChecks.join(\"-\")}-check`;\n\t}\n\tisDisabled({ variantDataRules }: VariantRuleAllowedChecks): boolean {\n\t\treturn variantDataRules.giveaway;\n\t}\n\n\tgetInsufficientMaterialData() {\n\t\treturn {\n\t\t\tisPartiallyDisabled: true,\n\t\t\tisDisabled: false\n\t\t} as const;\n\t}\n\n\tgetParametrizedOptions() {\n\t\tconst resultingMap = new Map<string, Tuple<number, typeof totalPlayers> | false>([[\"N+ Off\", false]]);\n\t\tfor (let i = 1; i < 10; i++) resultingMap.set(`${i}+`, createTuple(i, totalPlayers));\n\t\tfor (const value of [12, 15, 20, 30, 50]) resultingMap.set(`${value}+`, createTuple(value, totalPlayers));\n\t\treturn resultingMap;\n\t}\n\n\tinitDecoratorSettings() {\n\t\tconst lives = this.decorator.fenOptions.tag(\"lives\");\n\t\tfor (const color of colors) {\n\t\t\tif (lives[color] === null) {\n\t\t\t\tlives[color] = this.defaultChecks[color];\n\t\t\t}\n\t\t}\n\n\t\tfor (const decorator of this.wrappingDecorators) decorator.initDecoratorSettings?.();\n\t}\n\n\taffectOptions(move: MoveComponent, settings = createDefaultFENEffectSettings()): PostMoveResults {\n\t\tconst { board, sideToMove } = this.decorator;\n\t\tconst currentChecks = board.getCurrentChecks().map((arr) => new Set(arr));\n\t\tconst isNCheckValidated = !settings.ignoreCheckmateChecks && !settings.ignoreNextTurn;\n\t\tconst royal = this.decorator.fenOptions.tag(\"royal\"),\n\t\t\tlives = this.decorator.fenOptions.tag(\"lives\");\n\t\tconst results = this.callHandler(\"affectOptions\", arguments);\n\n\t\tconst isStandardMove = verifyStandardMove(move);\n\t\tif (isNCheckValidated) {\n\t\t\tconst updatedChecks = board.getCurrentChecks(sideToMove);\n\n\t\t\tconst playerChecks = createTuple(0, totalPlayers);\n\t\t\tfor (const color of colors) {\n\t\t\t\tfor (const coordinate of updatedChecks[color]) {\n\t\t\t\t\tconst royalPiece = royal[color];\n\t\t\t\t\tif (\n\t\t\t\t\t\t!currentChecks[color].has(coordinate) ||\n\t\t\t\t\t\t(royalPiece && isStandardMove && compareCoordinates(move.endCoordinates, royalPiece))\n\t\t\t\t\t) {\n\t\t\t\t\t\tplayerChecks[color]++;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (lives.every<number>((live): live is number => live !== null)) {\n\t\t\t\tfor (const color of colors) {\n\t\t\t\t\tlives[color] -= playerChecks[color];\n\t\t\t\t\tif (lives[color] <= 0) {\n\t\t\t\t\t\tthis.decorator.assignPoints(sideToMove, this.decorator.obtainPointsForMate());\n\t\t\t\t\t\tthis.decorator.turnPiecesDead(color);\n\t\t\t\t\t\tlives[color] = 0;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (this.decorator.getRealPlayers() > 1) {\n\t\t\t\tthis.decorator.sideToMove = this.decorator.nextTurn(sideToMove);\n\t\t\t\tboard.pregenerateAttacks();\n\t\t\t}\n\t\t}\n\n\t\treturn results;\n\t}\n}\n","import { FENData } from \"../../../FENData/FENData\";\nimport { getOppositePlacedColor, totalPlayers, VariantType } from \"../../../GameInformation/GameData\";\nimport type { PieceString } from \"../../../GameInformation/GameUnits/PieceString\";\nimport { pieceControlConfigSettings } from \"../../../PieceControl/PieceControlInterface\";\nimport { VariantRule } from \"../../VariantRule\";\nimport type { VariantRuleAllowedChecks, VariantRuleHandler } from \"../../VariantRuleInterface\";\n\nconst tag = \"oppositeMultiplier\";\n\nexport class OppositeMultiplier extends VariantRule<typeof FENData, typeof tag> implements VariantRuleHandler<FENData> {\n\tprivate static readonly MAXIMUM_MULTIPLIER = 6;\n\tstatic {\n\t\tVariantRule.initVariantRule(OppositeMultiplier);\n\t}\n\tprivate oppositeMultiplierValue = 2;\n\n\tgetDecoratorType() {\n\t\treturn FENData;\n\t}\n\n\tgetPublicProperties() {\n\t\treturn {\n\t\t\tparameterValue: this.oppositeMultiplierValue,\n\t\t\tinformation: {\n\t\t\t\tname: \"Opposite's piece value\",\n\t\t\t\ttextualForm: `Ox${this.oppositeMultiplierValue}`,\n\t\t\t\tdescription: `Opposite's pieces are worth ${this.oppositeMultiplierValue} times their normal points value until one player is eliminated`,\n\t\t\t\ttag\n\t\t\t}\n\t\t} as const;\n\t}\n\t\n\tmatchesPGNDeclaration(match: string): boolean {\n\t\tconst matchArray = match.toLowerCase().match(/^OppX=(\\d)$/i);\n\t\tif (matchArray) {\n\t\t\tconst numericValue = Number(matchArray[1]);\n\t\t\tif (numericValue <= 0 || numericValue > OppositeMultiplier.MAXIMUM_MULTIPLIER) return false;\n\t\t\tthis.oppositeMultiplierValue = numericValue;\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tserializeToParsingForm(): string {\n\t\treturn `OppX=${this.oppositeMultiplierValue}`;\n\t}\n\n\tisDisabled({ variantDataRules, gameType, fenTags }: VariantRuleAllowedChecks): boolean {\n\t\treturn (\n\t\t\tgameType === VariantType.Teams ||\n\t\t\tvariantDataRules.giveaway ||\n\t\t\tfenTags.dead.value.reduce((p, n, i) => p + Number(n || fenTags.resigned.value[i]), 0) <= totalPlayers - 1\n\t\t);\n\t}\n\n\tgetParametrizedOptions() {\n\t\tconst options = new Map<string, number | false>([[\"Ox Off\", false]]);\n\t\tfor (let i = 1; i <= OppositeMultiplier.MAXIMUM_MULTIPLIER; i++) options.set(`Ox${i}`, i);\n\t\treturn options;\n\t}\n\n\tgetPointsForPiece(pieceString: PieceString): number {\n\t\tconst dead = this.decorator.fenOptions.tag(\"dead\"),\n\t\t\tresigned = this.decorator.fenOptions.tag(\"resigned\");\n\t\tconst aliveColors = dead.map((d, i) => d || resigned[i]).filter(Boolean).length;\n\t\tif (aliveColors === totalPlayers && pieceString.isPiece() && pieceString.color === getOppositePlacedColor(this.decorator.sideToMove)) {\n\t\t\treturn pieceControlConfigSettings[pieceString.piece].points.singlesPoints * this.oppositeMultiplierValue;\n\t\t} else return this.callHandler(\"getPointsForPiece\", arguments);\n\t}\n}\n","import { MoveData, SpecialMove } from \"../../../MoveTree/MoveTreeInterface\";\nimport type { PlayerBooleanTuple } from \"../../../Board/Board\";\nimport { FENData } from \"../../../FENData/FENData\";\nimport { VariantRule } from \"../../VariantRule\";\nimport { variantRuleColors, VariantRuleHandler } from \"../../VariantRuleInterface\";\nimport { getOppositePlacedColor } from \"../../../GameInformation/GameData\";\nimport { PieceString } from \"@moveGeneration/GameInformation/GameUnits/PieceString\";\n\nconst tag = \"oppositeSideCastling\";\nexport class OppositeSideCastling extends VariantRule<typeof FENData, typeof tag> implements VariantRuleHandler<FENData> {\n\tstatic {\n\t\tVariantRule.initVariantRule(OppositeSideCastling);\n\t}\n\n\tgetDecoratorType() {\n\t\treturn FENData;\n\t}\n\tgetPublicProperties() {\n\t\treturn {\n\t\t\tparameterValue: true,\n\t\t\tinformation: {\n\t\t\t\tname: \"Opposite-side Castling\",\n\t\t\t\tdescription: \"Once your opponent has castled, you can only castle to the opposite side\",\n\t\t\t\ttag,\n\t\t\t\tcolor: variantRuleColors.minor,\n\t\t\t\tdisplayIcon: \"ὸ\"\n\t\t\t}\n\t\t} as const;\n\t}\n\tmatchesPGNDeclaration(match: string) {\n\t\treturn /^OppositeSideCastling$/i.test(match);\n\t}\n\tserializeToParsingForm(): string {\n\t\treturn \"OppositeSideCastling\";\n\t}\n\tisDisabled(): boolean {\n\t\treturn false;\n\t}\n\n\tprocessStandardMove(moveData: MoveData): { endPiece: PieceString[] } {\n\t\tconst result = this.callHandler(\"processStandardMove\", arguments);\n\n\t\tif (\"specialType\" in moveData) {\n\t\t\tlet castlingDataReference: PlayerBooleanTuple | undefined;\n\t\t\tif (moveData.specialType === SpecialMove.CastlingKingside) {\n\t\t\t\tcastlingDataReference = this.decorator.fenOptions.tag(\"castleKingside\");\n\t\t\t} else if (moveData.specialType === SpecialMove.CastlingQueenside) {\n\t\t\t\tcastlingDataReference = this.decorator.fenOptions.tag(\"castleQueenside\");\n\t\t\t}\n\n\t\t\tif (castlingDataReference) {\n\t\t\t\tcastlingDataReference[getOppositePlacedColor(this.decorator.sideToMove)] = false;\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n}\n","import { FENData } from \"../../../FENData/FENData\";\nimport { PostMoveResults } from \"../../../FENData/FENDataInterface\";\nimport { createPieceFromData, PieceString } from \"../../../GameInformation/GameUnits/PieceString\";\nimport { VariantRule } from \"../../VariantRule\";\nimport { variantRuleColors, VariantRuleHandler } from \"../../VariantRuleInterface\";\nimport type { PieceLetter } from \"@moveGeneration/PieceControl/PieceControlInterface\";\nimport { MoveComponent, MoveData, verifyInternalMove, verifyStandardMove } from \"../../../MoveTree/MoveTreeInterface\";\nimport { chessGlyphIndex } from \"@client/fonts/chessGlyphIndex\";\n\nconst tag = \"piecesGoToBanks\";\nexport class PiecesGoToBanks extends VariantRule<typeof FENData, typeof tag> implements VariantRuleHandler<FENData> {\n\tgetDecoratorType() {\n\t\treturn FENData;\n\t}\n\tgetPublicProperties() {\n\t\treturn {\n\t\t\tparameterValue: true,\n\t\t\tinformation: {\n\t\t\t\tname: \"Bank Captures\",\n\t\t\t\tdescription: \"Captured pieces go to banks\",\n\t\t\t\ttag,\n\t\t\t\tcolor: variantRuleColors.extending,\n\t\t\t\tdisplayIcon: chessGlyphIndex.copyToClipboard\n\t\t\t}\n\t\t} as const;\n\t}\n\tmatchesPGNDeclaration(match: string): boolean {\n\t\treturn /^Crazy(?:house|wan)$/i.test(match);\n\t}\n\tserializeToParsingForm(): string {\n\t\treturn \"\";\n\t}\n\tisDisabled(): boolean {\n\t\treturn false;\n\t}\n\n\tprocessStandardMove(moveData: MoveData): { endPiece: PieceString[] } {\n\t\tconst promotedFrom = this.decorator.fenOptions.tag(\"promotedFrom\");\n\n\t\tif (moveData.promotion) {\n\t\t\tconst pieceLetter = this.decorator.board.board[moveData.startCoordinates[0]][moveData.startCoordinates[1]].piece;\n\t\t\tpromotedFrom.set(moveData.endCoordinates, pieceLetter);\n\t\t} else {\n\t\t\tfor (const [key, value] of promotedFrom) {\n\t\t\t\tif (key[0] === moveData.startCoordinates[0] && key[1] === moveData.endCoordinates[1]) {\n\t\t\t\t\tpromotedFrom.delete(key);\n\t\t\t\t\tpromotedFrom.set(moveData.endCoordinates, value);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn this.callHandler(\"processStandardMove\", arguments);\n\t}\n\n\taffectOptions(move: MoveComponent): PostMoveResults {\n\t\tconst fenOptions = this.decorator.fenOptions;\n\t\tconst areBanksEnabled = fenOptions.tag(\"areBanksEnabled\"),\n\t\t\tbank = fenOptions.tag(\"bank\"),\n\t\t\tpromotedFrom = fenOptions.tag(\"promotedFrom\");\n\n\t\tif (areBanksEnabled[this.decorator.sideToMove]) {\n\t\t\tif (!verifyInternalMove(move)) {\n\t\t\t\tif (verifyStandardMove(move)) {\n\t\t\t\t\tconst captures = this.decorator.getCapturedPieces(move);\n\t\t\t\t\tconst sideToMove = this.decorator.sideToMove;\n\t\t\t\t\tconst addPieceToBank = (piece: PieceLetter) => {\n\t\t\t\t\t\tfor (const [key, value] of bank[sideToMove]) {\n\t\t\t\t\t\t\tif (key.piece === piece && key.color === sideToMove) {\n\t\t\t\t\t\t\t\tbank[sideToMove].set(key, value + 1);\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbank[sideToMove].set(createPieceFromData(sideToMove, piece), 1);\n\t\t\t\t\t};\n\n\t\t\t\t\tcaptures.forEach((c) => {\n\t\t\t\t\t\tfor (const [key, value] of promotedFrom) {\n\t\t\t\t\t\t\tif (key[0] === c[0] && key[1] === c[1]) {\n\t\t\t\t\t\t\t\tpromotedFrom.delete(key);\n\t\t\t\t\t\t\t\taddPieceToBank(value);\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\taddPieceToBank(this.decorator.board.board[c[0]][c[1]].piece);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn this.callHandler(\"affectOptions\", arguments);\n\t}\n}\n","import { chessGlyphIndex } from \"@client/fonts/chessGlyphIndex\";\nimport { FENData } from \"../../../FENData/FENData\";\nimport { totalPlayers, VariantType } from \"../../../GameInformation/GameData\";\nimport { VariantRule } from \"../../VariantRule\";\nimport { VariantRuleAllowedChecks, variantRuleColors, VariantRuleHandler } from \"../../VariantRuleInterface\";\n\nconst tag = \"playForMate\";\nexport class PlayForMate extends VariantRule<typeof FENData, typeof tag> implements VariantRuleHandler<FENData> {\n\tstatic {\n\t\tVariantRule.initVariantRule(PlayForMate);\n\t}\n\tprivate initiallyAliveColors = totalPlayers;\n\tprivate static readonly checkmatePoints = {\n\t\t[1]: 24,\n\t\t[2]: 32,\n\t\t[3]: 48\n\t};\n\n\tgetDecoratorType() {\n\t\treturn FENData;\n\t}\n\tgetPublicProperties() {\n\t\treturn {\n\t\t\tparameterValue: true,\n\t\t\tinformation: {\n\t\t\t\tname: \"Play for mate\",\n\t\t\t\tdescription: \"No points for pieces, only checkmates matter\",\n\t\t\t\ttag,\n\t\t\t\tcolor: variantRuleColors.pointsAlternation,\n\t\t\t\tdisplayIcon: chessGlyphIndex.hashtag\n\t\t\t}\n\t\t} as const;\n\t}\n\tmatchesPGNDeclaration(match: string) {\n\t\treturn /^Play4Mate$/i.test(match);\n\t}\n\tserializeToParsingForm(): string {\n\t\treturn \"Play4Mate\";\n\t}\n\tisDisabled({ gameType }: VariantRuleAllowedChecks): boolean {\n\t\treturn gameType === VariantType.Teams;\n\t}\n\n\tinitDecoratorSettings() {\n\t\tthis.initiallyAliveColors = this.decorator.fenOptions\n\t\t\t.tag(\"dead\")\n\t\t\t.map((d, i) => d || this.decorator.fenOptions.tag(\"resigned\")[i])\n\t\t\t.filter(Boolean).length;\n\n\t\tfor (const decorator of this.wrappingDecorators) decorator.initDecoratorSettings?.();\n\t}\n\n\tobtainPointsForMate(): number {\n\t\tconst aliveColors = this.decorator.fenOptions.tag(\"dead\").filter(Boolean).length;\n\t\tswitch (aliveColors) {\n\t\t\tcase 1:\n\t\t\t\tif (this.initiallyAliveColors === totalPlayers) {\n\t\t\t\t\treturn PlayForMate.checkmatePoints[1];\n\t\t\t\t}\n\t\t\t// * Fallthrough\n\t\t\tcase 2:\n\t\t\t\tif (this.initiallyAliveColors >= totalPlayers - 1) {\n\t\t\t\t\treturn PlayForMate.checkmatePoints[2];\n\t\t\t\t}\n\t\t\t// * Fallthrough\n\t\t\tcase 3:\n\t\t\t\treturn PlayForMate.checkmatePoints[3];\n\t\t\tdefault:\n\t\t\t\tconsole.error(`Unexpected players length ${aliveColors}`);\n\t\t\t\treturn 0;\n\t\t}\n\t}\n\n\tgetPointsForPiece(): number {\n\t\treturn 0;\n\t}\n}\n","import { VariantType } from \"@moveGeneration/GameInformation/GameData\";\nimport { FENData } from \"../../../FENData/FENData\";\nimport { VariantRule } from \"../../VariantRule\";\nimport type { VariantRuleAllowedChecks, VariantRuleHandler } from \"../../VariantRuleInterface\";\n\nconst tag = \"pointsForMate\";\nexport class PointsForMate extends VariantRule<typeof FENData, typeof tag> implements VariantRuleHandler<FENData> {\n\tstatic {\n\t\tVariantRule.initVariantRule(PointsForMate);\n\t}\n\tprivate pointsForMate: number;\n\tconstructor(pointsForMate?: unknown) {\n\t\tsuper();\n\t\tif (typeof pointsForMate === \"number\") {\n\t\t\tthis.pointsForMate = pointsForMate;\n\t\t} else {\n\t\t\tthis.pointsForMate = 20;\n\t\t}\n\t}\n\n\tgetDecoratorType() {\n\t\treturn FENData;\n\t}\n\n\tgetPublicProperties() {\n\t\treturn {\n\t\t\tparameterValue: this.pointsForMate,\n\t\t\tinformation: {\n\t\t\t\tname: `Points for Mate`,\n\t\t\t\ttextualForm: `+${this.pointsForMate}`,\n\t\t\t\tdescription: `Checkmates & king captures are worth ${this.pointsForMate} points`,\n\t\t\t\ttag\n\t\t\t}\n\t\t} as const;\n\t}\n\n\tmatchesPGNDeclaration(match: string) {\n\t\tconst matchArray = match.match(/^PointsForMate=(3|5|10|40)$/i);\n\t\tif (matchArray) {\n\t\t\tthis.pointsForMate = Number(matchArray[1]);\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tserializeToParsingForm(): string {\n\t\treturn `PointsForMate=${this.pointsForMate}`;\n\t}\n\n\tisDisabled({ variantDataRules, gameType }: VariantRuleAllowedChecks): boolean {\n\t\treturn variantDataRules.giveaway || variantDataRules.playForMate || gameType === VariantType.Teams;\n\t}\n\n\tgetParametrizedOptions() {\n\t\tconst options = new Map<string, number>();\n\t\tfor (const value of [20, 3, 5, 10, 40]) options.set(`+${value}`, value);\n\t\treturn options;\n\t}\n\n\tobtainPointsForMate() {\n\t\treturn this.pointsForMate;\n\t}\n}\n","import { throwOnNever } from \"@client/ts/baseTypes\";\nimport { FENData } from \"../../../FENData/FENData\";\nimport { InternalMove, InternalMoveSignature } from \"../../../MoveTree/MoveTreeInterface\";\nimport { VariantRule } from \"../../VariantRule\";\nimport { variantRuleColors, VariantRuleHandler } from \"../../VariantRuleInterface\";\nimport { chessGlyphIndex } from \"@client/fonts/chessGlyphIndex\";\n\nconst tag = \"stalemateOptions\";\nexport const stalemateOptionsValues = {\n\tstalemateLoses: \"loss\",\n\tstalemateWins: \"win\",\n\tstalemateDraws: \"draw\"\n} as const;\nexport type CustomStalemateValue = (typeof stalemateOptionsValues)[keyof typeof stalemateOptionsValues];\nexport const verifyCustomStalemateValue = (v: string): v is CustomStalemateValue => Object.values<string>(stalemateOptionsValues).includes(v);\n\nexport class StalemateOptions extends VariantRule<typeof FENData, typeof tag> implements VariantRuleHandler<FENData> {\n\tstatic {\n\t\tVariantRule.initVariantRule(StalemateOptions);\n\t}\n\tprivate type: CustomStalemateValue | undefined;\n\tprivate isFFA = false;\n\n\tconstructor(type?: unknown) {\n\t\tsuper();\n\t\tif (typeof type === \"string\" && verifyCustomStalemateValue(type)) {\n\t\t\tthis.type = type;\n\t\t} else {\n\t\t\tthis.type = undefined;\n\t\t}\n\t}\n\n\tgetDecoratorType() {\n\t\treturn FENData;\n\t}\n\n\tgetPublicProperties() {\n\t\tconst description =\n\t\t\tthis.type === \"draw\"\n\t\t\t\t? `Stalemate is a draw`\n\t\t\t\t: this.isFFA\n\t\t\t\t? `The remaining players share the points`\n\t\t\t\t: `The stalemated player ${this.type === \"loss\" ? \"loses\" : \"wins\"}`;\n\t\treturn {\n\t\t\tparameterValue: this.type,\n\t\t\tinformation: {\n\t\t\t\tname: \"Stalemate\",\n\t\t\t\tdescription,\n\t\t\t\ttag,\n\t\t\t\tcolor: variantRuleColors.minor,\n\t\t\t\tdisplayIcon: chessGlyphIndex.dollarSign\n\t\t\t}\n\t\t} as const;\n\t}\n\n\tmatchesPGNDeclaration(match: string): boolean {\n\t\tconst matchArray = match.toLowerCase().match(/^Stalemate=(.+)$/i);\n\t\tif (matchArray) {\n\t\t\tconst presumedOption = matchArray[1];\n\t\t\tif (verifyCustomStalemateValue(presumedOption)) {\n\t\t\t\tthis.type = presumedOption;\n\t\t\t}\n\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tserializeToParsingForm(): string {\n\t\treturn `Stalemate=${this.type ?? \"draw\"}`;\n\t}\n\n\tisDisabled(): boolean {\n\t\treturn false;\n\t}\n\t\n\tgetParametrizedOptions() {\n\t\treturn new Map<string, CustomStalemateValue>([\n\t\t\t[\"Draw\", stalemateOptionsValues.stalemateDraws],\n\t\t\t[\"The stalemated player loses\", stalemateOptionsValues.stalemateLoses],\n\t\t\t[\"The stalemated player wins\", stalemateOptionsValues.stalemateWins]\n\t\t]);\n\t}\n\n\tinitDecoratorSettings() {\n\t\tif (this.type === undefined) {\n\t\t\tif (this.decorator.board.gameType.isFFA() && this.decorator.fenOptions.tag(\"dead\").filter(Boolean).length > 2) {\n\t\t\t\tthis.type = \"win\";\n\t\t\t\tthis.isFFA = true;\n\t\t\t} else {\n\t\t\t\tthis.type = \"draw\";\n\t\t\t\tthis.isFFA = false;\n\t\t\t}\n\t\t}\n\n\t\tfor (const decorator of this.wrappingDecorators) decorator.initDecoratorSettings?.();\n\t}\n\n\tprocessInternalMove(internalMove: InternalMove): { stalemates: [boolean, boolean, boolean, boolean] } {\n\t\tconst currentTurn = this.decorator.sideToMove;\n\t\tconst returnValues = this.callHandler(\"processInternalMove\", arguments);\n\t\tif (internalMove.type === InternalMoveSignature.Stalemate) {\n\t\t\tconst pointsForMate = this.decorator.obtainPointsForMate();\n\t\t\tswitch (this.type) {\n\t\t\t\tcase \"loss\":\n\t\t\t\t\tif (!this.isFFA) {\n\t\t\t\t\t\tthis.decorator.points[currentTurn] += pointsForMate;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t// * Fallthrough\n\t\t\t\tcase \"draw\":\n\t\t\t\t\tthis.injectIntoBaseClass(function (this: FENData) {\n\t\t\t\t\t\tthis.spreadPointsBetweenPlayersEvenly();\n\t\t\t\t\t})();\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"win\":\n\t\t\t\t\tthis.decorator.points[this.decorator.sideToMove] += pointsForMate;\n\t\t\t\t\tbreak;\n\t\t\t\tcase undefined:\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tthrowOnNever(this.type);\n\t\t\t}\n\n\t\t\tif (this.decorator.getRealPlayers() === 1) {\n\t\t\t\tthis.decorator.assignGeneralTermination(\"Stalemate\", currentTurn);\n\t\t\t}\n\t\t}\n\n\t\treturn returnValues;\n\t}\n}\n","import type { Tuple } from \"@client/ts/baseTypes\";\nimport { compareCoordinates } from \"../../../Board/BoardInterface\";\nimport { FENData } from \"../../../FENData/FENData\";\nimport { PostMoveResults } from \"../../../FENData/FENDataInterface\";\nimport { colors, totalPlayers, VariantType } from \"../../../GameInformation/GameData\";\nimport { createPieceFromData } from \"../../../GameInformation/GameUnits/PieceString\";\nimport { pieceControlConfigSettings } from \"../../../PieceControl/PieceControlInterface\";\nimport { VariantRule } from \"../../VariantRule\";\nimport { VariantRuleAllowedChecks, variantRuleColors, VariantRuleHandler } from \"../../VariantRuleInterface\";\nimport { DeadKingWalking } from \"./DeadKingWalking\";\nimport { chessGlyphIndex } from \"@client/fonts/chessGlyphIndex\";\n\nconst tag = \"takeover\";\nexport class Takeover extends VariantRule<typeof FENData, typeof tag> implements VariantRuleHandler<FENData> {\n\tstatic {\n\t\tVariantRule.initVariantRule(Takeover);\n\t}\n\treadonly dependencies = new Map([[DeadKingWalking, []]]);\n\n\tgetDecoratorType() {\n\t\treturn FENData;\n\t}\n\tgetPublicProperties() {\n\t\treturn {\n\t\t\tparameterValue: true,\n\t\t\tinformation: {\n\t\t\t\tname: \"Takeover\",\n\t\t\t\tdescription: \"Checkmate players to take control of their pieces\",\n\t\t\t\ttag,\n\t\t\t\tcolor: variantRuleColors.phased,\n\t\t\t\tdisplayIcon: chessGlyphIndex.exchange\n\t\t\t}\n\t\t} as const;\n\t}\n\tmatchesPGNDeclaration(match: string) {\n\t\treturn /^Takeover$/i.test(match);\n\t}\n\tserializeToParsingForm(): string {\n\t\treturn \"Takeover\";\n\t}\n\tisDisabled({ gameType }: VariantRuleAllowedChecks): boolean {\n\t\treturn gameType === VariantType.Teams;\n\t}\n\n\taffectOptions(): PostMoveResults {\n\t\tconst sideToMove = this.decorator.sideToMove,\n\t\t\tdetectedPieces = this.decorator.board.getPlayerPieces();\n\t\tconst results = this.callHandler(\"affectOptions\", arguments);\n\t\tfor (const color of colors) {\n\t\t\tif (!results.checkmates[color]) continue;\n\t\t\tfor (const piece of detectedPieces[sideToMove]) {\n\t\t\t\tconst pieceString = this.decorator.board.board[piece[0]][piece[1]];\n\t\t\t\tif (!pieceString.isDead() || pieceControlConfigSettings[pieceString.piece].moveGenerationSettings.isPawn) continue;\n\t\t\t\tthis.decorator.board.board[piece[0]][piece[1]] = createPieceFromData(sideToMove, pieceString.piece);\n\t\t\t}\n\t\t}\n\n\t\treturn results;\n\t}\n\n\tcountTotalPointsOnBoard(): [number, number, number, number] {\n\t\tconst zombieImmune = this.decorator.fenOptions.tag(\"zombieImmune\"),\n\t\t\troyals = this.decorator.fenOptions.tag(\"royal\");\n\t\tconst resultingPoints: Tuple<number, typeof totalPlayers> = [0, 0, 0, 0];\n\t\tthis.decorator.board.getPlayerPieces().forEach((army, color) => {\n\t\t\tif (zombieImmune[color]) return;\n\t\t\tconst royal = royals[color];\n\t\t\tfor (const coordinate of army) {\n\t\t\t\tif (royal && compareCoordinates(coordinate, royal)) {\n\t\t\t\t\tresultingPoints[color] += this.decorator.obtainPointsForMate();\n\t\t\t\t} else {\n\t\t\t\t\tconst piece = this.decorator.board.board[coordinate[0]][coordinate[1]].piece;\n\t\t\t\t\tresultingPoints[color] += pieceControlConfigSettings[piece].points.singlesPoints;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\treturn resultingPoints;\n\t}\n}\n","import { FENData } from \"../../../FENData/FENData\";\nimport { PostMoveResults } from \"../../../FENData/FENDataInterface\";\nimport { VariantRule } from \"../../VariantRule\";\nimport type { VariantRuleHandler } from \"../../VariantRuleInterface\";\n\nconst tag = \"threefoldRepetition\";\nexport class ThreefoldRepetition extends VariantRule<typeof FENData, typeof tag> implements VariantRuleHandler<FENData> {\n\tstatic {\n\t\tVariantRule.initVariantRule(ThreefoldRepetition);\n\t}\n\tprivate totalRepetitionsRequired: number;\n\n\tconstructor(totalRepetitions?: unknown) {\n\t\tsuper();\n\t\tif (typeof totalRepetitions === \"number\" && totalRepetitions > 0) {\n\t\t\tthis.totalRepetitionsRequired = totalRepetitions;\n\t\t} else {\n\t\t\tthis.totalRepetitionsRequired = 3;\n\t\t}\n\t}\n\n\tgetDecoratorType() {\n\t\treturn FENData;\n\t}\n\n\tgetPublicProperties() {\n\t\tconst isDisabled = this.totalRepetitionsRequired === Infinity;\n\t\treturn {\n\t\t\tparameterValue: this.totalRepetitionsRequired,\n\t\t\tinformation: {\n\t\t\t\tname: \"N-fold Repetition\",\n\t\t\t\ttextualForm: \"\",\n\t\t\t\tdescription: isDisabled\n\t\t\t\t\t? \"3-fold repetition disabled\"\n\t\t\t\t\t: `After position repeats ${this.totalRepetitionsRequired} times game is over`,\n\t\t\t\ttag\n\t\t\t}\n\t\t} as const;\n\t}\n\n\tmatchesPGNDeclaration(match: string) {\n\t\tconst matchArray = match.match(/^ThreefoldRepetition=((?:\\d+)|(?:Infinity))$/i);\n\t\tif (matchArray) {\n\t\t\tthis.totalRepetitionsRequired = Number(matchArray[1]);\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tserializeToParsingForm(): string {\n\t\treturn `ThreefoldRepetition=${this.totalRepetitionsRequired}`;\n\t}\n\n\tisDisabled(): boolean {\n\t\treturn false;\n\t}\n\n\tgetParametrizedOptions() {\n\t\tconst options = new Map<string, number>();\n\t\tfor (const value of [3, 2, 5]) options.set(`${value}-fold`, value);\n\t\toptions.set(\"Unlimited\", Infinity);\n\t\treturn options;\n\t}\n\n\taffectOptions(): PostMoveResults {\n\t\tconst results = this.callHandler(\"affectOptions\", arguments);\n\t\tconst repetitions = this.decorator.board.moves.getHash(this.decorator.board.moves.constructPreliminaryHashString(this.decorator.board));\n\n\t\tif (repetitions + 1 >= this.totalRepetitionsRequired) {\n\t\t\tthis.decorator.assignGeneralTermination(\"Threefold Repetition\");\n\t\t\tthis.injectIntoBaseClass(function (this: FENData) {\n\t\t\t\tthis.spreadPointsBetweenPlayersEvenly();\n\t\t\t})();\n\t\t}\n\n\t\treturn results;\n\t}\n}\n","import { createTuple } from \"../../../../../baseTypes\";\nimport { totalPlayers } from \"../../../GameInformation/GameData\";\nimport { PieceControl } from \"../../../PieceControl/PieceControl\";\nimport type { ControlConfiguration } from \"@moveGeneration/PieceControl/PieceControlInterface\";\nimport { VariantRule } from \"../../VariantRule\";\nimport { variantRuleColors, VariantRuleHandler } from \"../../VariantRuleInterface\";\nimport { chessGlyphIndex } from \"@client/fonts/chessGlyphIndex\";\n\nconst tag = \"anyCapture\";\nexport class AnyCapture extends VariantRule<typeof PieceControl, typeof tag> implements VariantRuleHandler<PieceControl> {\n\tstatic {\n\t\tVariantRule.initVariantRule(AnyCapture);\n\t}\n\n\tgetDecoratorType() {\n\t\treturn PieceControl;\n\t}\n\n\tgetPublicProperties() {\n\t\treturn {\n\t\t\tparameterValue: true,\n\t\t\tinformation: {\n\t\t\t\tname: \"Any Capture\",\n\t\t\t\tdescription: \"You can capture your own pieces\",\n\t\t\t\ttag,\n\t\t\t\tcolor: variantRuleColors.autogenous,\n\t\t\t\tdisplayIcon: chessGlyphIndex.captureAnything\n\t\t\t}\n\t\t} as const;\n\t}\n\n\tmatchesPGNDeclaration(match: string): boolean {\n\t\treturn /^AnyCapture$/i.test(match);\n\t}\n\n\tserializeToParsingForm(): string {\n\t\treturn \"AnyCapture\";\n\t}\n\n\tisDisabled(): boolean {\n\t\treturn false;\n\t}\n\n\tconfigure(configuration: Required<ControlConfiguration>) {\n\t\tconst modifiedConfiguration: Required<ControlConfiguration> = {\n\t\t\t...configuration,\n\t\t\timmunePieces: createTuple(false, totalPlayers)\n\t\t};\n\n\t\tfor (const decorator of this.wrappingDecorators) {\n\t\t\tif (decorator.configure) return decorator.configure(modifiedConfiguration);\n\t\t}\n\t\treturn PieceControl.prototype.configure.call(this.decorator, modifiedConfiguration);\n\t}\n}\n","import { PieceLetter, verifyPieceLetter, pieceControlConfigSettings, defaultPieces } from \"@moveGeneration/PieceControl/PieceControlInterface\";\nimport { compileEnumeration, prefixWithIndefiniteArticle } from \"@client/ts/utils/StringFormatUtils\";\nimport { PieceControl } from \"../../../PieceControl/PieceControl\";\nimport { VariantRule } from \"../../VariantRule\";\nimport type { VariantRuleHandler } from \"../../VariantRuleInterface\";\n\nconst tag = \"promotionPieces\";\nexport class PromoteTo extends VariantRule<typeof PieceControl, typeof tag> implements VariantRuleHandler<PieceControl> {\n\tstatic {\n\t\tVariantRule.initVariantRule(PromoteTo);\n\t}\n\n\tstatic filterPromotionPieceString(pieces: string): PieceLetter[] {\n\t\tconst inputPromotion = pieces.split(\"\").filter<PieceLetter>((p): p is PieceLetter => verifyPieceLetter(p));\n\t\treturn inputPromotion.length ? inputPromotion : [defaultPieces.queen, defaultPieces.rook, defaultPieces.bishop, defaultPieces.knight];\n\t}\n\n\tprivate promotionPieces: PieceLetter[];\n\tconstructor(promotionPieces?: unknown) {\n\t\tsuper();\n\t\tthis.promotionPieces =\n\t\t\tArray.isArray(promotionPieces) &&\n\t\t\tpromotionPieces.every<PieceLetter>((p): p is PieceLetter => typeof p === \"string\" && verifyPieceLetter(p))\n\t\t\t\t? promotionPieces\n\t\t\t\t: [defaultPieces.queen, defaultPieces.rook, defaultPieces.bishop, defaultPieces.knight];\n\t}\n\n\tgetDecoratorType() {\n\t\treturn PieceControl;\n\t}\n\n\tgetPublicProperties() {\n\t\tconst pieceNames = this.promotionPieces.reduce<string[]>((p, c) => {\n\t\t\tconst pieceName = pieceControlConfigSettings[c].naming.name;\n\t\t\treturn [...p, pieceName];\n\t\t}, []);\n\t\treturn {\n\t\t\tparameterValue: this.promotionPieces,\n\t\t\tinformation: {\n\t\t\t\tname: \"Pawns promote to\",\n\t\t\t\ttextualForm: \"\",\n\t\t\t\tdescription: `Pawns promote to ${prefixWithIndefiniteArticle(compileEnumeration(pieceNames))}`,\n\t\t\t\ttag\n\t\t\t}\n\t\t} as const;\n\t}\n\n\tmatchesPGNDeclaration(match: string): boolean {\n\t\tconst matchArray = match.match(/^PromoteTo=([A-ZxΘ]+)$/i);\n\t\tif (matchArray) {\n\t\t\tthis.promotionPieces = PromoteTo.filterPromotionPieceString(matchArray[1]);\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tserializeToParsingForm(): string {\n\t\treturn `PromoteTo=${this.promotionPieces.join(\"\")}`;\n\t}\n\n\tisDisabled(): boolean {\n\t\treturn false;\n\t}\n\n\tinitDecoratorSettings(): void {\n\t\tif (this.decorator.hooks.usePawnLogic) {\n\t\t\tthis.decorator.hooks.usePawnLogic.promotionPieces = this.promotionPieces;\n\t\t}\n\n\t\tfor (const decorator of this.wrappingDecorators) decorator.initDecoratorSettings?.();\n\t}\n}\n","import { formatOrdinalNumber } from \"@client/ts/utils/StringFormatUtils\";\nimport { boardDimension } from \"../../../GameInformation/GameData\";\nimport { PieceControl } from \"../../../PieceControl/PieceControl\";\nimport { VariantRule } from \"../../VariantRule\";\nimport type { VariantRuleHandler } from \"../../VariantRuleInterface\";\n\nconst tag = \"promotionRank\";\nexport const disabledRank = 99;\nexport class PromotionRank extends VariantRule<typeof PieceControl, typeof tag> implements VariantRuleHandler<PieceControl> {\n\tstatic {\n\t\tVariantRule.initVariantRule(PromotionRank);\n\t}\n\n\tprivate promotionRank: number;\n\tconstructor(promotionRank?: unknown) {\n\t\tsuper();\n\t\tthis.promotionRank = typeof promotionRank === \"number\" ? promotionRank : 8;\n\t}\n\n\tgetDecoratorType() {\n\t\treturn PieceControl;\n\t}\n\n\tgetPublicProperties() {\n\t\treturn {\n\t\t\tparameterValue: this.promotionRank,\n\t\t\tinformation: {\n\t\t\t\tname: \"Promotion Rank\",\n\t\t\t\ttextualForm: \"\",\n\t\t\t\tdescription: `on the ${this.promotionRank}${formatOrdinalNumber(this.promotionRank)} rank`,\n\t\t\t\ttag\n\t\t\t}\n\t\t} as const;\n\t}\n\n\tmatchesPGNDeclaration(match: string): boolean {\n\t\tconst matchArray = match.match(/^Prom=(\\d\\d?)$/i);\n\t\tif (matchArray) {\n\t\t\tthis.promotionRank = Number(matchArray[1]);\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tserializeToParsingForm(): string {\n\t\treturn `Prom=${this.promotionRank}`;\n\t}\n\n\tisDisabled(): boolean {\n\t\treturn false;\n\t}\n\n\tgetParametrizedOptions() {\n\t\tconst resultingMap = new Map<string, number>();\n\t\tfor (let i = 1; i <= boardDimension; i++) {\n\t\t\tresultingMap.set(String(i) + formatOrdinalNumber(i), i);\n\t\t}\n\t\tresultingMap.set(\"No promotion\", disabledRank);\n\t\treturn resultingMap;\n\t}\n\n\tinitDecoratorSettings(): void {\n\t\tif (this.decorator.hooks.usePawnLogic) {\n\t\t\tthis.decorator.hooks.usePawnLogic.promotionRanks = [\n\t\t\t\tboardDimension - this.promotionRank,\n\t\t\t\tthis.promotionRank - 1,\n\t\t\t\tthis.promotionRank - 1,\n\t\t\t\tboardDimension - this.promotionRank\n\t\t\t];\n\t\t}\n\n\t\tfor (const decorator of this.wrappingDecorators) decorator.initDecoratorSettings?.();\n\t}\n}\n","import { chessGlyphIndex } from \"@client/fonts/chessGlyphIndex\";\nimport { PieceControl } from \"../../../PieceControl/PieceControl\";\nimport { AttackType, PieceControlConfiguration } from \"../../../PieceControl/PieceControlInterface\";\nimport { VariantRule } from \"../../VariantRule\";\nimport { variantRuleColors, VariantRuleHandler } from \"../../VariantRuleInterface\";\n\nconst tag = \"royalsCannotCapture\";\nexport class RoyalsCannotCapture extends VariantRule<typeof PieceControl, typeof tag> implements VariantRuleHandler<PieceControl> {\n\tgetDecoratorType() {\n\t\treturn PieceControl;\n\t}\n\n\tgetPublicProperties() {\n\t\treturn {\n\t\t\tparameterValue: true,\n\t\t\tinformation: {\n\t\t\t\tname: \"Royals Cannot Capture\",\n\t\t\t\tdescription: \"Royal pieces cannot capture pieces.\",\n\t\t\t\ttag,\n\t\t\t\tcolor: variantRuleColors.autogenous,\n\t\t\t\tdisplayIcon: chessGlyphIndex.handshake\n\t\t\t}\n\t\t} as const;\n\t}\n\n\tmatchesPGNDeclaration(): boolean {\n\t\treturn false;\n\t}\n\n\tserializeToParsingForm(): string {\n\t\treturn \"\";\n\t}\n\n\tisDisabled(): boolean {\n\t\treturn false;\n\t}\n\n\tgetMovePossibility(configuration: PieceControlConfiguration): boolean {\n\t\tconst royal = this.decorator.fenData.fenOptions.tag(\"royal\")[this.decorator.color];\n\t\tif (royal && royal[0] === this.decorator.i && royal[1] === this.decorator.j) {\n\t\t\tconfiguration.special = AttackType.MoveOnly;\n\t\t}\n\n\t\tfor (const decorator of this.wrappingDecorators) {\n\t\t\tif (decorator.getMovePossibility) return decorator.getMovePossibility(configuration);\n\t\t}\n\t\treturn PieceControl.prototype.getMovePossibility.call(this.decorator, configuration);\n\t}\n}\n","import { AttackType } from \"@moveGeneration/PieceControl/PieceControlInterface\";\nimport { PieceControl } from \"../../../PieceControl/PieceControl\";\nimport { VariantRule } from \"../../VariantRule\";\nimport { variantRuleColors, VariantRuleHandler } from \"../../VariantRuleInterface\";\nimport { chessGlyphIndex } from \"@client/fonts/chessGlyphIndex\";\n\nconst tag = \"sideways\";\nexport class Sideways extends VariantRule<typeof PieceControl, typeof tag> implements VariantRuleHandler<PieceControl> {\n\tstatic {\n\t\tVariantRule.initVariantRule(Sideways);\n\t}\n\n\tgetDecoratorType() {\n\t\treturn PieceControl;\n\t}\n\n\tgetPublicProperties() {\n\t\treturn {\n\t\t\tparameterValue: true,\n\t\t\tinformation: {\n\t\t\t\tname: \"Sideways\",\n\t\t\t\tdescription: \"Pawns can also move one square sideways\",\n\t\t\t\ttag,\n\t\t\t\tcolor: variantRuleColors.autogenous,\n\t\t\t\tdisplayIcon: chessGlyphIndex.pawnSideways\n\t\t\t}\n\t\t} as const;\n\t}\n\n\tmatchesPGNDeclaration(match: string): boolean {\n\t\treturn /^Sideways$/i.test(match);\n\t}\n\n\tserializeToParsingForm(): string {\n\t\treturn \"Sideways\";\n\t}\n\n\tisDisabled(): boolean {\n\t\treturn false;\n\t}\n\n\tgetPossibleCells() {\n\t\tif (this.decorator.hooks.usePawnLogic) {\n\t\t\tthis.injectIntoBaseClass(function (this: PieceControl) {\n\t\t\t\tthis.generateJumpAttack({ displacement: [0, -1], special: AttackType.MoveOnly });\n\t\t\t\tthis.generateJumpAttack({ displacement: [0, 1], special: AttackType.MoveOnly });\n\t\t\t})();\n\t\t}\n\n\t\tfor (const decorator of this.wrappingDecorators) {\n\t\t\tif (decorator.getPossibleCells) return decorator.getPossibleCells();\n\t\t}\n\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n\t\tconst prototype: PieceControl = Object.getPrototypeOf(this.decorator);\n\t\tprototype.getPossibleCells.call(this.decorator);\n\t}\n}\n","import { PieceControl } from \"../../../PieceControl/PieceControl\";\nimport { AttackType, PieceControlConfiguration } from \"../../../PieceControl/PieceControlInterface\";\nimport { VariantRule } from \"../../VariantRule\";\nimport type { VariantRuleHandler } from \"../../VariantRuleInterface\";\n\nconst tag = \"stonewall\";\nexport class Stonewall extends VariantRule<typeof PieceControl, typeof tag> implements VariantRuleHandler<PieceControl> {\n\tstatic {\n\t\tVariantRule.initVariantRule(Stonewall);\n\t}\n\n\tgetDecoratorType() {\n\t\treturn PieceControl;\n\t}\n\n\tgetPublicProperties() {\n\t\treturn {\n\t\t\tparameterValue: true,\n\t\t\tinformation: {\n\t\t\t\tname: \"Stonewall\",\n\t\t\t\ttextualForm: \"\",\n\t\t\t\tdescription: \"Dead pieces cannot be captured\",\n\t\t\t\ttag\n\t\t\t}\n\t\t} as const;\n\t}\n\n\tmatchesPGNDeclaration(match: string): boolean {\n\t\treturn /^Deadwall$/i.test(match);\n\t}\n\n\tserializeToParsingForm(): string {\n\t\treturn \"Deadwall\";\n\t}\n\n\tisDisabled(): boolean {\n\t\treturn false;\n\t}\n\n\tgetMovePossibility(configuration: PieceControlConfiguration): boolean {\n\t\tconst {\n\t\t\tdisplacement: [i, j],\n\t\t\tspecial\n\t\t} = configuration;\n\t\tlet modifiedConfiguration = configuration;\n\n\t\tif (\n\t\t\t(special === AttackType.AttackOnly || special === AttackType.Normal || special === AttackType.RayGen) &&\n\t\t\tthis.decorator.board[i] &&\n\t\t\tthis.decorator.board[i][j] &&\n\t\t\tthis.decorator.board[i][j].isDead()\n\t\t) {\n\t\t\tmodifiedConfiguration = {\n\t\t\t\t...configuration,\n\t\t\t\tspecial: AttackType.MoveOnly\n\t\t\t};\n\t\t}\n\n\t\tfor (const decorator of this.wrappingDecorators) {\n\t\t\tif (decorator.getMovePossibility) return decorator.getMovePossibility(configuration);\n\t\t}\n\t\treturn PieceControl.prototype.getMovePossibility.call(this.decorator, modifiedConfiguration);\n\t}\n}\n","import type { ControlConfiguration } from \"@moveGeneration/PieceControl/PieceControlInterface\";\nimport { PieceControl } from \"../../../PieceControl/PieceControl\";\nimport { VariantRule } from \"../../VariantRule\";\nimport { variantRuleColors, VariantRuleHandler } from \"../../VariantRuleInterface\";\nimport { chessGlyphIndex } from \"@client/fonts/chessGlyphIndex\";\n\nconst tag = \"torpedo\";\nexport class Torpedo extends VariantRule<typeof PieceControl, typeof tag> implements VariantRuleHandler<PieceControl> {\n\tstatic {\n\t\tVariantRule.initVariantRule(Torpedo);\n\t}\n\n\tgetDecoratorType() {\n\t\treturn PieceControl;\n\t}\n\n\tgetPublicProperties() {\n\t\treturn {\n\t\t\tparameterValue: true,\n\t\t\tinformation: {\n\t\t\t\tname: \"Torpedo\",\n\t\t\t\tdescription: \"Pawns can always jump two squares\",\n\t\t\t\ttag,\n\t\t\t\tcolor: variantRuleColors.autogenous,\n\t\t\t\tdisplayIcon: chessGlyphIndex.torpedo\n\t\t\t}\n\t\t} as const;\n\t}\n\n\tmatchesPGNDeclaration(match: string): boolean {\n\t\treturn /^Torpedo$/i.test(match);\n\t}\n\n\tserializeToParsingForm(): string {\n\t\treturn \"Torpedo\";\n\t}\n\n\tisDisabled(): boolean {\n\t\treturn false;\n\t}\n\n\tconfigure(configuration: ControlConfiguration) {\n\t\tconst modifiedConfiguration: ControlConfiguration = {\n\t\t\t...configuration,\n\t\t\tbaseRank: true\n\t\t};\n\n\t\tfor (const decorator of this.wrappingDecorators) {\n\t\t\tif (decorator.configure) return decorator.configure(modifiedConfiguration);\n\t\t}\n\t\tPieceControl.prototype.configure.call(this.decorator, modifiedConfiguration);\n\t}\n}\n","import type { FunctionType, Tuple } from \"@client/ts/baseTypes\";\nimport { createHexColor, IndexedColor } from \"@client/ts/interfaces/Colors\";\nimport type { FENOptionsTags } from \"@moveGeneration/FENData/FENOptions/FENOptionsTagsInterface\";\nimport type { Coordinate } from \"@moveGeneration/GameInformation/GameUnits/GameUnits\";\nimport type { Board } from \"../Board/Board\";\nimport type { FENData } from \"../FENData/FENData\";\nimport type { totalPlayers, VariantType } from \"../GameInformation/GameData\";\nimport type { PieceControl } from \"../PieceControl/PieceControl\";\nimport type { PieceLetter } from \"../PieceControl/PieceControlInterface\";\nimport type { CustomStalemateValue } from \"./VariantRuleDefinitions/FENDataDecorators/StalemateOptions\";\nimport type { StripPieceStringObjects } from \"@moveGeneration/MoveTree/MoveTreeInterface\";\n\nexport interface VariantHandlerTarget<C extends AllowedHandlerClasses> {\n\t__baseClass: C;\n\tinitDecoratorSettings(): void;\n}\n\nexport type FunctionProperties<T> = Pick<T, { [K in keyof T]: T[K] extends FunctionType ? K : never }[keyof T]>;\nexport type AllowedHandlerClasses = Board | FENData | PieceControl;\nexport type AllowedSuperClasses = typeof Board | typeof FENData | typeof PieceControl;\n\nexport type VariantRuleHandler<C extends AllowedHandlerClasses> = {\n\t[K in keyof FunctionProperties<C>]?: C[K];\n};\n\ninterface BaseVariantRuleInformation<K extends keyof VariantDataRules> {\n\tname: string;\n\tdescription: string;\n\ttag: K;\n}\ninterface TextualVariantRuleInformation<K extends keyof VariantDataRules> extends BaseVariantRuleInformation<K> {\n\ttextualForm: string;\n\tcolor?: never;\n\tdisplayIcon?: never;\n}\ninterface StandardVariantRuleInformation<K extends keyof VariantDataRules> extends BaseVariantRuleInformation<K> {\n\ttextualForm?: never;\n\tcolor: IndexedColor;\n\tdisplayIcon: string;\n}\nexport type VariantRuleInformation<K extends keyof VariantDataRules> =\n\t| Readonly<StandardVariantRuleInformation<K>>\n\t| Readonly<TextualVariantRuleInformation<K>>;\n\nexport interface VariantRuleAllowedChecks {\n\treadonly variantDataRules: VariantDataRules | StripPieceStringObjects<VariantDataRules>;\n\treadonly gameType: VariantType;\n\treadonly fenTags: FENOptionsTags;\n}\n\nexport interface VariantDataRules {\n\talternativeTeams: number | false;\n\tblindfold: boolean;\n\tcaptureTheKing: boolean;\n\tchess960: number | false;\n\tcrazyhouse: boolean;\n\tghostboard: boolean;\n\tparadigmChess30: number | false;\n\ttaboo: boolean;\n\tenPassant: boolean;\n\tfatalCapture: boolean;\n\tpiecesGoToBanks: boolean;\n\tanyCapture: boolean;\n\tpromotionPieces: PieceLetter[] | false;\n\tpromotionRank: number | false;\n\tsideways: boolean;\n\tstonewall: boolean;\n\ttorpedo: boolean;\n\toppositeSideCastling: boolean;\n\tsetupChess: number | false;\n\tpiecesFaceCenter: boolean;\n\troyalsCannotCapture: boolean;\n\tseirawanSetup: boolean;\n\tatomic: boolean;\n\tfogOfWar: boolean;\n\tanonymous: boolean;\n\tsemiAnonymous: boolean;\n\tstalemateOptions: CustomStalemateValue | undefined;\n\tforcedCapture: boolean;\n\tgiveaway: boolean;\n\tallowPassing: boolean;\n\tpointsForMate: number | false;\n\ttakeover: boolean;\n\tkingOfTheHill: Coordinate[] | false;\n\tbarePieceRule: boolean;\n\tduckChess: boolean;\n\tplayForMate: boolean;\n\toppositeMultiplier: number | false;\n\tnCheck: Tuple<number, typeof totalPlayers> | false;\n\tselfCheck: boolean;\n\tfiftyMoveRule: number | false;\n\tthreefoldRepetition: number | false;\n\tselfPartner: boolean;\n\tdeadKingWalking: boolean;\n}\n\nexport const variantRuleColors = {\n\tminor: createHexColor(\"#e01492\"),\n\tvisual: createHexColor(\"#ad5709\"),\n\tautogenous: createHexColor(\"#f2791e\"),\n\tmetadata: createHexColor(\"#89a5d3\"),\n\tstartingPosition: createHexColor(\"#7030a0\"),\n\textending: createHexColor(\"#fbaa07\"),\n\twidespread: createHexColor(\"#d40c0c\"),\n\tpointsAlternation: createHexColor(\"#00b0f0\"),\n\tphased: createHexColor(\"#00b050\")\n} as const;\n","import { Board } from \"../Board/Board\";\nimport { FENData } from \"../FENData/FENData\";\nimport { PieceControl } from \"../PieceControl/PieceControl\";\nimport { ForcedCapture } from \"./VariantRuleDefinitions/BoardDecorators/ForcedCapture\";\nimport { SeirawanSetup } from \"./VariantRuleDefinitions/BoardDecorators/SeirawanSetup\";\nimport { SetupChess } from \"./VariantRuleDefinitions/BoardDecorators/SetupChess\";\nimport { Taboo } from \"./VariantRuleDefinitions/BoardDecorators/Taboo\";\nimport { FiftyMoveRule } from \"./VariantRuleDefinitions/FENDataDecorators/FiftyMoveRule\";\nimport { Giveaway } from \"./VariantRuleDefinitions/FENDataDecorators/Giveaway\";\nimport { StalemateOptions } from \"./VariantRuleDefinitions/FENDataDecorators/StalemateOptions\";\nimport { ThreefoldRepetition } from \"./VariantRuleDefinitions/FENDataDecorators/ThreefoldRepetition\";\nimport { PromoteTo } from \"./VariantRuleDefinitions/PieceControlDecorators/PromoteTo\";\nimport { PromotionRank } from \"./VariantRuleDefinitions/PieceControlDecorators/PromotionRank\";\nimport { VariantRule, VariantRulePublicProperties } from \"./VariantRule\";\nimport type { AllowedSuperClasses, VariantDataRules, VariantRuleAllowedChecks } from \"./VariantRuleInterface\";\n\nexport interface VariantRuleParsingTypes {\n\tboardDecorators: Array<VariantRule<typeof Board, keyof VariantDataRules>>;\n\tpieceControlDecorators: Array<VariantRule<typeof PieceControl, keyof VariantDataRules>>;\n\tfenDataDecorators: Array<VariantRule<typeof FENData, keyof VariantDataRules>>;\n\t[Symbol.iterator]: () => Generator<VariantRule<AllowedSuperClasses, keyof VariantDataRules>, void>;\n}\nexport const createBaseParsingTypes = (): VariantRuleParsingTypes => ({\n\tboardDecorators: [],\n\tpieceControlDecorators: [],\n\tfenDataDecorators: [],\n\t*[Symbol.iterator]() {\n\t\tfor (const rv of [...this.boardDecorators, ...this.pieceControlDecorators, ...this.fenDataDecorators]) {\n\t\t\tconst variantRule: VariantRule<AllowedSuperClasses, keyof VariantDataRules> = rv;\n\t\t\tyield variantRule;\n\t\t}\n\t}\n});\n\nconst variantRulePriorities = [SetupChess, ForcedCapture, Taboo, SeirawanSetup, PromoteTo, PromotionRank, Giveaway].reverse();\n\nfunction differentiateDecoratorMethods(\n\tvariant: VariantRule<AllowedSuperClasses, keyof VariantDataRules>,\n\tmethods: {\n\t\t[K in keyof Omit<VariantRuleParsingTypes, symbol>]: (\n\t\t\tvariant: VariantRuleParsingTypes[K] extends Array<VariantRule<infer C, keyof VariantDataRules>>\n\t\t\t\t? VariantRule<C, keyof VariantDataRules>\n\t\t\t\t: never\n\t\t) => void;\n\t}\n) {\n\tconst verifyDecorator = <C extends typeof Board | typeof PieceControl | typeof FENData>(\n\t\trv: VariantRule<AllowedSuperClasses, keyof VariantDataRules>,\n\t\ttype: C\n\t): rv is VariantRule<C, keyof VariantDataRules> => rv.getDecoratorType() === type;\n\n\tif (verifyDecorator(variant, Board)) {\n\t\tmethods.boardDecorators(variant);\n\t} else if (verifyDecorator(variant, PieceControl)) {\n\t\tmethods.pieceControlDecorators(variant);\n\t} else if (verifyDecorator(variant, FENData)) {\n\t\tmethods.fenDataDecorators(variant);\n\t}\n}\n\nexport function parseVariantRules(rules: string): VariantRuleParsingTypes {\n\ttype VariantRuleConstructor = new (...args: unknown[]) => VariantRule<AllowedSuperClasses, keyof VariantDataRules>;\n\tconst variantClasses = new Set<VariantRuleConstructor>();\n\tconst variantRuleList = new Set<VariantRule<AllowedSuperClasses, keyof VariantDataRules>>();\n\tconst forcedRules = [PromotionRank, PromoteTo, StalemateOptions, FiftyMoveRule, ThreefoldRepetition];\n\tfor (const variantRule of VariantRule.variantRuleList) {\n\t\tconst rv = new variantRule();\n\t\tvariantRuleList.add(rv);\n\t\tvariantClasses.add(variantRule);\n\t}\n\n\tconst finalList = createBaseParsingTypes();\n\tconst rulesStrings = rules.split(/\\s+/);\n\n\tconst insertVariantRule = (variant: VariantRule<AllowedSuperClasses, keyof VariantDataRules>) => {\n\t\tdifferentiateDecoratorMethods(variant, {\n\t\t\tboardDecorators: (variant: VariantRule<typeof Board, keyof VariantDataRules>) => {\n\t\t\t\tfinalList.boardDecorators.push(variant);\n\t\t\t},\n\t\t\tpieceControlDecorators: (variant: VariantRule<typeof PieceControl, keyof VariantDataRules>) => {\n\t\t\t\tfinalList.pieceControlDecorators.push(variant);\n\t\t\t},\n\t\t\tfenDataDecorators: (variant: VariantRule<typeof FENData, keyof VariantDataRules>) => {\n\t\t\t\tfinalList.fenDataDecorators.push(variant);\n\t\t\t}\n\t\t});\n\n\t\tfor (const [dependency, dependencyArgs] of variant.dependencies) {\n\t\t\tif (\n\t\t\t\t!Object.values(finalList).some((decorators: Array<VariantRule<AllowedSuperClasses, keyof VariantDataRules>>) =>\n\t\t\t\t\tdecorators.some((rv) => rv instanceof dependency)\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\tinsertVariantRule(new dependency(...dependencyArgs));\n\t\t\t}\n\t\t}\n\t};\n\n\tfor (const variant of variantRuleList) {\n\t\tfor (const ruleString of rulesStrings) {\n\t\t\tif (variant.matchesPGNDeclaration(ruleString)) {\n\t\t\t\tinsertVariantRule(variant);\n\t\t\t\tvariantRuleList.delete(variant);\n\t\t\t}\n\t\t}\n\t}\n\n\tfor (const forcedRule of forcedRules) {\n\t\tconst variant = new forcedRule();\n\t\tdifferentiateDecoratorMethods(variant, {\n\t\t\tboardDecorators: (variant: VariantRule<typeof Board, keyof VariantDataRules>) => {\n\t\t\t\tif (!finalList.boardDecorators.some((rule) => rule instanceof forcedRule)) {\n\t\t\t\t\tfinalList.boardDecorators.push(variant);\n\t\t\t\t}\n\t\t\t},\n\t\t\tpieceControlDecorators: (variant: VariantRule<typeof PieceControl, keyof VariantDataRules>) => {\n\t\t\t\tif (!finalList.pieceControlDecorators.some((rule) => rule instanceof forcedRule)) {\n\t\t\t\t\tfinalList.pieceControlDecorators.push(variant);\n\t\t\t\t}\n\t\t\t},\n\t\t\tfenDataDecorators: (variant: VariantRule<typeof FENData, keyof VariantDataRules>) => {\n\t\t\t\tif (!finalList.fenDataDecorators.some((rule) => rule instanceof forcedRule)) {\n\t\t\t\t\tfinalList.fenDataDecorators.push(variant);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tfor (const rule of variantRulePriorities) {\n\t\tconst resultingRule = new rule();\n\t\tdifferentiateDecoratorMethods(resultingRule, {\n\t\t\tboardDecorators: () => {\n\t\t\t\tconst index = finalList.boardDecorators.findIndex((c) => c instanceof rule);\n\t\t\t\tif (index !== -1) {\n\t\t\t\t\tfinalList.boardDecorators.unshift(finalList.boardDecorators.splice(index, 1)[0]);\n\t\t\t\t}\n\t\t\t},\n\t\t\tpieceControlDecorators: () => {\n\t\t\t\tconst index = finalList.pieceControlDecorators.findIndex((c) => c instanceof rule);\n\t\t\t\tif (index !== -1) {\n\t\t\t\t\tfinalList.pieceControlDecorators.unshift(finalList.pieceControlDecorators.splice(index, 1)[0]);\n\t\t\t\t}\n\t\t\t},\n\t\t\tfenDataDecorators: () => {\n\t\t\t\tconst index = finalList.fenDataDecorators.findIndex((c) => c instanceof rule);\n\t\t\t\tif (index !== -1) {\n\t\t\t\t\tfinalList.fenDataDecorators.unshift(finalList.fenDataDecorators.splice(index, 1)[0]);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\treturn finalList;\n}\n\nexport function compileVariantRuleData(rules: VariantRuleParsingTypes): VariantDataRules {\n\tconst finalObject: Partial<VariantDataRules> = {};\n\tconst variantRuleList = VariantRule.variantRuleList.map((rv) => new rv());\n\tfor (const rule of variantRuleList) {\n\t\tfinalObject[rule.getPublicProperties().information.tag] = false;\n\t}\n\n\tconst setFinalObjectProperty = <K extends keyof VariantDataRules>(properties: VariantRulePublicProperties<K>) => {\n\t\tfinalObject[properties.information.tag] = properties.parameterValue;\n\t};\n\n\tfor (const rule of rules) setFinalObjectProperty(rule.getPublicProperties());\n\treturn finalObject as VariantDataRules;\n}\n\nexport function copyVariantRules<T extends AllowedSuperClasses>(\n\trvs: Array<VariantRule<T, keyof VariantDataRules>>\n): Array<VariantRule<T, keyof VariantDataRules>> {\n\treturn rvs.map((rv) => {\n\t\tconst parameterValue = rv.getPublicProperties().parameterValue;\n\t\tconst parameterArray = parameterValue !== false ? [parameterValue] : [];\n\t\treturn new rv.constructor(parameterArray);\n\t});\n}\n\nexport function validateVariantRules(board: Board) {\n\tconst configuration: VariantRuleAllowedChecks = {\n\t\tvariantDataRules: board.variantData,\n\t\tgameType: board.gameType.type,\n\t\tfenTags: board.data.fenOptions.tags\n\t};\n\treturn {\n\t\t...board.variantRules,\n\t\tboardDecorators: board.variantRules.boardDecorators.filter((rv) => !rv.isDisabled(configuration)),\n\t\tpieceControlDecorators: board.variantRules.pieceControlDecorators.filter((rv) => !rv.isDisabled(configuration)),\n\t\tfenDataDecorators: board.variantRules.fenDataDecorators.filter((rv) => !rv.isDisabled(configuration))\n\t};\n}\n","import { createTupleFromCallback, Tuple } from \"@client/ts/baseTypes\";\nimport {\n\tcolors,\n\tGamePlayerData,\n\tgetPlayerNameFromColor,\n\tplayerNames,\n\tTermination,\n\tTimeControl,\n\ttotalPlayers,\n\tvalidateTerminationString,\n\tVariantType\n} from \"@moveGeneration/GameInformation/GameData\";\nimport { truncateNumber } from \"@utils/NumberUtils\";\nimport type { VariantTag } from \"../TagInterface\";\nimport { tagNamesEqual, unwrapTag, wrapTag } from \"../Utils\";\n\nconst variantTypeTag = \"Variant\";\nexport const createVariantTypeTag = (): VariantTag<VariantType> => ({\n\ttag: \"variantType\",\n\tcurrentValue: VariantType.FFA,\n\tverifyTagInParsing(inputTag) {\n\t\treturn tagNamesEqual(inputTag, variantTypeTag);\n\t},\n\tparseTag(inputTag) {\n\t\tconst tagContents = unwrapTag(inputTag, variantTypeTag);\n\t\tfor (const type of Object.values(VariantType)) {\n\t\t\tif (tagContents === type) return type;\n\t\t}\n\n\t\treturn VariantType.FFA;\n\t},\n\tserialize(board) {\n\t\treturn wrapTag(variantTypeTag, board.gameType.type);\n\t}\n});\n\nconst variantDateTag = \"Date\";\nexport const createDateTag = (): VariantTag<Date> => ({\n\ttag: \"date\",\n\tcurrentValue: new Date(),\n\tverifyTagInParsing(inputTag) {\n\t\treturn tagNamesEqual(inputTag, variantDateTag);\n\t},\n\tparseTag(tagContents) {\n\t\treturn new Date(unwrapTag(tagContents, variantDateTag));\n\t},\n\tserialize(board) {\n\t\tif (!board.gameData.date) return;\n\t\tif (typeof board.gameData.date === \"object\") {\n\t\t\treturn wrapTag(variantDateTag, board.gameData.date.toUTCString());\n\t\t} else {\n\t\t\treturn wrapTag(variantDateTag, board.gameData.date);\n\t\t}\n\t}\n});\n\nconst variantSiteTag = \"Site\";\nexport const createSiteTag = (): VariantTag<string> => ({\n\ttag: \"site\",\n\tcurrentValue: \"\",\n\tverifyTagInParsing(inputTag) {\n\t\treturn tagNamesEqual(inputTag, variantSiteTag);\n\t},\n\tparseTag(tagContents) {\n\t\treturn unwrapTag(tagContents, variantSiteTag);\n\t},\n\tserialize(board) {\n\t\tif (!board.gameData.site) return;\n\t\treturn wrapTag(variantSiteTag, board.gameData.site);\n\t}\n});\n\nconst variantTimeControlTag = \"TimeControl\",\n\tgetDefaultTimeControl = (): TimeControl => ({ baseTime: 180, increment: 2, isDelay: false });\nexport const createTimeControlTag = (): VariantTag<TimeControl> => ({\n\ttag: \"timeControl\",\n\tcurrentValue: getDefaultTimeControl(),\n\tverifyTagInParsing(inputTag) {\n\t\treturn tagNamesEqual(inputTag, variantTimeControlTag);\n\t},\n\tparseTag(inputTag) {\n\t\tconst defaultTC = getDefaultTimeControl();\n\t\tconst matchArray = unwrapTag(inputTag, variantTimeControlTag)\n\t\t\t.match(/^((?:0\\.\\d\\d?)?|(?:\\d\\d?s?))(?:(?:(?:\\+|\\|)(\\d\\d?)(D?))|(\\smin))$/)\n\t\t\t?.slice(1);\n\n\t\tif (matchArray) {\n\t\t\tconst [minutesMatch, secondsMatch, delay] = matchArray;\n\t\t\tif (!secondsMatch) return defaultTC;\n\t\t\tdefaultTC.isDelay = delay ? true : false;\n\t\t\tif (/\\smin/.test(secondsMatch)) {\n\t\t\t\tdefaultTC.increment = 0;\n\t\t\t} else {\n\t\t\t\tdefaultTC.increment = Number(secondsMatch);\n\t\t\t}\n\t\t\tif (minutesMatch.endsWith(\"s\")) {\n\t\t\t\tdefaultTC.baseTime = Math.round(Number(minutesMatch.slice(0, -1)));\n\t\t\t} else {\n\t\t\t\tdefaultTC.baseTime = Number(minutesMatch) * 60;\n\t\t\t}\n\t\t}\n\n\t\treturn defaultTC;\n\t},\n\tserialize(board) {\n\t\tconst timeControl = board.gameData.timeControl;\n\t\tconst noIncrement = timeControl.increment === 0;\n\t\tlet timeControlString = \"\";\n\t\tif (timeControl.baseTime < 60) {\n\t\t\ttimeControlString += noIncrement ? `${timeControl.baseTime * 60} sec` : `${timeControl.baseTime * 60}s`;\n\t\t} else if (timeControl.baseTime > 60 && noIncrement) {\n\t\t\ttimeControlString += `${truncateNumber(timeControl.baseTime / 60, 1)} min`;\n\t\t} else {\n\t\t\ttimeControlString += truncateNumber(timeControl.baseTime / 60, 1);\n\t\t}\n\n\t\tif (!noIncrement) {\n\t\t\ttimeControlString += \"|\";\n\t\t\ttimeControlString += timeControl.increment;\n\t\t}\n\t\tif (timeControl.isDelay) {\n\t\t\ttimeControlString += \"D\";\n\t\t}\n\n\t\treturn wrapTag(variantTimeControlTag, timeControlString);\n\t}\n});\n\nconst variantTerminationTag = \"Termination\";\nexport const createTerminationTag = (): VariantTag<Termination | undefined> => ({\n\ttag: \"termination\",\n\tcurrentValue: undefined,\n\tverifyTagInParsing(inputTag) {\n\t\treturn tagNamesEqual(inputTag, variantTerminationTag);\n\t},\n\tparseTag(inputTag) {\n\t\tconst tagContents = unwrapTag(inputTag, variantTerminationTag);\n\t\treturn validateTerminationString(tagContents) ? tagContents : undefined;\n\t},\n\tserialize(board) {\n\t\tif (!board.gameData.termination) return;\n\t\treturn wrapTag(variantTerminationTag, board.gameData.termination);\n\t}\n});\n\nconst variantGameId = \"GameNr\";\nexport const createGameNumberTag = (): VariantTag<number | undefined> => ({\n\ttag: \"gameNumber\",\n\tcurrentValue: undefined,\n\tverifyTagInParsing(inputTag) {\n\t\treturn tagNamesEqual(inputTag, variantGameId);\n\t},\n\tparseTag(inputTag) {\n\t\tconst id = Number(unwrapTag(inputTag, variantGameId));\n\t\treturn isNaN(id) ? undefined : id;\n\t},\n\tserialize(board) {\n\t\tif (!board.gameData.gameNumber) return;\n\t\treturn wrapTag(variantGameId, board.gameData.gameNumber.toString());\n\t}\n});\n\nexport const createPlayerDataTag = (): VariantTag<Tuple<GamePlayerData, typeof totalPlayers>> => ({\n\ttag: \"playerData\",\n\tcurrentValue: createTupleFromCallback(() => ({}), totalPlayers),\n\tverifyTagInParsing(inputTag) {\n\t\tfor (const color of colors) {\n\t\t\tconst playerName = getPlayerNameFromColor(color);\n\t\t\tif (tagNamesEqual(inputTag, playerName) || tagNamesEqual(inputTag, `${playerName}Elo`)) return true;\n\t\t}\n\n\t\treturn false;\n\t},\n\tparseTag(inputTag) {\n\t\tfor (const color of colors) {\n\t\t\tconst playerName = getPlayerNameFromColor(color);\n\t\t\tconst newCurrentValue: Tuple<GamePlayerData, typeof totalPlayers> = [...this.currentValue];\n\t\t\tif (tagNamesEqual(inputTag, playerName)) {\n\t\t\t\tconst name = unwrapTag(inputTag, playerName);\n\t\t\t\tif (name) newCurrentValue[color] = { ...newCurrentValue[color], name };\n\t\t\t\treturn newCurrentValue;\n\t\t\t} else if (tagNamesEqual(inputTag, `${playerName}Elo`)) {\n\t\t\t\tconst elo = Number(unwrapTag(inputTag, playerName));\n\t\t\t\tif (!isNaN(elo)) newCurrentValue[color] = { ...newCurrentValue[color], elo };\n\t\t\t\treturn newCurrentValue;\n\t\t\t}\n\t\t}\n\n\t\tthrow new Error(\"Tag does not match any player data signature\");\n\t},\n\tserialize(board) {\n\t\tconst uniqueResultingTags: string[] = [];\n\t\tfor (const color of colors) {\n\t\t\tconst playerData = board.gameData.players[color];\n\t\t\tif (playerData.elo) {\n\t\t\t\tuniqueResultingTags.push(wrapTag(`${playerNames[color]}Elo`, String(playerData.elo)));\n\t\t\t}\n\t\t\tif (playerData.name) {\n\t\t\t\tuniqueResultingTags.push(wrapTag(`${playerNames[color]}`, String(playerData.name)));\n\t\t\t}\n\t\t}\n\n\t\treturn uniqueResultingTags.join(\"\\n\");\n\t}\n});\n\nconst resultsTag = \"Results\";\nexport const createResultsTag = (): VariantTag<string> => ({\n\ttag: \"results\",\n\tcurrentValue: \"\",\n\tverifyTagInParsing(inputTag) {\n\t\treturn tagNamesEqual(inputTag, resultsTag);\n\t},\n\tparseTag(tagContents) {\n\t\treturn unwrapTag(tagContents, resultsTag);\n\t},\n\tserialize(board) {\n\t\tif (!board.gameData.result) return;\n\t\treturn wrapTag(resultsTag, board.gameData.result);\n\t}\n});\n","import { createBaseParsingTypes, parseVariantRules, VariantRuleParsingTypes } from \"@moveGeneration/VariantRules/VariantRuleSetup\";\nimport type { VariantTag } from \"../TagInterface\";\nimport { tagNamesEqual, unwrapTag, wrapTag } from \"../Utils\";\n\nconst variantRulesTag = \"RuleVariants\";\nexport const createVariantRulesTag = (): VariantTag<VariantRuleParsingTypes> => ({\n\ttag: \"variantRules\",\n\tcurrentValue: createBaseParsingTypes(),\n\tverifyTagInParsing(inputTag) {\n\t\treturn tagNamesEqual(inputTag, variantRulesTag);\n\t},\n\tparseTag(tagContents) {\n\t\treturn parseVariantRules(unwrapTag(tagContents, variantRulesTag));\n\t},\n\tserialize(board) {\n\t\tconst resultingRuleList: string[] = [];\n\t\tfor (const rule of board.variantRules) {\n\t\t\tconst serializedForm = rule.serializeToParsingForm();\n\t\t\tif (serializedForm) {\n\t\t\t\tresultingRuleList.push(serializedForm);\n\t\t\t}\n\t\t}\n\n\t\treturn wrapTag(variantRulesTag, resultingRuleList.join(\" \"));\n\t}\n});\n","import type { Board } from \"@moveGeneration/Board/Board\";\nimport { createFENDataTag } from \"./TagLogic/FENDataTag\";\nimport * as GenericTags from \"./TagLogic/GameMetadataTags\";\nimport { createVariantRulesTag } from \"./TagLogic/VariantRulesTag\";\n\nexport const createDefaultVariantTags = () => ({\n\tvariantType: GenericTags.createVariantTypeTag(),\n\tstartingPosition: createFENDataTag(),\n\tvariantRules: createVariantRulesTag(),\n\tdate: GenericTags.createDateTag(),\n\tsite: GenericTags.createSiteTag(),\n\ttimeControl: GenericTags.createTimeControlTag(),\n\ttermination: GenericTags.createTerminationTag(),\n\tgameNumber: GenericTags.createGameNumberTag(),\n\tplayerData: GenericTags.createPlayerDataTag(),\n\tresults: GenericTags.createResultsTag()\n});\nexport type VariantTags = ReturnType<typeof createDefaultVariantTags>;\n\nexport interface VariantTag<T> {\n\tcurrentValue: T;\n\treadonly tag: keyof VariantTags;\n\tverifyTagInParsing(inputTag: string): boolean;\n\tparseTag(tagContents: string): T;\n\tserialize(board: Board): string | undefined;\n}\n","import type { Board } from \"@moveGeneration/Board/Board\";\nimport type { GameData } from \"@moveGeneration/GameInformation/GameData\";\nimport { nonPlayablePieces } from \"@moveGeneration/GameInformation/GameUnits/GameUnits\";\nimport type { PieceLetter } from \"@moveGeneration/PieceControl/PieceControlInterface\";\nimport { compileVariantRuleData } from \"@moveGeneration/VariantRules/VariantRuleSetup\";\nimport { parsePGN4Moves } from \"./Moves/ParsePGNMoves\";\nimport { serializePGNMoves } from \"./Moves/SerializePGNMoves\";\nimport { createDefaultVariantTags, VariantTags } from \"./TagInterface\";\n\nexport function parsePGN4(pgn4: string) {\n\tlet pgn4Tags: string[],\n\t\tpgn4Moves = \"\";\n\tconst match = pgn4.match(/(?=1\\.\\s*?[xA-ZΑ-ωa-n0-9-])/);\n\tif (match?.index) {\n\t\tpgn4Moves = pgn4.substring(match.index);\n\t\tpgn4Tags = pgn4\n\t\t\t.substring(0, match.index)\n\t\t\t.split(\"]\")\n\t\t\t.map((t) => t.trim());\n\t} else {\n\t\tpgn4Tags = pgn4.split(\"]\").map((t) => t.trim());\n\t}\n\tconst moves = pgn4Moves.length ? parsePGN4Moves(pgn4Moves) : [];\n\n\tconst variantTags = createDefaultVariantTags();\n\tlet wasFEN4set = false;\n\tfor (const input of pgn4Tags) {\n\t\tlet variantTag: keyof VariantTags;\n\t\tfor (variantTag in variantTags) {\n\t\t\tconst tag = variantTags[variantTag];\n\t\t\tif (Object.prototype.hasOwnProperty.call(variantTags, variantTag) && tag.verifyTagInParsing(input)) {\n\t\t\t\tif (variantTag === \"startingPosition\") wasFEN4set = true;\n\t\t\t\ttag.currentValue = tag.parseTag(input);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\tif (!wasFEN4set) variantTags.startingPosition.currentValue.fenData.fenOptions.setTag(\"noCorners\", true);\n\n\tconst gameData: GameData = {\n\t\tsite: variantTags.site.currentValue,\n\t\tgameNumber: variantTags.gameNumber.currentValue,\n\t\tdate: variantTags.date.currentValue,\n\t\ttimeControl: variantTags.timeControl.currentValue,\n\t\tplayers: variantTags.playerData.currentValue,\n\t\ttermination: variantTags.termination.currentValue,\n\t\tresult: undefined\n\t};\n\n\tconst variantRuleData = compileVariantRuleData(variantTags.variantRules.currentValue);\n\tconst promotionPieces = Array.isArray(variantRuleData.promotionPieces) ? variantRuleData.promotionPieces : [];\n\n\tconst nonPlayablePieceValues: string[] = Object.values(nonPlayablePieces);\n\treturn {\n\t\tgameData,\n\t\tgameType: variantTags.variantType.currentValue,\n\t\tvariantRules: variantTags.variantRules.currentValue,\n\t\tvariantRuleData,\n\t\tboard: variantTags.startingPosition.currentValue.board,\n\t\tfenData: variantTags.startingPosition.currentValue.fenData,\n\t\tpieceSet: new Set<PieceLetter>(\n\t\t\t[...variantTags.startingPosition.currentValue.pieceSet, ...promotionPieces].filter((e) => !nonPlayablePieceValues.includes(e))\n\t\t),\n\t\tmoves\n\t};\n}\n\nexport interface SerializedBoardStrings {\n\tboard: string;\n\tmoves: string;\n}\nconst defaultTags = createDefaultVariantTags();\nexport function serializeBoard(board: Board): SerializedBoardStrings {\n\treturn {\n\t\tboard: Object.values(defaultTags)\n\t\t\t.map((t) => t.serialize(board))\n\t\t\t.filter<string>((v): v is string => v !== undefined)\n\t\t\t.join(\"\\n\"),\n\t\tmoves: serializePGNMoves(board.moves)\n\t};\n}\n","import type { MoveTreeInterface } from \"@moveGeneration/MoveTree/MoveTree\";\nimport type { MoveWrapper } from \"@moveGeneration/MoveTree/MoveTreeInterface\";\n\nexport function serializePGNMoves(moveTree: MoveTreeInterface): string {\n\tlet resultingString = \"\";\n\n\tconst traverse = (moves: MoveWrapper[]) => {\n\t\tfor (const moveWrapper of moves) {\n\t\t\tif (moveWrapper.metadata.currentFullMove) {\n\t\t\t\tresultingString = resultingString.replace(/\\s\\.\\.\\s$/, \"\");\n\t\t\t\tresultingString += ` ${moveWrapper.metadata.currentFullMove}. `;\n\t\t\t}\n\n\t\t\tresultingString += moveWrapper.cachedNames.fullMoveNotation;\n\t\t\tif (moveWrapper.comment) resultingString += ` {${moveWrapper.comment}}`;\n\t\t\tresultingString += \" .. \";\n\n\t\t\tfor (const alternativeLine of moveWrapper.alternativeLines) {\n\t\t\t\tresultingString += \"(.. \";\n\t\t\t\ttraverse(alternativeLine);\n\t\t\t\tresultingString += \" )\";\n\t\t\t}\n\t\t}\n\n\t\tresultingString = resultingString.replace(/\\s\\.\\.\\s$/, \"\");\n\t};\n\n\ttraverse(moveTree.moves);\n\treturn resultingString;\n}\n","import { assertNonUndefined } from \"@client/ts/baseTypes\";\nimport { verifyColorEnumValue, colorEnum } from \"@moveGeneration/GameInformation/GameUnits/GameUnits\";\nimport { duckPieceString, createPieceFromData, deadColorIndex } from \"@moveGeneration/GameInformation/GameUnits/PieceString\";\nimport {\n\tMoveData,\n\tDroppingMove,\n\tInternalMove,\n\tInternalMoveSignature,\n\tSpecialMove,\n\tMoveComponent,\n\tverifyInternalMove,\n\tMoveWrapper,\n\tcreateDummyMoveMetadata,\n\tverifyMoveWrapperProperties,\n\tMove,\n\tverifyRequiredMove\n} from \"@moveGeneration/MoveTree/MoveTreeInterface\";\nimport { verifyPieceLetter } from \"@moveGeneration/PieceControl/PieceControlInterface\";\nimport { parseEnPassantCoordinates, parseSingleCoordinate } from \"../Utils\";\n\nexport const PGN4_SYNTAX = {\n\tSPLIT: \".\",\n\tPIECE_REGEX: /[xA-ZΑ-ωa-nrbyg0-9-=+#@]/,\n\tPIECE_REGEX_SIMPLIFIED: /[A-ZΑ-ωa-n0-9-]/,\n\tMOVE_CAPTURING_REGEX: /^[A-ZΑ-ω]?([a-n]\\d{1,2})(?:-|x[A-ZΑ-ω]?)[A-ZΑ-ω]?([a-n]\\d{1,2})/,\n\tDUCK_MOVE_CAPTURING_REGEX: /Θ([a-n]\\d{1,2})?-([a-n]\\d{1,2})/,\n\tDROPPING_MOVE_CAPTURING_REGEX: /Θ?@([a-z])([A-ZΑ-ω])-([a-n]\\d{1,2})/,\n\tBRACKETS: {\n\t\tCOMMENT_START: \"{\",\n\t\tCOMMENT_END: \"}\",\n\t\tVARIATION_START: \"(\",\n\t\tVARIATION_END: \")\"\n\t},\n\tCOORDINATE_REGEX: /[a-n](?:(?:1[0-4])|(?:[1-9]))/,\n\tCOMMENT_SYNTAXES: {\n\t\tCLOCK: /\\[%timestamp (-?\\d+?)]/,\n\t\tARROWS: /\\[%cal ((?:R|B|Y|G).+?)]/,\n\t\tSQUARES: /\\[%csl ((?:R|B|Y|G).+?)]/,\n\t\tANNOTATION: /\\[%ann (.+?)]/\n\t}\n} as const;\n\nfunction obtainDuckMove(move: string): MoveData | DroppingMove | undefined {\n\tconst match = move.match(PGN4_SYNTAX.DUCK_MOVE_CAPTURING_REGEX);\n\tif (match) {\n\t\tif (match[1]) {\n\t\t\tconst startCoordinates = parseSingleCoordinate(match[1]);\n\t\t\tconst endCoordinates = parseSingleCoordinate(match[2]);\n\t\t\tif (!startCoordinates || !endCoordinates) return;\n\t\t\treturn { startCoordinates, endCoordinates };\n\t\t} else {\n\t\t\tconst endCoordinates = parseSingleCoordinate(match[2]);\n\t\t\tif (!endCoordinates) return;\n\t\t\treturn { piece: duckPieceString, endCoordinates };\n\t\t}\n\t} else return;\n}\n\nfunction obtainInternalType(type: string): InternalMove | undefined {\n\tlet internalMove: keyof typeof InternalMoveSignature;\n\tfor (internalMove in InternalMoveSignature) {\n\t\tif (Object.prototype.hasOwnProperty.call(InternalMoveSignature, internalMove)) {\n\t\t\tif (InternalMoveSignature[internalMove] === type) return { type: InternalMoveSignature[internalMove] };\n\t\t}\n\t}\n}\n\nfunction obtainDroppingMove(move: string): DroppingMove | undefined {\n\tconst match = move.match(PGN4_SYNTAX.DROPPING_MOVE_CAPTURING_REGEX);\n\tif (match) {\n\t\tconst [, color, piece, coordinate] = match;\n\t\tif (!verifyColorEnumValue(color) || !verifyPieceLetter(piece)) return;\n\t\tconst endCoordinates = parseSingleCoordinate(coordinate);\n\t\tif (!endCoordinates) return;\n\t\treturn {\n\t\t\tpiece: createPieceFromData(colorEnum[color], piece),\n\t\t\tendCoordinates\n\t\t};\n\t} else return;\n}\n\nfunction obtainStandardMove(move: string): MoveData | undefined {\n\tconst moveData: MoveData = { startCoordinates: [-1, -1], endCoordinates: [-1, -1] };\n\tconst promotionMatch = move.match(/.*?=([A-Zx])/);\n\tif (promotionMatch?.[1]) {\n\t\tmoveData.promotion = [createPieceFromData(deadColorIndex, promotionMatch[1].charAt(0))];\n\t}\n\n\tconst moveCoordinates = move.match(PGN4_SYNTAX.MOVE_CAPTURING_REGEX);\n\tif (moveCoordinates) {\n\t\tconst startCoordinate = parseSingleCoordinate(moveCoordinates[1]);\n\t\tconst endCoordinate = parseSingleCoordinate(moveCoordinates[2]);\n\n\t\tassertNonUndefined(startCoordinate);\n\t\tassertNonUndefined(endCoordinate);\n\t\tmoveData.startCoordinates = startCoordinate;\n\t\tmoveData.endCoordinates = endCoordinate;\n\n\t\treturn moveData;\n\t} else {\n\t\tif (/O-O-O.*/.test(move)) {\n\t\t\treturn { ...moveData, specialType: SpecialMove.CastlingQueenside };\n\t\t} else if (/O-O.*/.test(move)) {\n\t\t\treturn { ...moveData, specialType: SpecialMove.CastlingKingside };\n\t\t}\n\t}\n}\n\nfunction cloneMoveData(move: MoveComponent): MoveComponent {\n\tif (!verifyInternalMove(move)) {\n\t\tif (\"startCoordinates\" in move) {\n\t\t\tconst newMove: MoveData = {\n\t\t\t\tstartCoordinates: [...move.startCoordinates],\n\t\t\t\tendCoordinates: [...move.endCoordinates]\n\t\t\t};\n\t\t\tif (\"specialType\" in move) {\n\t\t\t\tnewMove.specialType = move.specialType;\n\t\t\t}\n\t\t\tif (\"promotion\" in move) {\n\t\t\t\tnewMove.promotion = move.promotion;\n\t\t\t}\n\t\t\treturn newMove;\n\t\t} else {\n\t\t\treturn {\n\t\t\t\tendCoordinates: move.endCoordinates,\n\t\t\t\tpiece: move.piece\n\t\t\t};\n\t\t}\n\t} else {\n\t\treturn { type: move.type };\n\t}\n}\n\nexport const parsePGN4Moves = (moves: string): MoveWrapper[] => {\n\tconst parseMoves = (selectedMove: string, path: number[]): MoveWrapper[] => {\n\t\tconst moveList: MoveWrapper[] = [];\n\t\tconst currentPath = path;\n\n\t\tfunction getMoveIndexes(mI: number) {\n\t\t\twhile (selectedMove[mI] && PGN4_SYNTAX.PIECE_REGEX.test(selectedMove[mI])) mI++;\n\t\t\treturn mI;\n\t\t}\n\n\t\tfunction parseComment(mI: number) {\n\t\t\twhile (selectedMove[mI] && selectedMove[mI] !== PGN4_SYNTAX.BRACKETS.COMMENT_END) mI++;\n\t\t\treturn mI;\n\t\t}\n\n\t\tfunction getEnumeratorIndex(mI: number) {\n\t\t\twhile (selectedMove[mI] && /\\d|\\./.test(selectedMove[mI])) mI++;\n\t\t\treturn --mI;\n\t\t}\n\n\t\tfunction findBracketIndex(i: number) {\n\t\t\tlet depth = 0;\n\t\t\tfor (; i < selectedMove.length; i++) {\n\t\t\t\tswitch (selectedMove[i]) {\n\t\t\t\t\tcase PGN4_SYNTAX.BRACKETS.COMMENT_START:\n\t\t\t\t\t\ti = parseComment(i);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase PGN4_SYNTAX.BRACKETS.VARIATION_START:\n\t\t\t\t\t\tdepth++;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase PGN4_SYNTAX.BRACKETS.VARIATION_END:\n\t\t\t\t\t\tif (--depth === 0) {\n\t\t\t\t\t\t\treturn i;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthrow new TypeError(\"No matching parentheses for input \" + selectedMove);\n\t\t}\n\n\t\tfunction processMoveDataInsertion() {\n\t\t\tif (currentMoveData) {\n\t\t\t\tcurrentPath.push(++increment);\n\t\t\t\tcurrentMove.path = currentPath.slice();\n\t\t\t\tcurrentPath.pop();\n\t\t\t\tcurrentMove.moveData = currentMoveData.map((m) => cloneMoveData(m));\n\t\t\t\tcurrentMove.metadata = createDummyMoveMetadata();\n\t\t\t\tconst clockSyntax = currentMove.comment?.match(PGN4_SYNTAX.COMMENT_SYNTAXES.CLOCK);\n\t\t\t\tif (clockSyntax && !isNaN(Number(clockSyntax[1]))) {\n\t\t\t\t\tcurrentMove.comment = currentMove.comment?.replace(PGN4_SYNTAX.COMMENT_SYNTAXES.CLOCK, \"\");\n\t\t\t\t\tcurrentMove.metadata.playerClock = Number(clockSyntax[1]);\n\t\t\t\t}\n\t\t\t\tconst arrowSyntax = currentMove.comment?.match(PGN4_SYNTAX.COMMENT_SYNTAXES.ARROWS);\n\t\t\t\tif (arrowSyntax) {\n\t\t\t\t\tconst arrows = arrowSyntax[1].split(\",\");\n\t\t\t\t\tfor (const arrow of arrows) {\n\t\t\t\t\t\tconst [color, coordinate] = [arrow[0], arrow.slice(1)];\n\t\t\t\t\t\tconst numericColor = color.toLowerCase(),\n\t\t\t\t\t\t\tarrowCoordinates = parseEnPassantCoordinates(coordinate);\n\t\t\t\t\t\tif (!verifyColorEnumValue(numericColor) || !arrowCoordinates) continue;\n\t\t\t\t\t\tcurrentMove.metadata.highlightedArrows.push([colorEnum[numericColor], ...arrowCoordinates]);\n\t\t\t\t\t}\n\t\t\t\t\tcurrentMove.comment = currentMove.comment?.replace(PGN4_SYNTAX.COMMENT_SYNTAXES.ARROWS, \"\");\n\t\t\t\t}\n\t\t\t\tconst squareSyntax = currentMove.comment?.match(PGN4_SYNTAX.COMMENT_SYNTAXES.SQUARES);\n\t\t\t\tif (squareSyntax) {\n\t\t\t\t\tconst squares = squareSyntax[1].split(\",\");\n\t\t\t\t\tfor (const square of squares) {\n\t\t\t\t\t\tconst [color, inputCoordinate] = [square[0], square.slice(1)];\n\t\t\t\t\t\tconst numericColor = color.toLowerCase(),\n\t\t\t\t\t\t\tcoordinate = parseSingleCoordinate(inputCoordinate);\n\t\t\t\t\t\tif (!verifyColorEnumValue(numericColor) || !coordinate) continue;\n\t\t\t\t\t\tcurrentMove.metadata.highlightedSquares.push([colorEnum[numericColor], coordinate]);\n\t\t\t\t\t}\n\t\t\t\t\tcurrentMove.comment = currentMove.comment?.replace(PGN4_SYNTAX.COMMENT_SYNTAXES.SQUARES, \"\");\n\t\t\t\t}\n\t\t\t\tconst annotationMatch = currentMove.comment?.match(PGN4_SYNTAX.COMMENT_SYNTAXES.ANNOTATION);\n\t\t\t\tif (annotationMatch) {\n\t\t\t\t\tcurrentMove.metadata.annotation = annotationMatch[1];\n\t\t\t\t\tcurrentMove.comment = currentMove.comment?.replace(PGN4_SYNTAX.COMMENT_SYNTAXES.ANNOTATION, \"\");\n\t\t\t\t}\n\n\t\t\t\tif (verifyMoveWrapperProperties(currentMove)) {\n\t\t\t\t\tmoveList.push(Object.assign({}, currentMove));\n\t\t\t\t} else {\n\t\t\t\t\tconsole.error(`Not all properties of move wrapper are filled out: ${JSON.stringify(currentMove)}`);\n\t\t\t\t}\n\n\t\t\t\tcurrentMove = {\n\t\t\t\t\talternativeLines: [],\n\t\t\t\t\tcomment: \"\"\n\t\t\t\t};\n\t\t\t\tcurrentMoveData = undefined;\n\t\t\t}\n\t\t}\n\n\t\tfunction obtainMoveFromInfo(info: string): Move {\n\t\t\tconst currentMove: MoveComponent[] = [];\n\t\t\tconst internalType = obtainInternalType(info[0]);\n\t\t\tif (info.length === 1 && internalType !== undefined) {\n\t\t\t\treturn [internalType];\n\t\t\t}\n\n\t\t\tconst standardMove = obtainStandardMove(info);\n\t\t\tif (standardMove) currentMove.push(standardMove);\n\t\t\tconst droppingMove = obtainDroppingMove(info);\n\t\t\tif (droppingMove) currentMove.push(droppingMove);\n\t\t\tconst duckMove = obtainDuckMove(info);\n\t\t\tif (duckMove) currentMove.push(duckMove);\n\n\t\t\tif (verifyRequiredMove(currentMove)) {\n\t\t\t\treturn currentMove;\n\t\t\t} else throw new Error(`Move length is 0 for string ${info}`);\n\t\t}\n\n\t\tlet currentMoveData: Move | undefined;\n\t\tlet currentMove: Partial<MoveWrapper> = {\n\t\t\talternativeLines: [],\n\t\t\tcomment: \"\"\n\t\t};\n\n\t\tlet increment = -1,\n\t\t\tvariationIncrement = -1;\n\t\ttry {\n\t\t\tfor (let i = 0; i < selectedMove.length; i++) {\n\t\t\t\tconst isNumNaN = isNaN(Number(selectedMove[i]));\n\t\t\t\tif (isNumNaN && !/\\s/.test(selectedMove[i]) && selectedMove[i] !== PGN4_SYNTAX.SPLIT) {\n\t\t\t\t\tif (PGN4_SYNTAX.PIECE_REGEX_SIMPLIFIED.test(selectedMove[i])) {\n\t\t\t\t\t\tconst index = getMoveIndexes(i);\n\t\t\t\t\t\tcurrentMoveData = obtainMoveFromInfo(selectedMove.substring(i, index));\n\t\t\t\t\t\ti = index;\n\t\t\t\t\t} else if (moves[i] === PGN4_SYNTAX.BRACKETS.COMMENT_START) {\n\t\t\t\t\t\tconst index = parseComment(i);\n\t\t\t\t\t\tcurrentMove.comment = moves.substring(i + 1, index);\n\t\t\t\t\t\ti = index;\n\t\t\t\t\t} else if (moves[i] === PGN4_SYNTAX.BRACKETS.VARIATION_START) {\n\t\t\t\t\t\tconst index = findBracketIndex(i);\n\t\t\t\t\t\tcurrentPath.push(increment + 1, ++variationIncrement);\n\t\t\t\t\t\tcurrentMove.alternativeLines?.push([...parseMoves(moves.substring(i + 1, index), currentPath.slice())]);\n\t\t\t\t\t\ti = index;\n\t\t\t\t\t}\n\t\t\t\t} else if (\n\t\t\t\t\t(selectedMove[i] === PGN4_SYNTAX.SPLIT && moves[i + 1] && moves[i + 1] === PGN4_SYNTAX.SPLIT) ||\n\t\t\t\t\t(moves[i].trim() && !isNumNaN && moves[i + 1] && (moves[i + 1] === PGN4_SYNTAX.SPLIT || !isNaN(Number(moves[i + 1]))))\n\t\t\t\t) {\n\t\t\t\t\tif (!isNumNaN) i = getEnumeratorIndex(i);\n\t\t\t\t\tif (currentMoveData) {\n\t\t\t\t\t\tprocessMoveDataInsertion();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t} finally {\n\t\t\tprocessMoveDataInsertion();\n\t\t\tcurrentPath.push(increment + 1);\n\t\t\tcurrentMove.path = currentPath.slice();\n\t\t\tif (verifyMoveWrapperProperties(currentMove)) {\n\t\t\t\tmoveList.push(Object.assign({}, currentMove));\n\t\t\t}\n\t\t}\n\n\t\treturn moveList;\n\t};\n\n\treturn parseMoves(moves, []);\n};\n","import { createTuple, Tuple, verifyTupleType } from \"@client/ts/baseTypes\";\nimport { BoardSquares, initializeBoardSquares } from \"@client/ts/logic/BaseInterfaces\";\nimport { FENData, FENOptions } from \"@moveGeneration/FENData/FENData\";\nimport type { FENOptionsTags } from \"@moveGeneration/FENData/FENOptions/FENOptionsTagsInterface\";\nimport { boardDimension, colors, totalPlayers } from \"@moveGeneration/GameInformation/GameData\";\nimport {\n\tverifyColorEnumValue,\n\tcolorEnum,\n\tCoordinate,\n\tnonPlayablePieces,\n\tstringColorEnum\n} from \"@moveGeneration/GameInformation/GameUnits/GameUnits\";\nimport { createPieceFromString, emptyPieceString, PieceString } from \"@moveGeneration/GameInformation/GameUnits/PieceString\";\nimport type { PieceLetter } from \"@moveGeneration/PieceControl/PieceControlInterface\";\nimport type { VariantTag } from \"../TagInterface\";\nimport { tagNamesEqual, unwrapTag, wrapTag } from \"../Utils\";\n\nexport function checkDimensionIntersection(dimension: Coordinate, [i, j]: Coordinate) {\n\tconst dimensionI = (boardDimension - dimension[0]) / 2,\n\t\tdimensionJ = (boardDimension - dimension[1]) / 2;\n\treturn i < dimensionI || i >= dimensionI + dimension[0] || j < dimensionJ || j >= dimensionJ + dimension[1];\n}\n\nfunction serializeFENOptions(fenOptions: FENOptions): string {\n\tconst resultingStrings: string[] = [];\n\tlet key: keyof FENOptionsTags;\n\tfor (key in fenOptions.tags) {\n\t\tif (!Object.prototype.hasOwnProperty.call(fenOptions.tags, key)) continue;\n\t\tconst serializedForm = fenOptions.tags[key].serialize();\n\t\tif (serializedForm) resultingStrings.push(serializedForm);\n\t}\n\n\treturn `{${resultingStrings.join(\",\")}}`;\n}\n\nfunction modifyFourBooleanParameter(part: string, fenDataArrayRef: Tuple<boolean, typeof totalPlayers>) {\n\tconst booleans = part.split(\",\").map((e) => Boolean(Number(e)));\n\tif (verifyTupleType(booleans, totalPlayers)) {\n\t\tfenDataArrayRef.forEach((_, i, arr) => (arr[i] = booleans[i]));\n\t} else {\n\t\tconsole.error(\"Incorrect amount of arguments for the boolean parameter length in FENData: \" + part);\n\t\tconsole.trace(`Expected ${totalPlayers} arguments, but got ${booleans.length}`);\n\t}\n}\n\nconst predefinedFENpositions = {\n\t\"4PC\": \"R-0,0,0,0-1,1,1,1-1,1,1,1-0,0,0,0-0-x,x,x,yR,yN,yB,yK,yQ,yB,yN,yR,x,x,x/x,x,x,yP,yP,yP,yP,yP,yP,yP,yP,x,x,x/x,x,x,8,x,x,x/bR,bP,10,gP,gR/bN,bP,10,gP,gN/bB,bP,10,gP,gB/bQ,bP,10,gP,gK/bK,bP,10,gP,gQ/bB,bP,10,gP,gB/bN,bP,10,gP,gN/bR,bP,10,gP,gR/x,x,x,8,x,x,x/x,x,x,rP,rP,rP,rP,rP,rP,rP,rP,x,x,x/x,x,x,rR,rN,rB,rQ,rK,rB,rN,rR,x,x,x\",\n\t\"4PCo\": \"R-0,0,0,0-1,1,1,1-1,1,1,1-0,0,0,0-0-x,x,x,yR,yN,yB,yK,yQ,yB,yN,yR,x,x,x/x,x,x,yP,yP,yP,yP,yP,yP,yP,yP,x,x,x/x,x,x,8,x,x,x/bR,bP,10,gP,gR/bN,bP,10,gP,gN/bB,bP,10,gP,gB/bK,bP,10,gP,gQ/bQ,bP,10,gP,gK/bB,bP,10,gP,gB/bN,bP,10,gP,gN/bR,bP,10,gP,gR/x,x,x,8,x,x,x/x,x,x,rP,rP,rP,rP,rP,rP,rP,rP,x,x,x/x,x,x,rR,rN,rB,rQ,rK,rB,rN,rR,x,x,x\",\n\t\"4PCb\": \"R-0,0,0,0-1,1,1,1-1,1,1,1-0,0,0,0-0-x,x,x,yR,yN,yB,yQ,yK,yB,yN,yR,x,x,x/x,x,x,yP,yP,yP,yP,yP,yP,yP,yP,x,x,x/x,x,x,8,x,x,x/bR,bP,10,gP,gR/bN,bP,10,gP,gN/bB,bP,10,gP,gB/bQ,bP,10,gP,gQ/bK,bP,10,gP,gK/bB,bP,10,gP,gB/bN,bP,10,gP,gN/bR,bP,10,gP,gR/x,x,x,8,x,x,x/x,x,x,rP,rP,rP,rP,rP,rP,rP,rP,x,x,x/x,x,x,rR,rN,rB,rQ,rK,rB,rN,rR,x,x,x\",\n\t\"4PCn\": \"R-0,0,0,0-1,1,1,1-1,1,1,1-0,0,0,0-0-x,x,x,yR,yN,yB,yQ,yK,yB,yN,yR,x,x,x/x,x,x,yP,yP,yP,yP,yP,yP,yP,yP,x,x,x/x,x,x,8,x,x,x/bR,bP,10,gP,gR/bN,bP,10,gP,gN/bB,bP,10,gP,gB/bQ,bP,10,gP,gK/bK,bP,10,gP,gQ/bB,bP,10,gP,gB/bN,bP,10,gP,gN/bR,bP,10,gP,gR/x,x,x,8,x,x,x/x,x,x,rP,rP,rP,rP,rP,rP,rP,rP,x,x,x/x,x,x,rR,rN,rB,rQ,rK,rB,rN,rR,x,x,x\",\n\t\"2PC\": \"R-0,1,0,1-1,1,1,1-1,1,1,1-0,0,0,0-0-{'pawnBaseRank':5,'wb':true,'dim':'8x8'}-x,x,x,x,x,x,x,x,x,x,x,x,x,x/x,x,x,x,x,x,x,x,x,x,x,x,x,x/x,x,x,x,x,x,x,x,x,x,x,x,x,x/x,x,x,yR,yN,yB,yQ,yK,yB,yN,yR,x,x,x/x,x,x,yP,yP,yP,yP,yP,yP,yP,yP,x,x,x/x,x,x,8,x,x,x/x,x,x,8,x,x,x/x,x,x,8,x,x,x/x,x,x,8,x,x,x/x,x,x,rP,rP,rP,rP,rP,rP,rP,rP,x,x,x/x,x,x,rR,rN,rB,rQ,rK,rB,rN,rR,x,x,x/x,x,x,x,x,x,x,x,x,x,x,x,x,x/x,x,x,x,x,x,x,x,x,x,x,x,x,x/x,x,x,x,x,x,x,x,x,x,x,x,x,x\"\n} as const;\nconst verifyPredefinedFENPosition = (fenShorthand: string): fenShorthand is keyof typeof predefinedFENpositions =>\n\tfenShorthand in predefinedFENpositions;\n\nconst fenDataTag = \"StartFen4\";\nexport const createFENDataTag = (): VariantTag<{\n\tboard: BoardSquares<PieceString>;\n\tfenData: FENData;\n\tpieceSet: Set<PieceLetter>;\n}> => ({\n\ttag: \"startingPosition\",\n\tcurrentValue: {\n\t\tboard: initializeBoardSquares((): PieceString => emptyPieceString),\n\t\tfenData: new FENData(),\n\t\tpieceSet: new Set<PieceLetter>()\n\t},\n\tverifyTagInParsing(inputTag) {\n\t\treturn tagNamesEqual(inputTag, fenDataTag);\n\t},\n\tparseTag(inputTag) {\n\t\tconst tagContents = unwrapTag(inputTag, fenDataTag);\n\t\tconst fenDataString = verifyPredefinedFENPosition(tagContents) ? predefinedFENpositions[tagContents] : tagContents;\n\n\t\tconst fenData = new FENData();\n\t\tconst board: BoardSquares<PieceString> = initializeBoardSquares(() => emptyPieceString);\n\t\tconst pieceSet = new Set<PieceLetter>();\n\n\t\tconst transparentWall = createPieceFromString(\"x\");\n\t\tconst parts = fenDataString.split(\"-\");\n\t\tif (parts.length < 7 || parts[parts.length - 1].split(\"/\").length !== boardDimension) {\n\t\t\tconsole.warn(\"FEN has less than 7 parts: \" + fenDataString);\n\t\t} else {\n\t\t\tconst sideToMove = parts[0].charAt(0).toLowerCase();\n\t\t\tif (verifyColorEnumValue(sideToMove)) {\n\t\t\t\tfenData.sideToMove = colorEnum[sideToMove];\n\t\t\t} else {\n\t\t\t\tconsole.warn(\"FEN option 1: side to move is not an alphabetic color: \" + sideToMove);\n\t\t\t}\n\n\t\t\tmodifyFourBooleanParameter(parts[1], fenData.fenOptions.tag(\"dead\"));\n\t\t\tmodifyFourBooleanParameter(parts[2], fenData.fenOptions.tag(\"castleKingside\"));\n\t\t\tmodifyFourBooleanParameter(parts[3], fenData.fenOptions.tag(\"castleQueenside\"));\n\n\t\t\tconst points = parts[4].split(\",\").map((e) => Number(e));\n\t\t\tif (verifyTupleType(points, totalPlayers)) {\n\t\t\t\tfenData.points = points;\n\t\t\t} else {\n\t\t\t\tconsole.warn(`FEN option 5: points is of incorrect length: ${points.join(\",\")}`);\n\t\t\t}\n\n\t\t\tfenData.plyCount = Number(parts[5]);\n\n\t\t\tconst royals: Tuple<Coordinate | null, typeof totalPlayers> = createTuple(null, totalPlayers);\n\t\t\tconst verifyKeyInTags = (key: string): key is keyof FENOptionsTags => key in fenData.fenOptions.tags;\n\n\t\t\tif (parts[6].startsWith(\"{\")) {\n\t\t\t\tconst initialParsing: unknown = JSON.parse(parts[6].replaceAll(\"(\", \"[\").replaceAll(\")\", \"]\").replaceAll(\"'\", '\"'));\n\t\t\t\tif (typeof initialParsing !== \"object\" || initialParsing === null)\n\t\t\t\t\tthrow new Error(\"Unexpected object definition syntax for \" + String(initialParsing));\n\t\t\t\tfor (const [key, value] of Object.entries(initialParsing)) {\n\t\t\t\t\tif (!verifyKeyInTags(key)) continue;\n\t\t\t\t\tconst tag = fenData.fenOptions.tags[key];\n\t\t\t\t\ttag.value = tag.parse(value);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst position = parts[parts.length - 1].split(\"/\"),\n\t\t\t\tdimension = fenData.fenOptions.tag(\"dim\");\n\t\t\tposition.forEach((line, i) => {\n\t\t\t\tlet j = 0;\n\t\t\t\tfor (let pieceStr of line.split(\",\")) {\n\t\t\t\t\tif (pieceStr.endsWith('\"')) pieceStr = pieceStr.slice(0, -1);\n\t\t\t\t\tif (isNaN(Number(pieceStr))) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tif (!checkDimensionIntersection(dimension, [i, j])) {\n\t\t\t\t\t\t\t\tconst pieceString = createPieceFromString(pieceStr);\n\t\t\t\t\t\t\t\tboard[i][j] = pieceString;\n\t\t\t\t\t\t\t\tif (pieceString.isPiece()) {\n\t\t\t\t\t\t\t\t\tif (pieceString.piece === \"K\" && !royals[pieceString.color]) {\n\t\t\t\t\t\t\t\t\t\troyals[pieceString.color] = [i, j];\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tpieceSet.add(pieceString.piece);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} finally {\n\t\t\t\t\t\t\tj++;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else j += Number(pieceStr);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tfor (const color of colors) {\n\t\t\t\tfor (const [piece] of fenData.fenOptions.tag(\"bank\")[color]) {\n\t\t\t\t\tif (piece.piece in nonPlayablePieces) continue;\n\t\t\t\t\tpieceSet.add(piece.piece);\n\t\t\t\t}\n\t\t\t}\n\t\t\tfenData.fenOptions.setTag(\"royal\", royals);\n\n\t\t\tfor (let i = 0; i < boardDimension; i++) {\n\t\t\t\tfor (let j = 0; j < boardDimension; j++) {\n\t\t\t\t\tif (checkDimensionIntersection(dimension, [i, j])) board[i][j] = transparentWall;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (!fenData.fenOptions.tag(\"noCorners\")) {\n\t\t\tconst cornerAreaSize = 3,\n\t\t\t\tarrayDimension = boardDimension - 1;\n\t\t\tbaseLoop: for (let i = 0; i < cornerAreaSize; i++) {\n\t\t\t\tfor (let j = 0; j < cornerAreaSize; j++) {\n\t\t\t\t\tconst squares: Coordinate[] = [\n\t\t\t\t\t\t[i, j],\n\t\t\t\t\t\t[arrayDimension - i, j],\n\t\t\t\t\t\t[i, arrayDimension - j],\n\t\t\t\t\t\t[arrayDimension - i, arrayDimension - j]\n\t\t\t\t\t];\n\t\t\t\t\tfor (const square of squares) {\n\t\t\t\t\t\tconst pieceString = board[square[0]][square[1]];\n\t\t\t\t\t\tif (!pieceString.isWall() || pieceString.piece !== transparentWall.piece) {\n\t\t\t\t\t\t\tfenData.fenOptions.setTag(\"noCorners\", true);\n\t\t\t\t\t\t\tbreak baseLoop;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn { fenData, board, pieceSet };\n\t},\n\tserialize(baseBoard) {\n\t\tconst { board, data } = baseBoard;\n\t\tlet resultingString = \"\";\n\t\tresultingString += `${stringColorEnum[data.sideToMove].toUpperCase()}-`;\n\t\tresultingString += `${data.fenOptions\n\t\t\t.tag(\"dead\")\n\t\t\t.map((d) => Number(d))\n\t\t\t.join(\",\")}-`;\n\t\tresultingString += `${data.fenOptions\n\t\t\t.tag(\"castleKingside\")\n\t\t\t.map((d) => Number(d))\n\t\t\t.join(\",\")}-`;\n\t\tresultingString += `${data.fenOptions\n\t\t\t.tag(\"castleQueenside\")\n\t\t\t.map((d) => Number(d))\n\t\t\t.join(\",\")}-`;\n\t\tresultingString += `${data.points.join(\",\")}-`;\n\t\tresultingString += `${data.plyCount}-`;\n\t\tresultingString += `${serializeFENOptions(data.fenOptions)}-`;\n\n\t\tlet currentEmptySquares = 0;\n\t\tfor (const row of board) {\n\t\t\tfor (const pieceString of row) {\n\t\t\t\tif (pieceString.isEmpty()) {\n\t\t\t\t\tcurrentEmptySquares++;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (currentEmptySquares !== 0) {\n\t\t\t\t\tresultingString += `${currentEmptySquares},`;\n\t\t\t\t\tcurrentEmptySquares = 0;\n\t\t\t\t}\n\t\t\t\tresultingString += `${pieceString.value},`;\n\t\t\t}\n\n\t\t\tif (currentEmptySquares !== 0) {\n\t\t\t\tresultingString += `${currentEmptySquares}/`;\n\t\t\t\tcurrentEmptySquares = 0;\n\t\t\t} else {\n\t\t\t\tresultingString = resultingString.slice(0, -1);\n\t\t\t\tresultingString += \"/\";\n\t\t\t}\n\t\t}\n\t\tresultingString = resultingString.slice(0, -1);\n\n\t\treturn wrapTag(fenDataTag, resultingString);\n\t}\n});\n","import type { Coordinate } from \"@moveGeneration/GameInformation/GameUnits/GameUnits\";\n\nexport function parseSingleCoordinate(coordinate: string): Coordinate | undefined {\n\tif (coordinate.length === 0) return;\n\tconst parsedCoordinate: [number, number] = [14 - Number(coordinate.slice(1)), coordinate.charCodeAt(0) - 97];\n\tif (Number.isNaN(parsedCoordinate[0]) || Number.isNaN(parsedCoordinate[1])) return;\n\tif (parsedCoordinate[0] < 0 || parsedCoordinate[0] > 13 || parsedCoordinate[1] < 0 || parsedCoordinate[1] > 13) return;\n\treturn parsedCoordinate;\n}\n\nexport function parseEnPassantCoordinates(coordinates: string): [Coordinate, Coordinate] | undefined {\n\tif (coordinates.length === 0) return;\n\tconst coordinatesArray = coordinates.split(\":\");\n\treturn [\n\t\t[14 - Number(coordinatesArray[0].slice(1)), coordinatesArray[0].charCodeAt(0) - 97],\n\t\t[14 - Number(coordinatesArray[1].slice(1)), coordinatesArray[1].charCodeAt(0) - 97]\n\t];\n}\n\nexport const wrapTag = (baseTag: string, content: string) => `[${baseTag} \"${content}\"]`;\nexport const tagNamesEqual = (baseTag: string, definedTag: string) => baseTag.toLowerCase().startsWith(`[${definedTag.toLowerCase()} \"`);\nexport const unwrapTag = (baseTag: string, definedTag: string) => baseTag.replace(`[${definedTag} \"`, \"\").slice(0, -1);\n","import { Tuple } from \"../baseTypes\";\n\nexport function shuffleArray<T>(array: T[]): T[];\nexport function shuffleArray<T, L extends number>(array: Tuple<T, L>): Tuple<T, L>;\nexport function shuffleArray<T, L extends number>(array: T[] | Tuple<T, L>): T[] | Tuple<T, L> {\n\tlet i = array.length;\n\tlet r = 0;\n\twhile (i !== 0) {\n\t\tr = Math.floor(Math.random() * i--);\n\t\t[array[i], array[r]] = [array[r], array[i]];\n\t}\n\n\treturn array;\n}\n\nexport function compareArrays(arr1: unknown[] | readonly unknown[], arr2: unknown[] | readonly unknown[]): boolean {\n\tif (arr1 === arr2) return true;\n\tif (arr1.length !== arr2.length) return false;\n\tfor (let i = 0; i < arr1.length; i++) {\n\t\tconst first = arr1[i],\n\t\t\tsecond = arr2[i];\n\t\tif (Array.isArray(first) && Array.isArray(second)) {\n\t\t\tif (!compareArrays(first, second)) return false;\n\t\t} else if (first !== second) {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\treturn true;\n}\n\nexport function countMinimumOf2DArrayExcludingZero(array: number[][]): number {\n\tlet minimum = Infinity;\n\tfor (const row of array) {\n\t\tfor (const number of row) {\n\t\t\tif (number !== 0 && number < minimum) {\n\t\t\t\tminimum = number;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn minimum;\n}\n\nexport function findLastIndex<T>(array: T[], callback: (value: T, index: number, arr: T[]) => boolean): number {\n\tlet i = array.length;\n\twhile (i--) {\n\t\tif (callback(array[i], i, array)) return i;\n\t}\n\treturn -1;\n}\n","export function truncateNumber(number: number, digits: number): number {\n\tconst multiplier = Math.pow(10, digits);\n\tconst adjusted = number * multiplier;\n\tif (adjusted < 0) {\n\t\treturn Math.ceil(adjusted / multiplier);\n\t} else {\n\t\treturn Math.floor(adjusted / multiplier);\n\t}\n}\n\nexport function bitCount(number: number): number {\n\tnumber = number - ((number >> 1) & 0x55555555);\n\tnumber = (number & 0x33333333) + ((number >> 2) & 0x33333333);\n\treturn (((number + (number >> 4)) & 0xf0f0f0f) * 0x1010101) >> 24;\n}\n","export function copyClass<T, P extends unknown[]>(instance: T, baseClass: new (...args: P) => T, customProperties = false): T {\n\tconst prototype: unknown = Object.getPrototypeOf(instance);\n\tif (typeof prototype !== \"object\") throw new Error(\"Expected prototype to be an object\");\n\tconst properties: unknown = Object.create(prototype);\n\tif (typeof properties !== \"object\" || properties === null) throw new Error(\"Expected prototype to be an object\");\n\tconst copy: unknown = Object.assign(properties, customProperties ? {} : instance);\n\tif (!(copy instanceof baseClass)) throw new Error(\"Expected prototype to not be overridden\");\n\treturn copy;\n}\n\nexport const verifyObjectType = (v: unknown): v is Record<PropertyKey, unknown> => typeof v === \"object\" && v !== null;\nexport function verifyPropertiesInObject<K extends string>(obj: Record<PropertyKey, unknown>, keys: readonly K[]): obj is Record<K, unknown> {\n\tfor (const key of keys) {\n\t\tif (!Object.prototype.hasOwnProperty.call(obj, key)) return false;\n\t}\n\treturn true;\n}\n","export function formatOrdinalNumber(num: number): string {\n\tconst lastTwoDigits = Number(String(num).slice(-2));\n\tif (lastTwoDigits > 3 && lastTwoDigits < 21) return \"th\";\n\tswitch (lastTwoDigits % 10) {\n\t\tcase 1:\n\t\t\treturn \"st\";\n\t\tcase 2:\n\t\t\treturn \"nd\";\n\t\tcase 3:\n\t\t\treturn \"rd\";\n\t\tdefault:\n\t\t\treturn \"th\";\n\t}\n}\n\nexport function compileEnumeration(list: string[]): string {\n\tif (list.length === 0) return \"\";\n\tif (list.length === 1) return list[0];\n\tlet result = \"\";\n\tfor (let i = 0; i < list.length; i++) {\n\t\tif (i === list.length - 2) {\n\t\t\tresult += ` ${list[i]} or `;\n\t\t} else if (i === list.length - 1) {\n\t\t\tresult += list[i];\n\t\t} else {\n\t\t\tresult += list[i] + \", \";\n\t\t}\n\t}\n\n\treturn result;\n}\n\nexport function prefixWithIndefiniteArticle(str: string): string {\n\tconst vowels = /[AEUIO]/i;\n\treturn vowels.test(str.charAt(0)) ? \"an \" + str : \"a \" + str;\n}\n\nexport function convertSecondsToFlexibleHoursMinutesSeconds(seconds: number): string {\n\tif (seconds >= 3600) {\n\t\treturn new Date(seconds * 1000).toISOString().substring(11, 16);\n\t} else {\n\t\treturn new Date(seconds * 1000).toISOString().substring(14, 19);\n\t}\n}\n\nexport function convertCamelCaseToKebabCase(baseString: string): string {\n\treturn baseString.replace(/([a-z])([A-Z])/g, \"$1-$2\").toLowerCase();\n}\n\nexport function hashString(string: string): number {\n\tlet hash = 0;\n\tfor (let i = 0; i < string.length; i++) {\n\t\tconst char = string.charCodeAt(i);\n\t\thash = (hash << 5) - hash + char;\n\t\thash |= 0;\n\t}\n\n\treturn hash;\n}\n","var map = {\n\t\"./BoardDecorators/AllowPassing.ts\": 67,\n\t\"./BoardDecorators/AlternativeTeams.ts\": 68,\n\t\"./BoardDecorators/BarePieceRule.ts\": 75,\n\t\"./BoardDecorators/Blindfold.ts\": 69,\n\t\"./BoardDecorators/CaptureTheKing.ts\": 33,\n\t\"./BoardDecorators/Chess960.ts\": 79,\n\t\"./BoardDecorators/Crazyhouse.ts\": 80,\n\t\"./BoardDecorators/DuckChess.ts\": 70,\n\t\"./BoardDecorators/FogOfWar.ts\": 76,\n\t\"./BoardDecorators/ForcedCapture.ts\": 35,\n\t\"./BoardDecorators/GameMetadataRules.ts\": 71,\n\t\"./BoardDecorators/Ghostboard.ts\": 81,\n\t\"./BoardDecorators/ParadigmChess30.ts\": 82,\n\t\"./BoardDecorators/PiecesFaceCenter.ts\": 83,\n\t\"./BoardDecorators/SeirawanSetup.ts\": 45,\n\t\"./BoardDecorators/SelfCheck.ts\": 84,\n\t\"./BoardDecorators/SetupChess.ts\": 52,\n\t\"./BoardDecorators/Taboo.ts\": 46,\n\t\"./BoardVariantModules/EngineMoveGeneration/Algorithms/ComfuterEvaluation.ts\": 36,\n\t\"./BoardVariantModules/EngineMoveGeneration/Algorithms/ComfuterEvaluationExtensions.ts\": 47,\n\t\"./BoardVariantModules/EngineMoveGeneration/Algorithms/MixedAlgorithms.ts\": 85,\n\t\"./BoardVariantModules/EngineMoveGeneration/Algorithms/RandomEvaluation.ts\": 27,\n\t\"./BoardVariantModules/EngineMoveGeneration/Algorithms/RandomEvaluationExtensions.ts\": 86,\n\t\"./BoardVariantModules/EngineMoveGeneration/BotInterface.ts\": 20,\n\t\"./BoardVariantModules/InsufficientMaterial/InsufficientMaterialChecker.ts\": 87,\n\t\"./BoardVariantModules/InsufficientMaterial/InsufficientMaterialConstructor.ts\": 53,\n\t\"./BoardVariantModules/InsufficientMaterial/PieceMedianCounter.ts\": 37,\n\t\"./BoardVariantModules/InsufficientMaterial/StateSerializer.ts\": 88,\n\t\"./BoardVariantModules/InsufficientMaterial/Utilities.ts\": 30,\n\t\"./FENDataDecorators/Atomic.ts\": 89,\n\t\"./FENDataDecorators/DeadKingWalking.ts\": 48,\n\t\"./FENDataDecorators/EnPassant.ts\": 90,\n\t\"./FENDataDecorators/FatalCapture.ts\": 91,\n\t\"./FENDataDecorators/FiftyMoveRule.ts\": 34,\n\t\"./FENDataDecorators/Giveaway.ts\": 54,\n\t\"./FENDataDecorators/KingOfTheHill.ts\": 92,\n\t\"./FENDataDecorators/NCheck.ts\": 93,\n\t\"./FENDataDecorators/OppositeMultiplier.ts\": 94,\n\t\"./FENDataDecorators/OppositeSideCastling.ts\": 95,\n\t\"./FENDataDecorators/PiecesGoToBanks.ts\": 96,\n\t\"./FENDataDecorators/PlayForMate.ts\": 97,\n\t\"./FENDataDecorators/PointsForMate.ts\": 98,\n\t\"./FENDataDecorators/StalemateOptions.ts\": 29,\n\t\"./FENDataDecorators/Takeover.ts\": 99,\n\t\"./FENDataDecorators/ThreefoldRepetition.ts\": 55,\n\t\"./PieceControlDecorators/AnyCapture.ts\": 100,\n\t\"./PieceControlDecorators/PromoteTo.ts\": 41,\n\t\"./PieceControlDecorators/PromotionRank.ts\": 28,\n\t\"./PieceControlDecorators/RoyalsCannotCapture.ts\": 38,\n\t\"./PieceControlDecorators/Sideways.ts\": 101,\n\t\"./PieceControlDecorators/Stonewall.ts\": 102,\n\t\"./PieceControlDecorators/Torpedo.ts\": 103\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 66;"],"names":["chessGlyphIndex","doubleBackwardArrow","downloadIcon","endBackwardArrow","forwardDoubleArrow","userSearch","userConnection","notAllowed","clock","extraInformation","authorshipNotice","draw","backwardArrow","userInformation","smallBackwardArrow","leaderBoard","equal","downwardArrow","upperArrow","endForwardArrow","urlAttached","crossMark","rightOutwardsArrow","hashtag","newspaper","twitter","checkMark","camera","alternativeLine","play","pause","reload","world","points","medal","soundOff","circleCrossMark","steadyEvaluation","facebook","circle","soundOn","plus","openEye","copyToClipboard","wavingFlag","editText","fullArrowLeft","fullArrowRight","smallArrowForward","goBackArrow","youtube","calendar","user","chat","lock","box","circularArrows","lightBulb","briefcase","board","knightArrows","newMessage","drawing","twoUsers","twoUsers2","openingBook","disclaimer","ringingBell","list","rookAndPawn","hamburgerList","mail","userExtraInformation","house","sheetAndPencil","openMail","chatBox","fullArrowDown","smallArrowUp","fullArrowUp","arrowIntoBox","key","file","books","sharing","userNotAllowed","userCrossMark","questionMark","boardWithCircle","googlePlus","reset","reddit","openBook","userPlus","cog","pin","suitcase","mark","cake","openLink","bishopStroke","linkedin","knight","threeCheck","chess960rapid","connection","quotes","exit","crossedBinoculars","leaderBoardReversed","bishopFull","printer","verticalEvaluation","t","pawn","twoPawns","unrated","elite","bug","cpu","forwardArrowCircle","squareCrossMark","android","twoUsersPlus","crossedArrows","king","kingFull","bishop","twoFullRooks","kingStrokes","fullKnight2","chess960","leaderBoardAscent","crazyhouse","checklist","target","pawnAndHalfRook","halfRookAndPawn","knightStrokes","pawnLogo","queenFull","exchange","userNext","userPrevious","compass","pawnStrokes","rookStrokes","screenDisplays","kingOfTheHill","antichess","queen","threePawns","queenStrokes","rookSmallStrokes","rookSmall","bishopPair","rookPair","knightPair","twoUsersSearch","shield","kingSmall","bishopSmall","knightSmall","userNoConnection","userStream","queenAlternative","pawnAlternative","threePawnsAlternative","twoPawnsAlternative","rookAlternative","knightPairFull","bishopPairFull","addBoard","diamond","scales","pawn3d","userShieldPlus","gold","ellipsis","analysis","archive","arrowBottomIntoBox","disclaimerEditor","sendTrophy","addCheckMark","checkMarkSquare","squareStaircase","arrowsUpBottom","star","verticalDash","shieldCheckMark","top3","addImage","chessStream","removeTrophy","importantMail","arrowLeave","donut","computerAnalysis","checkMarkSquareSmall","diagonalExpandArrows","leaderBoardHorizontal","checkMarkAsCircle","arrowFromBox","boxArrowBottom","boxArrowLeft","boxArrowRight","fourArrowsCentral","clashingSwords","ratingOffset","smilingFace","fileCabinet","editClock","userShield","homeFilled","paymentCard","fourArrowsOutwards","puzzle","addPhoto","arrowWallLeft","arrowWallRight","boardConfiguration","fourBlocks","sandglass","crown","cloudUpload","webChatBox","puzzleRush","knightHops","instagram","squarePlus","squareMinus","squareEqual","square","fireFull","pawnRecycle","noEngine","google","fourPlayer","pieceMeal","arrowBoldUp","arrowBoldDown","blunder","mistake","videoChatBox","bonesCrossed","displays","arrowEnter","newspaperHalf","bookmark","puzzleLarge","movePawn","pawn3dLarge","sun","rapid","blitz","bullet","mortarboard","laptop","resetWidth","pawnConnection","copyToClipboardFromText","fire","crownSmall","orderedList","chess960daily","arrowWallBottom","pawn3dBold","plusInCircle","lightCorner","darkCorner","steepCurve","heart","checkMarkThin","connectionDiagonal","diadem","plusMinus","recycling","metrics","top1","engineCheckMark","wikipedia","tournament","houseConfiguration","computerHindsight","computerCheckMark","lightDarkTheme","whistlingBell","crossMarkCompact","eyeCrossed","fide","favorite","tShirtPawn","addSmile","library","discord","analysisCheckMark","versusComputer","dollarSign","bestMove","gift","evaluationLinear","evaluationThrowaway","evaluationEqual","evaluationDead","evaluationSharp","evaluationPerplexing","evaluationSmooth","libraryAdd","selfPartner","fourPlayerConfiguration","listDownFlow","puzzleBattle","hyperbullet","gameLink","gameStudy","evaluationCrazy","engine","crossedSwordsInCircle","hallmark","like","boardTwoPlayers","fourPlayerChess","variants","cloudUploadCompact","clockIncrement","videoCamera","inaccuracy","bot","torpedo","vk","blindfold","customSettings","captureAnything","pawnSideways","noCastling","fogOfWar","automate","atomic","pawnCounterfeit","elephant","fullBlock","fourFullBlocks","nineFullBlocks","nineFullBlocksCrossed","hamburgerMenuCompact","listCompact","geoMark","crossedDonut","handshake","verified","sandglassRunningOut","rapidLowOnTime","tourneyBanner","noCloud","fork","donutTarget","newCalendarDay","cornerInfiltration","hastTagCompact","chatterbox","circleStar","targetPractice","pawnPromotion","flagProgression","pawnDoubleAttack","kingAndRook","specialMedal","pawnBanner","userSquare","verifiedCandidate","saveFile","duck","addBanner","qrCode","noAnalysis","dualPawn","gameEscape","tournamentCup","noExchanges","tikTok","pieChart","search","binoculars","largeBoard","exclamation","tournamentCupIcon","trashBin","arrowForwardBoldCompact","giftDiamond","filter","noChat","newSheet","xml","blockUser","facebookLike","facebookDislike","apple","phone","verifyFunctionType","func","createTuple","val","length","Array","from","fill","createTupleFromCallback","verifyTupleType","arr","assertNonUndefined","data","Error","throwOnNever","arg","TypeError","importAll","r","keys","forEach","hexColorRegex","createHexColor","color","test","initializeBoardSquares","baseValue","boardDimension","isVerticalPlacement","getVerticalPlacementModulus","num","result","concat","getHorizontalPlacementModulus","validateBoardMove","move","startingMoves","firstMove","verifyStandardMove","getLegalMoves","startCoordinates","verifyDroppingMove","getDroppingMoves","piece","verifyInternalMove","JSON","stringify","getAllowedInternalMoves","specialMoveSettings","hasEnPassant","variantData","duckChess","_step","_iterator","_createForOfIteratorHelper","_loop","moveComponent","value","find","legalMove","compareMoves","v","specialType","SpecialMove","nextChainedMoves","s","n","done","_ret","err","e","f","validateMoveTree","moves","clonedBoard","createClone","createMoveTree","createSnapshot","pregenerateAttacks","dimension","Math","max","fenOptions","tag","traverse","current","currentFullMove","arguments","undefined","currentTimeOnClocks","gameData","timeControl","baseTime","totalPlayers","previousSideToMove","i","moveWrapper","moveData","path","alternativeLines","newMoveWrapper","createBaseMoveWrapper","slice","comment","validationResult","_unused","firstStandardMoveSet","promotion","map","p","isWall","createPieceFromData","sideToMove","metadata","movingPiece","isCapture","getCapturedPieces","findLastIndex","b","currentSideToMove","results","makeMove","checkmates","checks","_step2","_iterator2","line","push","playerClock","_objectSpread","currentMove","getMove","assertValidMove","stringifyMove","changeGameTermination","snapshot","getBoardSnapshot","verifyValidMove","boardSnapshot","gameOver","termination","isTwoPlayer","gameType","type","VariantType","currentSnapshot","loadSnapshot","getCurrentResult","_step3","currentResults","dead","resigned","wb","_iterator3","colors","getPlayerNameFromColor","join","requiredDispatches","initialDispatches","dispatchSyncRecord","withWorkerResult","_","propertyKey","descriptor","originalMethod","_len","args","_key","postMessage","apply","this","workerDataSync","gameObjectPropertySync","RequestManager","_dec","_dec2","_dec3","_dec4","_dec5","_dec6","_dec7","_dec8","_dec9","_dec10","_dec11","_dec12","_dec13","_dec14","_dec15","_dec16","_dec17","_dec18","_dec19","_dec20","_dec21","_dec22","_dec23","_dec24","_dec25","_dec26","_dec27","_dec28","_dec29","_dec30","_dec31","_dec32","_applyDecoratedDescriptor","_class","constructor","_defineProperty","Map","stripPieceStrings","object","parse","generateInitiallyAliveColors","d","reduce","generateCurrentMoves","internalMoves","legalMoves","getPlayerPieces","set","stringifyCoordinate","construct","_variantName","pgn4","Board","decorateClassWithVariants","variantRules","boardDecorators","insufficientMaterialModule","InsufficientMaterialConstructor","state","insufficientMaterialChecker","InsufficientMaterialChecker","StateSerializer","serializeInsufficientMaterialState","generateInsufficientMaterialState","constructWithGeneratedData","insufficientMaterialState","deserializeInsufficientMaterialState","getFENSettings","royalCount","isCustomRoyals","isPiece","createSerializedState","getInitiallyAliveColors","initiallyAliveColors","getMoveTree","_step4","fullMoveCounter","_iterator4","resultingWrapper","cachedNames","highlightedArrows","highlightedSquares","_step5","_iterator5","loadSnapshotByPath","compareArrays","preliminarySnapshot","verifyNextChainedMovesAreDeleted","convertStrippedMoveToNormal","_step6","newMove","_iterator6","_moveComponent$promot","PieceString","verifyRequiredMove","passedMove","augmentMoveWithMetadata","makeMoveFunction","serializeBoardToPGN","serializeBoard","pieceString","j","_this$legalMoves$get","get","getInternalMoves","getVariantData","getBoard","toObject","getGameData","newGameData","date","toUTCString","getCurrentMove","getVariantRules","_step7","resultingRules","_iterator7","variantRule","getPublicProperties","getVariantType","deleteMove","playPreferredBotMove","getRealPlayers","_step8","_iterator8","_this$legalMoves$get2","preGeneratedAttacks","pieceDrops","algorithm","getDefaultZombieAlgorithm","evaluate","pickPreferredMove","changeFogPerspective","fogOfWarPerspective","newPerspective","nextTurn","getSquareVisibility","squareVisibility","prototype","Object","getOwnPropertyDescriptor","requestManager","self","onmessage","requestName","parameters","PieceControlConfigurator","control","_control","_isConfigured","coordinates","emptyPieceString","immunePieces","setCoordinates","x","y","setBaseImmunePieces","immune","setColor","setBoard","constructPieceControl","configure","PieceControlBuilder","_generalConfig","setFENData","fenData","setVariantRules","rules","createPieceControlWrap","letter","pieceControlConfigSettings","decoratedControl","PieceControl","copyVariantRules","initPieceControlDeclarations","baseImmunes","initDecoratorSettings","createBasePreGeneratedAttacks","createComplexMoveLegalityTracker","createGameTypeSettings","__baseClass","parsingResults","parsePGN4","injectBoard","FENData","fenDataDecorators","variantRuleData","validateVariantRules","initPieceControls","pieceSet","pieces","size","builder","pieceControlDecorators","pieceControlConfigurator","controls","a","isComplexSetup","assign","row","runComplexLegalityEvaluationChecks","targetObject","copyClass","presumedPieceLetters","Set","hasOwnProperty","call","add","isKingInCheck","baseColor","royal","slidingPieces","hoppingPieces","playerPieces","isEmpty","deadColorIndex","getCheckmatesAndStalemates","kingChecks","playerArmy","kingCaptures","stalemates","hasComplexRules","moveGenerationSettings","isComplex","hasComplexPieces","getCurrentChecks","playerRoyals","attackingCoordinates","pieceMovements","_step4$value","_slicedToArray","startingCoordinate","attack","compareCoordinates","returnValues","ignoreNextMoves","pregeneratedAttacks","affectOptions","ignoreCheckmateChecks","ignoreNextTurn","setNewMove","fenDataString","constructPreliminaryHashString","InternalMoveSignature","exclusiveSideToMoveGeneration","army","armyColor","coordinate","controlBuilder","setting","resultingMoves","getBaseColors","getPseudoLegalMoves","isJumping","rayGenJumpingAttacks","_step9","_iterator9","hoppingPieceLines","l","attackingColors","isSliding","_step10","_iterator10","rayGenSlidingAttacks","_step12","_iterator12","_step13","_iterator13","subAttack","slidingPiecesLines","m","_step11","_iterator11","AttackType","_step14","_iterator14","_step15","isRoyalOnLine","resultingAttack","_iterator15","_royal$_color","slidingPiecesRayTracing","nonPlayablePieces","pawnPieceString","isSetupComplex","isComplexEvaluation","isTheMoveLegal","isSeirawanDrop","royals","_moveData$startCoordi","pieceI","pieceJ","_moveData$endCoordina","endCoordinates","attackI","attackJ","moveArray","wallPieceString","_this$makeMove","_ref2","royalI","royalJ","_step16","isRoyalMove","attackers","targetSafety","legalitySettings","canKingCapture","_iterator16","kingCaptureColor","royalDefendedSquare","isFFA","_step17","_iterator17","_step21","_step17$value","attackingPiece","attackLine","isPieceUnderAttack","isRoyalUnderAttack","isTheTargetSquarePinListed","_iterator21","_step21$value","attackedX","attackedY","_step18","_iterator18","_step18$value","attackCoordinates","_step19","_iterator19","_step20","_step19$value","isTheTargetSquareBlocked","_iterator20","_step20$value","getCastlingMoves","specialMoves","isKingsideCastlingAvailable","getKingsideCastlingEndCoordinate","isQueensideCastlingAvailable","getQueensideCastlingEndCoordinate","getEnPassantMoves","pieceLetter","isPawn","enPassantCaptures","getAvailableEnPassantCaptures","pawnAttacks","_step22","_iterator22","_step23","_iterator23","enP","isIrreversible","irreversible","getSpecialMoves","_this$board$i","pseudoLegalMoves","generatedMove","split","capturedPieces","isKingCapture","c","_piece","currentMoves","maximum","pointIndexes","DisplaySettings","Highlighted","Fogged","Ghosted","Blindfolded","PieceFacesCenter","baseTeams","unstringifyCoordinate","Number","every","isNaN","teamSettings","firstTeamColors","secondTeamColors","isSameTeam","colorA","colorB","getTeammateColor","teammateIndex","indexOf","verifyNumericColor","variantRuleCache","coordinate1","coordinate2","FENOptions","createFENOptionsTags","pieceCoordinates","pieceEndCoordinates","checkSquares","static","newTags","tagsSnapshot","createFENOptionsTagsSnapshot","tags","loadTagSnapshot","verifyKeyTag","newOptions","setTag","fenTag","serializedState","generateCastling","_this","_this$tag2","dimensionRY","dimensionBG","dimensions","royalRanks","royalCoordinates","kingsideCastlePieceCoordinate","queensideCastlePieceCoordinate","boardSquares","royalCoordinateI","royalRanksI","condition","royalCoordinate","kArr","castlingData","castlingQueensideData","castlingKingsideData","castleQueenside","qArr","isCastlingAvailable","player","squares","checkSquare","coordinateA","coordinateB","getCastlingEndCoordinate","_this$tag$player","getKingsideCastlingPieceEndCoordinate","getQueensideCastlingPieceEndCoordinate","getKingsideCastlingTandemPiece","getQueensideCastlingTandemPiece","enPassant","botAlgorithms","ZombieType","plyCount","privateGameOver","newFENData","fenOptionsSnapshot","isDead","getCastlingPieceEndCoordinates","processStandardMove","_promotion$","startI","startJ","endI","endJ","endPiece","_this$getCastlingPiec2","kingsidePiece","queensidePiece","secondKPiece","_this$fenOptions$getK2","kI","kJ","secondQPiece","_this$fenOptions$getQ2","qI","qJ","castleKingside","royalPiece","spreadPointsBetweenPlayersEvenly","realPlayers","individualPoints","ceil","obtainPointsForMate","assignPoints","branchBetweenResignationMoves","playerName","toUpperCase","processInternalMove","internalMove","_this$board$insuffici","insufficientMaterial","checkCurrentState","assignGeneralTermination","turnPiecesDead","createDefaultArmyDeathSettings","excludeRoyals","doNotSetDead","deadPlayers","Boolean","isResignationOver","alivePlayer","findIndex","countTotalPointsOnBoard","processDroppingMove","bank","areBanksEnabled","setupComplete","playerBank","pieceStringReference","safeReference","bankPieceCount","delete","settings","onlyPawns","getKingCaptures","processPointsForChecks","currentChecks","updatedChecks","playerChecks","has","checkedPlayers","moveStalemates","endSquare","createDefaultFENEffectSettings","_ref","totalMateSum","boardAlternations","pointDistribution","checkmatePoints","pieceCapturingPoints","getPointsForPiece","isOver","_this$board$insuffici2","insufficientPieces","insufficient","getNeighboringSideToMove","previousTurn","singlesPoints","zombieImmune","resultingPoints","firstAlivePlayer","maximumIndex","generalTermination","verifyWinningTermination","verifyDrawingTermination","verifyParameterType","param","isArray","createBooleanTupleTag","defaultValue","isStatic","resultingObject","serialize","tuple","createPawnBaseRankTag","createEnPassantTag","input","_parseEnPassantCoordi","parseEnPassantCoordinates","some","convertCoordinateToPGN4","createCastleWithTag","createBoxOffsetTag","createBooleanTag","String","defaultDimension","createDimensionTag","baseInput","reverse","defaultZombies","createZombiesTag","newZombies","zombieType","verifyZombieType","createRoyalTag","_parseSingleCoordinat","parseSingleCoordinate","createLivesTag","createBankTag","defaultBanks","_pieceDefinition$spli2","_pieceDefinition$spli3","count","charAt","verifyPieceLetter","createPieceFromString","resultingStrings","entries","_ref3","_ref4","pieceStringObject","createPromotedFromTag","promotedFromMap","verifyObjectType","parsedCoordinate","promotedFromStrings","_step5$value","newMap","_step6$value","clear","_step7$value","createSetupPointsTag","createSeirawanDropsTag","seirawanDropsArray","pieceDefinition","PGN4_SYNTAX","coord","values","verifyDynamicFENOptionKey","verifyDynamicTag","Tags","pawnBaseRank","boxOffset","dim","noCorners","castleWith","lives","promotedFrom","setupPoints","seirawanDrops","resultingTags","playerNames","individualTerminations","generalWinningTerminations","includes","generalDrawingTerminations","generalTerminations","validateTerminationString","capitalizedTermination","str","startsWith","endsWith","fromCharCode","alternation","convertCoordinateToPGN4Array","getOppositePlacedColor","wall","transparentWall","colorEnum","g","verifyColorEnumValue","stringColorEnum","pieceString1","pieceString2","_color","getStringifiedColor","testEmptyPieceString","emptyLetter","testWallPieceString","wallPieceLetter","testActivePieceString","pawnPieceLetter","duckLetter","duckPieceString","generateCastlingString","extractPiece","obtainAmbiguousOrthogonality","moveMetadata","_parameters$snapshot","_moveMetadata$movingP","registeredPieces","_step$value","movements","boardPiece","c2","extractPromotion","extractChecksAndCheckmates","repeat","moveNotation","fullMoveNotation","resultingString","firstStandardMoveCaptureSet","shortenedMoveNotation","shortenedMoveNotationStringify","_moveWrapper$metadata","isFirstCapturingMoveSet","_obtainAmbiguousOrtho2","ambiguousRank","ambiguousFile","annotation","baseSnapshot","snapshots","WeakMap","boardHashes","startingSnapshot","hash","stripEmptyAlternativeLines","splice","stripDeletedMoveHashes","boardHash","currentLine","addBoardSnapshot","hasAdditionalPath","assignMoveWrapperKey","getMoveFromPathAndTree","baseMoveWrapper","alternativeFirstMove","obtainMatchingAlternativeLine","items","finalIndex","newCurrentMove","indexOfMinus","lastNumber","popped","pop","alterCurrentPath","getHash","preliminaryHashString","totalCount","standardMove","postMoveResults","deadColors","lastCurrentMoves","lastCurrent","alternativeLineContainer","boardObject","serializedForm","ps","verifyMoveWrapperProperties","move1","move2","EnPassant","createDummyMoveMetadata","requiredSettings","_movePath$shift","movePath","currentSelection","shift","currentIndex","index","getLatestChainedMoves","sliding","jumping","rayGenCache","hooks","useTrajectory","usePerspective","usePawnLogic","useHopping","baseRankActive","configuration","_configuration$baseRa","_configuration$coordi","baseRankCalc","baseRank","isRayTrace","attackType","modifyDisplacements","pushMove","_settings$irreversibl","_settings$irreversibl2","isRayGen","promotionRanks","promotionPieces","generateSlidingAttack","_settings$limit","_settings$special","_this$hooks$usePerspe","_settings$displacemen","displacement","displacementI","displacementJ","limit","Infinity","special","rayTraceLimit","_this$modifyDisplacem2","iLength","jLength","getMovePossibility","generateJumpAttack","_settings$special2","_this$hooks$usePerspe2","_settings$displacemen2","squareBlockingIndex","_this$modifyDisplacem4","isTestPassed","_this$hooks$usePerspe3","trajectoryX","trajectoryY","trajectory","_this$modifyDisplacem6","_configuration$displa","pushTo","getPossibleCells","trace","slidingLines","orthogonalMoves","diagonalMoves","kingDirections","camelHops","dabbabaHops","alfilHops","createPieceDeclaration","baseClassRef","super","teamsPoints","botFFAValue","botTeamsValue","defaultPieces","isColorBound","naming","name","shortName","dameLetter","description","stoneGeneralControl","soldierControl","xiangqiHorseControl","grasshopperPieceLetter","Normal","MoveOnly","AttackOnly","RayGen","RayTrace","RayTraceLimited","nonPlayableValues","rook","VariantRule","rv","variantRuleList","initializeBaseHandler","handler","decorator","initializeWrappingHandler","wrappingDecorators","injectIntoBaseClass","callback","bind","callHandler","method","decoratorMethod","decoratorType","getDecoratorType","verifyPrototypeProperty","superClass","prototypeMethod","getInsufficientMaterialData","isPartiallyDisabled","isDisabled","objectPrototype","Reflect","ownKeys","_Reflect$getPrototype","getPrototypeOf","baseClass","classReference","decoratorProperties","methods","lastInheritedMethods","basePrototype","verifyKeyInDecoratorProperties","k","_basePrototype","getOwnPropertyNames","property","localProperty","defineProperty","enumerable","configurable","_loop2","variantRuleChain","variantDecorator","variant","variantFunc","writable","require","AllowPassing","parameterValue","information","variantRuleColors","displayIcon","matchesPGNDeclaration","match","serializeToParsingForm","variantDataRules","giveaway","passingMoves","AlternativeTeams","teammate","rbTeams","teamOne","teamTwo","matchArray","getParametrizedOptions","_decorator$initDecora","BarePieceRule","_this$decorator","Blindfold","CaptureTheKing","taboo","Chess960","colorBoundPieces","supermajorPieces","minorPieces","edgePieces","positionID","regExp","newID","nr","rank","chess960ranges","legacy","legacy2PThreshold","legacy2PRank","legacy2PTakeaway","legacy4Prank","pieceArrays","ranks","walls","intersections","pieceMasks","c960range","calcNr","positions","generatePositionIndexes","colorBoundIndexes","floor","sort","supermajorIndex","minorPieceIndexes","minorPieceCache","position","edgeSet","royalSet","colorDelta","majorDelta","_i","_intersections","intersection","calcTempNr","cycles","twins","royalPieces","royalOnCorrectRank","replaceRow","createBaseChess960mappings","supermajorOverRoyal","mI","Crazyhouse","FiftyMoveRule","resultingMoveDrops","isRY","pawnPromotionRank","promotionRank","moveDrop","_this$decorator$makeM","DuckChess","latestMoves","ducks","emptySquares","droppingChainedMoves","duckChainedMoves","emptySquare","FogOfWar","currentPlayerMoves","_arr","drop","ForcedCapture","hasCaptures","Anonymous","players","elo","SemiAnonymous","shuffleArray","_decorator$initDecora2","SelfPartner","fenTags","_decorator$initDecora3","firstTeamPlayer","secondTeamPlayer","Ghostboard","ParadigmChess30","positionId","getInformation","paradigmRanges","twoPlayerRank","twoPlayerAdjustment","_royalPieces$player","moveCoordinate","iter","_pieceCoordinates$i$s","rp","permutations","PiecesFaceCenter","SeirawanSetup","setupChess","_this$decorator$data","disabledIndex","returnValue","_this$decorator$data2","stringifiedCoordinate","validateWithDrops","continuations","SelfCheck","nCheck","captureTheKing","baseChecks","newCoordinates","_step2$value","SetupChess","options","areSetupPointsUnset","bankEnabled","wereBanksEnabled","files","pawnRanks","permutationCoordinates","flatMap","pawnPermutationCoordinates","disabled","getCoordinateList","pointValue","pointsLeft","anyDrop","Taboo","initialDead","newDead","onlyUnique","stringifyKey","getPieceInFront","comfuterAlgorithm","createBotAlgorithm","boardAccessors","augmentBoardAccessorsFromBoard","remainingReal","remaining","coverage","hangingCache","coverageCache","pieceValueCache","getDistanceFromKing","abs","getCoverage","_boardAccessors2","defaultSideToMove","defenders","cvg","pieceC","pieceColor","cache","getPieceValue","_boardAccessors3","isTeams","controlSetting","promotionDistance","getDistanceFromPromotion","_getCoverage","isRoyal","getCoordinationEval","_boardAccessors4","firstPlayerMovesBefore","p1","p2","_boardAccessors5","next","hanging","pieceValue","_boardAccessors7","_getCoverage3","attackerValue","pc","min","attackedFromLeft","pawnDefends","threatened","h","underDefended","attackingPlayers","canRespondDirectlyToThreat","getKingSafetyEval","_boardAccessors12","kingEval","checkableEval","exposedEval","_step26","baseReferences","_iterator26","_step26$value","_step27","_iterator27","_step30","_step27$value","_iterator30","squareAccessDefinitions","isChecked","checkableSq","_step28","prev","_iterator28","accessKey","ki","kj","_i3","_x2","_step29","_iterator29","_boardSquares$_i","_boardSquares$_i2","_getCoverage5","getEval","totalEval","_boardAccessors14","isKingsideCastle","isQueensideCastle","_boardAccessors","destinations","dest","inspectCoverage","_getMaterialEval","_boardAccessors10","myMaterial","oppMaterial","pcVal","getMaterialEval","hillEval","getDistFromHill","_boardAccessors9","_board$getCheckmatesA","checksLength","barePieceRule","getMatesEval","_boardAccessors8","_board$preGeneratedAt","_board$preGeneratedAt2","blockedBy","bSqr","getMobilityEval","partner","_boardAccessors11","pinnedEval","discovsEval","discovered","pins","_step24","_royalPiece","royalX","royalY","pieceX","pieceY","_iterator24","_step25","_step24$value","attackPiece","_iterator25","_step25$value","_pins","sqrt","_i2","_discovered","getPinsEval","_boardAccessors13","targetPiece","isZombieEatZombie","fiftyMoveRule","stringifiedType","initializeBoardAccessorsFromBoard","_step31","moveValues","_iterator31","evaluations","_step32","sorted","best","_iterator32","_step32$value","evaluated","pick","random","randomlyPickNextChainedMoves","createComfuterAlgorithm","createComfuterBasedAlgorithm","comfuterCheckerAlgorithm","baseEvaluations","evaluation","_board$makeMove","comfuterMuncherAlgorithm","comfuterPusherAlgorithm","_step3$value","patzerAlgorithm","defaultBoard","RanterAlgorithm","randoBotAlgorithm","isForcedContinuation","copyOfMoves","zombieEatZombieMoves","otherMoves","startingEvaluation","createRandomBasedAlgorithm","checkerAlgorithm","muncherAlgorithm","pusherAlgorithm","_variantRule$getInsuf","noRoyalsToMate","hasPromotion","disabledRank","getRoyalPieceMedians","_this$state","royalMoveMedians","extraWalls","accumulator","median","minimumMedian","stalemateOptions","stalemateOptionsValues","obtainPieceSymbolFromCoordinate","_this$state2","optimizedPieces","pieceSquareMedians","backwardsPieceRegistry","availableSymbols","selectedSymbol","candidates","getOwnPropertySymbols","candidateIndex","getPartialIntersection","royalColor","_this$obtainPieceSymb","enemyCoordinate","resultingInsufficientPieces","royalPieceMedians","_this$state3","oppositionMedians","squaresPlayerCanOutrange","fenRoyal","currentColorBounds","royalsCannotCapture","_this$obtainPieceSymb3","medians","_pieceSquareMedians$p","subSymbol","_pieceSquareMedians$p2","sum","emptyBoard","NON_INDEXED_PIECE_SYMBOL","optimizePieceSet","initializeRoyals","possibleRoyals","royalPieceSets","recurseThroughSquares","pieceMoveRegistry","currentSquares","unvisitedSquares","baseBuilder","registryResult","Uint16Array","oneBitMask","recurse","moveLength","moveString","binaryMasks","_value$split2","parseInt","Symbol","valueArr","addToBoardDestinations","boardDestinations","getBoardDestinations","initializeBackwardsPieceRegistry","entry","uintArray","isAlwaysIntersecting","permutationArray","permutationEntry","uintArr","remappedSymbols","remappedSymbol","_this$state$backwards","_j2","_this$state$backwards2","uintValues","sym","remapped","generateOppositionSquares","royalMoves","oppositionRowEchelon","finalArray","findMinimumOnBoardSquares","generateOppositeMedians","rowEchelon","royalPieceA","royalPieceB","_loop3","i2","_loop4","_j3","_jjIndex$toString","_iiIndex$toString","j2","jjIndex","iiIndex","toString","newResultingSquares","dimSquare","bitCount","minimum","generatePieceMoveMedians","_this2","currentMessages","requiredMessages","_loop5","_loop6","registeredSymbol","pieceMedianCounter","Worker","URL","moveRegistryArray","uint","buffer","royalPieceSet","terminate","_this$generateOpposit","_e$data","resultingMedianArray","resultingSquares","royalMoveSet","countBitsOnBoard","resultingMedian","countMinimumOf2DArrayExcludingZero","counters","individualCounter","symbol","numericKey","indexingNumber","setBits","possiblePieces","maximumTarget","moveSet","_optimalRoyalMoveSets","optimalMoveSet","detractionSet","Atomic","RoyalsCannotCapture","baseCoordinates","addCoordinate","disI","disJ","coordinateI","coordinateJ","atomicCoordinates","DeadKingWalking","pointsForMate","enPassants","eligibleEnPassants","_eligibleEnPassants","enPassantCoordinate","enPassantInfo","FatalCapture","endCaptureCoordinates","_move$startCoordinate","_move$endCoordinates","returnType","fullMoves","totalFullMoves","textualForm","alivePlayers","Giveaway","StalemateOptions","capturedPiece","pointsForPiece","stalematePoints","KingOfTheHill","hillSquares","defaultCoordinates","toLowerCase","coordinatesArray","defaultRoyal","NCheck","defaultChecks","check","resultingMap","isNCheckValidated","isStandardMove","live","OppositeMultiplier","oppositeMultiplierValue","numericValue","MAXIMUM_MULTIPLIER","OppositeSideCastling","castlingDataReference","PiecesGoToBanks","captures","addPieceToBank","PlayForMate","PointsForMate","playForMate","stalemateLoses","stalemateWins","stalemateDraws","verifyCustomStalemateValue","presumedOption","_this$type","currentTurn","Takeover","detectedPieces","ThreefoldRepetition","totalRepetitions","totalRepetitionsRequired","AnyCapture","modifiedConfiguration","PromoteTo","inputPromotion","pieceNames","prefixWithIndefiniteArticle","compileEnumeration","filterPromotionPieceString","PromotionRank","formatOrdinalNumber","Sideways","Stonewall","Torpedo","minor","visual","autogenous","startingPosition","extending","widespread","pointsAlternation","phased","_regeneratorRuntime","exports","Op","hasOwn","obj","desc","$Symbol","iteratorSymbol","iterator","asyncIteratorSymbol","asyncIterator","toStringTagSymbol","toStringTag","define","wrap","innerFn","outerFn","tryLocsList","protoGenerator","Generator","generator","create","context","Context","makeInvokeMethod","tryCatch","fn","ContinueSentinel","GeneratorFunction","GeneratorFunctionPrototype","IteratorPrototype","getProto","NativeIteratorPrototype","Gp","defineIteratorMethods","_invoke","AsyncIterator","PromiseImpl","invoke","resolve","reject","record","__await","then","unwrapped","error","previousPromise","callInvokeWithMethodAndArg","doneResult","delegate","delegateResult","maybeInvokeDelegate","sent","_sent","dispatchException","abrupt","methodName","return","info","resultName","nextLoc","pushTryEntry","locs","tryLoc","catchLoc","finallyLoc","afterLoc","tryEntries","resetTryEntry","completion","iterable","iteratorMethod","displayName","isGeneratorFunction","genFun","ctor","setPrototypeOf","__proto__","awrap","async","Promise","skipTempReset","stop","rootRecord","rval","exception","handle","loc","caught","hasCatch","hasFinally","finallyEntry","complete","finish","catch","thrown","delegateYield","createBaseParsingTypes","_callee","_context","variantRulePriorities","differentiateDecoratorMethods","verifyDecorator","parseVariantRules","variantClasses","forcedRules","finalList","rulesStrings","insertVariantRule","dependencies","dependency","dependencyArgs","decorators","ruleString","forcedRule","_forcedRules","rule","unshift","compileVariantRuleData","finalObject","properties","rvs","parameterArray","variantTypeTag","variantDateTag","variantSiteTag","variantTimeControlTag","variantTerminationTag","variantGameId","createPlayerDataTag","currentValue","verifyTagInParsing","inputTag","tagNamesEqual","parseTag","newCurrentValue","unwrapTag","uniqueResultingTags","playerData","wrapTag","resultsTag","variantRulesTag","createDefaultVariantTags","variantType","tagContents","_Object$values","createFENDataTag","resultingRuleList","Date","site","increment","isDelay","_unwrapTag$match","defaultTC","_matchArray","minutesMatch","secondsMatch","delay","round","noIncrement","timeControlString","truncateNumber","gameNumber","id","GenericTags","pgn4Tags","pgn4Moves","substring","trim","parsePGN4Moves","variantTags","wasFEN4set","variantTag","nonPlayablePieceValues","defaultTags","moveTree","replace","SPLIT","PIECE_REGEX","PIECE_REGEX_SIMPLIFIED","MOVE_CAPTURING_REGEX","DUCK_MOVE_CAPTURING_REGEX","DROPPING_MOVE_CAPTURING_REGEX","BRACKETS","COMMENT_START","COMMENT_END","VARIATION_START","VARIATION_END","COORDINATE_REGEX","COMMENT_SYNTAXES","CLOCK","ARROWS","SQUARES","ANNOTATION","parseMoves","selectedMove","currentMoveData","moveList","currentPath","getMoveIndexes","parseComment","getEnumeratorIndex","findBracketIndex","depth","processMoveDataInsertion","_currentMove$comment","_currentMove$comment3","_currentMove$comment5","_currentMove$comment7","cloneMoveData","_currentMove$comment2","clockSyntax","arrowSyntax","_currentMove$comment4","arrow","numericColor","arrowCoordinates","squareSyntax","_currentMove$comment6","inputCoordinate","_currentMove$comment8","annotationMatch","obtainMoveFromInfo","internalType","obtainInternalType","promotionMatch","moveCoordinates","startCoordinate","endCoordinate","obtainStandardMove","droppingMove","_match","obtainDroppingMove","duckMove","obtainDuckMove","variationIncrement","isNumNaN","_currentMove$alternat","checkDimensionIntersection","dimensionI","dimensionJ","modifyFourBooleanParameter","part","fenDataArrayRef","booleans","predefinedFENpositions","fenDataTag","parts","verifyKeyInTags","initialParsing","replaceAll","_Object$entries","_Object$entries$_i","pieceStr","arrayDimension","baseLoop","_i4","_squares","baseBoard","serializeFENOptions","currentEmptySquares","charCodeAt","baseTag","content","definedTag","array","arr1","arr2","first","second","number","digits","multiplier","pow","adjusted","instance","customProperties","copy","lastTwoDigits","webpackContext","req","webpackContextResolve","__webpack_require__","o","code","module"],"sourceRoot":""}